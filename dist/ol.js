(function(e){function t(r){if(o[r])return o[r].exports;var i=o[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var o={};return t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(o,'a',o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=1)})([function(e,t,o){'use strict';function r(e,t){return this instanceof r?void(this._maxEntries=T(4,e||9),this._minEntries=T(2,E(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()):new r(e,t)}function n(e,t,o){if(!o)return t.indexOf(e);for(var r=0;r<t.length;r++)if(o(e,t[r]))return r;return-1}function a(e,t){s(e,0,e.children.length,t,e)}function s(e,t,o,r,n){n||(n=h(null)),n.minX=Infinity,n.minY=Infinity,n.maxX=-Infinity,n.maxY=-Infinity;for(var a=t,i;a<o;a++)i=e.children[a],l(n,e.leaf?r(i):i);return n}function l(e,t){return e.minX=f(e.minX,t.minX),e.minY=f(e.minY,t.minY),e.maxX=T(e.maxX,t.maxX),e.maxY=T(e.maxY,t.maxY),e}function i(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function g(e){return e.maxX-e.minX+(e.maxY-e.minY)}function _(e,t){return(T(t.maxX,e.maxX)-f(t.minX,e.minX))*(T(t.maxY,e.maxY)-f(t.minY,e.minY))}function u(e,t){var o=T(e.minX,t.minX),r=T(e.minY,t.minY),i=f(e.maxX,t.maxX),n=f(e.maxY,t.maxY);return T(0,i-o)*T(0,n-r)}function c(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function h(e){return{children:e,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function m(e,t,o,r,i){for(var n=[t,o],a;n.length;)o=n.pop(),t=n.pop(),o-t<=r||(a=t+E((o-t)/r/2)*r,S(e,a,t,o,i),n.push(t,a,a,o))}var f=Math.min,x=Math.log,E=Math.ceil,T=Math.max;e.exports=r,e.exports.default=r;var S=o(2);r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,o=[],r=this.toBBox;if(!y(e,t))return o;for(var n=[],a,i,s,l;t;){for(a=0,i=t.children.length;a<i;a++)s=t.children[a],l=t.leaf?r(s):s,y(e,l)&&(t.leaf?o.push(s):c(e,l)?this._all(s,o):n.push(s));t=n.pop()}return o},collides:function(e){var t=this.data,o=this.toBBox;if(!y(e,t))return!1;for(var r=[],n,i,a,s;t;){for(n=0,i=t.children.length;n<i;n++)if(a=t.children[n],s=t.leaf?o(a):a,y(e,s)){if(t.leaf||c(e,s))return!0;r.push(a)}t=r.pop()}return!1},load:function(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(var t=0,o=e.length;t<o;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=h([]),this},remove:function(e,t){if(!e)return this;for(var o=this.data,r=this.toBBox(e),a=[],s=[],l,i,d,p;o||a.length;){if(o||(o=a.pop(),i=a[a.length-1],l=s.pop(),p=!0),o.leaf&&(d=n(e,o.children,t),-1!==d))return o.children.splice(d,1),a.push(o),this._condense(a),this;p||o.leaf||!c(o,r)?i?(l++,o=i.children[l],p=!1):o=null:(a.push(o),s.push(l),l=0,i=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:i,compareMinY:d,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var o=[];e;)e.leaf?t.push.apply(t,e.children):o.push.apply(o,e.children),e=o.pop();return t},_build:function(e,t,o,r){var n=o-t+1,s=this._maxEntries,l;if(n<=s)return l=h(e.slice(t,o+1)),a(l,this.toBBox),l;r||(r=E(x(n)/x(s)),s=E(n/Math.pow(s,r-1))),l=h([]),l.leaf=!1,l.height=r;var d=E(n/s),p=d*E(Math.sqrt(s)),g,i,_,u;for(m(e,t,o,p,this.compareMinX),g=t;g<=o;g+=p)for(_=f(g+p-1,o),m(e,g,_,d,this.compareMinY),i=g;i<=_;i+=d)u=f(i+d-1,_),l.children.push(this._build(e,i,u,r-1));return a(l,this.toBBox),l},_chooseSubtree:function(e,t,o,r){for(var n,i,a,s,l,d,g,u;r.push(t),!(t.leaf||r.length-1===o);){for(g=u=Infinity,n=0,i=t.children.length;n<i;n++)a=t.children[n],l=p(a),d=_(e,a)-l,d<u?(u=d,g=l<g?l:g,s=a):d==u&&l<g&&(g=l,s=a);t=s||t.children[0]}return t},_insert:function(e,t,o){var r=this.toBBox,i=o?e:r(e),n=[],a=this._chooseSubtree(i,this.data,t,n);for(a.children.push(e),l(a,i);0<=t&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(i,n,t)},_split:function(e,t){var o=e[t],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);var n=this._chooseSplitIndex(o,i,r),s=h(o.children.splice(n,o.children.length-n));s.height=o.height,s.leaf=o.leaf,a(o,this.toBBox),a(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(o,s)},_splitRoot:function(e,t){this.data=h([e,t]),this.data.height=e.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,o){var r,i,n,a,l,d,g,_;for(d=g=Infinity,r=t;r<=o-t;r++)i=s(e,0,r,this.toBBox),n=s(e,r,o,this.toBBox),a=u(i,n),l=p(i)+p(n),a<d?(d=a,_=r,g=l<g?l:g):a===d&&l<g&&(g=l,_=r);return _},_chooseSplitAxis:function(e,t,o){var r=e.leaf?this.compareMinX:i,n=e.leaf?this.compareMinY:d,a=this._allDistMargin(e,t,o,r),s=this._allDistMargin(e,t,o,n);a<s&&e.children.sort(r)},_allDistMargin:function(e,t,o,r){e.children.sort(r);var n=this.toBBox,a=s(e,0,t,n),d=s(e,o-t,o,n),p=g(a)+g(d),_,i;for(_=t;_<o-t;_++)i=e.children[_],l(a,e.leaf?n(i):i),p+=g(a);for(_=o-t-1;_>=t;_--)i=e.children[_],l(d,e.leaf?n(i):i),p+=g(d);return p},_adjustParentBBoxes:function(e,t,o){for(var r=o;0<=r;r--)l(t[r],e)},_condense:function(e){for(var t=e.length-1,o;0<=t;t--)0===e[t].children.length?0<t?(o=e[t-1].children,o.splice(o.indexOf(e[t]),1)):this.clear():a(e[t],this.toBBox)},_initFormat:function(e){var t=['return a',' - b',';'];this.compareMinX=new Function('a','b',t.join(e[0])),this.compareMinY=new Function('a','b',t.join(e[1])),this.toBBox=new Function('a','return {minX: a'+e[0]+', minY: a'+e[1]+', maxX: a'+e[2]+', maxY: a'+e[3]+'};')}}},function(e,t,o){'use strict';function r(e,t){const o=Sd.length;for(let r=0;r<o;++r)try{const o=e.getContext(Sd[r],t);if(o)return o}catch(t){}return null}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function n(e){return e.ol_uid||(e.ol_uid=++vd)}function a(e){for(const t in e)delete e[t]}function s(e){const t=[];for(const o in e)t.push(e[o]);return t}function l(e){for(var t in e)return!1;return!t}function d(e){const t=function(t){const o=e.listener,r=e.bindTo||e.target;return e.callOnce&&h(e),o.call(r,t)};return e.boundListener=t,t}function p(e,t,o,r){let n;for(let a=0,i=e.length;a<i;++a)if(n=e[a],n.listener===t&&n.bindTo===o)return r&&(n.deleteIndex=a),n}function g(e,t){const o=e.ol_lm;return o?o[t]:void 0}function _(e){let t=e.ol_lm;return t||(t=e.ol_lm={}),t}function u(e,t){const o=g(e,t);if(o){for(let r=0,i=o.length;r<i;++r)e.removeEventListener(t,o[r].boundListener),a(o[r]);o.length=0;const r=e.ol_lm;r&&(delete r[t],0===Object.keys(r).length&&delete e.ol_lm)}}function c(e,t,o,r,i){const n=_(e);let a=n[t];a||(a=n[t]=[]);let s=p(a,o,r,!1);return s?!i&&(s.callOnce=!1):(s={bindTo:r,callOnce:!!i,listener:o,target:e,type:t},e.addEventListener(t,d(s)),a.push(s)),s}function y(e,t,o,r){return c(e,t,o,r,!0)}function m(e,t,o,r){const i=g(e,t);if(i){const e=p(i,o,r,!0);e&&h(e)}}function h(e){if(e&&e.target){e.target.removeEventListener(e.type,e.boundListener);const t=g(e.target,e.type);if(t){const o='deleteIndex'in e?e.deleteIndex:t.indexOf(e);-1!==o&&t.splice(o,1),0===t.length&&u(e.target,e.type)}a(e)}}function f(e){const t=_(e);for(const o in t)u(e,o)}function E(){return!0}function x(){return!1}function T(){}function S(e){e.stopPropagation()}function C(e){return Xd.hasOwnProperty(e)?Xd[e]:Xd[e]='change:'+e}function R(e,t){if(!e)throw new Od(t)}function I(e){const t=b();for(let o=0,r=e.length;o<r;++o)V(t,e[o]);return t}function L(e,t,o){const r=$l.apply(null,e),i=$l.apply(null,t),n=id.apply(null,e),a=id.apply(null,t);return G(r,i,n,a,o)}function P(e,t,o){return o?(o[0]=e[0]-t,o[1]=e[1]-t,o[2]=e[2]+t,o[3]=e[3]+t,o):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function v(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function F(e,t,o){let r,i;return r=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0,i=o<e[1]?e[1]-o:e[3]<o?o-e[3]:0,r*r+i*i}function O(e,t){return N(e,t[0],t[1])}function w(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function N(e,t,o){return e[0]<=t&&t<=e[2]&&e[1]<=o&&o<=e[3]}function A(e,t){const o=e[0],r=e[1],i=e[2],n=e[3],a=t[0],s=t[1];let l=Qd.UNKNOWN;return a<o?l|=Qd.LEFT:a>i&&(l|=Qd.RIGHT),s<r?l|=Qd.BELOW:s>n&&(l|=Qd.ABOVE),l===Qd.UNKNOWN&&(l=Qd.INTERSECTING),l}function b(){return[Infinity,Infinity,-Infinity,-Infinity]}function G(e,t,o,r,i){return i?(i[0]=e,i[1]=t,i[2]=o,i[3]=r,i):[e,t,o,r]}function D(e){return G(Infinity,Infinity,-Infinity,-Infinity,e)}function k(e,t){const o=e[0],r=e[1];return G(o,r,o,r,t)}function U(e,t){const o=D(t);return z(o,e)}function Y(e,t,o,r,i){const n=D(i);return X(n,e,t,o,r)}function j(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function B(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function V(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function z(e,t){for(let o=0,r=t.length;o<r;++o)V(e,t[o]);return e}function X(e,t,o,r,i){for(;o<r;o+=i)W(e,t[o],t[o+1]);return e}function W(e,t,o){e[0]=$l(e[0],t),e[1]=$l(e[1],o),e[2]=id(e[2],t),e[3]=id(e[3],o)}function K(e,t,o){let r;return(r=t.call(o,q(e)),r)?r:(r=t.call(o,J(e)),r)?r:(r=t.call(o,ie(e)),r)?r:(r=t.call(o,re(e)),!!r&&r)}function H(e){let t=0;return se(e)||(t=ne(e)*te(e)),t}function q(e){return[e[0],e[1]]}function J(e){return[e[2],e[1]]}function Q(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function $(e,t){let o;return t===Jd.BOTTOM_LEFT?o=q(e):t===Jd.BOTTOM_RIGHT?o=J(e):t===Jd.TOP_LEFT?o=re(e):t===Jd.TOP_RIGHT?o=ie(e):R(!1,13),o}function ee(e,t,o,r,i){const n=t*r[0]/2,a=t*r[1]/2,s=Ql(o),l=Jl(o),d=n*s,p=n*l,g=a*s,_=a*l,u=e[0],c=e[1],y=u-d+_,m=u-d-_,h=u+d-_,f=u+d+_,x=c-p-g,E=c-p+g,T=c+p+g,S=c+p-g;return G($l(y,m,h,f),$l(x,E,T,S),id(y,m,h,f),id(x,E,T,S),i)}function te(e){return e[3]-e[1]}function oe(e,t,o){const r=o?o:b();return ae(e,t)?(r[0]=e[0]>t[0]?e[0]:t[0],r[1]=e[1]>t[1]?e[1]:t[1],r[2]=e[2]<t[2]?e[2]:t[2],r[3]=e[3]<t[3]?e[3]:t[3]):D(r),r}function re(e){return[e[0],e[3]]}function ie(e){return[e[2],e[3]]}function ne(e){return e[2]-e[0]}function ae(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function se(){return!1}function le(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function de(e,t){const o=(e[2]-e[0])/2*(t-1),r=(e[3]-e[1])/2*(t-1);e[0]-=o,e[2]+=o,e[1]-=r,e[3]+=r}function pe(e,t,o){let r=!1;const i=A(e,t),n=A(e,o);if(i===Qd.INTERSECTING||n===Qd.INTERSECTING)r=!0;else{const a=e[0],s=e[1],l=e[2],d=e[3],p=t[0],g=t[1],_=o[0],u=o[1],c=(u-g)/(_-p);let m,h;!(n&Qd.ABOVE)||i&Qd.ABOVE||(m=_-(u-d)/c,r=m>=a&&m<=l),r||!(n&Qd.RIGHT)||i&Qd.RIGHT||(h=u-(_-l)*c,r=h>=s&&h<=d),r||!(n&Qd.BELOW)||i&Qd.BELOW||(m=_-(u-s)/c,r=m>=a&&m<=l),r||!(n&Qd.LEFT)||i&Qd.LEFT||(h=u-(_-a)*c,r=h>=s&&h<=d)}return r}function ge(e,t,o){const r=[e[0],e[1],e[0],e[3],e[2],e[1],e[2],e[3]];t(r,r,2);const i=[r[0],r[2],r[4],r[6]],n=[r[1],r[3],r[5],r[7]];return L(i,n,o)}function _e(e,t,o,r,n,a){const s=a?a:[];let l=0;for(let i=t;i<o;i+=r){const t=e[i],o=e[i+1];s[l++]=n[0]*t+n[2]*o+n[4],s[l++]=n[1]*t+n[3]*o+n[5]}return a&&s.length!=l&&(s.length=l),s}function ue(e,t,o,r,n,a,s){const l=s?s:[],d=Ql(n),p=Jl(n),g=a[0],_=a[1];let u=0;for(let i=t;i<o;i+=r){const t=e[i]-g,o=e[i+1]-_;l[u++]=g+t*d-o*p,l[u++]=_+t*p+o*d;for(let t=i+2;t<i+r;++t)l[u++]=e[t]}return s&&l.length!=u&&(l.length=u),l}function ce(e,t,o,r,n,a,s,l){const d=l?l:[],p=s[0],g=s[1];let _=0;for(let i=t;i<o;i+=r){const t=e[i]-p,o=e[i+1]-g;d[_++]=p+n*t,d[_++]=g+a*o;for(let t=i+2;t<i+r;++t)d[_++]=e[t]}return l&&d.length!=_&&(d.length=_),d}function ye(e,t,o,r,n,a,s){const l=s?s:[];let d=0;for(let i=t;i<o;i+=r){l[d++]=e[i]+n,l[d++]=e[i+1]+a;for(let t=i+2;t<i+r;++t)l[d++]=e[t]}return s&&l.length!=d&&(l.length=d),l}function me(e,t,o){return $l(id(e,t),o)}function he(e){return R(0<e,29),td(2,rd(od(e)/Zl))}function fe(e,o,r,i,n,a){const s=n-r,l=a-i;if(0!=s||0!=l){const d=((e-r)*s+(o-i)*l)/(s*s+l*l);1<d?(r=n,i=a):0<d&&(r+=s*d,i+=l*d)}return xe(e,o,r,i)}function xe(e,t,o,r){const i=o-e,n=r-t;return i*i+n*n}function Ee(e){const t=e.length;for(let o=0;o<t;o++){let i=o,n=Hl(e[o][o]);for(let a=o+1;a<t;a++){const t=Hl(e[a][o]);t>n&&(n=t,i=a)}if(0===n)return null;const r=e[i];e[i]=e[o],e[o]=r;for(let r=o+1;r<t;r++){const i=-e[r][o]/e[o][o];for(let n=o;n<t+1;n++)o==n?e[r][n]=0:e[r][n]+=i*e[o][n]}}const o=Array(t);for(let r=t-1;0<=r;r--){o[r]=e[r][t]/e[r][r];for(let i=r-1;0<=i;i--)e[i][t]-=e[i][r]*o[r]}return o}function Te(e){return 180*e/Kl}function Se(e){return e*Kl/180}function Ce(e,t){const o=e%t;return 0>o*t?o+t:o}function Re(e,t,o){return e+o*(t-e)}function Ie(e,t,o){const r=Se(e[1]),i=Se(t[1]),n=(i-r)/2,s=Se(t[0]-e[0])/2,l=Jl(n)*Jl(n)+Jl(s)*Jl(s)*Ql(r)*Ql(i);return 2*(o||tp)*Wl(ed(l),ed(1-l))}function Le(e,t){let o=0;for(let r=0,i=e.length;r<i-1;++r)o+=Ie(e[r],e[r+1],t);return o}function Pe(e,t){const o=t||{},r=o.radius||tp,n=o.projection||'EPSG:3857',a=e.getType();a!==ep.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,'EPSG:4326'));let s=0,l,d,p,i,g,_;switch(a){case ep.POINT:case ep.MULTI_POINT:break;case ep.LINE_STRING:case ep.LINEAR_RING:{l=e.getCoordinates(),s=Le(l,r);break}case ep.MULTI_LINE_STRING:case ep.POLYGON:{for(l=e.getCoordinates(),p=0,i=l.length;p<i;++p)s+=Le(l[p],r);break}case ep.MULTI_POLYGON:{for(l=e.getCoordinates(),p=0,i=l.length;p<i;++p)for(d=l[p],g=0,_=d.length;g<_;++g)s+=Le(d[g],r);break}case ep.GEOMETRY_COLLECTION:{const o=e.getGeometries();for(p=0,i=o.length;p<i;++p)s+=Pe(o[p],t);break}default:throw new Error('Unsupported geometry type: '+a);}return s}function ve(e,t){let o=0;const r=e.length;let n=e[r-1][0],a=e[r-1][1];for(let s=0;s<r;s++){const t=e[s][0],r=e[s][1];o+=Se(t-n)*(2+Jl(Se(a))+Jl(Se(r))),n=t,a=r}return o*t*t/2}function Fe(e,t){const o=t||{},r=o.radius||tp,n=o.projection||'EPSG:3857',a=e.getType();a!==ep.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,'EPSG:4326'));let s=0,l,d,p,i,g,_;switch(a){case ep.POINT:case ep.MULTI_POINT:case ep.LINE_STRING:case ep.MULTI_LINE_STRING:case ep.LINEAR_RING:break;case ep.POLYGON:{for(l=e.getCoordinates(),s=Hl(ve(l[0],r)),(p=1,i=l.length);p<i;++p)s-=Hl(ve(l[p],r));break}case ep.MULTI_POLYGON:{for(l=e.getCoordinates(),p=0,i=l.length;p<i;++p)for(d=l[p],s+=Hl(ve(d[0],r)),(g=1,_=d.length);g<_;++g)s-=Hl(ve(d[g],r));break}case ep.GEOMETRY_COLLECTION:{const o=e.getGeometries();for(p=0,i=o.length;p<i;++p)s+=Fe(o[p],t);break}default:throw new Error('Unsupported geometry type: '+a);}return s}function Oe(e,t,o,r){const i=Se(e[1]),n=Se(e[0]),a=t/(r||tp),s=Xl(Jl(i)*Ql(a)+Ql(i)*Jl(a)*Ql(o)),l=n+Wl(Jl(o)*Jl(a)*Ql(i),Ql(a)-Jl(i)*Jl(s));return[Te(l),Te(s)]}function we(e){ap.call(this,{code:e,units:ip.METERS,extent:dp,global:!0,worldExtent:pp,getPointResolution:function(e,t){return e/$d(t[1]/sp)}})}function Ne(e,t,o){const r=e.length,n=1<o?o:2;let a=t;a===void 0&&(2<n?a=e.slice():a=Array(r));const s=lp;for(let l=0;l<r;l+=n){a[l]=s*e[l]/180;let t=sp*od(Math.tan(Kl*(e[l+1]+90)/360));t>s?t=s:t<-s&&(t=-s),a[l+1]=t}return a}function Ae(e,t,o){const r=e.length,n=1<o?o:2;let a=t;a===void 0&&(2<n?a=e.slice():a=Array(r));for(let s=0;s<r;s+=n)a[s]=180*e[s]/lp,a[s+1]=360*zl(ql(e[s+1]/sp))/Kl-90;return a}function be(e,t){ap.call(this,{code:e,units:ip.DEGREES,extent:_p,axisOrientation:t,global:!0,metersPerUnit:up,worldExtent:_p})}function Me(e){return yp[e]||null}function Ge(e,t){yp[e]=t}function De(e,t,o){const r=e.getCode(),i=t.getCode();r in mp||(mp[r]={}),mp[r][i]=o}function ke(e,t){let o;return e in mp&&t in mp[e]&&(o=mp[e][t]),o}function Ue(e,t){let o;if(t!==void 0){for(let o=0,r=e.length;o<r;++o)t[o]=e[o];o=t}else o=e.slice();return o}function Ye(e,t){if(t!==void 0&&e!==t){for(let o=0,r=e.length;o<r;++o)t[o]=e[o];e=t}return e}function je(e){Ge(e.getCode(),e),De(e,e,Ue)}function Be(e){e.forEach(je)}function Ve(e){let t=null;if(e instanceof ap)t=e;else if('string'==typeof e){t=Me(e)}return t}function ze(e,t,o,r){e=Ve(e);let i;const n=e.getPointResolutionFunc();if(n)i=n(t,o);else{const n=e.getUnits();if(n==ip.DEGREES&&!r||r==ip.DEGREES)i=t;else{const n=Je(e,Ve('EPSG:4326'));let a=[o[0]-t/2,o[1],o[0]+t/2,o[1],o[0],o[1]-t/2,o[0],o[1]+t/2];a=n(a,a,2);const s=Ie(a.slice(0,2),a.slice(2,4)),l=Ie(a.slice(4,6),a.slice(6,8));i=(s+l)/2;const d=r?rp[r]:e.getMetersPerUnit();d!==void 0&&(i/=d)}}return i}function Xe(e){Be(e),e.forEach(function(t){e.forEach(function(e){t!==e&&De(t,e,Ue)})})}function We(e,t,o,r){e.forEach(function(e){t.forEach(function(t){De(e,t,o),De(t,e,r)})})}function Ke(e,t){return e?'string'==typeof e?Ve(e):e:Ve(t)}function He(e){return function(t,o,r){const n=t.length,a=r===void 0?2:r,s=o===void 0?Array(n):o;for(let l=0;l<n;l+=a){const o=e([t[l],t[l+1]]);s[l]=o[0],s[l+1]=o[1];for(let e=a-1;2<=e;--e)s[l+e]=t[l+e]}return s}}function Ze(e,t,o,r){const i=Ve(e),n=Ve(t);De(i,n,He(o)),De(n,i,He(r))}function qe(e,t){if(e===t)return!0;const o=e.getUnits()===t.getUnits();if(e.getCode()===t.getCode())return o;else{const r=Je(e,t);return r===Ue&&o}}function Je(e,t){const o=e.getCode(),r=t.getCode();let i=ke(o,r);return i||(i=Ye),i}function Qe(e,t){const o=Ve(e),r=Ve(t);return Je(o,r)}function $e(e,t,o){const r=Qe(t,o);return r(e,void 0,e.length)}function et(e,t,o){const r=Qe(t,o);return ge(e,r)}function tt(){return[1,0,0,1,0,0]}function ot(e){return it(e,1,0,0,1,0,0)}function rt(e,t){const o=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],l=t[0],d=t[1],p=t[2],g=t[3],_=t[4],u=t[5];return e[0]=o*l+i*d,e[1]=r*l+n*d,e[2]=o*p+i*g,e[3]=r*p+n*g,e[4]=o*_+i*u+a,e[5]=r*_+n*u+s,e}function it(t,o,r,i,n,a,e){return t[0]=o,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=e,t}function nt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function at(e,t){const o=t[0],r=t[1];return t[0]=e[0]*o+e[2]*r+e[4],t[1]=e[1]*o+e[3]*r+e[5],t}function st(e,t){const o=Ql(t),r=Jl(t);return rt(e,it(hp,o,r,-r,o,0,0))}function lt(e,t,o){return rt(e,it(hp,t,0,0,o,0,0))}function dt(e,t,o){return rt(e,it(hp,1,0,0,1,t,o))}function pt(e,t,o,r,i,n,a,s){const l=Jl(n),d=Ql(n);return e[0]=r*d,e[1]=i*l,e[2]=-r*l,e[3]=i*d,e[4]=a*r*d-s*r*l+t,e[5]=a*i*l+s*i*d+o,e}function gt(t){const o=_t(t);R(0!==o,32);const r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],e=t[5];return t[0]=a/o,t[1]=-i/o,t[2]=-n/o,t[3]=r/o,t[4]=(n*e-a*s)/o,t[5]=-(r*e-i*s)/o,t}function _t(e){return e[0]*e[3]-e[1]*e[2]}function ut(e){return'string'==typeof e?e:ft(e)}function ct(e){const t=document.createElement('div');if(t.style.color=e,''!==t.style.color){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}return''}function yt(e){return Array.isArray(e)?e:Cp(e)}function mt(e){let t,o,r,i,a;if(Sp.exec(e)&&(e=ct(e)),Tp.exec(e)){const s=e.length-1;let n=4>=s?1:2;const l=4==s||8==s;t=parseInt(e.substr(1+0*n,n),16),o=parseInt(e.substr(1+1*n,n),16),r=parseInt(e.substr(1+2*n,n),16),i=l?parseInt(e.substr(1+3*n,n),16):255,1==n&&(t=(t<<4)+t,o=(o<<4)+o,r=(r<<4)+r,l&&(i=(i<<4)+i)),a=[t,o,r,i/255]}else 0==e.indexOf('rgba(')?(a=e.slice(5,-1).split(',').map(Number),ht(a)):0==e.indexOf('rgb(')?(a=e.slice(4,-1).split(',').map(Number),a.push(1),ht(a)):R(!1,14);return a}function ht(e){return e[0]=me(0|e[0]+.5,0,255),e[1]=me(0|e[1]+.5,0,255),e[2]=me(0|e[2]+.5,0,255),e[3]=me(e[3],0,1),e}function ft(e){let t=e[0];t!=(0|t)&&(t=0|t+.5);let o=e[1];o!=(0|o)&&(o=0|o+.5);let r=e[2];r!=(0|r)&&(r=0|r+.5);const i=e[3]===void 0?1:e[3];return'rgba('+t+','+o+','+r+','+i+')'}function xt(e){return Et(e)?e:ft(e)}function Et(e){return'string'==typeof e||e instanceof CanvasPattern||e instanceof CanvasGradient}function Tt(e,t){const o=document.createElement('CANVAS');return e&&(o.width=e),t&&(o.height=t),o.getContext('2d')}function St(e){let t=e.offsetWidth;const o=getComputedStyle(e);return t+=parseInt(o.marginLeft,10)+parseInt(o.marginRight,10),t}function Ct(e){let t=e.offsetHeight;const o=getComputedStyle(e);return t+=parseInt(o.marginTop,10)+parseInt(o.marginBottom,10),t}function Rt(e,t){const o=t.parentNode;o&&o.replaceChild(e,t)}function It(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function Lt(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function Pt(){return ig||(ig=Tt(1,1)),ig}function vt(e,t){const o=Pt();return e!=o.font&&(o.font=e),o.measureText(t).width}function Ft(e,t,o,r){0!==t&&(e.translate(o,r),e.rotate(t),e.translate(-o,-r))}function Ot(e,t,o,r,i,n,a,s,l,d,p){let g;1!=o&&(g=e.globalAlpha,e.globalAlpha=g*o),t&&e.setTransform.apply(e,t),e.drawImage(r,i,n,a,s,l,d,a*p,s*p),g&&(e.globalAlpha=g),t&&e.setTransform.apply(e,lg)}function wt(e){let t;if('function'==typeof e)t=e;else{let o;Array.isArray(e)?o=e:(R(e instanceof xg,41),o=[e]),t=function(){return o}}return t}function Nt(){if(!Eg){const e=new mg({color:'rgba(255,255,255,0.4)'}),t=new fg({color:'#3399CC',width:1.25});Eg=[new xg({image:new cg({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}return Eg}function At(){const e={},t=[255,255,255,1],o=[0,153,255,1],r=3;return e[ep.POLYGON]=[new xg({fill:new mg({color:[255,255,255,.5]})})],e[ep.MULTI_POLYGON]=e[ep.POLYGON],e[ep.LINE_STRING]=[new xg({stroke:new fg({color:t,width:r+2})}),new xg({stroke:new fg({color:o,width:r})})],e[ep.MULTI_LINE_STRING]=e[ep.LINE_STRING],e[ep.CIRCLE]=e[ep.POLYGON].concat(e[ep.LINE_STRING]),e[ep.POINT]=[new xg({image:new cg({radius:2*r,fill:new mg({color:o}),stroke:new fg({color:t,width:r/2})}),zIndex:Infinity})],e[ep.MULTI_POINT]=e[ep.POINT],e[ep.GEOMETRY_COLLECTION]=e[ep.POLYGON].concat(e[ep.LINE_STRING],e[ep.POINT]),e}function bt(e){return e.getGeometry()}function Mt(e){if('function'==typeof e)return e;else{let t;return Array.isArray(e)?t=e:(R(e instanceof Tg,41),t=[e]),function(){return t}}}function Gt(e,t,o){let r,i;let n=0,a=e.length,s=!1;for(;n<a;)r=n+(a-n>>1),i=+(o||Dt)(e[r],t),0>i?n=r+1:(a=r,s=!i);return s?n:~n}function Dt(e,t){return e>t?1:e<t?-1:0}function kt(e,t){return 0<=e.indexOf(t)}function Ut(e,t,o){const r=e.length;if(e[0]<=t)return 0;if(t<=e[r-1])return r-1;else{let n;if(0<o){for(n=1;n<r;++n)if(e[n]<t)return n-1;}else if(0>o){for(n=1;n<r;++n)if(e[n]<=t)return n;}else for(n=1;n<r;++n){if(e[n]==t)return n;if(e[n]<t)return e[n-1]-t<t-e[n]?n-1:n}return r-1}}function Yt(e,t,o){for(;t<o;){const r=e[t];e[t]=e[o],e[o]=r,++t,--o}}function jt(e,t){const o=Array.isArray(t)?t:[t],r=o.length;for(let n=0;n<r;n++)e[e.length]=o[n]}function Bt(e,t){const o=e.indexOf(t),r=-1<o;return r&&e.splice(o,1),r}function Vt(e,t){const o=e.length>>>0;let r;for(let n=0;n<o;n++)if(r=e[n],t(r,n,e))return r;return null}function zt(e,t){const o=e.length;if(o!==t.length)return!1;for(let r=0;r<o;r++)if(e[r]!==t[r])return!1;return!0}function Xt(e,t){const o=e.length,r=Array(e.length);let n;for(n=0;n<o;n++)r[n]={index:n,value:e[n]};for(r.sort(function(e,o){return t(e.value,o.value)||e.index-o.index}),n=0;n<e.length;n++)e[n]=r[n].value}function Wt(e,t){let o;const r=!e.every(function(r,i){return o=i,!t(r,i,e)});return r?o:-1}function Kt(e,t,o){return e.every(function(r,i){if(0===i)return!0;const n=(t||Dt)(e[i-1],r);return!(0<n||o&&0===n)})}function Ht(e){let t;return 2==e?t=Ig.XY:3==e?t=Ig.XYZ:4==e&&(t=Ig.XYZM),t}function Zt(e){let t;return e==Ig.XY?t=2:e==Ig.XYZ||e==Ig.XYM?t=3:e==Ig.XYZM&&(t=4),t}function qt(e,t,o){const r=e.getFlatCoordinates();if(!r)return null;else{const i=e.getStride();return _e(r,0,r.length,i,t,o)}}function Jt(e,t,o,r){let i=0,n=e[o-r],a=e[o-r+1];for(;t<o;t+=r){const o=e[t],r=e[t+1];i+=a*o-n*r,n=o,a=r}return i/2}function Qt(e,t,o,r){let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a];n+=Jt(e,t,i,r),t=i}return n}function $t(e,t,o,r){let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a];n+=Qt(e,t,i,r),t=i[i.length-1]}return n}function eo(e,o,r,n,i,a,s){const l=e[o],d=e[o+1],p=e[r]-l,g=e[r+1]-d;let _;if(0==p&&0==g)_=o;else{const u=((i-l)*p+(a-d)*g)/(p*p+g*g);if(1<u)_=r;else{if(0<u){for(let t=0;t<n;++t)s[t]=Re(e[o+t],e[r+t],u);return void(s.length=n)}_=o}}for(let t=0;t<n;++t)s[t]=e[_+t];s.length=n}function to(e,t,o,r,i){let n=e[t],a=e[t+1];for(t+=r;t<o;t+=r){const o=e[t],r=e[t+1],s=xe(n,a,o,r);s>i&&(i=s),n=o,a=r}return i}function oo(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a];n=to(e,t,i,r,n),t=i}return n}function ro(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a];n=oo(e,t,i,r,n),t=i[i.length-1]}return n}function io(e,t,o,r,n,a,s,l,d,p,g){if(t==o)return p;let _,i;if(0===n){if(i=xe(s,l,e[t],e[t+1]),i<p){for(_=0;_<r;++_)d[_]=e[t+_];return d.length=r,i}return p}const u=g?g:[NaN,NaN];for(let c=t+r;c<o;)if(eo(e,c-r,c,r,s,l,u),i=xe(s,l,u[0],u[1]),i<p){for(p=i,_=0;_<r;++_)d[_]=u[_];d.length=r,c+=r}else c+=r*id(0|(ed(i)-ed(p))/n,1);if(a&&(eo(e,o-r,t,r,s,l,u),i=xe(s,l,u[0],u[1]),i<p)){for(p=i,_=0;_<r;++_)d[_]=u[_];d.length=r}return p}function no(e,t,o,r,n,a,s,l,d,p,i){const g=i?i:[NaN,NaN];for(let _=0,u=o.length;_<u;++_){const i=o[_];p=io(e,t,i,r,n,a,s,l,d,p,g),t=i}return p}function ao(e,t,o,r,n,a,s,l,d,p,i){const g=i?i:[NaN,NaN];for(let _=0,u=o.length;_<u;++_){const i=o[_];p=no(e,t,i,r,n,a,s,l,d,p,g),t=i[i.length-1]}return p}function so(e,t,o){for(let r=0,i=o.length;r<i;++r)e[t++]=o[r];return t}function lo(e,t,o,r){for(let n=0,i=o.length;n<i;++n){const i=o[n];for(let o=0;o<r;++o)e[t++]=i[o]}return t}function po(e,t,o,r,n){const a=n?n:[];let s=0;for(let i=0,l=o.length;i<l;++i){const n=lo(e,t,o[i],r);a[s++]=n,t=n}return a.length=s,a}function go(e,t,o,r,n){const a=n?n:[];let s=0;for(let i=0,l=o.length;i<l;++i){const n=po(e,t,o[i],r,a[s]);a[s++]=n,t=n[n.length-1]}return a.length=s,a}function _o(e,t,o,r,n){const a=void 0===n?[]:n;let s=0;for(let i=t;i<o;i+=r)a[s++]=e.slice(i,i+r);return a.length=s,a}function uo(e,t,o,r,n){const a=void 0===n?[]:n;let s=0;for(let i=0,l=o.length;i<l;++i){const n=o[i];a[s++]=_o(e,t,n,r,a[s]),t=n}return a.length=s,a}function co(e,t,o,r,n){const a=void 0===n?[]:n;let s=0;for(let i=0,l=o.length;i<l;++i){const n=o[i];a[s++]=uo(e,t,n,r,a[s]),t=n[n.length-1]}return a.length=s,a}function yo(e,t,o,r,i,a,s){const l=(o-t)/r;if(3>l){for(;t<o;t+=r)a[s++]=e[t],a[s++]=e[t+1];return s}const n=Array(l);n[0]=1,n[l-1]=1;const d=[t,o-r];for(let l=0;0<d.length;){const o=d.pop(),a=d.pop();let s=0;const p=e[a],g=e[a+1],_=e[o],u=e[o+1];for(let t=a+r;t<o;t+=r){const o=e[t],r=e[t+1],i=fe(o,r,p,g,_,u);i>s&&(l=t,s=i)}s>i&&(n[(l-t)/r]=1,a+r<l&&d.push(a,l),l+r<o&&d.push(l,o))}for(let d=0;d<l;++d)n[d]&&(a[s++]=e[t+d*r],a[s++]=e[t+d*r+1]);return s}function mo(e,t,o,r,n,a,s,l){for(let d=0,i=o.length;d<i;++d){const i=o[d];s=yo(e,t,i,r,n,a,s),l.push(s),t=i}return s}function ho(e,t){return t*Vl(e/t)}function fo(e,t,o,r,i,n,a){if(t==o)return a;let s=ho(e[t],i),l=ho(e[t+1],i);t+=r,n[a++]=s,n[a++]=l;let d,p;do if(d=ho(e[t],i),p=ho(e[t+1],i),t+=r,t==o)return n[a++]=d,n[a++]=p,a;while(d==s&&p==l);for(;t<o;){const o=ho(e[t],i),g=ho(e[t+1],i);if(t+=r,o==d&&g==p)continue;const _=d-s,u=p-l,c=o-s,y=g-l;if(_*y==u*c&&(0>_&&c<_||_==c||0<_&&c>_)&&(0>u&&y<u||u==y||0<u&&y>u)){d=o,p=g;continue}n[a++]=d,n[a++]=p,s=d,l=p,d=o,p=g}return n[a++]=d,n[a++]=p,a}function xo(e,t,o,r,n,a,s,l){for(let d=0,i=o.length;d<i;++d){const i=o[d];s=fo(e,t,i,r,n,a,s),l.push(s),t=i}return s}function Eo(e,t,o,r,n,a,s,l){for(let d=0,i=o.length;d<i;++d){const i=o[d],p=[];s=xo(e,t,i,r,n,a,s,p),l.push(p),t=i[i.length-1]}return s}function To(e,t,o,r,i){const n=K(i,function(i){return!So(e,t,o,r,i[0],i[1])});return!n}function So(e,t,o,r,i,n){let a=0,s=e[o-r],l=e[o-r+1];for(;t<o;t+=r){const o=e[t],r=e[t+1];l<=n?r>n&&0<(o-s)*(n-l)-(i-s)*(r-l)&&a++:r<=n&&0>(o-s)*(n-l)-(i-s)*(r-l)&&a--,s=o,l=r}return 0!=a}function Co(e,t,o,r,n,a){if(0===o.length)return!1;if(!So(e,t,o[0],r,n,a))return!1;for(let s=1,i=o.length;s<i;++s)if(So(e,o[s-1],o[s],r,n,a))return!1;return!0}function Ro(e,t,o,r,n,a){if(0===o.length)return!1;for(let s=0,i=o.length;s<i;++s){const i=o[s];if(Co(e,t,i,r,n,a))return!0;t=i[i.length-1]}return!1}function Io(e,t,o,r,n,a,s){let l,i,d,p,g,_,u;const c=n[a+1],y=[];for(let i=0,m=o.length;i<m;++i){const n=o[i];for(p=e[n-r],_=e[n-r+1],l=t;l<n;l+=r)g=e[l],u=e[l+1],(c<=_&&u<=c||_<=c&&c<=u)&&(d=(c-_)/(u-_)*(g-p)+p,y.push(d)),p=g,_=u}let m=NaN,h=-Infinity;for(y.sort(Dt),p=y[0],(l=1,i=y.length);l<i;++l){g=y[l];const i=Hl(g-p);i>h&&(d=(p+g)/2,Co(e,t,o,r,d,c)&&(m=d,h=i)),p=g}return isNaN(m)&&(m=n[a]),s?(s.push(m,c,h),s):[m,c,h]}function Lo(e,t,o,r,n){let a=[];for(let s=0,i=o.length;s<i;++s){const i=o[s];a=Io(e,t,i,r,n,2*s,a),t=i[i.length-1]}return a}function Po(e,t,o,r,i,n){const a=[e[t],e[t+1]],s=[];for(let l;t+r<o;t+=r){if(s[0]=e[t+r],s[1]=e[t+r+1],l=i.call(n,a,s),l)return l;a[0]=s[0],a[1]=s[1]}return!1}function vo(e,t,o,r,i){const n=X(b(),e,t,o,r);return!!ae(i,n)&&(!!w(i,n)||!!(n[0]>=i[0]&&n[2]<=i[2])||!!(n[1]>=i[1]&&n[3]<=i[3])||Po(e,t,o,r,function(e,t){return pe(i,e,t)}))}function Fo(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){if(vo(e,t,o[a],r,n))return!0;t=o[a]}return!1}function Oo(e,t,o,r,i){return!!vo(e,t,o,r,i)||!!So(e,t,o,r,i[0],i[1])||!!So(e,t,o,r,i[0],i[3])||!!So(e,t,o,r,i[2],i[1])||!!So(e,t,o,r,i[2],i[3])}function wo(e,t,o,r,n){if(!Oo(e,t,o[0],r,n))return!1;if(1===o.length)return!0;for(let a=1,i=o.length;a<i;++a)if(To(e,o[a-1],o[a],r,n))return!1;return!0}function No(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a];if(wo(e,t,i,r,n))return!0;t=i[i.length-1]}return!1}function Ao(e,t,o,r){for(;t<o-r;){for(let n=0;n<r;++n){const i=e[t+n];e[t+n]=e[o-r+n],e[o-r+n]=i}t+=r,o-=r}}function bo(e,t,o,r){let i=0,n=e[o-r],a=e[o-r+1];for(;t<o;t+=r){const o=e[t],r=e[t+1];i+=(o-n)*(r+a),n=o,a=r}return 0<i}function Mo(e,t,o,r,i){const n=i!==void 0&&i;for(let a=0,s=o.length;a<s;++a){const i=o[a],s=bo(e,t,i,r);if(0===a){if(n&&s||!n&&!s)return!1;}else if(n&&!s||!n&&s)return!1;t=i}return!0}function Go(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a)if(!Mo(e,t,o[a],r,n))return!1;return!0}function Do(e,t,o,r,i){const n=i!==void 0&&i;for(let a=0,s=o.length;a<s;++a){const i=o[a],s=bo(e,t,i,r),l=0===a?n&&s||!n&&!s:n&&!s||!n&&s;l&&Ao(e,t,i,r),t=i}return t}function ko(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a)t=Do(e,t,o[a],r,n);return t}function Uo(e,t,o,r){const a=o?o:32,n=[];for(let s=0;s<a;++s)jt(n,Oe(e,t,2*Kl*s/a,r));n.push(n[0],n[1]);const i=new Ng(null);return i.setFlatCoordinates(Ig.XY,n,[n.length]),i}function Yo(e){const t=e[0],o=e[1],r=e[2],i=e[3],n=[t,o,t,i,r,i,r,o,t,o],a=new Ng(null);return a.setFlatCoordinates(Ig.XY,n,[n.length]),a}function jo(e,t,o){const r=t?t:32,i=e.getStride(),n=e.getLayout(),a=new Ng(null,n),s=i*(r+1),l=Array(s);for(let r=0;r<s;r++)l[r]=0;const d=[l.length];return a.setFlatCoordinates(n,l,d),Bo(a,e.getCenter(),e.getRadius(),o),a}function Bo(e,t,o,r){const n=e.getFlatCoordinates(),i=e.getLayout(),a=e.getStride(),s=e.getEnds(),l=n.length/a-1,d=r?r:0;for(let s=0;s<=l;++s){const e=s*a,r=d+2*Ce(s,l)*Kl/l;n[e]=t[0]+o*Ql(r),n[e+1]=t[1]+o*Jl(r)}e.setFlatCoordinates(i,n,s)}function Vo(e,t,o){const r=void 0===o?''+e:e.toFixed(o);let i=r.indexOf('.');return i=-1===i?r.length:i,i>t?r:Array(1+t-i).join('0')+r}function zo(e,t){const o=(''+e).split('.'),r=(''+t).split('.');for(let n=0;n<id(o.length,r.length);n++){const e=parseInt(o[n]||'0',10),t=parseInt(r[n]||'0',10);if(e>t)return 1;if(t>e)return-1}return 0}function Xo(e,t){return e[0]+=t[0],e[1]+=t[1],e}function Wo(e,t){const o=t.getRadius(),r=t.getCenter(),i=r[0],n=r[1],a=e[0],s=e[1];let l=a-i;const p=s-n;0==l&&0==p&&(l=1);const g=ed(l*l+p*p),d=i+o*l/g;return[d,n+o*p/g]}function Ko(e,t){const o=e[0],r=e[1],i=t[0],n=t[1],a=i[0],s=i[1],l=n[0],d=n[1],p=l-a,g=d-s,_=0===p&&0===g?0:(p*(o-a)+g*(r-s))/(p*p+g*g||0);let u,c;return 0>=_?(u=a,c=s):1<=_?(u=l,c=d):(u=a+_*p,c=s+_*g),[u,c]}function Ho(e,t,o){const r=Ce(t+180,360)-180,i=Hl(3600*r),n=o||0,a=td(10,n);let s=Bl(i/3600),l=Bl((i-3600*s)/60),d=i-3600*s-60*l;return d=rd(d*a)/a,60<=d&&(d=0,l+=1),60<=l&&(l=0,s+=1),s+'\xB0 '+Vo(l,2)+'\u2032 '+Vo(d,2,n)+'\u2033'+(0==r?'':' '+e.charAt(0>r?1:0))}function Zo(e,t,o){return e?t.replace('{x}',e[0].toFixed(o)).replace('{y}',e[1].toFixed(o)):''}function qo(e,t){let o=!0;for(let r=e.length-1;0<=r;--r)if(e[r]!=t[r]){o=!1;break}return o}function Jo(e,t){const o=Ql(t),r=Jl(t),i=e[0]*o-e[1]*r,n=e[1]*o+e[0]*r;return e[0]=i,e[1]=n,e}function Qo(e,t){return e[0]*=t,e[1]*=t,e}function $o(e,t){const o=e[0]-t[0],r=e[1]-t[1];return o*o+r*r}function er(e,t){return ed($o(e,t))}function tr(e,t){return $o(e,Ko(e,t))}function or(e,t){return Zo(e,'{x}, {y}',t)}function rr(e,r,t,a,o,i){let s=NaN,l=NaN;const d=(t-r)/a;if(1==d)s=e[r],l=e[r+1];else if(2==d)s=(1-o)*e[r]+o*e[r+a],l=(1-o)*e[r+1]+o*e[r+a+1];else if(0!=d){let n=e[r],d=e[r+1],p=0;const g=[0];for(let o=r+a;o<t;o+=a){const t=e[o],r=e[o+1];p+=ed((t-n)*(t-n)+(r-d)*(r-d)),g.push(p),n=t,d=r}const i=o*p,_=Gt(g,i);if(0>_){const n=(i-g[-_-2])/(g[-_-1]-g[-_-2]),t=r+(-_-2)*a;s=Re(e[t],e[t+a],n),l=Re(e[t+1],e[t+a+1],n)}else s=e[r+_*a],l=e[r+_*a+1]}return i?(i[0]=s,i[1]=l,i):[s,l]}function ir(e,t,o,r,n,i){if(o==t)return null;let a;if(n<e[t+r-1])return i?(a=e.slice(t,t+r),a[r-1]=n,a):null;if(e[o-1]<n)return i?(a=e.slice(o-r,o),a[r-1]=n,a):null;if(n==e[t+r-1])return e.slice(t,t+r);let s=t/r,l=o/r;for(;s<l;){const t=s+l>>1;n<e[(t+1)*r-1]?l=t:s=t+1}const d=e[s*r-1];if(n==d)return e.slice((s-1)*r,(s-1)*r+r);const p=e[(s+1)*r-1];a=[];for(let l=0;l<r-1;++l)a.push(Re(e[(s-1)*r+l],e[s*r+l],(n-d)/(p-d)));return a.push(n),a}function nr(e,t,o,r,i,n,a){if(a)return ir(e,t,o[o.length-1],r,i,n);let s;if(i<e[r-1])return n?(s=e.slice(0,r),s[r-1]=i,s):null;if(e[e.length-1]<i)return n?(s=e.slice(e.length-r),s[r-1]=i,s):null;for(let s=0,l=o.length;s<l;++s){const n=o[s];if(t!=n){if(i<e[t+r-1])return null;if(i<=e[n-1])return ir(e,t,n,r,i,!1);t=n}}return null}function ar(e,t,o,r){let n=e[t],a=e[t+1],s=0;for(let l=t+r;l<o;l+=r){const t=e[l],o=e[l+1];s+=ed((t-n)*(t-n)+(o-a)*(o-a)),n=t,a=o}return s}function sr(e,t,o){const r=[];let i=e(0),n=e(1),s=t(i),a=t(n);const l=[n,i],d=[a,s],p=[1,0],g={};for(let _=1e5,u,c,y,m,h,f;0<--_&&0<p.length;)y=p.pop(),i=l.pop(),s=d.pop(),f=y.toString(),f in g||(r.push(s[0],s[1]),g[f]=!0),m=p.pop(),n=l.pop(),a=d.pop(),h=(y+m)/2,u=e(h),c=t(u),fe(c[0],c[1],s[0],s[1],a[0],a[1])<o?(r.push(a[0],a[1]),f=m.toString(),g[f]=!0):(p.push(m,h,h,y),d.push(a,c,c,s),l.push(n,u,u,i));return r}function lr(e,t,o,r,i){const n=Ve('EPSG:4326');return sr(function(r){return[e,t+(o-t)*r]},Qe(n,r),i)}function dr(e,t,o,r,i){const n=Ve('EPSG:4326');return sr(function(r){return[t+(o-t)*r,e]},Qe(n,r),i)}function pr(e){return td(e,3)}function gr(e){return 1-pr(1-e)}function _r(e){return 3*e*e-2*e*e*e}function ur(e){return e}function cr(){const e=Tt(1,1);return e.fillStyle='rgba(0,0,0,0)',e.fillRect(0,0,1,1),e.canvas}function yr(t,o){const r=o.cloneEvent(t,t),e=r.preventDefault;return r.preventDefault=function(){t.preventDefault(),e()},r.pointerId=__,r.isPrimary=!0,r.pointerType=u_,r}function mr(e){return function(t){return t?[me(t[0],e[0],e[2]),me(t[1],e[1],e[3])]:void 0}}function hr(e){return e}function fr(e){return function(t,o,r){if(t!==void 0){let i=Ut(e,t,r);i=me(i+o,0,e.length-1);const n=Bl(i);if(i!=n&&n<e.length-1){const t=e[n]/e[n+1];return e[n]/td(t,i-n)}return e[n]}}}function xr(e,t,o){return function(r,i,n){if(void 0!==r){const a=Bl(od(t/r)/od(e)+(-n/2+.5));let s=id(a+i,0);return void 0!==o&&(s=$l(s,o)),t/td(e,s)}}}function Er(e){return void 0===e?void 0:0}function Tr(e,t){return void 0===e?void 0:e+t}function Sr(e){const t=2*Kl/e;return function(e,o){return void 0===e?void 0:(e=Bl((e+o)/t+.5)*t,e)}}function Cr(e){const t=e||Se(5);return function(e,o){return void 0===e?void 0:Hl(e+o)<=t?0:e+o}}function Rr(e){return void 0===e.extent?hr:mr(e.extent)}function Ir(e){let t,o,r;let i=e.minZoom===void 0?D_:e.minZoom,n=e.maxZoom===void 0?28:e.maxZoom;const a=e.zoomFactor===void 0?2:e.zoomFactor;if(e.resolutions!==void 0){const a=e.resolutions;o=a[i],r=a[n]===void 0?a[a.length-1]:a[n],t=fr(a)}else{const s=Ke(e.projection,'EPSG:3857'),l=s.getExtent(),d=l?id(ne(l),te(l)):360*rp[ip.DEGREES]/s.getMetersPerUnit(),p=d/b_/1;o=e.maxResolution,o===void 0?o=p/td(a,i):i=0,r=e.minResolution,r===void 0&&(e.maxZoom===void 0?r=p/268435456:e.maxResolution===void 0?r=p/td(a,n):r=o/td(a,n)),n=i+Bl(od(o/r)/od(a)),r=o/td(a,n-i),t=xr(a,o,n-i)}return{constraint:t,maxResolution:o,minResolution:r,minZoom:i,zoomFactor:a}}function Lr(e){const t=!(e.enableRotation!==void 0)||e.enableRotation;if(t){const t=e.constrainRotation;return void 0===t||!0===t?Cr():!1===t?Tr:'number'==typeof t?Sr(t):Tr}return Er}function Pr(e){return!(e.sourceCenter&&e.targetCenter&&!qo(e.sourceCenter,e.targetCenter))&&!(e.sourceResolution!==e.targetResolution)&&!(e.sourceRotation!==e.targetRotation)}function vr(e,t,o){return void 0===o&&(o=[0,0]),o[0]=e[0]+2*t,o[1]=e[1]+2*t,o}function Fr(e){return 0<e[0]&&0<e[1]}function wr(e,t,o){return void 0===o&&(o=[0,0]),o[0]=0|e[0]*t+.5,o[1]=0|e[1]*t+.5,o}function Nr(e,t){return Array.isArray(e)?e:(void 0===t?t=[e,e]:t[0]=t[1]=e,t)}function Ar(e){let t=null;void 0!==e.keyboardEventTarget&&(t='string'==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const o={},r=e.layers instanceof W_?e.layers:new W_({layers:e.layers});o[P_.LAYERGROUP]=r,o[P_.TARGET]=e.target,o[P_.VIEW]=void 0===e.view?new U_:e.view;let i;void 0!==e.controls&&(Array.isArray(e.controls)?i=new qd(e.controls.slice()):(R(e.controls instanceof qd,47),i=e.controls));let n;void 0!==e.interactions&&(Array.isArray(e.interactions)?n=new qd(e.interactions.slice()):(R(e.interactions instanceof qd,48),n=e.interactions));let a;return void 0===e.overlays?a=new qd:Array.isArray(e.overlays)?a=new qd(e.overlays.slice()):(R(e.overlays instanceof qd,49),a=e.overlays),{controls:i,interactions:n,keyboardEventTarget:t,overlays:a,values:o}}function br(e,t){return e.visible&&t>=e.minResolution&&t<e.maxResolution}function Mr(e){this.updateElement_(e.frameState)}function Gr(e){const t=e.frameState;if(t){const e=t.viewState.rotation;if(e!=this.rotation_){const t='rotate('+e+'rad)';if(this.autoHide_){const t=this.element.classList.contains(Dp);t||0!==e?t&&0!==e&&this.element.classList.remove(Dp):this.element.classList.add(Dp)}this.label_.style.msTransform=t,this.label_.style.webkitTransform=t,this.label_.style.transform=t}this.rotation_=e}}function Dr(e){const t=e?e:{},o=new qd,r=void 0===t.zoom||t.zoom;r&&o.push(new iu(t.zoomOptions));const i=void 0===t.rotate||t.rotate;i&&o.push(new ou(t.rotateOptions));const n=void 0===t.attribution||t.attribution;return n&&o.push(new eu(t.attributionOptions)),o}function kr(e,t,o){const r=e.getCenter();if(r){const i=e.constrainCenter([r[0]+t[0],r[1]+t[1]]);o?e.animate({duration:o,easing:ur,center:i}):e.setCenter(i)}}function Ur(e,t,o,r){t=e.constrainRotation(t,0),Yr(e,t,o,r)}function Yr(e,t,o,r){if(t!==void 0){const i=e.getRotation(),n=e.getCenter();i!==void 0&&n&&0<r?e.animate({rotation:t,anchor:o,duration:r,easing:gr}):e.rotate(t,o)}}function jr(e,t,o,r,i){t=e.constrainResolution(t,0,i),Vr(e,t,o,r)}function Br(e,t,o,r){const i=e.getResolution();let n=e.constrainResolution(i,t,0);if(n!==void 0){const t=e.getResolutions();n=me(n,e.getMinResolution()||t[t.length-1],e.getMaxResolution()||t[0])}if(o&&void 0!==n&&n!==i){const t=e.getCenter();let r=e.calculateCenterZoom(n,o);r=e.constrainCenter(r),o=[(n*t[0]-i*r[0])/(n-i),(n*t[1]-i*r[1])/(n-i)]}Vr(e,n,o,r)}function Vr(e,t,o,r){if(t){const i=e.getResolution(),n=e.getCenter();if(i!==void 0&&n&&t!==i&&r)e.animate({resolution:t,anchor:o,duration:r,easing:gr});else{if(o){const r=e.calculateCenterZoom(t,o);e.setCenter(r)}e.setResolution(t)}}}function zr(e){let t=!1;const o=e.originalEvent;if(e.type==n_.DBLCLICK){const r=e.map,i=e.coordinate,n=o.shiftKey?-this.delta_:this.delta_,a=r.getView();Br(a,n,i,this.duration_),e.preventDefault(),t=!0}return!t}function Xr(e){const t=e.length;let o=0,r=0;for(let n=0;n<t;n++)o+=e[n].clientX,r+=e[n].clientY;return[o/t,r/t]}function Wr(e){const t=e.type;return t===n_.POINTERDOWN||t===n_.POINTERDRAG||t===n_.POINTERUP}function Kr(e){if(!(e instanceof s_))return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==n_.POINTERDRAG)this.handleDragEvent_(e);else if(e.type==n_.POINTERUP){const t=this.handleUpEvent_(e);this.handlingDownUpSequence=t&&0<this.targetPointers.length}}else if(e.type==n_.POINTERDOWN){const o=this.handleDownEvent_(e);this.handlingDownUpSequence=o,t=this.shouldStopEvent(o)}else e.type==n_.POINTERMOVE&&this.handleMoveEvent_(e);return!t}function Hr(e){const t=this.targetPointers,o=Xr(t);if(t.length!=this.lastPointersCount_)this.kinetic_&&this.kinetic_.begin();else if(this.kinetic_&&this.kinetic_.update(o[0],o[1]),this.lastCentroid){const t=this.lastCentroid[0]-o[0],r=o[1]-this.lastCentroid[1],i=e.map,n=i.getView();let a=[t,r];Qo(a,n.getResolution()),Jo(a,n.getRotation()),Xo(a,n.getCenter()),a=n.constrainCenter(a),n.setCenter(a)}this.lastCentroid=o,this.lastPointersCount_=t.length}function Zr(e){const t=e.map,o=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const e=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),i=o.getCenter(),n=t.getPixelFromCoordinate(i),a=t.getCoordinateFromPixel([n[0]-e*Ql(r),n[1]-e*Jl(r)]);o.animate({center:o.constrainCenter(a),duration:500,easing:gr})}return o.setHint(M_.INTERACTING,-1),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}function qr(e){if(0<this.targetPointers.length&&this.condition_(e)){const t=e.map,o=t.getView();return this.lastCentroid=null,this.handlingDownUpSequence||o.setHint(M_.INTERACTING,1),o.getAnimating()&&o.setCenter(e.frameState.viewState.center),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=1<this.targetPointers.length,!0}return!1}function Jr(e){if(Eu(e)){const t=e.map,o=t.getView();if(o.getConstraints().rotation!==Er){const r=t.getSize(),i=e.pixel,n=Wl(r[1]/2-i[1],i[0]-r[0]/2);if(void 0!==this.lastAngle_){const e=n-this.lastAngle_,t=o.getRotation();Yr(o,t-e)}this.lastAngle_=n}}}function Qr(e){if(!Eu(e))return!0;const t=e.map,o=t.getView();o.setHint(M_.INTERACTING,-1);const r=o.getRotation();return Ur(o,r,void 0,this.duration_),!1}function $r(e){if(!Eu(e))return!1;if(uu(e)&&this.condition_(e)){const t=e.map;return t.getView().setHint(M_.INTERACTING,1),this.lastAngle_=void 0,!0}return!1}function ei(e,t,o){const r=o[0]-t[0],i=o[1]-t[1];return r*r+i*i>=this.minArea_}function ti(e){Eu(e)&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Ou(Fu.BOXDRAG,e.coordinate,e)))}function oi(e){return!Eu(e)||(this.box_.setMap(null),this.boxEndCondition_(e,this.startPixel_,e.pixel)&&(this.onBoxEnd(e),this.dispatchEvent(new Ou(Fu.BOXEND,e.coordinate,e))),!1)}function ri(e){return!!Eu(e)&&!!(uu(e)&&this.condition_(e))&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ou(Fu.BOXSTART,e.coordinate,e)),!0)}function ii(e){let t=!1;if(e.type==Yd.KEYDOWN){const o=e.originalEvent,r=o.keyCode;if(this.condition_(e)&&(r==Mu.DOWN||r==Mu.LEFT||r==Mu.RIGHT||r==Mu.UP)){const o=e.map,i=o.getView(),n=i.getResolution()*this.pixelDelta_;let a=0,s=0;r==Mu.DOWN?s=-n:r==Mu.LEFT?a=-n:r==Mu.RIGHT?a=n:s=n;const l=[a,s];Jo(l,i.getRotation()),kr(i,l,this.duration_),e.preventDefault(),t=!0}}return!t}function ni(e){let t=!1;if(e.type==Yd.KEYDOWN||e.type==Yd.KEYPRESS){const o=e.originalEvent,r=o.charCode;if(this.condition_(e)&&(r==43||r==45)){const o=e.map,i=r==43?this.delta_:-this.delta_,n=o.getView();Br(n,i,void 0,this.duration_),e.preventDefault(),t=!0}}return!t}function ai(e){if(!this.condition_(e))return!0;const t=e.type;if(t!==Yd.WHEEL&&t!==Yd.MOUSEWHEEL)return!0;e.preventDefault();const o=e.map,r=e.originalEvent;this.useAnchor_&&(this.lastAnchor_=e.coordinate);let i;if(e.type==Yd.WHEEL?(i=r.deltaY,Ip&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(i/=Fp),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(i*=40)):e.type==Yd.MOUSEWHEEL&&(i=-r.wheelDeltaY,Lp&&(i/=3)),0===i)return!1;const n=Date.now();if(void 0===this.startTime_&&(this.startTime_=n),(!this.mode_||n-this.startTime_>this.trackpadEventGap_)&&(this.mode_=4>Hl(i)?Yu.TRACKPAD:Yu.WHEEL),this.mode_===Yu.TRACKPAD){const e=o.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):e.setHint(M_.INTERACTING,1),this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);let t=e.getResolution()*td(2,i/this.trackpadDeltaPerZoom_);const r=e.getMinResolution(),a=e.getMaxResolution();let s=0;if(t<r?(t=id(t,r/this.trackpadZoomBuffer_),s=1):t>a&&(t=$l(t,a*this.trackpadZoomBuffer_),s=-1),this.lastAnchor_){const o=e.calculateCenterZoom(t,this.lastAnchor_);e.setCenter(e.constrainCenter(o))}return e.setResolution(t),0==s&&this.constrainResolution_&&e.animate({resolution:e.constrainResolution(t,0<i?-1:1),easing:gr,anchor:this.lastAnchor_,duration:this.duration_}),0<s?e.animate({resolution:r,easing:gr,anchor:this.lastAnchor_,duration:500}):0>s&&e.animate({resolution:a,easing:gr,anchor:this.lastAnchor_,duration:500}),this.startTime_=n,!1}this.delta_+=i;const a=id(this.timeout_-(n-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,o),a),!1}function si(e){let t=0;const o=this.targetPointers[0],r=this.targetPointers[1],i=Wl(r.clientY-o.clientY,r.clientX-o.clientX);if(void 0!==this.lastAngle_){const e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Hl(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=e}this.lastAngle_=i;const n=e.map,a=n.getView();if(a.getConstraints().rotation!==Er){const e=n.getViewport().getBoundingClientRect(),o=Xr(this.targetPointers);if(o[0]-=e.left,o[1]-=e.top,this.anchor_=n.getCoordinateFromPixel(o),this.rotating_){const e=a.getRotation();n.render(),Yr(a,e+t,this.anchor_)}}}function li(e){if(2>this.targetPointers.length){const t=e.map,o=t.getView();if(o.setHint(M_.INTERACTING,-1),this.rotating_){const e=o.getRotation();Ur(o,e,this.anchor_,this.duration_)}return!1}return!0}function di(e){if(2<=this.targetPointers.length){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().setHint(M_.INTERACTING,1),!0}return!1}function pi(e){let t=1;const o=this.targetPointers[0],r=this.targetPointers[1],i=o.clientX-r.clientX,n=o.clientY-r.clientY,a=ed(i*i+n*n);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const s=e.map,l=s.getView(),d=l.getResolution(),p=l.getMaxResolution(),g=l.getMinResolution();let _=d*t;_>p?(t=p/d,_=p):_<g&&(t=g/d,_=g),1!=t&&(this.lastScaleDelta_=t);const u=s.getViewport().getBoundingClientRect(),c=Xr(this.targetPointers);c[0]-=u.left,c[1]-=u.top,this.anchor_=s.getCoordinateFromPixel(c),s.render(),Vr(l,_,this.anchor_)}function gi(e){if(2>this.targetPointers.length){const t=e.map,o=t.getView();o.setHint(M_.INTERACTING,-1);const r=o.getResolution();if(this.constrainResolution_||r<o.getMinResolution()||r>o.getMaxResolution()){const e=this.lastScaleDelta_-1;jr(o,r,this.anchor_,this.duration_,e)}return!1}return!0}function _i(e){if(2<=this.targetPointers.length){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().setHint(M_.INTERACTING,1),!0}return!1}function ui(e){const t=e.dataTransfer.files;for(let o=0,r=t.length;o<r;++o){const e=t.item(o),r=new FileReader;r.addEventListener(Yd.LOAD,this.handleResult_.bind(this,e)),r.readAsText(e)}}function ci(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect='copy'}function yi(e){if(Eu(e)){const t=e.map,o=t.getSize(),r=e.pixel,i=r[0]-o[0]/2,n=o[1]/2-r[1],a=Wl(n,i),s=ed(i*i+n*n),l=t.getView();if(l.getConstraints().rotation!==Er&&void 0!==this.lastAngle_){const e=a-this.lastAngle_;Yr(l,l.getRotation()-e)}if(this.lastAngle_=a,void 0!==this.lastMagnitude_){const e=this.lastMagnitude_*(l.getResolution()/s);Vr(l,e)}void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/s),this.lastMagnitude_=s}}function mi(e){if(!Eu(e))return!0;const t=e.map,o=t.getView();o.setHint(M_.INTERACTING,-1);const r=this.lastScaleDelta_-1;return Ur(o,o.getRotation()),jr(o,o.getResolution(),void 0,this.duration_,r),this.lastScaleDelta_=0,!1}function hi(e){return!!Eu(e)&&!!this.condition_(e)&&(e.map.getView().setHint(M_.INTERACTING,1),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0)}function fi(e,t,o,r){const n=[];let a=b();for(let s=0,i=o.length;s<i;++s){const i=o[s];a=Y(e,t,i[0],r),n.push((a[0]+a[2])/2,(a[1]+a[3])/2),t=i[i.length-1]}return n}function xi(e,t,o,r){return function(i,n,a){const s=new XMLHttpRequest;s.open('GET','function'==typeof e?e(i,n,a):e,!0),t.getType()==pc.ARRAY_BUFFER&&(s.responseType='arraybuffer'),s.onload=function(){if(!s.status||200<=s.status&&300>s.status){const e=t.getType();let i;e==pc.JSON||e==pc.TEXT?i=s.responseText:e==pc.XML?(i=s.responseXML,!i&&(i=new DOMParser().parseFromString(s.responseText,'application/xml'))):e==pc.ARRAY_BUFFER&&(i=s.response),i?o.call(this,t.readFeatures(i,{featureProjection:a}),t.readProjection(i),t.getLastExtent()):r.call(this)}else r.call(this)}.bind(this),s.onerror=function(){r.call(this)}.bind(this),s.send()}}function Ei(e,t){return xi(e,t,function(e){this.addFeatures(e)},T)}function Ti(){return[[-Infinity,-Infinity,Infinity,Infinity]]}function Si(){const e=At();return function(t){return e[t.getGeometry().getType()]}}function Ci(e){e.originalEvent.type===Yd.CONTEXTMENU&&e.preventDefault(),this.freehand_=this.mode_!==Tc.POINT&&this.freehandCondition_(e);let t=e.type===n_.POINTERMOVE,o=!0;if(this.lastDragTime_&&e.type===n_.POINTERDRAG){const o=Date.now();o-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)}return this.freehand_&&e.type===n_.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e),o=!1):this.freehand_&&e.type===n_.POINTERDOWN?o=!1:t?(o=e.type===n_.POINTERMOVE,o&&this.freehand_?o=this.handlePointerMove_(e):(e.pointerEvent.pointerType==u_||e.type===n_.POINTERDRAG&&!this.downTimeout_)&&this.handlePointerMove_(e)):e.type===n_.DBLCLICK&&(o=!1),Kr.call(this,e)&&o}function Ri(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e),!0):!!this.condition_(e)&&(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new s_(n_.POINTERMOVE,e.map,e.pointerEvent,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0)}function Ii(e){let t=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const o=this.mode_===Tc.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||o?this.finishDrawing():this.atFinish_(e)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e):(this.startDrawing_(e),this.mode_===Tc.POINT&&this.finishDrawing()),t=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!t&&this.stopClick_&&e.stopPropagation(),t}function Li(e){let t;return e===ep.POINT||e===ep.MULTI_POINT?t=Tc.POINT:e===ep.LINE_STRING||e===ep.MULTI_LINE_STRING?t=Tc.LINE_STRING:e===ep.POLYGON||e===ep.MULTI_POLYGON?t=Tc.POLYGON:e===ep.CIRCLE&&(t=Tc.CIRCLE),t}function Pi(e){return!(e instanceof s_)||(e.type!=n_.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),Kr.call(this,e),!1)}function vi(e){const t=e.pixel,o=e.map,r=this.getExtent();let i=this.snapToVertex_(t,o);const n=function(e){let t=null,o=null;return e[0]==r[0]?t=r[2]:e[0]==r[2]&&(t=r[0]),e[1]==r[1]?o=r[3]:e[1]==r[3]&&(o=r[1]),null!==t&&null!==o?[t,o]:null};if(i&&r){const e=i[0]==r[0]||i[0]==r[2]?i[0]:null,t=i[1]==r[1]||i[1]==r[3]?i[1]:null;null!==e&&null!==t?this.pointerHandler_=Ai(n(i)):null===e?null!==t&&(this.pointerHandler_=bi(n([r[0],t]),n([r[2],t]))):this.pointerHandler_=bi(n([e,r[1]]),n([e,r[3]]))}else i=o.getCoordinateFromPixel(t),this.setExtent([i[0],i[1],i[0],i[1]]),this.pointerHandler_=Ai(i);return!0}function Fi(e){if(this.pointerHandler_){const t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}return!0}function Oi(){this.pointerHandler_=null;const e=this.getExtent();return e&&0!==H(e)||this.setExtent(null),!1}function wi(){const e=At();return function(){return e[ep.POLYGON]}}function Ni(){const e=At();return function(){return e[ep.POINT]}}function Ai(e){return function(t){return I([e,t])}}function bi(e,t){return e[0]==t[0]?function(o){return I([e,[o[0],t[1]]])}:e[1]==t[1]?function(o){return I([e,[t[0],o[1]]])}:null}function Mi(e){return[[[e[0],e[1]],[e[0],e[3]]],[[e[0],e[3]],[e[2],e[3]]],[[e[2],e[3]],[e[2],e[1]]],[[e[2],e[1]],[e[0],e[1]]]]}function Gi(e,t){return e.index-t.index}function Di(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);const t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0,this.modified_=!1;const o=this.vertexFeature_;if(o){const r=[],i=o.getGeometry(),a=i.getCoordinates(),s=I([a]),l=this.rBush_.getInExtent(s),d={};l.sort(Gi);for(let o=0,i=l.length;o<i;++o){const i=l[o],s=i.segment;let p=n(i.feature);const g=i.depth;if(g&&(p+='-'+g.join('-')),d[p]||(d[p]=[,,]),i.geometry.getType()===ep.CIRCLE&&i.index===Nc){const e=Bi(t,i);qo(e,a)&&!d[p][0]&&(this.dragSegments_.push([i,0]),d[p][0]=i)}else if(qo(s[0],a)&&!d[p][0])this.dragSegments_.push([i,0]),d[p][0]=i;else if(qo(s[1],a)&&!d[p][1]){if((i.geometry.getType()===ep.LINE_STRING||i.geometry.getType()===ep.MULTI_LINE_STRING)&&d[p][0]&&0===d[p][0].index)continue;this.dragSegments_.push([i,1]),d[p][1]=i}else this.insertVertexCondition_(e)&&n(s)in this.vertexSegments_&&!d[p][0]&&!d[p][1]&&r.push([i,a])}r.length&&this.willModifyFeatures_(e);for(let e=r.length-1;0<=e;--e)this.insertVertex_.apply(this,r[e])}return!!this.vertexFeature_}function ki(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);const t=e.coordinate;for(let o=0,r=this.dragSegments_.length;o<r;++o){const e=this.dragSegments_[o],r=e[0],i=r.depth,n=r.geometry;let a;const s=r.segment,l=e[1];for(;t.length<n.getStride();)t.push(s[l][t.length]);switch(n.getType()){case ep.POINT:a=t,s[0]=s[1]=t;break;case ep.MULTI_POINT:a=n.getCoordinates(),a[r.index]=t,s[0]=s[1]=t;break;case ep.LINE_STRING:a=n.getCoordinates(),a[r.index+l]=t,s[l]=t;break;case ep.MULTI_LINE_STRING:a=n.getCoordinates(),a[i[0]][r.index+l]=t,s[l]=t;break;case ep.POLYGON:a=n.getCoordinates(),a[i[0]][r.index+l]=t,s[l]=t;break;case ep.MULTI_POLYGON:a=n.getCoordinates(),a[i[1]][i[0]][r.index+l]=t,s[l]=t;break;case ep.CIRCLE:s[0]=s[1]=t,r.index===wc?(this.changingFeature_=!0,n.setCenter(t),this.changingFeature_=!1):(this.changingFeature_=!0,n.setRadius(er(n.getCenter(),t)),this.changingFeature_=!1);break;default:}a&&this.setGeometryCoordinates_(n,a)}this.createOrUpdateVertexFeature_(t)}function Ui(e){for(let t=this.dragSegments_.length-1;0<=t;--t){const e=this.dragSegments_[t][0],o=e.geometry;if(o.getType()===ep.CIRCLE){const t=o.getCenter(),r=e.featureSegments[0],i=e.featureSegments[1];r.segment[0]=r.segment[1]=t,i.segment[0]=i.segment[1]=t,this.rBush_.update(k(t),r),this.rBush_.update(o.getExtent(),i)}else this.rBush_.update(I(e.segment),e)}return this.modified_&&(this.dispatchEvent(new Fc(vc.MODIFYEND,this.features_,e)),this.modified_=!1),!1}function Yi(e){if(!(e instanceof s_))return!0;this.lastPointerEvent_=e;let t;return e.map.getView().getInteracting()||e.type!=n_.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type==n_.SINGLECLICK&&this.ignoreNextSingleClick_?t=!0:t=this.removePoint()),e.type==n_.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),Kr.call(this,e)&&!t}function ji(e,t){const o=t.geometry;if(o.getType()===ep.CIRCLE){const r=o;if(t.index===Nc){const t=$o(r.getCenter(),e),o=ed(t)-r.getRadius();return o*o}}return tr(e,t.segment)}function Bi(e,t){const o=t.geometry;return o.getType()===ep.CIRCLE&&t.index===Nc?o.getClosestPoint(e):Ko(e,t.segment)}function Vi(){const e=At();return function(){return e[ep.POINT]}}function zi(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),o=this.removeCondition_(e),r=this.toggleCondition_(e),i=e.map,n=this.featureOverlay_.getSource().getFeaturesCollection(),s=[],l=[];if(!t&&!o&&!r){a(this.featureLayerAssociation_),i.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return l.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=n.getLength()-1;0<=e;--e){const t=n.item(e),o=l.indexOf(t);-1<o?l.splice(o,1):(n.remove(t),s.push(t))}0!==l.length&&n.extend(l)}else{i.forEachFeatureAtPixel(e.pixel,function(e,i){if(this.filter_(e,i))return(t||r)&&!kt(n.getArray(),e)?(l.push(e),this.addFeatureLayerAssociation_(e,i)):(o||r)&&kt(n.getArray(),e)&&(s.push(e),this.removeFeatureLayerAssociation_(e)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=s.length-1;0<=e;--e)n.remove(s[e]);n.extend(l)}return(0<l.length||0<s.length)&&this.dispatchEvent(new bc(Ac.SELECT,l,s,e)),yu(e)}function Xi(){const e=At();return jt(e[ep.POLYGON],e[ep.LINE_STRING]),jt(e[ep.GEOMETRY_COLLECTION],e[ep.LINE_STRING]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}function Wi(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t.snapped&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel),Kr.call(this,e)}function Ki(){const e=s(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}function Hi(e,t){const o=tr(this.pixelCoordinate_,e.segment),r=tr(this.pixelCoordinate_,t.segment);return o-r}function Zi(e){if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=e.coordinate,Qi.call(this,e);const t=this.features_||new qd([this.lastFeature_]);return this.dispatchEvent(new kc(Dc.TRANSLATESTART,t,e.coordinate)),!0}return!1}function qi(e){if(this.lastCoordinate_){this.lastCoordinate_=null,Qi.call(this,e);const t=this.features_||new qd([this.lastFeature_]);return this.dispatchEvent(new kc(Dc.TRANSLATEEND,t,e.coordinate)),!0}return!1}function Ji(e){if(this.lastCoordinate_){const t=e.coordinate,o=t[0]-this.lastCoordinate_[0],r=t[1]-this.lastCoordinate_[1],i=this.features_||new qd([this.lastFeature_]);i.forEach(function(e){const t=e.getGeometry();t.translate(o,r),e.setGeometry(t)}),this.lastCoordinate_=t,this.dispatchEvent(new kc(Dc.TRANSLATING,i,t))}}function Qi(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?'ol-grab':'ol-grabbing'),t.classList.add(this.lastCoordinate_?'ol-grabbing':'ol-grab')):t.classList.remove('ol-grab','ol-grabbing')}function $i(e){const t=e?e:{},o=new qd,r=new e_(-.005,.05,100),i=void 0===t.altShiftDragRotate||t.altShiftDragRotate;i&&o.push(new Pu);const n=void 0===t.doubleClickZoom||t.doubleClickZoom;n&&o.push(new du({delta:t.zoomDelta,duration:t.zoomDuration}));const a=void 0===t.dragPan||t.dragPan;a&&o.push(new Iu({kinetic:r}));const s=void 0===t.pinchRotate||t.pinchRotate;s&&o.push(new zu);const l=void 0===t.pinchZoom||t.pinchZoom;l&&o.push(new Wu({constrainResolution:t.constrainResolution,duration:t.zoomDuration}));const d=void 0===t.keyboard||t.keyboard;d&&(o.push(new Du),o.push(new Uu({delta:t.zoomDelta,duration:t.zoomDuration})));const p=void 0===t.mouseWheelZoom||t.mouseWheelZoom;p&&o.push(new Bu({constrainResolution:t.constrainResolution,duration:t.zoomDuration}));const g=void 0===t.shiftDragZoom||t.shiftDragZoom;return g&&o.push(new bu({duration:t.zoomDuration})),o}function en(e,t,o){const r=o?ut(o):'null';return t+':'+e+':'+r}function tn(){iy.expire()}function on(e,t){return e.zIndex-t.zIndex}function rn(e,t,o,r,i){return void 0===i?new dy(e,t,o,r):(i.minX=e,i.maxX=t,i.minY=o,i.maxY=r,i)}function nn(e,t,o,r,n,a,s,i){const l=[],d=e[t]>e[o-r],p=n.length;let g=e[t],_=e[t+1];t+=r;let u=e[t],c=e[t+1],m=0,h=ed(td(u-g,2)+td(c-_,2)),f='',E=0,T,S,C;for(let R=0;R<p;++R){S=d?p-R-1:R;const I=n.charAt(S);f=d?I+f:f+I;const L=a(f)-E;E+=L;const P=s+L/2;for(;t<o-r&&m+h<P;)g=u,_=c,t+=r,u=e[t],c=e[t+1],m+=h,h=ed(td(u-g,2)+td(c-_,2));const v=P-m;let F=Wl(c-_,u-g);if(d&&(F+=0<F?-Kl:Kl),void 0!==C){let e=F-C;if(e+=e>Kl?-2*Kl:e<-Kl?2*Kl:0,Hl(e)>i)return null}const O=v/h,w=Re(g,u,O),x=Re(_,c,O);C==F?(d&&(T[0]=w,T[1]=x,T[2]=L/2),T[4]=f):(f=I,E=L,T=[w,x,L/2,F,f],d?l.unshift(T):l.push(T),C=F),s+=L}return l}function an(e,t,o,r,n){let a=o,s=o,l=0,d=0,p=o,g,_,i,u,c,y,m,h,f,x;for(_=o;_<r;_+=n){const o=t[_],r=t[_+1];void 0!==c&&(f=o-c,x=r-y,u=ed(f*f+x*x),void 0!=m&&(d+=i,g=jl((m*f+h*x)/(i*u)),g>e&&(d>l&&(l=d,a=p,s=_),d=0,p=_-n)),i=u,m=f,h=x),c=o,y=r}return d+=u,d>l?[p,_]:[a,s]}function sn(e,t,o){const r=t.length;let n=0;for(let a=0;a<r;++a){const r=vt(e,t[a]);n=id(n,r),o.push(r)}return n}function ln(e,t,o){let r;const i=Bl(e.length/2);if(t>=i)for(r=i;r<t;r++)e[r][o]=!0;else if(t<i)for(r=t+1;r<i;r++)e[r][o]=!0}function dn(e){if(void 0!==My[e])return My[e];const t=2*e+1,o=Array(t);for(let r=0;r<t;r++)o[r]=Array(t);for(let t=e,r=0,i=0;t>=r;)ln(o,e+t,e+r),ln(o,e+r,e+t),ln(o,e-r,e+t),ln(o,e-t,e+r),ln(o,e-t,e-r),ln(o,e-r,e-t),ln(o,e+r,e-t),ln(o,e+t,e-r),r++,i+=1+2*r,0<2*(i-t)+1&&(t-=1,i+=1-2*t);return My[e]=o,o}function pn(e,t,o){const r=Object.keys(e).map(Number).sort(Dt),n={};for(let i=0,a=r.length;i<a;++i){const a=e[r[i].toString()];for(let e=0,r=a.length;e<r;){const r=a[e++],i=a[e++];r.replay(t,i,o,n)}}}function gn(e,t){return n(e)-n(t)}function _n(e,t){const o=un(e,t);return o*o}function un(e,t){return Dy*e/t}function cn(e,t,o,r,i,n){let a=!1;const s=o.getImage();if(s){let e=s.getImageState();e==Gp.LOADED||e==Gp.ERROR?s.unlistenImageChange(i,n):(e==Gp.IDLE&&s.load(),e=s.getImageState(),s.listenImageChange(i,n),a=!0)}return yn(e,t,o,r),a}function yn(e,t,o,r){const i=o.getGeometryFunction()(t);if(i){const n=i.getSimplifiedGeometry(r),a=o.getRenderer();if(a)mn(e,n,o,t);else{const r=ky[n.getType()];r(e,n,o,t)}}}function mn(e,t,o,r){if(t.getType()==ep.GEOMETRY_COLLECTION){const n=t.getGeometries();for(let t=0,i=n.length;t<i;++t)mn(e,n[t],o,r);return}const i=e.getReplay(o.getZIndex(),yy.DEFAULT);i.drawCustom(t,r,o.getRenderer())}function hn(){const e=document.body;return!!(e.webkitRequestFullscreen||e.mozRequestFullScreen&&document.mozFullScreenEnabled||e.msRequestFullscreen&&document.msFullscreenEnabled||e.requestFullscreen&&document.fullscreenEnabled)}function fn(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}function xn(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function En(e){e.mozRequestFullScreenWithKeys?e.mozRequestFullScreenWithKeys():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):xn(e)}function Tn(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function Sn(){this.validateExtent_(),this.updateBox_()}function Cn(e){const t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}function Rn(e){if(e.frameState){this.sliderInitialized_||this.initSlider_();const t=e.frameState.viewState.resolution;t!==this.currentResolution_&&(this.currentResolution_=t,this.setThumbPosition_(t))}}function In(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ln(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}function Pn(e,t,o){const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),void 0!==t&&e.texParameteri(xd,hd,t),void 0!==o&&e.texParameteri(xd,fd,o),r}function vn(e,t,o,r,i){const n=Pn(e,r,i);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,o,0,e.RGBA,e.UNSIGNED_BYTE,null),n}function Fn(e,t,o,r){const i=Pn(e,o,r);return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i}function On(e,t,o,r){const i=o-r;return!!(e[t]===e[i]&&e[t+1]===e[i+1]&&3<(o-t)/r)&&!!Jt(e,t,o,r)}function wn(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null,this.updateHTML_(this.lastMouseMovePixel_)}function Nn(e,t,o){const r=o?Ve(o.featureProjection):null,i=o?Ve(o.dataProjection):null;let n;if(n=r&&i&&!qe(r,i)?e instanceof Ep?(t?e.clone():e).transform(t?r:i,t?i:r):et(e,i,r):e,t&&o&&void 0!==o.decimals){const t=td(10,o.decimals);n===e&&(n=n.clone()),n.applyTransform(function(e){for(let o=0,r=e.length;o<r;++o)e[o]=Vl(e[o]*t)/t;return e})}return n}function An(e){if('string'==typeof e){const t=JSON.parse(e);return t?t:null}return null===e?null:e}function bn(e,t){if(!e)return null;let o;if('number'==typeof e.x&&'number'==typeof e.y)o=ep.POINT;else if(e.points)o=ep.MULTI_POINT;else if(e.paths)o=1===e.paths.length?ep.LINE_STRING:ep.MULTI_LINE_STRING;else if(e.rings){const t=Gn(e),r=Mn(e.rings,t);e=Ad({},e),1===r.length?(o=ep.POLYGON,e.rings=r[0]):(o=ep.MULTI_POLYGON,e.rings=r)}const r=Yh[o];return Nn(r(e),!1,t)}function Mn(e,t){const o=[],r=[],n=[];let a,i;for(a=0,i=e.length;a<i;++a){o.length=0,lo(o,0,e[a],t.length);const i=bo(o,0,o.length,t.length);i?r.push([e[a]]):n.push(e[a])}for(;n.length;){const e=n.shift();let t=!1;for(a=r.length-1;0<=a;a--){const o=r[a][0],i=w(new Fg(o).getExtent(),new Fg(e).getExtent());if(i){r[a].push(e),t=!0;break}}t||r.push([e.reverse()])}return r}function Gn(e){let t=Ig.XY;return!0===e.hasZ&&!0===e.hasM?t=Ig.XYZM:!0===e.hasZ?t=Ig.XYZ:!0===e.hasM&&(t=Ig.XYM),t}function Dn(e){const t=e.getLayout();return{hasZ:t===Ig.XYZ||t===Ig.XYZM,hasM:t===Ig.XYM||t===Ig.XYZM}}function kn(e,t){const o=jh[e.getType()];return o(Nn(e,!0,t),t)}function Un(e,t){return Vh.createElementNS(e,t)}function Yn(e,t){return jn(e,t,[]).join('')}function jn(e,t,o){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?o.push((e.nodeValue+'').replace(/(\r\n|\r|\n)/g,'')):o.push(e.nodeValue);else{let r;for(r=e.firstChild;r;r=r.nextSibling)jn(r,t,o)}return o}function Bn(e){return e instanceof Document}function Vn(e){return e instanceof Node}function zn(e,t,o){return e.getAttributeNS(t,o)||''}function Xn(e){return new DOMParser().parseFromString(e,'application/xml')}function Wn(e,t){return function(o,r){const i=e.call(t===void 0?this:t,o,r);if(i!==void 0){const e=r[r.length-1];jt(e,i)}}}function Kn(e,t){return function(o,r){const i=e.call(t===void 0?this:t,o,r);if(i!==void 0){const e=r[r.length-1];e.push(i)}}}function Hn(e,t){return function(o,r){const i=e.call(t===void 0?this:t,o,r);i!==void 0&&(r[r.length-1]=i)}}function Zn(e,t,o){return function(r,i){const n=e.call(o===void 0?this:o,r,i);if(n!==void 0){const e=i[i.length-1],o=t===void 0?r.localName:t;let a;a=o in e?e[o]:e[o]=[],a.push(n)}}}function qn(e,t,o){return function(r,i){const n=e.call(o===void 0?this:o,r,i);if(n!==void 0){const e=i[i.length-1],o=t===void 0?r.localName:t;e[o]=n}}}function Jn(e,t){return function(o,r,i){e.call(t===void 0?this:t,o,r,i);const n=i[i.length-1],a=n.node;a.appendChild(o)}}function Qn(e){let t,o;return function(r,i,n){if(t===void 0){t={};const i={};i[r.localName]=e,t[r.namespaceURI]=i,o=$n(r.localName)}ia(t,o,i,n)}}function $n(e,t){const o=e;return function(e,r,i){const n=r[r.length-1],a=n.node;let s=o;void 0===s&&(s=i);let l=t;return void 0===t&&(l=a.namespaceURI),Un(l,s)}}function ea(e,t){const o=t.length,r=Array(o);for(let n=0;n<o;++n)r[n]=e[t[n]];return r}function ta(e,t,o){const r=o===void 0?{}:o;let n,i;for(n=0,i=e.length;n<i;++n)r[e[n]]=t;return r}function oa(e,t,o,r){let i;for(i=t.firstElementChild;i;i=i.nextElementSibling){const t=e[i.namespaceURI];if(t!==void 0){const e=t[i.localName];e!==void 0&&e.call(r,i,o)}}}function ra(e,t,o,r,i){return r.push(e),oa(t,o,r,i),r.pop()}function ia(e,t,o,r,n,a){const s=(n===void 0?o:n).length;let l,d;for(let p=0;p<s;++p)l=o[p],void 0!==l&&(d=t.call(void 0===a?this:a,l,r,void 0===n?void 0:n[p]),void 0!==d&&e[d.namespaceURI][d.localName].call(a,d,l,r))}function na(e,t,o,r,i,n,a){return i.push(e),ia(t,o,r,i,n,a),i.pop()}function aa(e){const t=Yn(e,!1);return sa(t)}function sa(e){const t=/^\s*(true|1)|(false|0)\s*$/.exec(e);return t?void 0!==t[1]||!1:void 0}function la(e){const t=Yn(e,!1),o=Date.parse(t);return isNaN(o)?void 0:o/1e3}function da(e){const t=Yn(e,!1);return pa(t)}function pa(e){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);return t?parseFloat(t[1]):void 0}function ga(e){const t=Yn(e,!1);return _a(t)}function _a(e){const t=/^\s*(\d+)\s*$/.exec(e);return t?parseInt(t[1],10):void 0}function ua(e){return Yn(e,!1).trim()}function ca(e,t){fa(e,t?'1':'0')}function ya(e,t){e.appendChild(Vh.createCDATASection(t))}function ma(e,t){const o=t.toPrecision();e.appendChild(Vh.createTextNode(o))}function ha(e,t){const o=t.toString();e.appendChild(Vh.createTextNode(o))}function fa(e,t){e.appendChild(Vh.createTextNode(t))}function xa(e,t){const o=e.getGeometry();if(o){const e=vf[o.getType()];if(e){const o=t[t.length-1].node;return Un(o.namespaceURI,e)}}}function Ea(e,t,o,r){return e.push(parseFloat(o.getAttribute('lon')),parseFloat(o.getAttribute('lat'))),'ele'in r?(e.push(r.ele),delete r.ele,t.hasZ=!0):e.push(0),'time'in r?(e.push(r.time),delete r.time,t.hasM=!0):e.push(0),e}function Ta(e,t,o){let r=Ig.XY,n=2;if(e.hasZ&&e.hasM?(r=Ig.XYZM,n=4):e.hasZ?(r=Ig.XYZ,n=3):e.hasM&&(r=Ig.XYM,n=3),4!=n){for(let o=0,r=t.length/4;o<r;o++)t[o*n]=t[4*o],t[o*n+1]=t[4*o+1],e.hasZ&&(t[o*n+2]=t[4*o+2]),e.hasM&&(t[o*n+2]=t[4*o+3]);if(t.length=t.length/4*n,o)for(let e=0,t=o.length;e<t;e++)o[e]=o[e]/4*n}return r}function Sa(e,t){const o=t[t.length-1],r=e.getAttribute('href');null!==r&&(o.link=r),oa(pf,e,t)}function Ca(e,t){const o=t[t.length-1];o.extensionsNode_=e}function Ra(e,t){const o=t[0],r=ra({flatCoordinates:[],layoutOptions:{}},gf,e,t);if(r){const e=r.flatCoordinates;delete r.flatCoordinates;const t=r.layoutOptions;delete r.layoutOptions;const i=Ta(t,e),n=new Gg(null);n.setFlatCoordinates(i,e),Nn(n,!1,o);const a=new Cg(n);return a.setProperties(r),a}}function Ia(e,t){const o=t[0],r=ra({flatCoordinates:[],ends:[],layoutOptions:{}},uf,e,t);if(r){const e=r.flatCoordinates;delete r.flatCoordinates;const t=r.ends;delete r.ends;const i=r.layoutOptions;delete r.layoutOptions;const n=Ta(i,e,t),a=new ec(null);a.setFlatCoordinates(n,e,t),Nn(a,!1,o);const s=new Cg(a);return s.setProperties(r),s}}function La(e,t){const o=t[0],r=ra({},mf,e,t);if(r){const t={},i=Ea([],t,e,r),n=Ta(t,i),a=new wg(i,n);Nn(a,!1,o);const s=new Cg(a);return s.setProperties(r),s}}function Pa(e,t,o){e.setAttribute('href',t);const r=o[o.length-1],i=r.properties,n=[i.linkText,i.linkType];na({node:e},ff,Xh,n,o,hf)}function va(e,t,o){const r=o[o.length-1],i=r.node,n=i.namespaceURI,a=r.properties;e.setAttributeNS(null,'lat',t[1]),e.setAttributeNS(null,'lon',t[0]);const s=r.geometryLayout;switch(s){case Ig.XYZM:0!==t[3]&&(a.time=t[3]);case Ig.XYZ:0!==t[2]&&(a.ele=t[2]);break;case Ig.XYM:0!==t[2]&&(a.time=t[2]);break;default:}const l='rtept'==e.nodeName?Tf[n]:Lf[n],d=ea(a,l);na({node:e,properties:a},Pf,Xh,d,o,l)}function Fa(e){const t=[];for(let o=0,r=e.length;o<r;++o)t.push(e[o].clone());return t}function Oa(e,t){if(!e)return null;const o=Af[e.type];return Nn(o(e),!1,t)}function wa(e,t){const o=bf[e.getType()];return o(Nn(e,!0,t),t)}function Na(e){return'string'==typeof e?e:''}function Aa(e,t,o,r,i,n){let a=iy.get(t,r,n);return a||(a=new zf(e,t,o,r,i,n),iy.set(t,r,n,a)),a}function ba(){ex=[255,255,255,1],Hf=new mg({color:ex}),tx=[20,2],ox=Vf.PIXELS,rx=Vf.PIXELS,ix=[64,64],nx='https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png',ax=.5,Zf=new Kf({anchor:tx,anchorOrigin:Xf.BOTTOM_LEFT,anchorXUnits:ox,anchorYUnits:rx,crossOrigin:'anonymous',rotation:0,scale:ax,size:ix,src:nx}),sx='NO_IMAGE',qf=new fg({color:ex,width:1}),lx=new fg({color:[51,51,51,1],width:2}),Jf=new Yg({font:'bold 16px Helvetica',fill:Hf,stroke:lx,scale:.8}),Qf=new Tg({fill:Hf,image:Zf,text:Jf,stroke:qf,zIndex:0}),$f=[Qf]}function Ma(e,t){let o=null;const r=[0,0];let i='start';if(e.getImage()){let t=e.getImage().getImageSize();if(null===t&&(t=ix),2==t.length){const o=e.getImage().getScale();r[0]=o*t[0]/2,r[1]=-o*t[1]/2,i='left'}}if(null!==e.getText()){const t=e.getText();o=t.clone(),o.setFont(t.getFont()||Jf.getFont()),o.setScale(t.getScale()||Jf.getScale()),o.setFill(t.getFill()||Jf.getFill()),o.setStroke(t.getStroke()||lx)}else o=Jf.clone();o.setText(t),o.setOffsetX(r[0]),o.setOffsetY(r[1]),o.setTextAlign(i);const n=new Tg({text:o});return n}function Ga(e,t,o,r,i){return function(n){let a=i,s='',l;if(a){const e=n.getGeometry();e&&(a=e.getType()===ep.POINT)}if(a&&(s=n.get('name'),a=a&&s),e)return a?(l=Ma(e[0],s),e.concat(l)):e;if(t){const e=Da(t,o,r);return a?(l=Ma(e[0],s),e.concat(l)):e}return a?(l=Ma(o[0],s),o.concat(l)):o}}function Da(e,t,o){return Array.isArray(e)?e:'string'==typeof e?(!(e in o)&&'#'+e in o&&(e='#'+e),Da(o[e],t,o)):t}function ka(e){const t=Yn(e,!1),o=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(o){const e=o[1];return[parseInt(e.substr(6,2),16),parseInt(e.substr(4,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(0,2),16)/255]}}function Ua(e){let t=Yn(e,!1);const o=[],r=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;for(let i;i=r.exec(t);){const e=parseFloat(i[1]),r=parseFloat(i[2]),n=i[3]?parseFloat(i[3]):0;o.push(e,r,n),t=t.substr(i[0].length)}return''===t?o:void 0}function Ya(e){const t=Yn(e,!1).trim();let o=e.baseURI;if(o&&'about:blank'!=o||(o=window.location.href),o){const e=new URL(t,o);return e.href}return t}function ja(e){return da(e)}function Ba(e,t){return ra(void 0,ux,e,t)}function Va(e,t){const o=ra({},cx,e,t);if(!o)return;const r=t[t.length-1],i='Icon'in o?o.Icon:{},n=!('Icon'in o)||0<Object.keys(i).length;let a;const s=i.href;s?a=s:n&&(a=nx);let l=Xf.BOTTOM_LEFT,d,p,g;const _=o.hotSpot;_?(d=[_.x,_.y],p=_.xunits,g=_.yunits,l=_.origin):a===nx?(d=tx,p=ox,g=rx):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(d=[.5,0],p=Vf.FRACTION,g=Vf.FRACTION);let u;const c=i.x,m=i.y;c!==void 0&&m!==void 0&&(u=[c,m]);let y;const f=i.w,x=i.h;f!==void 0&&x!==void 0&&(y=[f,x]);let h;const E=o.heading;E!==void 0&&(h=Se(E));let T=o.scale;if(n){a==nx&&(y=ix,T===void 0&&(T=ax));const e=new Kf({anchor:d,anchorOrigin:l,anchorXUnits:p,anchorYUnits:g,crossOrigin:'anonymous',offset:u,offsetOrigin:Xf.BOTTOM_LEFT,rotation:h,scale:T,size:y,src:a});r.imageStyle=e}else r.imageStyle=sx}function za(e,t){const o=ra({},yx,e,t);if(o){const e=t[t.length-1],r=new Yg({fill:new mg({color:'color'in o?o.color:ex}),scale:o.scale});e.textStyle=r}}function Xa(e,t){const o=ra({},mx,e,t);if(o){const e=t[t.length-1],r=new fg({color:'color'in o?o.color:ex,width:'width'in o?o.width:1});e.strokeStyle=r}}function Wa(e,t){const o=ra({},hx,e,t);if(o){const e=t[t.length-1],r=new mg({color:'color'in o?o.color:ex});e.fillStyle=r;const i=o.fill;void 0!==i&&(e.fill=i);const n=o.outline;void 0!==n&&(e.outline=n)}}function Ka(e,t){return ra(null,fx,e,t)}function Ha(e,t){const o=ra({flatCoordinates:[],whens:[]},Ex,e,t);if(o){const e=o.flatCoordinates,t=o.whens;for(let o=0,r=$l(e.length,t.length);o<r;++o)e[4*o+3]=t[o];const r=new Gg(null);return r.setFlatCoordinates(Ig.XYZM,e),r}}function Za(e,t){return ra(null,Sx,e,t)}function qa(e,t){const o=ra({},Cx,e,t),r=Za(e,t);if(r){const e=new Gg(null);return e.setFlatCoordinates(Ig.XYZ,r),e.setProperties(o),e}}function Ja(e,t){const o=ra({},Cx,e,t),r=Za(e,t);if(r){const e=new Ag(null);return e.setFlatCoordinates(Ig.XYZ,r,[r.length]),e.setProperties(o),e}}function Qa(e,t){const o=ra([],Rx,e,t);if(!o)return null;if(0===o.length)return new wf(o);let r=!0,i;const n=o[0].getType();let a;for(let s=1,i=o.length;s<i;++s)if(a=o[s],a.getType()!=n){r=!1;break}if(r){let e,t;if(n==ep.POINT){const r=o[0];e=r.getLayout(),t=r.getFlatCoordinates();for(let e=1,r=o.length;e<r;++e)a=o[e],jt(t,a.getFlatCoordinates());i=new oc(null),i.setFlatCoordinates(e,t),os(i,o)}else n==ep.LINE_STRING?(i=new ec(null),i.setLineStrings(o),os(i,o)):n==ep.POLYGON?(i=new ic(null),i.setPolygons(o),os(i,o)):n==ep.GEOMETRY_COLLECTION?i=new wf(o):R(!1,37)}else i=new wf(o);return i}function $a(e,t){const o=ra({},Cx,e,t),r=Za(e,t);if(r){const e=new wg(null);return e.setFlatCoordinates(Ig.XYZ,r),e.setProperties(o),e}}function es(e,t){const o=ra({},Cx,e,t),r=ra([null],Ix,e,t);if(r&&r[0]){const e=new Ag(null),t=r[0],n=[t.length];for(let e=1,o=r.length;e<o;++e)jt(t,r[e]),n.push(t.length);return e.setFlatCoordinates(Ig.XYZ,t,n),e.setProperties(o),e}}function ts(e,t){const o=ra({},Lx,e,t);if(!o)return null;let r='fillStyle'in o?o.fillStyle:Hf;const i=o.fill;void 0===i||i||(r=null);let n='imageStyle'in o?o.imageStyle:Zf;n==sx&&(n=void 0);const a='textStyle'in o?o.textStyle:Jf;let s='strokeStyle'in o?o.strokeStyle:qf;const l=o.outline;return void 0===l||l||(s=null),[new Tg({fill:r,image:n,stroke:s,text:a,zIndex:void 0})]}function os(e,t){const o=t.length,r=Array(t.length),n=Array(t.length),a=Array(t.length);let s,l,d;s=l=d=!1;for(let p=0;p<o;++p){const e=t[p];r[p]=e.get('extrude'),n[p]=e.get('tessellate'),a[p]=e.get('altitudeMode'),s=s||r[p]!==void 0,l=l||n[p]!==void 0,d=d||a[p]}s&&e.set('extrude',r),l&&e.set('tessellate',n),d&&e.set('altitudeMode',a)}function rs(e,t){oa(vx,e,t)}function is(e,t){oa(Fx,e,t)}function ns(e,t){const o=yt(t),r=4==o.length?o[3]:1,n=[255*r,o[2],o[1],o[0]];for(let o=0;4>o;++o){const e=parseInt(n[o],10).toString(16);n[o]=1==e.length?'0'+e:e}fa(e,n.join(''))}function as(e,t,o){const r=t.getType();let i,n;r==ep.GEOMETRY_COLLECTION?(i=t.getGeometries(),n=$x):r==ep.MULTI_POINT?(i=t.getPoints(),n=eE):r==ep.MULTI_LINE_STRING?(i=t.getLineStrings(),n=tE):r==ep.MULTI_POLYGON?(i=t.getPolygons(),n=rE):R(!1,39),na({node:e},iE,n,i,o)}function ss(e,t,o){na({node:e},nE,oE,[t],o)}function ls(e,t,o){const r={node:e};t.getId()&&e.setAttribute('id',t.getId());const i=t.getProperties(),n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[t.getGeometryName()]=1;const a=Object.keys(i||{}).sort().filter(function(e){return!n[e]});if(0<a.length){const e=ea(i,a);na(r,aE,lE,[{names:a,values:e}],o)}const s=t.getStyleFunction();if(s){const e=s(t,0);if(e){const t=Array.isArray(e)?e[0]:e;this.writeStyles_&&(i.Style=t);const o=t.getText();o&&(i.name=o.getText())}}const l=o[o.length-1].node,d=sE[l.namespaceURI],p=ea(i,d);na(r,aE,Xh,p,o,d);const g=o[0];let _=t.getGeometry();_&&(_=Nn(_,!0,g)),na(r,aE,$x,[_],o)}function ds(e,t,o){const r=t.getFlatCoordinates(),i={node:e};i.layout=t.getLayout(),i.stride=t.getStride();const n=t.getProperties();n.coordinates=r;const a=o[o.length-1].node,s=dE[a.namespaceURI],l=ea(n,s);na(i,pE,Xh,l,o,s)}function ps(e,t,o){const r=t.getLinearRings(),i=r.shift(),n={node:e};na(n,gE,_E,r,o),na(n,gE,uE,[i],o)}function gs(e,t){ma(e,Vl(1e6*t)/1e6)}function _s(e,t,o){if(3===e){const e={keys:[],values:[],features:[]},r=o.readVarint()+o.pos;o.readFields(us,e,r),e.length=e.features.length,e.length&&(t[e.name]=e)}}function us(e,t,o){if(15===e)t.version=o.readVarint();else if(1===e)t.name=o.readString();else if(5===e)t.extent=o.readVarint();else if(2===e)t.features.push(o.pos);else if(3===e)t.keys.push(o.readString());else if(4===e){let r=null;for(const t=o.readVarint()+o.pos;o.pos<t;)e=o.readVarint()>>3,r=1===e?o.readString():2===e?o.readFloat():3===e?o.readDouble():4===e?o.readVarint64():5===e?o.readVarint():6===e?o.readSVarint():7===e?o.readBoolean():null;t.values.push(r)}}function cs(e,t,o){if(1==e)t.id=o.readVarint();else if(2==e)for(const e=o.readVarint()+o.pos;o.pos<e;){const e=t.layer.keys[o.readVarint()],r=t.layer.values[o.readVarint()];t.properties[e]=r}else 3==e?t.type=o.readVarint():4==e&&(t.geometry=o.pos)}function ys(e,t,o){e.pos=t.features[o];const r=e.readVarint()+e.pos,i={layer:t,type:0,properties:{}};return e.readFields(cs,i,r),i}function ms(e,t){let o;return 1===e?o=1===t?ep.POINT:ep.MULTI_POINT:2===e?o=1===t?ep.LINE_STRING:ep.MULTI_LINE_STRING:3==e&&(o=ep.POLYGON),o}function hs(e,t){const o=t[t.length-1];o.tags[e.getAttribute('k')]=e.getAttribute('v')}function fs(e,t,o,r,i,n){let a,s;void 0===i?(a=[],s=0):(a=i,s=void 0===n?0:n);for(let l=t;l<o;){const t=e[l++];a[s++]=e[l++],a[s++]=t;for(let t=2;t<r;++t)a[s++]=e[l++]}return a.length=s,a}function xs(e,t,o){const r=o?o:1e5;let n;const a=Array(t);for(n=0;n<t;++n)a[n]=0;for(let r=0,i=e.length;r<i;)for(n=0;n<t;++n,++r){const t=e[r],o=t-a[n];a[n]=t,e[r]=o}return Ts(e,r)}function Es(e,t,o){const r=o?o:1e5;let n;const a=Array(t);for(n=0;n<t;++n)a[n]=0;const s=Ss(e,r);for(let r=0,i=s.length;r<i;)for(n=0;n<t;++n,++r)a[n]+=s[r],s[r]=a[n];return s}function Ts(e,t){const o=t?t:1e5;for(let r=0,i=e.length;r<i;++r)e[r]=Vl(e[r]*o);return Cs(e)}function Ss(e,t){const o=t?t:1e5,r=Rs(e);for(let n=0,i=r.length;n<i;++n)r[n]/=o;return r}function Cs(e){for(let t=0,o=e.length;t<o;++t){const o=e[t];e[t]=0>o?~(o<<1):o<<1}return Is(e)}function Rs(e){const t=Ls(e);for(let o=0,r=t.length;o<r;++o){const e=t[o];t[o]=1&e?~(e>>1):e>>1}return t}function Is(e){let t='';for(let o=0,r=e.length;o<r;++o)t+=Ps(e[o]);return t}function Ls(e){const t=[];let o=0,r=0;for(let n=0,i=e.length;n<i;++n){const i=e.charCodeAt(n)-63;o|=(31&i)<<r,32>i?(t.push(o),o=0,r=0):r+=5}return t}function Ps(e){let t='',o;for(;32<=e;)o=(32|31&e)+63,t+=Yl(o),e>>=5;return o=e+63,t+=Yl(o),t}function vs(e,t){const o=[];let r,n;for(let a=0,i=e.length;a<i;++a)r=e[a],0<a&&o.pop(),n=0<=r?t[r]:t[~r].slice().reverse(),o.push.apply(o,n);for(let r=0,i=o.length;r<i;++r)o[r]=o[r].slice();return o}function Fs(e,t,o,r,n,a,s){const l=e.geometries,d=[];for(let p=0,i=l.length;p<i;++p)d[p]=Os(l[p],t,o,r,n,a,s);return d}function Os(e,t,o,r,i,n,a){let s;const l=e.type,d=AE[l];s='Point'===l||'MultiPoint'===l?d(e,o,r):d(e,t);const p=new Cg;p.setGeometry(Nn(s,!1,a)),void 0!==e.id&&p.setId(e.id);let g=e.properties;return i&&(!g&&(g={}),g[i]=n),g&&p.setProperties(g),p}function ws(e,t,o){for(let r=0,i=e.length;r<i;++r)Ns(e[r],t,o)}function Ns(e,t,o){let r=0,n=0;for(let a=0,i=e.length;a<i;++a){const i=e[a];r+=i[0],n+=i[1],i[0]=r,i[1]=n,As(i,t,o)}}function As(e,t,o){e[0]=e[0]*t[0]+o[0],e[1]=e[1]*t[1]+o[1]}function bs(){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(UE,e))}function Ms(e,t,o){return new jE(e,t,o)}function Gs(e,t){const o=Un(IT,'Filter'),r=Un(IT,'FeatureId');o.appendChild(r),r.setAttribute('fid',t),e.appendChild(o)}function Ds(e,t){e=e?e:CT;const o=e+':';return 0===t.indexOf(o)?t:o+t}function ks(e,t,o){na({node:e},DT,$n(t.getTagName()),[t],o)}function Us(e,t,o){const r={node:e},n=t.conditions;for(let a=0,i=n.length;a<i;++a){const e=n[a];na(r,DT,$n(e.getTagName()),[e],o)}}function Ys(e,t){t.matchCase!==void 0&&e.setAttribute('matchCase',t.matchCase.toString()),Bs(e,t.propertyName),Vs(e,''+t.expression)}function js(e,t,o){const r=Un(IT,e);fa(r,o),t.appendChild(r)}function Bs(e,t){js('PropertyName',e,t)}function Vs(e,t){js('Literal',e,t)}function zs(e,t){const o=Un(Hh,'TimeInstant');e.appendChild(o);const r=Un(Hh,'timePosition');o.appendChild(r),fa(r,t)}function Xs(e,t,o){const r=o[o.length-1],i=Ad({},r);i.node=e,na(i,DT,$n('Query'),t,o)}function Ws(e){const t=e.getCoordinates();return 0===t.length?'':t.join(' ')}function Ks(e){const t=e.getCoordinates(),o=[];for(let r=0,i=t.length;r<i;++r)o.push(t[r].join(' '));return o.join(',')}function Hs(e){const t=[],o=e.getLinearRings();for(let r=0,i=o.length;r<i;++r)t.push('('+Ks(o[r])+')');return t.join(',')}function Zs(e){const t=e.getLayout();let o='';return(t===Ig.XYZ||t===Ig.XYZM)&&(o+=UT),(t===Ig.XYM||t===Ig.XYZM)&&(o+=Z),o}function qs(e){let t=e.getType();const o=VT[t],r=o(e);if(t=t.toUpperCase(),e instanceof Pg){const o=Zs(e);0<o.length&&(t+=' '+o)}return 0===r.length?t+' '+kT:t+'('+r+')'}function Js(e){return e.getAttributeNS(WT,'href')}function Qs(e,t){return ra({},_S,e,t)}function $s(e,t){return ra({},lS,e,t)}function el(e,t){const o=Qs(e,t);if(o){const t=[_a(e.getAttribute('width')),_a(e.getAttribute('height'))];return o.size=t,o}}function tl(e,t){return ra([],uS,e,t)}function rl(e){const t=ua(e).split(' ');if(t&&2==t.length){const e=+t[0],o=+t[1];return isNaN(e)||isNaN(o)?void 0:[e,o]}}function il(e,t,o,r){return void 0===r?[e,t,o]:(r[0]=e,r[1]=t,r[2]=o,r)}function nl(e,t,o){return e+'/'+t+'/'+o}function al(e){return nl(e[0],e[1],e[2])}function sl(e){return e.split('/').map(Number)}function ll(e){return(e[1]<<e[0])+e[2]}function dl(e){const t=e[0],o=Array(t);let r=1<<t-1,n,i;for(n=0;n<t;++n)i=48,e[1]&r&&(i+=1),e[2]&r&&(i+=2),o[n]=Yl(i),r>>=1;return o.join('')}function pl(e,t){const o=e[0],r=e[1],i=e[2];if(t.getMinZoom()>o||o>t.getMaxZoom())return!1;const n=t.getExtent();let a;return a=n?t.getTileRangeForExtentAndZ(n,o):t.getFullTileRange(o),!a||a.containsXY(r,i)}function gl(e,t){const o=/\{z\}/g,r=/\{x\}/g,i=/\{y\}/g,n=/\{-y\}/g;return function(a){return a?e.replace(o,a[0].toString()).replace(r,a[1].toString()).replace(i,function(){const e=-a[2]-1;return e.toString()}).replace(n,function(){const e=a[0],o=t.getFullTileRange(e);R(o,55);const r=o.getHeight()+a[2];return r.toString()}):void 0}}function _l(e,t){const o=e.length,r=Array(o);for(let n=0;n<o;++n)r[n]=gl(e[n],t);return ul(r)}function ul(e){return 1===e.length?e[0]:function(t,o,r){if(!t)return;else{const i=ll(t),n=Ce(i,e.length);return e[n](t,o,r)}}}function cl(){}function yl(e){const t=[];let o=/\{([a-z])-([a-z])\}/.exec(e);if(o){const r=o[1].charCodeAt(0),i=o[2].charCodeAt(0);let n;for(n=r;n<=i;++n)t.push(e.replace(o[0],Yl(n)));return t}if(o=o=/\{(\d+)-(\d+)\}/.exec(e),o){const r=parseInt(o[2],10);for(let n=parseInt(o[1],10);n<=r;n++)t.push(e.replace(o[0],n.toString()));return t}return t.push(e),t}function ml(e,t,o,r){function i(){delete window[s],a.parentNode.removeChild(a)}const a=document.createElement('script'),s='olc_'+n(t);a.async=!0,a.src=e+(-1==e.indexOf('?')?'?':'&')+(r||'callback')+'='+s;const l=setTimeout(function(){i(),o&&o()},1e4);window[s]=function(e){clearTimeout(l),i(),t(e)},document.getElementsByTagName('head')[0].appendChild(a)}function hl(e,t,o,r){const i=$e(o,t,e);let n=ze(t,r,o);const a=t.getMetersPerUnit();a!==void 0&&(n*=a);const s=e.getMetersPerUnit();s!==void 0&&(n/=s);const l=e.getExtent();if(!l||O(l,i)){const t=ze(e,n,i)/n;isFinite(t)&&0<t&&(n/=t)}return n}function fl(e,t,o,r){const i=o-e,n=r-t,a=ed(i*i+n*n);return[Vl(o+i/a),Vl(r+n/a)]}function xl(e,t,o,r,i,n,a,s,l,d,p){const g=Tt(Vl(o*e),Vl(o*t));if(0===l.length)return g.canvas;g.scale(o,o);const _=b();l.forEach(function(e){B(_,e.extent)});const u=ne(_),c=te(_),y=Tt(Vl(o*u/r),Vl(o*c/r)),m=o/r;l.forEach(function(e){const t=e.extent[0]-_[0],o=-(e.extent[3]-_[3]),r=ne(e.extent),i=te(e.extent);y.drawImage(e.image,d,d,e.image.width-2*d,e.image.height-2*d,t*m,o*m,r*m,i*m)});const h=re(a);return s.getTriangles().forEach(function(e){const t=e.source,i=e.target;let a=t[0][0],s=t[0][1],l=t[1][0],d=t[1][1],p=t[2][0],u=t[2][1];const c=(i[0][0]-h[0])/n,m=-(i[0][1]-h[1])/n,f=(i[1][0]-h[0])/n,x=-(i[1][1]-h[1])/n,E=(i[2][0]-h[0])/n,T=-(i[2][1]-h[1])/n,S=a,C=s;a=0,s=0,l-=S,d-=C,p-=S,u-=C;const R=[[l,d,0,0,f-c],[p,u,0,0,E-c],[0,0,l,d,x-m],[0,0,p,u,T-m]],I=Ee(R);if(I){g.save(),g.beginPath();const e=(c+f+E)/3,t=(m+x+T)/3,i=fl(e,t,c,m),n=fl(e,t,f,x),a=fl(e,t,E,T);g.moveTo(n[0],n[1]),g.lineTo(i[0],i[1]),g.lineTo(a[0],a[1]),g.clip(),g.transform(I[0],I[2],I[1],I[3],c,m),g.translate(_[0]-S,_[3]-C),g.scale(r/o,-r/o),g.drawImage(y.canvas,0,0),g.restore()}}),p&&(g.save(),g.strokeStyle='black',g.lineWidth=1,s.getTriangles().forEach(function(e){const t=e.target,o=(t[0][0]-h[0])/n,r=-(t[0][1]-h[1])/n,i=(t[1][0]-h[0])/n,a=-(t[1][1]-h[1])/n,s=(t[2][0]-h[0])/n,l=-(t[2][1]-h[1])/n;g.beginPath(),g.moveTo(i,a),g.lineTo(o,r),g.lineTo(s,l),g.closePath(),g.stroke()}),g.restore()),g.canvas}function El(e){let t=e.getDefaultTileGrid();return t||(t=Il(e),e.setDefaultTileGrid(t)),t}function Tl(e,t,o){const r=t[0],i=e.getTileCoordCenter(t),n=Ll(o);if(!O(n,i)){const t=ne(n),o=rd((n[0]-i[0])/t);return i[0]+=t*o,e.getTileCoordForCoordAndZ(i,r)}return t}function Sl(e,t,o,r){const i=r===void 0?Jd.TOP_LEFT:r,n=Rl(e,t,o);return new dC({extent:e,origin:$(e,i),resolutions:n,tileSize:o})}function Cl(e){const t={};return Ad(t,void 0===e?{}:e),void 0===t.extent&&(t.extent=Ve('EPSG:3857').getExtent()),t.resolutions=Rl(t.extent,t.maxZoom,t.tileSize),delete t.maxZoom,new dC(t)}function Rl(e,t,o){const r=t===void 0?A_:t,i=te(e),n=ne(e),a=Nr(o===void 0?b_:o),s=id(n/a[0],i/a[1]),l=r+1,d=Array(l);for(let r=0;r<l;++r)d[r]=s/td(2,r);return d}function Il(e,t,o,r){const i=Ll(e);return Sl(i,t,o,r)}function Ll(e){e=Ve(e);let t=e.getExtent();if(!t){const o=180*rp[ip.DEGREES]/e.getMetersPerUnit();t=G(-o,-o,o,o)}return t}function Pl(e,t){e.getImage().src=t}function vl(e,t){e.getImage().src=t}function Fl(e,t){const o=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&o.push(e+'='+encodeURIComponent(t[e]))});const r=o.join('&');return e=e.replace(/[?&]$/,''),e=-1===e.indexOf('?')?e+'?':e+'&',e+r}function Ol(e,t,o,r){const i=ne(e),n=te(e),a=t[0],s=t[1],l=.0254/r;return s*i>a*n?i*o/(a*l):n*o/(s*l)}function wl(e,t,o){if(!e.prepareFrame(t,o))return null;const r=t.size[0],i=t.size[1];if(!zC)zC=Tt(r,i);else{const e=zC.canvas;e.width!==r||e.height!==i?zC=Tt(r,i):zC.clearRect(0,0,r,i)}return e.composeFrame(t,o,zC),zC.getImageData(0,0,r,i)}function Nl(e){return e.map(function(e){return e.getLayer().getLayerState()})}function Al(e){const t=e.length,o=Array(t);for(let r=0;r<t;++r)o[r]=bl(e[r]);return o}function bl(e){let t=null;return e instanceof _C?t=Gl(e):e instanceof PC&&(t=Ml(e)),t}function Ml(e){const t=new qS({source:e});return new oy(t)}function Gl(e){const t=new $S({source:e});return new _y(t)}function Dl(e,t){const o=xi(t,e.getFormat(),e.onLoad.bind(e),e.onError.bind(e));e.setLoader(o)}function kl(e,t,o){const r=[],i=[],n=[],a=[],s=[],l=void 0===o?[]:o,d='TileMatrix',p='Identifier',g='ScaleDenominator',_='TopLeftCorner',u=e['SupportedCRS'],c=Ve(u.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,'$1:$3'))||Ve(u),y=c.getMetersPerUnit(),m='ne'==c.getAxisOrientation().substr(0,2);return e[d].sort(function(e,t){return t[g]-e[g]}),e[d].forEach(function(t){let o;if(o=!(0<l.length)||Vt(l,function(o){return t[p]==o[d]||-1===t[p].indexOf(':')&&e[p]+':'+t[p]===o[d]}),o){i.push(t[p]);const e=28e-5*t[g]/y,o=t['TileWidth'],l=t['TileHeight'];m?n.push([t[_][1],t[_][0]]):n.push(t[_]),r.push(e),a.push(o==l?o:[o,l]),s.push([t.MatrixWidth,-t.MatrixHeight])}}),new nR({extent:t,origins:n,resolutions:r,matrixIds:i,tileSizes:a,sizes:s})}function Ul(e,t){const o=e.Contents.Layer,r=Vt(o,function(e){return e.Identifier==t.layer});if(null===r)return null;const i=e.Contents.TileMatrixSet;let n;n=1<r.TileMatrixSetLink.length?'projection'in t?Wt(r.TileMatrixSetLink,function(e){const o=Vt(i,function(t){return t.Identifier==e.TileMatrixSet}),r=o.SupportedCRS,n=Ve(r.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,'$1:$3'))||Ve(r),a=Ve(t.projection);return n&&a?qe(n,a):r==t.projection}):Wt(r.TileMatrixSetLink,function(e){return e.TileMatrixSet==t.matrixSet}):0,0>n&&(n=0);const a=r.TileMatrixSetLink[n].TileMatrixSet,s=r.TileMatrixSetLink[n].TileMatrixSetLimits;let l=r.Format[0];'format'in t&&(l=t.format),n=Wt(r.Style,function(e){return'style'in t?e.Title==t.style:e.isDefault}),0>n&&(n=0);const d=r.Style[n].Identifier,p={};'Dimension'in r&&r.Dimension.forEach(function(e){const t=e.Identifier;let o=e.Default;void 0===o&&(o=e.Value[0]),p[t]=o});const g=e.Contents.TileMatrixSet,_=Vt(g,function(e){return e.Identifier==a});let u;const c=_.SupportedCRS;if(c&&(u=Ve(c.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,'$1:$3'))||Ve(c)),'projection'in t){const e=Ve(t.projection);e&&(!u||qe(e,u))&&(u=e)}const y=r.WGS84BoundingBox;let m,h;if(void 0!==y){const e=Ve('EPSG:4326').getExtent();h=y[0]==e[0]&&y[2]==e[2],m=et(y,'EPSG:4326',u);const t=u.getExtent();t&&!w(t,m)&&(m=void 0)}const f=kl(_,m,s),x=[];let E=t.requestEncoding;if(E=void 0===E?'':E,'OperationsMetadata'in e&&'GetTile'in e.OperationsMetadata){const t=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let e=0,o=t.length;e<o;++e)if(t[e].Constraint){const o=Vt(t[e].Constraint,function(e){return'GetEncoding'==e.name}),r=o.AllowedValues.Value;if(''===E&&(E=r[0]),E===iR.KVP)kt(r,iR.KVP)&&x.push(t[e].href);else break}else t[e].href&&(E=iR.KVP,x.push(t[e].href))}return 0===x.length&&(E=iR.REST,r.ResourceURL.forEach(function(e){'tile'===e.resourceType&&(l=e.format,x.push(e.template))})),{urls:x,layer:t.layer,matrixSet:a,format:l,projection:u,requestEncoding:E,tileGrid:f,style:d,dimensions:p,wrapX:h,crossOrigin:t.crossOrigin}}var Yl=String.fromCharCode,jl=Math.acos,Bl=Math.floor,Vl=Math.round,zl=Math.atan,Xl=Math.asin,Wl=Math.atan2,Kl=Math.PI,Hl=Math.abs,Zl=Math.LN2,ql=Math.exp,Jl=Math.sin,Ql=Math.cos,$l=Math.min,ed=Math.sqrt,td=Math.pow,od=Math.log,rd=Math.ceil,id=Math.max;Object.defineProperty(t,'__esModule',{value:!0});const nd=16384,ad=5,sd=771,ld=34962,dd=34963,pd=3042,gd=5121,_d=5126,ud=6408,cd=9729,yd=10240,md=10241,hd=10242,fd=10243,xd=3553,Ed=33071,Td=36160,Sd=['experimental-webgl','webgl','webkit-3d','moz-webgl'],Cd=!0;let Rd=!1,Id,Ld;if('undefined'!=typeof window&&'WebGLRenderingContext'in window)try{const e=document.createElement('CANVAS'),t=r(e,{failIfMajorPerformanceCaveat:!0});t&&(Rd=!0,Id=t.getParameter(t.MAX_TEXTURE_SIZE),Ld=t.getSupportedExtensions())}catch(t){}const Pd='v4.6.4';let vd=0;const Fd=function(e){const t=Pd.split('-')[0];this.message='Assertion failed. See https://openlayers.org/en/'+t+'/doc/errors/#'+e+' for details.',this.code=e,this.name='AssertionError'};i(Fd,Error);var Od=Fd,wd={ADD:'add',REMOVE:'remove'},Nd={PROPERTYCHANGE:'propertychange'};const Ad='function'==typeof Object.assign?Object.assign:function(e){if(e===void 0||null===e)throw new TypeError('Cannot convert undefined or null to object');const t=Object(e);for(let o=1,r=arguments.length;o<r;++o){const e=arguments[o];if(e!==void 0&&null!==e)for(const o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t},bd=function(){};bd.prototype.disposed_=!1,bd.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},bd.prototype.disposeInternal=T;var Md=bd;const Gd=function(e){this.propagationStopped,this.type=e,this.target=null};Gd.prototype.preventDefault=Gd.prototype.stopPropagation=function(){this.propagationStopped=!0};var Dd=Gd;const kd=function(){Md.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}};i(kd,Md),kd.prototype.addEventListener=function(e,t){let o=this.listeners_[e];o||(o=this.listeners_[e]=[]),-1===o.indexOf(t)&&o.push(t)},kd.prototype.dispatchEvent=function(e){const t='string'==typeof e?new Dd(e):e,o=t.type;t.target=this;const r=this.listeners_[o];let i;if(r){o in this.dispatching_||(this.dispatching_[o]=0,this.pendingRemovals_[o]=0),++this.dispatching_[o];for(let e=0,o=r.length;e<o;++e)if(!1===r[e].call(this,t)||t.propagationStopped){i=!1;break}if(--this.dispatching_[o],0===this.dispatching_[o]){let e=this.pendingRemovals_[o];for(delete this.pendingRemovals_[o];e--;)this.removeEventListener(o,T);delete this.dispatching_[o]}return i}},kd.prototype.disposeInternal=function(){f(this)},kd.prototype.getListeners=function(e){return this.listeners_[e]},kd.prototype.hasListener=function(e){return e?e in this.listeners_:0<Object.keys(this.listeners_).length},kd.prototype.removeEventListener=function(e,t){const o=this.listeners_[e];if(o){const r=o.indexOf(t);e in this.pendingRemovals_?(o[r]=T,++this.pendingRemovals_[e]):(o.splice(r,1),0===o.length&&delete this.listeners_[e])}};var Ud=kd,Yd={CHANGE:'change',CLEAR:'clear',CONTEXTMENU:'contextmenu',CLICK:'click',DBLCLICK:'dblclick',DRAGENTER:'dragenter',DRAGOVER:'dragover',DROP:'drop',ERROR:'error',KEYDOWN:'keydown',KEYPRESS:'keypress',LOAD:'load',MOUSEDOWN:'mousedown',MOUSEMOVE:'mousemove',MOUSEOUT:'mouseout',MOUSEUP:'mouseup',MOUSEWHEEL:'mousewheel',MSPOINTERDOWN:'MSPointerDown',RESIZE:'resize',TOUCHSTART:'touchstart',TOUCHMOVE:'touchmove',TOUCHEND:'touchend',WHEEL:'wheel'};const jd=function(){Ud.call(this),this.revision_=0};i(jd,Ud),jd.prototype.changed=function(){++this.revision_,this.dispatchEvent(Yd.CHANGE)},jd.prototype.dispatchEvent,jd.prototype.getRevision=function(){return this.revision_},jd.prototype.on=function(e,t){if(Array.isArray(e)){const o=e.length,r=Array(o);for(let n=0;n<o;++n)r[n]=c(this,e[n],t);return r}return c(this,e,t)},jd.prototype.once=function(e,t){if(Array.isArray(e)){const o=e.length,r=Array(o);for(let n=0;n<o;++n)r[n]=y(this,e[n],t);return r}return y(this,e,t)},jd.prototype.un=function(e,t){if(Array.isArray(e)){for(let o=0,r=e.length;o<r;++o)m(this,e[o],t);return}m(this,e,t)};var Bd=jd;const Vd=function(e,t,o){Dd.call(this,e),this.key=t,this.oldValue=o};i(Vd,Dd);const zd=function(e){Bd.call(this),n(this),this.values_={},e!==void 0&&this.setProperties(e)};i(zd,Bd);const Xd={};zd.prototype.get=function(e){let t;return this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t},zd.prototype.getKeys=function(){return Object.keys(this.values_)},zd.prototype.getProperties=function(){return Ad({},this.values_)},zd.prototype.notify=function(e,t){let o;o=C(e),this.dispatchEvent(new Vd(o,e,t)),o=Nd.PROPERTYCHANGE,this.dispatchEvent(new Vd(o,e,t))},zd.prototype.set=function(e,t,o){if(o)this.values_[e]=t;else{const o=this.values_[e];this.values_[e]=t,o!==t&&this.notify(e,o)}},zd.prototype.setProperties=function(e,t){for(const o in e)this.set(o,e[o],t)},zd.prototype.unset=function(e,t){if(e in this.values_){const o=this.values_[e];delete this.values_[e],t||this.notify(e,o)}};var Wd=zd;const Kd={LENGTH:'length'},Hd=function(e,t){Dd.call(this,e),this.element=t};i(Hd,Dd);const Zd=function(e,t){Wd.call(this);if(this.unique_=!!(t||{}).unique,this.array_=e?e:[],this.unique_)for(let e=0,t=this.array_.length;e<t;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()};i(Zd,Wd),Zd.prototype.clear=function(){for(;0<this.getLength();)this.pop()},Zd.prototype.extend=function(e){for(let t=0,o=e.length;t<o;++t)this.push(e[t]);return this},Zd.prototype.forEach=function(e){const t=this.array_;for(let o=0,r=t.length;o<r;++o)e(t[o],o,t)},Zd.prototype.getArray=function(){return this.array_},Zd.prototype.item=function(e){return this.array_[e]},Zd.prototype.getLength=function(){return this.get(Kd.LENGTH)},Zd.prototype.insertAt=function(e,t){this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Hd(wd.ADD,t))},Zd.prototype.pop=function(){return this.removeAt(this.getLength()-1)},Zd.prototype.push=function(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()},Zd.prototype.remove=function(e){const t=this.array_;for(let o=0,r=t.length;o<r;++o)if(t[o]===e)return this.removeAt(o)},Zd.prototype.removeAt=function(e){const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Hd(wd.REMOVE,t)),t},Zd.prototype.setAt=function(e,t){const o=this.getLength();if(e<o){this.unique_&&this.assertUnique_(t,e);const o=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Hd(wd.REMOVE,o)),this.dispatchEvent(new Hd(wd.ADD,t))}else{for(let t=o;t<e;++t)this.insertAt(t,void 0);this.insertAt(e,t)}},Zd.prototype.updateLength_=function(){this.set(Kd.LENGTH,this.array_.length)},Zd.prototype.assertUnique_=function(e,t){for(let o=0,r=this.array_.length;o<r;++o)if(this.array_[o]===e&&o!==t)throw new Od(58)};var qd=Zd,Jd={BOTTOM_LEFT:'bottom-left',BOTTOM_RIGHT:'bottom-right',TOP_LEFT:'top-left',TOP_RIGHT:'top-right'},Qd={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};const $d=function(){let e;return e='cosh'in Math?Math.cosh:function(e){const t=ql(e);return(t+1/t)/2},e}();var ep={POINT:'Point',LINE_STRING:'LineString',LINEAR_RING:'LinearRing',POLYGON:'Polygon',MULTI_POINT:'MultiPoint',MULTI_LINE_STRING:'MultiLineString',MULTI_POLYGON:'MultiPolygon',GEOMETRY_COLLECTION:'GeometryCollection',CIRCLE:'Circle'};/**
 * @license
 * Latitude/longitude spherical geodesy formulae taken from
 * http://www.movable-type.co.uk/scripts/latlong.html
 * Licensed under CC-BY-3.0.
 */const tp=6371008.8,op={DEGREES:'degrees',FEET:'ft',METERS:'m',PIXELS:'pixels',TILE_PIXELS:'tile-pixels',USFEET:'us-ft'},rp={};rp[op.DEGREES]=6370997*(2*Kl)/360,rp[op.FEET]=.3048,rp[op.METERS]=1,rp[op.USFEET]=1200/3937;var ip=op;const np=function(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent===void 0?null:e.extent,this.worldExtent_=e.worldExtent===void 0?null:e.worldExtent,this.axisOrientation_=e.axisOrientation===void 0?'enu':e.axisOrientation,this.global_=e.global!==void 0&&e.global,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit};np.prototype.canWrapX=function(){return this.canWrapX_},np.prototype.getCode=function(){return this.code_},np.prototype.getExtent=function(){return this.extent_},np.prototype.getUnits=function(){return this.units_},np.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||rp[this.units_]},np.prototype.getWorldExtent=function(){return this.worldExtent_},np.prototype.getAxisOrientation=function(){return this.axisOrientation_},np.prototype.isGlobal=function(){return this.global_},np.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)},np.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},np.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},np.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)},np.prototype.setWorldExtent=function(e){this.worldExtent_=e},np.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},np.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var ap=np;const sp=6378137,lp=Kl*sp,dp=[-lp,-lp,lp,lp],pp=[-180,-85,180,85];i(we,ap);const gp=[new we('EPSG:3857'),new we('EPSG:102100'),new we('EPSG:102113'),new we('EPSG:900913'),new we('urn:ogc:def:crs:EPSG:6.18:3:3857'),new we('urn:ogc:def:crs:EPSG::3857'),new we('http://www.opengis.net/gml/srs/epsg.xml#3857')],_p=[-180,-90,180,90],up=Kl*6378137/180;i(be,ap);const cp=[new be('CRS:84'),new be('EPSG:4326','neu'),new be('urn:ogc:def:crs:EPSG::4326','neu'),new be('urn:ogc:def:crs:EPSG:6.6:4326','neu'),new be('urn:ogc:def:crs:OGC:1.3:CRS84'),new be('urn:ogc:def:crs:OGC:2:84'),new be('http://www.opengis.net/gml/srs/epsg.xml#4326','neu'),new be('urn:x-ogc:def:crs:EPSG:4326','neu')];let yp={},mp={};(function(){Xe(gp),Xe(cp),We(cp,gp,Ne,Ae)})();const hp=[,,,,,,],fp=function(){Wd.call(this),this.extent_=b(),this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0};i(fp,Wd);const xp=tt();fp.prototype.clone=function(){},fp.prototype.closestPointXY=function(){},fp.prototype.getClosestPoint=function(e,t){const o=t?t:[NaN,NaN];return this.closestPointXY(e[0],e[1],o,Infinity),o},fp.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])},fp.prototype.computeExtent=function(){},fp.prototype.containsXY=x,fp.prototype.getExtent=function(e){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),le(this.extent_,e)},fp.prototype.rotate=function(){},fp.prototype.scale=function(){},fp.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)},fp.prototype.getSimplifiedGeometry=function(){},fp.prototype.getType=function(){},fp.prototype.applyTransform=function(){},fp.prototype.intersectsExtent=function(){},fp.prototype.translate=function(){},fp.prototype.transform=function(e,t){e=Ve(e);const o=e.getUnits()==ip.TILE_PIXELS?function(o,r,i){const n=e.getExtent(),a=e.getWorldExtent(),s=te(a)/te(n);return pt(xp,a[0],a[3],s,-s,0,0,0),_e(o,0,o.length,i,xp,r),Qe(e,t)(o,r,i)}:Qe(e,t);return this.applyTransform(o),this};var Ep=fp;const Tp=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Sp=/^([a-z]*)$/i,Cp=function(){const e={};let t=0;return function(o){let r;if(e.hasOwnProperty(o))r=e[o];else{if(t>=1024){let o=0;for(const r in e)0==(3&o++)&&(delete e[r],--t)}r=mt(o),e[o]=r,++t}return r}}(),Rp='undefined'==typeof navigator?'':navigator.userAgent.toLowerCase(),Ip=-1!==Rp.indexOf('firefox'),Lp=-1!==Rp.indexOf('safari')&&-1==Rp.indexOf('chrom'),Pp=-1!==Rp.indexOf('webkit')&&-1==Rp.indexOf('edge'),vp=-1!==Rp.indexOf('macintosh'),Fp=window.devicePixelRatio||1,Op=function(){let e=!1;try{e=!!document.createElement('CANVAS').getContext('2d').setLineDash}catch(t){}return e}(),wp='geolocation'in navigator,Np='ontouchstart'in window,Ap='PointerEvent'in window,bp=!!navigator.msPointerEnabled,Mp=Rd;var Gp={IDLE:0,LOADING:1,LOADED:2,ERROR:3};const Dp='ol-hidden',kp='ol-unselectable',Up='ol-control',Yp='ol-collapsed',jp=function(){let e;const t={};return function(o){if(e||(e=document.createElement('div').style),!(o in t)){e.font=o;const r=e.fontFamily;if(e.font='',!r)return null;t[o]=r.split(/,\s?/)}return t[o]}}(),Bp=function(e){Ud.call(this),this.highWaterMark=e===void 0?2048:e,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null};i(Bp,Ud),Bp.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},Bp.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(Yd.CLEAR)},Bp.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},Bp.prototype.forEach=function(e,t){for(let o=this.oldest_;o;)e.call(t,o.value_,o.key_,this),o=o.newer},Bp.prototype.get=function(e){const t=this.entries_[e];return(R(void 0!==t,15),t===this.newest_)?t.value_:(t===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(t.newer.older=t.older,t.older.newer=t.newer),t.newer=null,t.older=this.newest_,this.newest_.newer=t,this.newest_=t,t.value_)},Bp.prototype.remove=function(e){const t=this.entries_[e];return R(void 0!==t,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_},Bp.prototype.getCount=function(){return this.count_},Bp.prototype.getKeys=function(){const e=Array(this.count_);let t=0,o;for(o=this.newest_;o;o=o.older)e[t++]=o.key_;return e},Bp.prototype.getValues=function(){const e=Array(this.count_);let t=0,o;for(o=this.newest_;o;o=o.older)e[t++]=o.value_;return e},Bp.prototype.peekLast=function(){return this.oldest_.value_},Bp.prototype.peekLastKey=function(){return this.oldest_.key_},Bp.prototype.peekFirstKey=function(){return this.newest_.key_},Bp.prototype.pop=function(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},Bp.prototype.replace=function(e,t){this.get(e),this.entries_[e].value_=t},Bp.prototype.set=function(e,t){R(!(e in this.entries_),16);const o={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=o:this.oldest_=o,this.newest_=o,this.entries_[e]=o,++this.count_},Bp.prototype.setSize=function(e){this.highWaterMark=e},Bp.prototype.prune=function(){for(;this.canExpireCache();)this.pop()};var Vp=Bp;const zp='10px sans-serif',Xp=[0,0,0,1],Wp='round',Kp=[],Hp=0,Zp='round',qp=10,Jp=[0,0,0,1],Qp='center',$p='middle',eg=[0,0,0,0],tg=1,og=new Vp,rg={};let ig=null;const ng={},ag=function(){function e(e){const t=Pt();let o=!0;for(let r=0;r<l;++r){const i=s[r];if(t.font=n+i,g=t.measureText(d).width,e!=i){t.font=n+e+','+i;const r=t.measureText(d).width;o=o&&r!=g}}return o}function t(){let t=!0;for(const i in r)r[i]<o&&(e(i)?(r[i]=o,a(ng),ig=null,og.clear()):(++r[i],t=!1));t&&(clearInterval(p),p=void 0)}const o=60,r=rg,n='32px ',s=['monospace','serif'],l=s.length,d='wmytzilWMYTZIL@#/&?$%10\uF013';let p,g;return function(i){const n=jp(i);if(n)for(let a=0,i=n.length;a<i;++a){const i=n[a];i in r||(r[i]=o,!e(i)&&(r[i]=0,void 0===p&&(p=setInterval(t,32))))}}}(),sg=function(){let e;const t=ng;return function(o){let r=t[o];return void 0==r&&(!e&&(e=document.createElement('span'),e.textContent='M',e.style.margin=e.style.padding='0 !important',e.style.position='absolute !important',e.style.left='-99999px !important'),e.style.font=o,document.body.appendChild(e),r=t[o]=e.offsetHeight,document.body.removeChild(e)),r}}(),lg=tt(),dg=function(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.snapToPixel_=e.snapToPixel};dg.prototype.getOpacity=function(){return this.opacity_},dg.prototype.getRotateWithView=function(){return this.rotateWithView_},dg.prototype.getRotation=function(){return this.rotation_},dg.prototype.getScale=function(){return this.scale_},dg.prototype.getSnapToPixel=function(){return this.snapToPixel_},dg.prototype.getAnchor=function(){},dg.prototype.getImage=function(){},dg.prototype.getHitDetectionImage=function(){},dg.prototype.getImageState=function(){},dg.prototype.getImageSize=function(){},dg.prototype.getHitDetectionImageSize=function(){},dg.prototype.getOrigin=function(){},dg.prototype.getSize=function(){},dg.prototype.setOpacity=function(e){this.opacity_=e},dg.prototype.setRotateWithView=function(e){this.rotateWithView_=e},dg.prototype.setRotation=function(e){this.rotation_=e},dg.prototype.setScale=function(e){this.scale_=e},dg.prototype.setSnapToPixel=function(e){this.snapToPixel_=e},dg.prototype.listenImageChange=function(){},dg.prototype.load=function(){},dg.prototype.unlistenImageChange=function(){};var pg=dg;const gg=function(e){this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=e.fill===void 0?null:e.fill,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius===void 0?e.radius1:e.radius,this.radius2_=e.radius2,this.angle_=e.angle===void 0?0:e.angle,this.stroke_=e.stroke===void 0?null:e.stroke,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=e.atlasManager,this.render_(this.atlasManager_);const t=!(e.snapToPixel!==void 0)||e.snapToPixel,o=e.rotateWithView!==void 0&&e.rotateWithView;pg.call(this,{opacity:1,rotateWithView:o,rotation:e.rotation===void 0?0:e.rotation,scale:1,snapToPixel:t})};i(gg,pg),gg.prototype.clone=function(){const e=new gg({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),snapToPixel:this.getSnapToPixel(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return e.setOpacity(this.getOpacity()),e.setScale(this.getScale()),e},gg.prototype.getAnchor=function(){return this.anchor_},gg.prototype.getAngle=function(){return this.angle_},gg.prototype.getFill=function(){return this.fill_},gg.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_},gg.prototype.getImage=function(){return this.canvas_},gg.prototype.getImageSize=function(){return this.imageSize_},gg.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},gg.prototype.getImageState=function(){return Gp.LOADED},gg.prototype.getOrigin=function(){return this.origin_},gg.prototype.getPoints=function(){return this.points_},gg.prototype.getRadius=function(){return this.radius_},gg.prototype.getRadius2=function(){return this.radius2_},gg.prototype.getSize=function(){return this.size_},gg.prototype.getStroke=function(){return this.stroke_},gg.prototype.listenImageChange=function(){},gg.prototype.load=function(){},gg.prototype.unlistenImageChange=function(){},gg.prototype.render_=function(e){let t='',o='',r=0,i=null,n=0,a=0,s,l;this.stroke_&&(l=this.stroke_.getColor(),null===l&&(l=Jp),l=xt(l),a=this.stroke_.getWidth(),a===void 0&&(a=tg),i=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),!Op&&(i=null,n=0),o=this.stroke_.getLineJoin(),o===void 0&&(o=Zp),t=this.stroke_.getLineCap(),t===void 0&&(t=Wp),r=this.stroke_.getMiterLimit(),r===void 0&&(r=qp));let d=2*(this.radius_+a)+1;const p={strokeStyle:l,strokeWidth:a,size:d,lineCap:t,lineDash:i,lineDashOffset:n,lineJoin:o,miterLimit:r};if(e===void 0){const e=Tt(d,d);this.canvas_=e.canvas,d=this.canvas_.width,s=d,this.draw_(p,e,0,0),this.createHitDetectionCanvas_(p)}else{d=Vl(d);const t=!this.fill_;let o;t&&(o=this.drawHitDetectionCanvas_.bind(this,p));const r=this.getChecksum(),i=e.add(r,d,d,this.draw_.bind(this,p),o);this.canvas_=i.image,this.origin_=[i.offsetX,i.offsetY],s=i.image.width,t?(this.hitDetectionCanvas_=i.hitImage,this.hitDetectionImageSize_=[i.hitImage.width,i.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[s,s])}this.anchor_=[d/2,d/2],this.size_=[d,d],this.imageSize_=[s,s]},gg.prototype.draw_=function(e,t,o,r){let n,i,a;t.setTransform(1,0,0,1,0,0),t.translate(o,r),t.beginPath();let s=this.points_;if(s===Infinity)t.arc(e.size/2,e.size/2,this.radius_,0,2*Kl,!0);else{const o=this.radius2_===void 0?this.radius_:this.radius2_;for(o!==this.radius_&&(s=2*s),n=0;n<=s;n++)i=2*n*Kl/s-Kl/2+this.angle_,a=0==n%2?this.radius_:o,t.lineTo(e.size/2+a*Ql(i),e.size/2+a*Jl(i))}if(this.fill_){let e=this.fill_.getColor();null===e&&(e=Xp),t.fillStyle=xt(e),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke()),t.closePath()},gg.prototype.createHitDetectionCanvas_=function(e){if(this.hitDetectionImageSize_=[e.size,e.size],this.fill_)return void(this.hitDetectionCanvas_=this.canvas_);const t=Tt(e.size,e.size);this.hitDetectionCanvas_=t.canvas,this.drawHitDetectionCanvas_(e,t,0,0)},gg.prototype.drawHitDetectionCanvas_=function(e,t,o,r){t.setTransform(1,0,0,1,0,0),t.translate(o,r),t.beginPath();let n=this.points_;if(n===Infinity)t.arc(e.size/2,e.size/2,this.radius_,0,2*Kl,!0);else{const o=this.radius2_===void 0?this.radius_:this.radius2_;o!==this.radius_&&(n=2*n);let r,i,a;for(r=0;r<=n;r++)a=2*r*Kl/n-Kl/2+this.angle_,i=0==r%2?this.radius_:o,t.lineTo(e.size/2+i*Ql(a),e.size/2+i*Jl(a))}t.fillStyle=Xp,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.stroke()),t.closePath()},gg.prototype.getChecksum=function(){const e=this.stroke_?this.stroke_.getChecksum():'-',t=this.fill_?this.fill_.getChecksum():'-',o=!this.checksums_||e!=this.checksums_[1]||t!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6];if(o){const o='r'+e+t+(this.radius_===void 0?'-':this.radius_.toString())+(this.radius2_===void 0?'-':this.radius2_.toString())+(this.angle_===void 0?'-':this.angle_.toString())+(this.points_===void 0?'-':this.points_.toString());this.checksums_=[o,e,t,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]};var _g=gg;const ug=function(e){const t=e||{};_g.call(this,{points:Infinity,fill:t.fill,radius:t.radius,snapToPixel:t.snapToPixel,stroke:t.stroke,atlasManager:t.atlasManager})};i(ug,_g),ug.prototype.clone=function(){const e=new ug({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),snapToPixel:this.getSnapToPixel(),atlasManager:this.atlasManager_});return e.setOpacity(this.getOpacity()),e.setScale(this.getScale()),e},ug.prototype.setRadius=function(e){this.radius_=e,this.render_(this.atlasManager_)};var cg=ug;const yg=function(e){const t=e||{};this.color_=t.color===void 0?null:t.color,this.checksum_=void 0};yg.prototype.clone=function(){const e=this.getColor();return new yg({color:e&&e.slice?e.slice():e||void 0})},yg.prototype.getColor=function(){return this.color_},yg.prototype.setColor=function(e){this.color_=e,this.checksum_=void 0},yg.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?this.checksum_=n(this.color_).toString():this.checksum_='f'+(this.color_?ut(this.color_):'-')),this.checksum_};var mg=yg;const hg=function(e){const t=e||{};this.color_=t.color===void 0?null:t.color,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash===void 0?null:t.lineDash,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width,this.checksum_=void 0};hg.prototype.clone=function(){const e=this.getColor();return new hg({color:e&&e.slice?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},hg.prototype.getColor=function(){return this.color_},hg.prototype.getLineCap=function(){return this.lineCap_},hg.prototype.getLineDash=function(){return this.lineDash_},hg.prototype.getLineDashOffset=function(){return this.lineDashOffset_},hg.prototype.getLineJoin=function(){return this.lineJoin_},hg.prototype.getMiterLimit=function(){return this.miterLimit_},hg.prototype.getWidth=function(){return this.width_},hg.prototype.setColor=function(e){this.color_=e,this.checksum_=void 0},hg.prototype.setLineCap=function(e){this.lineCap_=e,this.checksum_=void 0},hg.prototype.setLineDash=function(e){this.lineDash_=e,this.checksum_=void 0},hg.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e,this.checksum_=void 0},hg.prototype.setLineJoin=function(e){this.lineJoin_=e,this.checksum_=void 0},hg.prototype.setMiterLimit=function(e){this.miterLimit_=e,this.checksum_=void 0},hg.prototype.setWidth=function(e){this.width_=e,this.checksum_=void 0},hg.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_='s',this.checksum_+=this.color_?'string'==typeof this.color_?this.color_:n(this.color_).toString():'-',this.checksum_+=','+(void 0===this.lineCap_?'-':this.lineCap_.toString())+','+(this.lineDash_?this.lineDash_.toString():'-')+','+(void 0===this.lineDashOffset_?'-':this.lineDashOffset_)+','+(void 0===this.lineJoin_?'-':this.lineJoin_)+','+(void 0===this.miterLimit_?'-':this.miterLimit_.toString())+','+(void 0===this.width_?'-':this.width_.toString())),this.checksum_};var fg=hg;const xg=function(e){const t=e||{};this.geometry_=null,this.geometryFunction_=bt,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill===void 0?null:t.fill,this.image_=t.image===void 0?null:t.image,this.renderer_=t.renderer===void 0?null:t.renderer,this.stroke_=t.stroke===void 0?null:t.stroke,this.text_=t.text===void 0?null:t.text,this.zIndex_=t.zIndex};xg.prototype.clone=function(){let e=this.getGeometry();return e&&e.clone&&(e=e.clone()),new xg({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},xg.prototype.getRenderer=function(){return this.renderer_},xg.prototype.setRenderer=function(e){this.renderer_=e},xg.prototype.getGeometry=function(){return this.geometry_},xg.prototype.getGeometryFunction=function(){return this.geometryFunction_},xg.prototype.getFill=function(){return this.fill_},xg.prototype.setFill=function(e){this.fill_=e},xg.prototype.getImage=function(){return this.image_},xg.prototype.setImage=function(e){this.image_=e},xg.prototype.getStroke=function(){return this.stroke_},xg.prototype.setStroke=function(e){this.stroke_=e},xg.prototype.getText=function(){return this.text_},xg.prototype.setText=function(e){this.text_=e},xg.prototype.getZIndex=function(){return this.zIndex_},xg.prototype.setGeometry=function(e){'function'==typeof e?this.geometryFunction_=e:'string'==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=bt,this.geometry_=e},xg.prototype.setZIndex=function(e){this.zIndex_=e};let Eg=null;var Tg=xg;const Sg=function(e){if(Wd.call(this),this.id_=void 0,this.geometryName_='geometry',this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,c(this,C(this.geometryName_),this.handleGeometryChanged_,this),void 0!==e)if(e instanceof Ep||!e){this.setGeometry(e)}else{this.setProperties(e)}};i(Sg,Wd),Sg.prototype.clone=function(){const e=new Sg(this.getProperties());e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const o=this.getStyle();return o&&e.setStyle(o),e},Sg.prototype.getGeometry=function(){return this.get(this.geometryName_)},Sg.prototype.getId=function(){return this.id_},Sg.prototype.getGeometryName=function(){return this.geometryName_},Sg.prototype.getStyle=function(){return this.style_},Sg.prototype.getStyleFunction=function(){return this.styleFunction_},Sg.prototype.handleGeometryChange_=function(){this.changed()},Sg.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(h(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=c(e,Yd.CHANGE,this.handleGeometryChange_,this)),this.changed()},Sg.prototype.setGeometry=function(e){this.set(this.geometryName_,e)},Sg.prototype.setStyle=function(e){this.style_=e,this.styleFunction_=e?Mt(e):void 0,this.changed()},Sg.prototype.setId=function(e){this.id_=e,this.changed()},Sg.prototype.setGeometryName=function(e){m(this,C(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=e,c(this,C(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()};var Cg=Sg,Rg={ACCURACY:'accuracy',ACCURACY_GEOMETRY:'accuracyGeometry',ALTITUDE:'altitude',ALTITUDE_ACCURACY:'altitudeAccuracy',HEADING:'heading',POSITION:'position',PROJECTION:'projection',SPEED:'speed',TRACKING:'tracking',TRACKING_OPTIONS:'trackingOptions'},Ig={XY:'XY',XYZ:'XYZ',XYM:'XYM',XYZM:'XYZM'};const Lg=function(){Ep.call(this),this.layout=Ig.XY,this.stride=2,this.flatCoordinates=null};i(Lg,Ep),Lg.prototype.containsXY=x,Lg.prototype.computeExtent=function(e){return Y(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},Lg.prototype.getCoordinates=function(){},Lg.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},Lg.prototype.getFlatCoordinates=function(){return this.flatCoordinates},Lg.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},Lg.prototype.getLayout=function(){return this.layout},Lg.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!=this.getRevision()&&(a(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),0>e||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];else{const o=this.getSimplifiedGeometryInternal(e),r=o.getFlatCoordinates();return r.length<this.flatCoordinates.length?(this.simplifiedGeometryCache[t]=o,o):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}},Lg.prototype.getSimplifiedGeometryInternal=function(){return this},Lg.prototype.getStride=function(){return this.stride},Lg.prototype.setFlatCoordinatesInternal=function(e,t){this.stride=Zt(e),this.layout=e,this.flatCoordinates=t},Lg.prototype.setCoordinates=function(){},Lg.prototype.setLayout=function(e,t,o){let r;if(e)r=Zt(e);else{for(let e=0;e<o;++e){if(0===t.length)return this.layout=Ig.XY,void(this.stride=2);t=t[0]}r=t.length,e=Ht(r)}this.layout=e,this.stride=r},Lg.prototype.applyTransform=function(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},Lg.prototype.rotate=function(e,t){const o=this.getFlatCoordinates();if(o){const r=this.getStride();ue(o,0,o.length,r,e,t,o),this.changed()}},Lg.prototype.scale=function(e,t,o){let r=t;r===void 0&&(r=e);let i=o;i||(i=Q(this.getExtent()));const n=this.getFlatCoordinates();if(n){const t=this.getStride();ce(n,0,n.length,t,e,r,i,n),this.changed()}},Lg.prototype.translate=function(e,t){const o=this.getFlatCoordinates();if(o){const r=this.getStride();ye(o,0,o.length,r,e,t,o),this.changed()}};var Pg=Lg;const vg=function(e,t){Pg.call(this),this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(e,t)};i(vg,Pg),vg.prototype.clone=function(){const e=new vg(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},vg.prototype.closestPointXY=function(e,t,o,r){return r<F(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=ed(to(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,o,r))},vg.prototype.getArea=function(){return Jt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},vg.prototype.getCoordinates=function(){return _o(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},vg.prototype.getSimplifiedGeometryInternal=function(e){const t=[];t.length=yo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);const o=new vg(null);return o.setFlatCoordinates(Ig.XY,t),o},vg.prototype.getType=function(){return ep.LINEAR_RING},vg.prototype.intersectsExtent=function(){},vg.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=lo(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(Ig.XY,null)},vg.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var Fg=vg;const Og=function(e,t){Pg.call(this),this.setCoordinates(e,t)};i(Og,Pg),Og.prototype.clone=function(){const e=new Og(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},Og.prototype.closestPointXY=function(e,t,o,r){const n=this.flatCoordinates,i=xe(e,t,n[0],n[1]);if(i<r){const e=this.stride;for(let t=0;t<e;++t)o[t]=n[t];return o.length=e,i}return r},Og.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},Og.prototype.computeExtent=function(e){return k(this.flatCoordinates,e)},Og.prototype.getType=function(){return ep.POINT},Og.prototype.intersectsExtent=function(e){return N(e,this.flatCoordinates[0],this.flatCoordinates[1])},Og.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,0),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=so(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(Ig.XY,null)},Og.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var wg=Og;const Ng=function(e,t){Pg.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(e,t)};i(Ng,Pg),Ng.prototype.appendLinearRing=function(e){this.flatCoordinates?jt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},Ng.prototype.clone=function(){const e=new Ng(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),e},Ng.prototype.closestPointXY=function(e,t,o,r){return r<F(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=ed(oo(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),no(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,o,r))},Ng.prototype.containsXY=function(e,t){return Co(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)},Ng.prototype.getArea=function(){return Qt(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},Ng.prototype.getCoordinates=function(e){let t;return void 0===e?t=this.flatCoordinates:(t=this.getOrientedFlatCoordinates().slice(),Do(t,0,this.ends_,this.stride,e)),uo(t,0,this.ends_,this.stride)},Ng.prototype.getEnds=function(){return this.ends_},Ng.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Q(this.getExtent());this.flatInteriorPoint_=Io(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},Ng.prototype.getInteriorPoint=function(){return new wg(this.getFlatInteriorPoint(),Ig.XYM)},Ng.prototype.getLinearRingCount=function(){return this.ends_.length},Ng.prototype.getLinearRing=function(e){if(0>e||this.ends_.length<=e)return null;const t=new Fg(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e])),t},Ng.prototype.getLinearRings=function(){const e=this.layout,t=this.flatCoordinates,o=this.ends_,r=[];let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a],s=new Fg(null);s.setFlatCoordinates(e,t.slice(n,i)),r.push(s),n=i}return r},Ng.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Mo(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Do(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},Ng.prototype.getSimplifiedGeometryInternal=function(e){const t=[],o=[];t.length=xo(this.flatCoordinates,0,this.ends_,this.stride,ed(e),t,0,o);const r=new Ng(null);return r.setFlatCoordinates(Ig.XY,t,o),r},Ng.prototype.getType=function(){return ep.POLYGON},Ng.prototype.intersectsExtent=function(e){return wo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)},Ng.prototype.setCoordinates=function(e,t){if(!e)this.setFlatCoordinates(Ig.XY,null,this.ends_);else{this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const o=po(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===o.length?0:o[o.length-1],this.changed()}},Ng.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t),this.ends_=o,this.changed()};var Ag=Ng;const bg=function(e){Wd.call(this);const t=e||{};this.position_=null,this.transform_=Ye,this.watchId_=void 0,c(this,C(Rg.PROJECTION),this.handleProjectionChanged_,this),c(this,C(Rg.TRACKING),this.handleTrackingChanged_,this),t.projection!==void 0&&this.setProjection(t.projection),t.trackingOptions!==void 0&&this.setTrackingOptions(t.trackingOptions),this.setTracking(t.tracking!==void 0&&t.tracking)};i(bg,Wd),bg.prototype.disposeInternal=function(){this.setTracking(!1),Wd.prototype.disposeInternal.call(this)},bg.prototype.handleProjectionChanged_=function(){const e=this.getProjection();e&&(this.transform_=Je(Ve('EPSG:4326'),e),this.position_&&this.set(Rg.POSITION,this.transform_(this.position_)))},bg.prototype.handleTrackingChanged_=function(){if(wp){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}},bg.prototype.positionChange_=function(e){const t=e.coords;this.set(Rg.ACCURACY,t.accuracy),this.set(Rg.ALTITUDE,null===t.altitude?void 0:t.altitude),this.set(Rg.ALTITUDE_ACCURACY,null===t.altitudeAccuracy?void 0:t.altitudeAccuracy),this.set(Rg.HEADING,null===t.heading?void 0:Se(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const o=this.transform_(this.position_);this.set(Rg.POSITION,o),this.set(Rg.SPEED,null===t.speed?void 0:t.speed);const r=Uo(this.position_,t.accuracy);r.applyTransform(this.transform_),this.set(Rg.ACCURACY_GEOMETRY,r),this.changed()},bg.prototype.positionError_=function(e){e.type=Yd.ERROR,this.setTracking(!1),this.dispatchEvent(e)},bg.prototype.getAccuracy=function(){return this.get(Rg.ACCURACY)},bg.prototype.getAccuracyGeometry=function(){return this.get(Rg.ACCURACY_GEOMETRY)||null},bg.prototype.getAltitude=function(){return this.get(Rg.ALTITUDE)},bg.prototype.getAltitudeAccuracy=function(){return this.get(Rg.ALTITUDE_ACCURACY)},bg.prototype.getHeading=function(){return this.get(Rg.HEADING)},bg.prototype.getPosition=function(){return this.get(Rg.POSITION)},bg.prototype.getProjection=function(){return this.get(Rg.PROJECTION)},bg.prototype.getSpeed=function(){return this.get(Rg.SPEED)},bg.prototype.getTracking=function(){return this.get(Rg.TRACKING)},bg.prototype.getTrackingOptions=function(){return this.get(Rg.TRACKING_OPTIONS)},bg.prototype.setProjection=function(e){this.set(Rg.PROJECTION,Ve(e))},bg.prototype.setTracking=function(e){this.set(Rg.TRACKING,e)},bg.prototype.setTrackingOptions=function(e){this.set(Rg.TRACKING_OPTIONS,e)};const Mg=function(e,t){Pg.call(this),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(e,t)};i(Mg,Pg),Mg.prototype.appendCoordinate=function(e){this.flatCoordinates?jt(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()},Mg.prototype.clone=function(){const e=new Mg(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},Mg.prototype.closestPointXY=function(e,t,o,r){return r<F(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=ed(to(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,o,r))},Mg.prototype.forEachSegment=function(e){return Po(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},Mg.prototype.getCoordinateAtM=function(e,t){if(this.layout!=Ig.XYM&&this.layout!=Ig.XYZM)return null;return ir(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t!==void 0&&t)},Mg.prototype.getCoordinates=function(){return _o(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},Mg.prototype.getCoordinateAt=function(e,t){return rr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t)},Mg.prototype.getLength=function(){return ar(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},Mg.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},Mg.prototype.getSimplifiedGeometryInternal=function(e){const t=[];t.length=yo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);const o=new Mg(null);return o.setFlatCoordinates(Ig.XY,t),o},Mg.prototype.getType=function(){return ep.LINE_STRING},Mg.prototype.intersectsExtent=function(e){return vo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},Mg.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=lo(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(Ig.XY,null)},Mg.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var Gg=Mg,Dg={POSTCOMPOSE:'postcompose',PRECOMPOSE:'precompose',RENDER:'render'},kg={POINT:'point',LINE:'line'};const Ug=function(e){const t=e||{};this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.text_=t.text,this.textAlign_=t.textAlign,this.textBaseline_=t.textBaseline,this.fill_=t.fill===void 0?new mg({color:'#333'}):t.fill,this.maxAngle_=t.maxAngle===void 0?Kl/4:t.maxAngle,this.placement_=t.placement===void 0?kg.POINT:t.placement,this.overflow_=!!t.overflow,this.stroke_=t.stroke===void 0?null:t.stroke,this.offsetX_=t.offsetX===void 0?0:t.offsetX,this.offsetY_=t.offsetY===void 0?0:t.offsetY,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding};Ug.prototype.clone=function(){return new Ug({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0})},Ug.prototype.getOverflow=function(){return this.overflow_},Ug.prototype.getFont=function(){return this.font_},Ug.prototype.getMaxAngle=function(){return this.maxAngle_},Ug.prototype.getPlacement=function(){return this.placement_},Ug.prototype.getOffsetX=function(){return this.offsetX_},Ug.prototype.getOffsetY=function(){return this.offsetY_},Ug.prototype.getFill=function(){return this.fill_},Ug.prototype.getRotateWithView=function(){return this.rotateWithView_},Ug.prototype.getRotation=function(){return this.rotation_},Ug.prototype.getScale=function(){return this.scale_},Ug.prototype.getStroke=function(){return this.stroke_},Ug.prototype.getText=function(){return this.text_},Ug.prototype.getTextAlign=function(){return this.textAlign_},Ug.prototype.getTextBaseline=function(){return this.textBaseline_},Ug.prototype.getBackgroundFill=function(){return this.backgroundFill_},Ug.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},Ug.prototype.getPadding=function(){return this.padding_},Ug.prototype.setOverflow=function(e){this.overflow_=e},Ug.prototype.setFont=function(e){this.font_=e},Ug.prototype.setMaxAngle=function(e){this.maxAngle_=e},Ug.prototype.setOffsetX=function(e){this.offsetX_=e},Ug.prototype.setOffsetY=function(e){this.offsetY_=e},Ug.prototype.setPlacement=function(e){this.placement_=e},Ug.prototype.setFill=function(e){this.fill_=e},Ug.prototype.setRotation=function(e){this.rotation_=e},Ug.prototype.setScale=function(e){this.scale_=e},Ug.prototype.setStroke=function(e){this.stroke_=e},Ug.prototype.setText=function(e){this.text_=e},Ug.prototype.setTextAlign=function(e){this.textAlign_=e},Ug.prototype.setTextBaseline=function(e){this.textBaseline_=e},Ug.prototype.setBackgroundFill=function(e){this.backgroundFill_=e},Ug.prototype.setBackgroundStroke=function(e){this.backgroundStroke_=e},Ug.prototype.setPadding=function(e){this.padding_=e};var Yg=Ug;const jg=new fg({color:'rgba(0,0,0,0.2)'}),Bg=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],Vg=function(e){const t=e||{};if(this.map_=null,this.postcomposeListenerKey_=null,this.projection_=null,this.maxLat_=Infinity,this.maxLon_=Infinity,this.minLat_=-Infinity,this.minLon_=-Infinity,this.maxLatP_=Infinity,this.maxLonP_=Infinity,this.minLatP_=-Infinity,this.minLonP_=-Infinity,this.targetSize_=void 0===t.targetSize?100:t.targetSize,this.maxLines_=void 0===t.maxLines?100:t.maxLines,this.meridians_=[],this.parallels_=[],this.strokeStyle_=void 0===t.strokeStyle?jg:t.strokeStyle,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,!0==t.showLabels){const e=Ho;this.lonLabelFormatter_=void 0==t.lonLabelFormatter?e.bind(this,'EW'):t.lonLabelFormatter,this.latLabelFormatter_=void 0==t.latLabelFormatter?e.bind(this,'NS'):t.latLabelFormatter,this.lonLabelPosition_=void 0==t.lonLabelPosition?0:t.lonLabelPosition,this.latLabelPosition_=void 0==t.latLabelPosition?1:t.latLabelPosition,this.lonLabelStyle_=void 0===t.lonLabelStyle?new Yg({font:'12px Calibri,sans-serif',textBaseline:'bottom',fill:new mg({color:'rgba(0,0,0,1)'}),stroke:new fg({color:'rgba(255,255,255,1)',width:3})}):t.lonLabelStyle,this.latLabelStyle_=void 0===t.latLabelStyle?new Yg({font:'12px Calibri,sans-serif',textAlign:'end',fill:new mg({color:'rgba(0,0,0,1)'}),stroke:new fg({color:'rgba(255,255,255,1)',width:3})}):t.latLabelStyle,this.meridiansLabels_=[],this.parallelsLabels_=[]}this.setMap(void 0===t.map?null:t.map)};Vg.prototype.addMeridian_=function(e,t,o,r,i,n){const a=this.getMeridian_(e,t,o,r,n);if(ae(a.getExtent(),i)){if(this.meridiansLabels_){const t=this.getMeridianPoint_(a,i,n);this.meridiansLabels_[n]={geom:t,text:this.lonLabelFormatter_(e)}}this.meridians_[n++]=a}return n},Vg.prototype.getMeridianPoint_=function(e,t,o){const r=e.getFlatCoordinates(),i=id(t[1],r[1]),n=$l(t[3],r[r.length-1]),a=me(t[1]+Hl(t[1]-t[3])*this.lonLabelPosition_,i,n),s=[r[0],a],l=void 0===this.meridiansLabels_[o]?new wg(null):this.meridiansLabels_[o].geom;return l.setCoordinates(s),l},Vg.prototype.addParallel_=function(e,t,o,r,i,n){const a=this.getParallel_(e,t,o,r,n);if(ae(a.getExtent(),i)){if(this.parallelsLabels_){const t=this.getParallelPoint_(a,i,n);this.parallelsLabels_[n]={geom:t,text:this.latLabelFormatter_(e)}}this.parallels_[n++]=a}return n},Vg.prototype.getParallelPoint_=function(e,t,o){const r=e.getFlatCoordinates(),i=id(t[0],r[0]),n=$l(t[2],r[r.length-2]),a=me(t[0]+Hl(t[0]-t[2])*this.latLabelPosition_,i,n),s=[a,r[1]],l=void 0===this.parallelsLabels_[o]?new wg(null):this.parallelsLabels_[o].geom;return l.setCoordinates(s),l},Vg.prototype.createGraticule_=function(e,t,o,r){const i=this.getInterval_(o);if(-1==i)return this.meridians_.length=this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),void(this.parallelsLabels_&&(this.parallelsLabels_.length=0));const n=this.toLonLatTransform_(t);let a=n[0],s=n[1];const l=this.maxLines_;let d=[id(e[0],this.minLonP_),id(e[1],this.minLatP_),$l(e[2],this.maxLonP_),$l(e[3],this.maxLatP_)],p,g,_,u;d=et(d,this.projection_,'EPSG:4326');const c=d[3],y=d[2],m=d[1],h=d[0];for(a=Bl(a/i)*i,u=me(a,this.minLon_,this.maxLon_),g=this.addMeridian_(u,m,c,r,e,0),p=0;u!=this.minLon_&&p++<l;)u=id(u-i,this.minLon_),g=this.addMeridian_(u,m,c,r,e,g);for(u=me(a,this.minLon_,this.maxLon_),p=0;u!=this.maxLon_&&p++<l;)u=$l(u+i,this.maxLon_),g=this.addMeridian_(u,m,c,r,e,g);for(this.meridians_.length=g,this.meridiansLabels_&&(this.meridiansLabels_.length=g),s=Bl(s/i)*i,_=me(s,this.minLat_,this.maxLat_),g=this.addParallel_(_,h,y,r,e,0),p=0;_!=this.minLat_&&p++<l;)_=id(_-i,this.minLat_),g=this.addParallel_(_,h,y,r,e,g);for(_=me(s,this.minLat_,this.maxLat_),p=0;_!=this.maxLat_&&p++<l;)_=$l(_+i,this.maxLat_),g=this.addParallel_(_,h,y,r,e,g);this.parallels_.length=g,this.parallelsLabels_&&(this.parallelsLabels_.length=g)},Vg.prototype.getInterval_=function(e){const t=this.projectionCenterLonLat_[0],o=this.projectionCenterLonLat_[1];let r=-1,n,i,a,s;const l=td(this.targetSize_*e,2),d=[],p=[];for(n=0,i=Bg.length;n<i&&(a=Bg[n]/2,d[0]=t-a,d[1]=o-a,p[0]=t+a,p[1]=o+a,this.fromLonLatTransform_(d,d),this.fromLonLatTransform_(p,p),s=td(p[0]-d[0],2)+td(p[1]-d[1],2),!(s<=l));++n)r=Bg[n];return r},Vg.prototype.getMap=function(){return this.map_},Vg.prototype.getMeridian_=function(e,t,o,r,i){const n=lr(e,t,o,this.projection_,r),a=void 0===this.meridians_[i]?new Gg(null):this.meridians_[i];return a.setFlatCoordinates(Ig.XY,n),a},Vg.prototype.getMeridians=function(){return this.meridians_},Vg.prototype.getParallel_=function(e,t,o,r,i){const n=dr(e,t,o,this.projection_,r),a=void 0===this.parallels_[i]?new Gg(null):this.parallels_[i];return a.setFlatCoordinates(Ig.XY,n),a},Vg.prototype.getParallels=function(){return this.parallels_},Vg.prototype.handlePostCompose_=function(t){const e=t.vectorContext,o=t.frameState,r=o.extent,n=o.viewState,a=n.center,s=n.projection,d=n.resolution,p=o.pixelRatio,g=!this.projection_||!qe(this.projection_,s);g&&this.updateProjectionInfo_(s),this.createGraticule_(r,a,d,d*d/(4*p*p)),e.setFillStrokeStyle(null,this.strokeStyle_);let _,i,l;for(_=0,i=this.meridians_.length;_<i;++_)l=this.meridians_[_],e.drawGeometry(l);for(_=0,i=this.parallels_.length;_<i;++_)l=this.parallels_[_],e.drawGeometry(l);let u;if(this.meridiansLabels_)for(_=0,i=this.meridiansLabels_.length;_<i;++_)u=this.meridiansLabels_[_],this.lonLabelStyle_.setText(u.text),e.setTextStyle(this.lonLabelStyle_),e.drawGeometry(u.geom);if(this.parallelsLabels_)for(_=0,i=this.parallelsLabels_.length;_<i;++_)u=this.parallelsLabels_[_],this.latLabelStyle_.setText(u.text),e.setTextStyle(this.latLabelStyle_),e.drawGeometry(u.geom)},Vg.prototype.updateProjectionInfo_=function(e){const t=Ve('EPSG:4326'),o=e.getExtent(),r=e.getWorldExtent(),i=et(r,t,e),n=r[3],a=r[2],s=r[1],l=r[0],d=i[3],p=i[2],g=i[1],_=i[0];this.maxLat_=n,this.maxLon_=a,this.minLat_=s,this.minLon_=l,this.maxLatP_=d,this.maxLonP_=p,this.minLatP_=g,this.minLonP_=_,this.fromLonLatTransform_=Qe(t,e),this.toLonLatTransform_=Qe(e,t),this.projectionCenterLonLat_=this.toLonLatTransform_(Q(o)),this.projection_=e},Vg.prototype.setMap=function(e){this.map_&&(h(this.postcomposeListenerKey_),this.postcomposeListenerKey_=null,this.map_.render()),e&&(this.postcomposeListenerKey_=c(e,Dg.POSTCOMPOSE,this.handlePostCompose_,this),e.render()),this.map_=e};const zg=function(e,t,o,r){Ud.call(this),this.extent=e,this.pixelRatio_=o,this.resolution=t,this.state=r};i(zg,Ud),zg.prototype.changed=function(){this.dispatchEvent(Yd.CHANGE)},zg.prototype.getExtent=function(){return this.extent},zg.prototype.getImage=function(){},zg.prototype.getPixelRatio=function(){return this.pixelRatio_},zg.prototype.getResolution=function(){return this.resolution},zg.prototype.getState=function(){return this.state},zg.prototype.load=function(){};var Xg=zg;const Wg=function(e,t,o,r,i,n){Xg.call(this,e,t,o,Gp.IDLE),this.src_=r,this.image_=new Image,null!==i&&(this.image_.crossOrigin=i),this.imageListenerKeys_=null,this.state=Gp.IDLE,this.imageLoadFunction_=n};i(Wg,Xg),Wg.prototype.getImage=function(){return this.image_},Wg.prototype.handleImageError_=function(){this.state=Gp.ERROR,this.unlistenImage_(),this.changed()},Wg.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=te(this.extent)/this.image_.height),this.state=Gp.LOADED,this.unlistenImage_(),this.changed()},Wg.prototype.load=function(){(this.state==Gp.IDLE||this.state==Gp.ERROR)&&(this.state=Gp.LOADING,this.changed(),this.imageListenerKeys_=[y(this.image_,Yd.ERROR,this.handleImageError_,this),y(this.image_,Yd.LOAD,this.handleImageLoad_,this)],this.imageLoadFunction_(this,this.src_))},Wg.prototype.setImage=function(e){this.image_=e},Wg.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(h),this.imageListenerKeys_=null};var Kg=Wg,Hg={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};const Zg=function(e,t,o){Ud.call(this);const r=o?o:{};this.tileCoord=e,this.state=t,this.interimTile=null,this.key='',this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={}};i(Zg,Ud),Zg.prototype.changed=function(){this.dispatchEvent(Yd.CHANGE)},Zg.prototype.getKey=function(){return this.key+'/'+this.tileCoord},Zg.prototype.getInterimTile=function(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==Hg.LOADED)return e;e=e.interimTile}while(e);return this},Zg.prototype.refreshInterimChain=function(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==Hg.LOADED){e.interimTile=null;break}else e.getState()==Hg.LOADING?t=e:e.getState()==Hg.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)},Zg.prototype.getTileCoord=function(){return this.tileCoord},Zg.prototype.getState=function(){return this.state},Zg.prototype.setState=function(e){this.state=e,this.changed()},Zg.prototype.load=function(){},Zg.prototype.getAlpha=function(e,t){if(!this.transition_)return 1;let o=this.transitionStarts_[e];if(!o)o=t,this.transitionStarts_[e]=o;else if(-1===o)return 1;const r=t-o+1e3/60;return r>=this.transition_?1:pr(r/this.transition_)},Zg.prototype.inTransition=function(e){return!!this.transition_&&-1!==this.transitionStarts_[e]},Zg.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)};var qg=Zg;const Jg=function(e,t,o,r,i,n){qg.call(this,e,t,n),this.crossOrigin_=r,this.src_=o,this.image_=new Image,null!==r&&(this.image_.crossOrigin=r),this.imageListenerKeys_=null,this.tileLoadFunction_=i};i(Jg,qg),Jg.prototype.disposeInternal=function(){this.state==Hg.LOADING&&(this.unlistenImage_(),this.image_=cr()),this.interimTile&&this.interimTile.dispose(),this.state=Hg.ABORT,this.changed(),qg.prototype.disposeInternal.call(this)},Jg.prototype.getImage=function(){return this.image_},Jg.prototype.getKey=function(){return this.src_},Jg.prototype.handleImageError_=function(){this.state=Hg.ERROR,this.unlistenImage_(),this.image_=cr(),this.changed()},Jg.prototype.handleImageLoad_=function(){this.state=this.image_.naturalWidth&&this.image_.naturalHeight?Hg.LOADED:Hg.EMPTY,this.unlistenImage_(),this.changed()},Jg.prototype.load=function(){this.state==Hg.ERROR&&(this.state=Hg.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Hg.IDLE&&(this.state=Hg.LOADING,this.changed(),this.imageListenerKeys_=[y(this.image_,Yd.ERROR,this.handleImageError_,this),y(this.image_,Yd.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))},Jg.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(h),this.imageListenerKeys_=null};var Qg=Jg;const $g=function(e,t,o){this.decay_=e,this.minVelocity_=t,this.delay_=o,this.points_=[],this.angle_=0,this.initialVelocity_=0};$g.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},$g.prototype.update=function(e,t){this.points_.push(e,t,Date.now())},$g.prototype.end=function(){if(6>this.points_.length)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let o=t-3;for(;0<o&&this.points_[o+2]>e;)o-=3;const r=this.points_[t+2]-this.points_[o+2];if(r<1e3/60)return!1;const i=this.points_[t]-this.points_[o],n=this.points_[t+1]-this.points_[o+1];return this.angle_=Wl(n,i),this.initialVelocity_=ed(i*i+n*n)/r,this.initialVelocity_>this.minVelocity_},$g.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},$g.prototype.getAngle=function(){return this.angle_};var e_=$g;const t_=function(e,t,o){Dd.call(this,e),this.map=t,this.frameState=o===void 0?null:o};i(t_,Dd);var o_=t_;const r_=function(e,t,o,r,i){o_.call(this,e,t,i),this.originalEvent=o,this.pixel=t.getEventPixel(o),this.coordinate=t.getCoordinateFromPixel(this.pixel),this.dragging=r!==void 0&&r};i(r_,o_),r_.prototype.preventDefault=function(){o_.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},r_.prototype.stopPropagation=function(){o_.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()};var i_=r_,n_={SINGLECLICK:'singleclick',CLICK:Yd.CLICK,DBLCLICK:Yd.DBLCLICK,POINTERDRAG:'pointerdrag',POINTERMOVE:'pointermove',POINTERDOWN:'pointerdown',POINTERUP:'pointerup',POINTEROVER:'pointerover',POINTEROUT:'pointerout',POINTERENTER:'pointerenter',POINTERLEAVE:'pointerleave',POINTERCANCEL:'pointercancel'};const a_=function(e,t,o,r,i){i_.call(this,e,t,o.originalEvent,r,i),this.pointerEvent=o};i(a_,i_);var s_=a_,l_={POINTERMOVE:'pointermove',POINTERDOWN:'pointerdown',POINTERUP:'pointerup',POINTEROVER:'pointerover',POINTEROUT:'pointerout',POINTERENTER:'pointerenter',POINTERLEAVE:'pointerleave',POINTERCANCEL:'pointercancel'};const d_=function(e,t){this.dispatcher=e,this.mapping_=t};d_.prototype.getEvents=function(){return Object.keys(this.mapping_)},d_.prototype.getHandlerForEvent=function(e){return this.mapping_[e]};var p_=d_;const g_=function(e){const t={mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout};p_.call(this,e,t),this.pointerMap=e.pointerMap,this.lastTouches=[]};i(g_,p_);const __=1,u_='mouse',c_=25;g_.prototype.isEventSimulatedFromTouch_=function(e){const o=this.lastTouches,r=e.clientX,i=e.clientY;for(let n=0,a=o.length,s;n<a&&(s=o[n]);n++){const e=Hl(r-s[0]),t=Hl(i-s[1]);if(e<=c_&&t<=c_)return!0}return!1},g_.prototype.mousedown=function(t){if(!this.isEventSimulatedFromTouch_(t)){__.toString()in this.pointerMap&&this.cancel(t);const o=yr(t,this.dispatcher);this.pointerMap[__.toString()]=t,this.dispatcher.down(o,t)}},g_.prototype.mousemove=function(t){if(!this.isEventSimulatedFromTouch_(t)){const o=yr(t,this.dispatcher);this.dispatcher.move(o,t)}},g_.prototype.mouseup=function(t){if(!this.isEventSimulatedFromTouch_(t)){const e=this.pointerMap[__.toString()];if(e&&e.button===t.button){const o=yr(t,this.dispatcher);this.dispatcher.up(o,t),this.cleanupMouse()}}},g_.prototype.mouseover=function(t){if(!this.isEventSimulatedFromTouch_(t)){const o=yr(t,this.dispatcher);this.dispatcher.enterOver(o,t)}},g_.prototype.mouseout=function(t){if(!this.isEventSimulatedFromTouch_(t)){const o=yr(t,this.dispatcher);this.dispatcher.leaveOut(o,t)}},g_.prototype.cancel=function(t){const o=yr(t,this.dispatcher);this.dispatcher.cancel(o,t),this.cleanupMouse()},g_.prototype.cleanupMouse=function(){delete this.pointerMap[__.toString()]};var y_=g_;const m_=function(e){const t={MSPointerDown:this.msPointerDown,MSPointerMove:this.msPointerMove,MSPointerUp:this.msPointerUp,MSPointerOut:this.msPointerOut,MSPointerOver:this.msPointerOver,MSPointerCancel:this.msPointerCancel,MSGotPointerCapture:this.msGotPointerCapture,MSLostPointerCapture:this.msLostPointerCapture};p_.call(this,e,t),this.pointerMap=e.pointerMap};i(m_,p_);const h_=['','unavailable','touch','pen','mouse'];m_.prototype.prepareEvent_=function(t){let o=t;return'number'==typeof t.pointerType&&(o=this.dispatcher.cloneEvent(t,t),o.pointerType=h_[t.pointerType]),o},m_.prototype.cleanup=function(e){delete this.pointerMap[e.toString()]},m_.prototype.msPointerDown=function(t){this.pointerMap[t.pointerId.toString()]=t;const o=this.prepareEvent_(t);this.dispatcher.down(o,t)},m_.prototype.msPointerMove=function(t){const o=this.prepareEvent_(t);this.dispatcher.move(o,t)},m_.prototype.msPointerUp=function(t){const o=this.prepareEvent_(t);this.dispatcher.up(o,t),this.cleanup(t.pointerId)},m_.prototype.msPointerOut=function(t){const o=this.prepareEvent_(t);this.dispatcher.leaveOut(o,t)},m_.prototype.msPointerOver=function(t){const o=this.prepareEvent_(t);this.dispatcher.enterOver(o,t)},m_.prototype.msPointerCancel=function(t){const o=this.prepareEvent_(t);this.dispatcher.cancel(o,t),this.cleanup(t.pointerId)},m_.prototype.msLostPointerCapture=function(t){const o=this.dispatcher.makeEvent('lostpointercapture',t,t);this.dispatcher.dispatchEvent(o)},m_.prototype.msGotPointerCapture=function(t){const o=this.dispatcher.makeEvent('gotpointercapture',t,t);this.dispatcher.dispatchEvent(o)};const f_=function(e){const t={pointerdown:this.pointerDown,pointermove:this.pointerMove,pointerup:this.pointerUp,pointerout:this.pointerOut,pointerover:this.pointerOver,pointercancel:this.pointerCancel,gotpointercapture:this.gotPointerCapture,lostpointercapture:this.lostPointerCapture};p_.call(this,e,t)};i(f_,p_),f_.prototype.pointerDown=function(e){this.dispatcher.fireNativeEvent(e)},f_.prototype.pointerMove=function(e){this.dispatcher.fireNativeEvent(e)},f_.prototype.pointerUp=function(e){this.dispatcher.fireNativeEvent(e)},f_.prototype.pointerOut=function(e){this.dispatcher.fireNativeEvent(e)},f_.prototype.pointerOver=function(e){this.dispatcher.fireNativeEvent(e)},f_.prototype.pointerCancel=function(e){this.dispatcher.fireNativeEvent(e)},f_.prototype.lostPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)},f_.prototype.gotPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)};const x_=function(e,t,o){Dd.call(this,e),this.originalEvent=t;const r=o?o:{};this.buttons=this.getButtons_(r),this.pressure=this.getPressure_(r,this.buttons),this.bubbles=!!('bubbles'in r)&&r.bubbles,this.cancelable=!!('cancelable'in r)&&r.cancelable,this.view='view'in r?r.view:null,this.detail='detail'in r?r.detail:null,this.screenX='screenX'in r?r.screenX:0,this.screenY='screenY'in r?r.screenY:0,this.clientX='clientX'in r?r.clientX:0,this.clientY='clientY'in r?r.clientY:0,this.ctrlKey=!!('ctrlKey'in r)&&r.ctrlKey,this.altKey=!!('altKey'in r)&&r.altKey,this.shiftKey=!!('shiftKey'in r)&&r.shiftKey,this.metaKey=!!('metaKey'in r)&&r.metaKey,this.button='button'in r?r.button:0,this.relatedTarget='relatedTarget'in r?r.relatedTarget:null,this.pointerId='pointerId'in r?r.pointerId:0,this.width='width'in r?r.width:0,this.height='height'in r?r.height:0,this.tiltX='tiltX'in r?r.tiltX:0,this.tiltY='tiltY'in r?r.tiltY:0,this.pointerType='pointerType'in r?r.pointerType:'',this.hwTimestamp='hwTimestamp'in r?r.hwTimestamp:0,this.isPrimary=!!('isPrimary'in r)&&r.isPrimary,t.preventDefault&&(this.preventDefault=function(){t.preventDefault()})};i(x_,Dd);let E_=!1;x_.prototype.getButtons_=function(e){let t;if(e.buttons||E_)t=e.buttons;else switch(e.which){case 1:t=1;break;case 2:t=4;break;case 3:t=2;break;default:t=0;}return t},x_.prototype.getPressure_=function(e,t){let o=0;return o=e.pressure?e.pressure:t?.5:0,o},function(){try{const e=new MouseEvent('click',{buttons:1});E_=1===e.buttons}catch(t){}}();const T_=function(e,t){const o={touchstart:this.touchstart,touchmove:this.touchmove,touchend:this.touchend,touchcancel:this.touchcancel};p_.call(this,e,o),this.pointerMap=e.pointerMap,this.mouseSource=t,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_=void 0,this.dedupTimeout_=2500};i(T_,p_);T_.prototype.isPrimaryTouch_=function(e){return this.firstTouchId_===e.identifier},T_.prototype.setPrimaryTouch_=function(e){const t=Object.keys(this.pointerMap).length;(0===t||1===t&&__.toString()in this.pointerMap)&&(this.firstTouchId_=e.identifier,this.cancelResetClickCount_())},T_.prototype.removePrimaryPointer_=function(e){e.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())},T_.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),200)},T_.prototype.resetClickCountHandler_=function(){this.clickCount_=0,this.resetId_=void 0},T_.prototype.cancelResetClickCount_=function(){this.resetId_!==void 0&&clearTimeout(this.resetId_)},T_.prototype.touchToPointer_=function(t,o){const r=this.dispatcher.cloneEvent(t,o);return r.pointerId=o.identifier+2,r.bubbles=!0,r.cancelable=!0,r.detail=this.clickCount_,r.button=0,r.buttons=1,r.width=o.webkitRadiusX||o.radiusX||0,r.height=o.webkitRadiusY||o.radiusY||0,r.pressure=o.webkitForce||o.force||.5,r.isPrimary=this.isPrimaryTouch_(o),r.pointerType='touch',r.clientX=o.clientX,r.clientY=o.clientY,r.screenX=o.screenX,r.screenY=o.screenY,r},T_.prototype.processTouches_=function(e,t){function o(){e.preventDefault()}const r=Array.prototype.slice.call(e.changedTouches),n=r.length;for(let a=0;a<n;++a){const i=this.touchToPointer_(e,r[a]);i.preventDefault=o,t.call(this,e,i)}},T_.prototype.findTouch_=function(e,t){const o=e.length;for(let r=0;r<o;r++){const o=e[r];if(o.identifier===t)return!0}return!1},T_.prototype.vacuumTouches_=function(e){const t=e.touches,o=Object.keys(this.pointerMap),r=o.length;if(r>=t.length){const n=[];for(let e=0;e<r;++e){const r=o[e],i=this.pointerMap[r];r==__||this.findTouch_(t,r-2)||n.push(i.out)}for(let t=0;t<n.length;++t)this.cancelOut_(e,n[t])}},T_.prototype.touchstart=function(e){this.vacuumTouches_(e),this.setPrimaryTouch_(e.changedTouches[0]),this.dedupSynthMouse_(e),this.clickCount_++,this.processTouches_(e,this.overDown_)},T_.prototype.overDown_=function(e,t){this.pointerMap[t.pointerId]={target:t.target,out:t,outTarget:t.target},this.dispatcher.over(t,e),this.dispatcher.enter(t,e),this.dispatcher.down(t,e)},T_.prototype.touchmove=function(e){e.preventDefault(),this.processTouches_(e,this.moveOverOut_)},T_.prototype.moveOverOut_=function(e,t){const o=t,r=this.pointerMap[o.pointerId];if(r){const t=r.out,i=r.outTarget;this.dispatcher.move(o,e),t&&i!==o.target&&(t.relatedTarget=o.target,o.relatedTarget=i,t.target=i,o.target?(this.dispatcher.leaveOut(t,e),this.dispatcher.enterOver(o,e)):(o.target=i,o.relatedTarget=null,this.cancelOut_(e,o))),r.out=o,r.outTarget=o.target}},T_.prototype.touchend=function(e){this.dedupSynthMouse_(e),this.processTouches_(e,this.upOut_)},T_.prototype.upOut_=function(e,t){this.dispatcher.up(t,e),this.dispatcher.out(t,e),this.dispatcher.leave(t,e),this.cleanUpPointer_(t)},T_.prototype.touchcancel=function(e){this.processTouches_(e,this.cancelOut_)},T_.prototype.cancelOut_=function(e,t){this.dispatcher.cancel(t,e),this.dispatcher.out(t,e),this.dispatcher.leave(t,e),this.cleanUpPointer_(t)},T_.prototype.cleanUpPointer_=function(e){delete this.pointerMap[e.pointerId],this.removePrimaryPointer_(e)},T_.prototype.dedupSynthMouse_=function(e){const o=this.mouseSource.lastTouches,r=e.changedTouches[0];if(this.isPrimaryTouch_(r)){const e=[r.clientX,r.clientY];o.push(e),setTimeout(function(){Bt(o,e)},this.dedupTimeout_)}};const S_=function(e){Ud.call(this),this.element_=e,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()};i(S_,Ud);const C_=[['bubbles',!1],['cancelable',!1],['view',null],['detail',null],['screenX',0],['screenY',0],['clientX',0],['clientY',0],['ctrlKey',!1],['altKey',!1],['shiftKey',!1],['metaKey',!1],['button',0],['relatedTarget',null],['buttons',0],['pointerId',0],['width',0],['height',0],['pressure',0],['tiltX',0],['tiltY',0],['pointerType',''],['hwTimestamp',0],['isPrimary',!1],['type',''],['target',null],['currentTarget',null],['which',0]];S_.prototype.registerSources=function(){if(Ap)this.registerSource('native',new f_(this));else if(bp)this.registerSource('ms',new m_(this));else{const e=new y_(this);this.registerSource('mouse',e),Np&&this.registerSource('touch',new T_(this,e))}this.register_()},S_.prototype.registerSource=function(e,t){const o=t,r=o.getEvents();r&&(r.forEach(function(t){const e=o.getHandlerForEvent(t);e&&(this.eventMap_[t]=e.bind(o))}.bind(this)),this.eventSourceList_.push(o))},S_.prototype.register_=function(){const e=this.eventSourceList_.length;for(let t=0;t<e;t++){const e=this.eventSourceList_[t];this.addEvents_(e.getEvents())}},S_.prototype.unregister_=function(){const e=this.eventSourceList_.length;for(let t=0;t<e;t++){const e=this.eventSourceList_[t];this.removeEvents_(e.getEvents())}},S_.prototype.eventHandler_=function(e){const t=e.type,o=this.eventMap_[t];o&&o(e)},S_.prototype.addEvents_=function(e){e.forEach(function(e){c(this.element_,e,this.eventHandler_,this)}.bind(this))},S_.prototype.removeEvents_=function(e){e.forEach(function(t){m(this.element_,t,this.eventHandler_,this)}.bind(this))},S_.prototype.cloneEvent=function(e,t){const o={};for(let r=0,i=C_.length;r<i;r++){const i=C_[r][0];o[i]=e[i]||t[i]||C_[r][1]}return o},S_.prototype.down=function(e,t){this.fireEvent(l_.POINTERDOWN,e,t)},S_.prototype.move=function(e,t){this.fireEvent(l_.POINTERMOVE,e,t)},S_.prototype.up=function(e,t){this.fireEvent(l_.POINTERUP,e,t)},S_.prototype.enter=function(e,t){e.bubbles=!1,this.fireEvent(l_.POINTERENTER,e,t)},S_.prototype.leave=function(e,t){e.bubbles=!1,this.fireEvent(l_.POINTERLEAVE,e,t)},S_.prototype.over=function(e,t){e.bubbles=!0,this.fireEvent(l_.POINTEROVER,e,t)},S_.prototype.out=function(e,t){e.bubbles=!0,this.fireEvent(l_.POINTEROUT,e,t)},S_.prototype.cancel=function(e,t){this.fireEvent(l_.POINTERCANCEL,e,t)},S_.prototype.leaveOut=function(e,t){this.out(e,t),this.contains_(e.target,e.relatedTarget)||this.leave(e,t)},S_.prototype.enterOver=function(e,t){this.over(e,t),this.contains_(e.target,e.relatedTarget)||this.enter(e,t)},S_.prototype.contains_=function(e,t){return!!(e&&t)&&e.contains(t)},S_.prototype.makeEvent=function(e,t,o){return new x_(e,o,t)},S_.prototype.fireEvent=function(t,o,r){const i=this.makeEvent(t,o,r);this.dispatchEvent(i)},S_.prototype.fireNativeEvent=function(t){const o=this.makeEvent(t.type,t,t);this.dispatchEvent(o)},S_.prototype.wrapMouseEvent=function(e,t){const o=this.makeEvent(e,y_.prepareEvent(t,this),t);return o},S_.prototype.disposeInternal=function(){this.unregister_(),Ud.prototype.disposeInternal.call(this)};var R_=S_;const I_=function(e,t){Ud.call(this),this.map_=e,this.clickTimeoutId_=0,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t?t*Fp:Fp,this.down_=null;const o=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new R_(o),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=c(this.pointerEventHandler_,l_.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=c(this.pointerEventHandler_,l_.POINTERMOVE,this.relayEvent_,this)};i(I_,Ud),I_.prototype.emulateClick_=function(e){let t=new s_(n_.CLICK,this.map_,e);this.dispatchEvent(t),0===this.clickTimeoutId_?this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=0;const t=new s_(n_.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250):(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=0,t=new s_(n_.DBLCLICK,this.map_,e),this.dispatchEvent(t))},I_.prototype.updateActivePointers_=function(e){const t=e;t.type==n_.POINTERUP||t.type==n_.POINTERCANCEL?delete this.trackedTouches_[t.pointerId]:t.type==n_.POINTERDOWN&&(this.trackedTouches_[t.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},I_.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);const t=new s_(n_.POINTERUP,this.map_,e);this.dispatchEvent(t),t.propagationStopped||this.dragging_||!this.isMouseActionButton_(e)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(h),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)},I_.prototype.isMouseActionButton_=function(e){return 0===e.button},I_.prototype.handlePointerDown_=function(e){this.updateActivePointers_(e);const t=new s_(n_.POINTERDOWN,this.map_,e);this.dispatchEvent(t),this.down_=e,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new R_(document),this.dragListenerKeys_.push(c(this.documentPointerEventHandler_,n_.POINTERMOVE,this.handlePointerMove_,this),c(this.documentPointerEventHandler_,n_.POINTERUP,this.handlePointerUp_,this),c(this.pointerEventHandler_,n_.POINTERCANCEL,this.handlePointerUp_,this)))},I_.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;const t=new s_(n_.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(t)}e.preventDefault()},I_.prototype.relayEvent_=function(e){const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new s_(e.type,this.map_,e,t))},I_.prototype.isMoving_=function(e){return Hl(e.clientX-this.down_.clientX)>this.moveTolerance_||Hl(e.clientY-this.down_.clientY)>this.moveTolerance_},I_.prototype.disposeInternal=function(){this.relayedListenerKey_&&(h(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(h(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(h),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),Ud.prototype.disposeInternal.call(this)};var L_={POSTRENDER:'postrender',MOVESTART:'movestart',MOVEEND:'moveend'},P_={LAYERGROUP:'layergroup',SIZE:'size',TARGET:'target',VIEW:'view'};const v_=function(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}},F_=Infinity;v_.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,a(this.queuedElements_)},v_.prototype.dequeue=function(){const e=this.elements_,t=this.priorities_,o=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(o);return delete this.queuedElements_[r],o},v_.prototype.enqueue=function(e){R(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=F_&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},v_.prototype.getCount=function(){return this.elements_.length},v_.prototype.getLeftChildIndex_=function(e){return 2*e+1},v_.prototype.getRightChildIndex_=function(e){return 2*e+2},v_.prototype.getParentIndex_=function(e){return e-1>>1},v_.prototype.heapify_=function(){let e;for(e=(this.elements_.length>>1)-1;0<=e;e--)this.siftUp_(e)},v_.prototype.isEmpty=function(){return 0===this.elements_.length},v_.prototype.isKeyQueued=function(e){return e in this.queuedElements_},v_.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))},v_.prototype.siftUp_=function(e){const t=this.elements_,o=this.priorities_,r=t.length,i=t[e],n=o[e],a=e;for(;e<r>>1;){const i=this.getLeftChildIndex_(e),n=this.getRightChildIndex_(e),a=n<r&&o[n]<o[i]?n:i;t[e]=t[a],o[e]=o[a],e=a}t[e]=i,o[e]=n,this.siftDown_(a,e)},v_.prototype.siftDown_=function(e,t){const o=this.elements_,r=this.priorities_,i=o[t],n=r[t];for(;t>e;){const e=this.getParentIndex_(t);if(r[e]>n)o[t]=o[e],r[t]=r[e],t=e;else break}o[t]=i,r[t]=n},v_.prototype.reprioritize=function(){const e=this.priorityFunction_,t=this.elements_,o=this.priorities_;let r=0;const a=t.length;let n,s,i;for(s=0;s<a;++s)n=t[s],i=e(n),i==F_?delete this.queuedElements_[this.keyFunction_(n)]:(o[r]=i,t[r++]=n);t.length=r,o.length=r,this.heapify_()};var O_=v_;const w_=function(e,t){O_.call(this,function(t){return e.apply(null,t)},function(e){return e[0].getKey()}),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}};i(w_,O_),w_.prototype.enqueue=function(e){const t=O_.prototype.enqueue.call(this,e);if(t){const t=e[0];c(t,Yd.CHANGE,this.handleTileChange,this)}return t},w_.prototype.getTilesLoading=function(){return this.tilesLoading_},w_.prototype.handleTileChange=function(e){const t=e.target,o=t.getState();if(o===Hg.LOADED||o===Hg.ERROR||o===Hg.EMPTY||o===Hg.ABORT){m(t,Yd.CHANGE,this.handleTileChange,this);const e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}},w_.prototype.loadMoreTiles=function(e,t){let o=0,r=!1,i,n,a;for(;this.tilesLoading_<e&&o<t&&0<this.getCount();)n=this.dequeue()[0],a=n.getKey(),i=n.getState(),i===Hg.ABORT?r=!0:i===Hg.IDLE&&!(a in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[a]=!0,++this.tilesLoading_,++o,n.load());0==o&&r&&this.tileChangeCallback_()};var N_=w_;const A_=42,b_=256;var M_={ANIMATING:0,INTERACTING:1},G_={CENTER:'center',RESOLUTION:'resolution',ROTATION:'rotation'};const D_=0,k_=function(e){Wd.call(this);const t=Ad({},e);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.updateAnimations_=this.updateAnimations_.bind(this),this.projection_=Ke(t.projection,'EPSG:3857'),this.applyOptions_(t)};i(k_,Wd),k_.prototype.applyOptions_=function(e){const t={};t[G_.CENTER]=e.center===void 0?null:e.center;const o=Ir(e);this.maxResolution_=o.maxResolution,this.minResolution_=o.minResolution,this.zoomFactor_=o.zoomFactor,this.resolutions_=e.resolutions,this.minZoom_=o.minZoom;const r=Rr(e),i=o.constraint,n=Lr(e);this.constraints_={center:r,resolution:i,rotation:n},e.resolution===void 0?e.zoom!==void 0&&(t[G_.RESOLUTION]=this.constrainResolution(this.maxResolution_,e.zoom-this.minZoom_),this.resolutions_&&(t[G_.RESOLUTION]=me(+(this.getResolution()||t[G_.RESOLUTION]),this.minResolution_,this.maxResolution_))):t[G_.RESOLUTION]=e.resolution,t[G_.ROTATION]=e.rotation===void 0?0:e.rotation,this.setProperties(t),this.options_=e},k_.prototype.getUpdatedOptions_=function(e){const t=Ad({},this.options_);return void 0===t.resolution?t.zoom=this.getZoom():t.resolution=this.getResolution(),t.center=this.getCenter(),t.rotation=this.getRotation(),Ad({},t,e)},k_.prototype.animate=function(){let e=arguments.length,t;if(1<e&&'function'==typeof arguments[e-1]&&(t=arguments[e-1],--e),!this.isDef()){const o=arguments[e-1];return o.center&&this.setCenter(o.center),void 0!==o.zoom&&this.setZoom(o.zoom),void 0!==o.rotation&&this.setRotation(o.rotation),void(t&&setTimeout(function(){t(!0)},0))}let o=Date.now(),r=this.getCenter().slice(),n=this.getResolution(),i=this.getRotation();const a=[];for(let s=0;s<e;++s){const e=arguments[s],l={start:o,complete:!1,anchor:e.anchor,duration:void 0===e.duration?1e3:e.duration,easing:e.easing||_r};if(e.center&&(l.sourceCenter=r,l.targetCenter=e.center,r=l.targetCenter),void 0===e.zoom?e.resolution&&(l.sourceResolution=n,l.targetResolution=e.resolution,n=l.targetResolution):(l.sourceResolution=n,l.targetResolution=this.constrainResolution(this.maxResolution_,e.zoom-this.minZoom_,0),n=l.targetResolution),void 0!==e.rotation){l.sourceRotation=i;const t=Ce(e.rotation-i+Kl,2*Kl)-Kl;l.targetRotation=i+t,i=l.targetRotation}l.callback=t,Pr(l)?l.complete=!0:o+=l.duration,a.push(l)}this.animations_.push(a),this.setHint(M_.ANIMATING,1),this.updateAnimations_()},k_.prototype.getAnimating=function(){return 0<this.hints_[M_.ANIMATING]},k_.prototype.getInteracting=function(){return 0<this.hints_[M_.INTERACTING]},k_.prototype.cancelAnimations=function(){this.setHint(M_.ANIMATING,-this.hints_[M_.ANIMATING]);for(let e=0,t=this.animations_.length;e<t;++e){const t=this.animations_[e];t[0].callback&&t[0].callback(!1)}this.animations_.length=0},k_.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let o=this.animations_.length-1;0<=o;--o){const r=this.animations_[o];let i=!0;for(let o=0,n=r.length;o<n;++o){const n=r[o];if(n.complete)continue;const a=e-n.start;let s=0<n.duration?a/n.duration:1;1<=s?(n.complete=!0,s=1):i=!1;const l=n.easing(s);if(n.sourceCenter){const e=n.sourceCenter[0],t=n.sourceCenter[1],o=n.targetCenter[0],r=n.targetCenter[1];this.set(G_.CENTER,[e+l*(o-e),t+l*(r-t)])}if(n.sourceResolution&&n.targetResolution){const e=1===l?n.targetResolution:n.sourceResolution+l*(n.targetResolution-n.sourceResolution);n.anchor&&this.set(G_.CENTER,this.calculateCenterZoom(e,n.anchor)),this.set(G_.RESOLUTION,e)}if(void 0!==n.sourceRotation&&void 0!==n.targetRotation){const e=1===l?Ce(n.targetRotation+Kl,2*Kl)-Kl:n.sourceRotation+l*(n.targetRotation-n.sourceRotation);n.anchor&&this.set(G_.CENTER,this.calculateCenterRotate(e,n.anchor)),this.set(G_.ROTATION,e)}if(t=!0,!n.complete)break}if(i){this.animations_[o]=null,this.setHint(M_.ANIMATING,-1);const e=r[0].callback;e&&setTimeout(function(){e(!0)},0)}}this.animations_=this.animations_.filter(Boolean),t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))},k_.prototype.calculateCenterRotate=function(e,t){let o;const r=this.getCenter();return void 0!==r&&(o=[r[0]-t[0],r[1]-t[1]],Jo(o,e-this.getRotation()),Xo(o,t)),o},k_.prototype.calculateCenterZoom=function(e,t){let o;const r=this.getCenter(),i=this.getResolution();if(r!==void 0&&i!==void 0){const n=t[0]-e*(t[0]-r[0])/i,a=t[1]-e*(t[1]-r[1])/i;o=[n,a]}return o},k_.prototype.getSizeFromViewport_=function(){const e=[100,100],t='.ol-viewport[data-view="'+n(this)+'"]',o=document.querySelector(t);if(o){const t=getComputedStyle(o);e[0]=parseInt(t.width,10),e[1]=parseInt(t.height,10)}return e},k_.prototype.constrainCenter=function(e){return this.constraints_.center(e)},k_.prototype.constrainResolution=function(e,t,o){return this.constraints_.resolution(e,t||0,o||0)},k_.prototype.constrainRotation=function(e,t){return this.constraints_.rotation(e,t||0)},k_.prototype.getCenter=function(){return this.get(G_.CENTER)},k_.prototype.getConstraints=function(){return this.constraints_},k_.prototype.getHints=function(e){return void 0===e?this.hints_.slice():(e[0]=this.hints_[0],e[1]=this.hints_[1],e)},k_.prototype.calculateExtent=function(e){const t=e||this.getSizeFromViewport_(),o=this.getCenter();R(o,1);const r=this.getResolution();R(void 0!==r,2);const i=this.getRotation();return R(void 0!==i,3),ee(o,r,i,t)},k_.prototype.getMaxResolution=function(){return this.maxResolution_},k_.prototype.getMinResolution=function(){return this.minResolution_},k_.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},k_.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))},k_.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},k_.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))},k_.prototype.getProjection=function(){return this.projection_},k_.prototype.getResolution=function(){return this.get(G_.RESOLUTION)},k_.prototype.getResolutions=function(){return this.resolutions_},k_.prototype.getResolutionForExtent=function(e,t){const o=t||this.getSizeFromViewport_(),r=ne(e)/o[0],i=te(e)/o[1];return id(r,i)},k_.prototype.getResolutionForValueFunction=function(e){const t=e||2,o=this.maxResolution_,r=this.minResolution_,i=od(o/r)/od(t);return function(e){const r=o/td(t,e*i);return r}},k_.prototype.getRotation=function(){return this.get(G_.ROTATION)},k_.prototype.getValueForResolutionFunction=function(e){const t=e||2,o=this.maxResolution_,r=this.minResolution_,i=od(o/r)/od(t);return function(e){const r=od(o/e)/od(t)/i;return r}},k_.prototype.getState=function(){const e=this.getCenter(),t=this.getProjection(),o=this.getResolution(),r=this.getRotation();return{center:e.slice(),projection:t===void 0?null:t,resolution:o,rotation:r,zoom:this.getZoom()}},k_.prototype.getZoom=function(){let e;const t=this.getResolution();return void 0!==t&&(e=this.getZoomForResolution(t)),e},k_.prototype.getZoomForResolution=function(e){let t=this.minZoom_||0,o,r;if(this.resolutions_){const i=Ut(this.resolutions_,e,1);t=i,o=this.resolutions_[i],r=i==this.resolutions_.length-1?2:o/this.resolutions_[i+1]}else o=this.maxResolution_,r=this.zoomFactor_;return t+od(o/e)/od(r)},k_.prototype.getResolutionForZoom=function(e){return this.constrainResolution(this.maxResolution_,e-this.minZoom_,0)},k_.prototype.fit=function(e,t){const o=t||{};let r=o.size;r||(r=this.getSizeFromViewport_());let i;e instanceof Pg?e.getType()===ep.CIRCLE?(e=e.getExtent(),i=Yo(e),i.rotate(this.getRotation(),Q(e))):i=e:(R(Array.isArray(e),24),R(!se(e),25),i=Yo(e));const n=void 0===o.padding?[0,0,0,0]:o.padding,a=void 0===o.constrainResolution||o.constrainResolution,s=void 0!==o.nearest&&o.nearest;let l=void 0===o.minResolution?void 0===o.maxZoom?0:this.constrainResolution(this.maxResolution_,o.maxZoom-this.minZoom_,0):o.minResolution;const d=i.getFlatCoordinates(),p=this.getRotation(),g=Ql(-p);let _=Jl(-p),u=+Infinity,c=+Infinity,y=-Infinity,m=-Infinity;const h=i.getStride();for(let o=0,r=d.length;o<r;o+=h){const e=d[o]*g-d[o+1]*_,t=d[o]*_+d[o+1]*g;u=$l(u,e),c=$l(c,t),y=id(y,e),m=id(m,t)}let f=this.getResolutionForExtent([u,c,y,m],[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]);if(f=isNaN(f)?l:id(f,l),a){let e=this.constrainResolution(f,0,0);!s&&e<f&&(e=this.constrainResolution(e,-1,0)),f=e}_=-_;let x=(u+y)/2,E=(c+m)/2;x+=(n[1]-n[3])/2*f,E+=(n[0]-n[2])/2*f;const S=x*g-E*_,C=E*g+x*_,I=[S,C],L=o.callback?o.callback:T;void 0===o.duration?(this.setResolution(f),this.setCenter(I),setTimeout(L.bind(void 0,!0),0)):this.animate({resolution:f,center:I,duration:o.duration,easing:o.easing},L)},k_.prototype.centerOn=function(e,t,o){const r=this.getRotation(),i=Ql(-r);let n=Jl(-r),a=e[0]*i-e[1]*n,s=e[1]*i+e[0]*n;const l=this.getResolution();a+=(t[0]/2-o[0])*l,s+=(o[1]-t[1]/2)*l,n=-n;const d=a*i-s*n,p=s*i+a*n;this.setCenter([d,p])},k_.prototype.isDef=function(){return!!this.getCenter()&&this.getResolution()!==void 0},k_.prototype.rotate=function(e,t){if(t!==void 0){const o=this.calculateCenterRotate(e,t);this.setCenter(o)}this.setRotation(e)},k_.prototype.setCenter=function(e){this.set(G_.CENTER,e),this.getAnimating()&&this.cancelAnimations()},k_.prototype.setHint=function(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]},k_.prototype.setResolution=function(e){this.set(G_.RESOLUTION,e),this.getAnimating()&&this.cancelAnimations()},k_.prototype.setRotation=function(e){this.set(G_.ROTATION,e),this.getAnimating()&&this.cancelAnimations()},k_.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))};var U_=k_,Y_={OPACITY:'opacity',VISIBLE:'visible',EXTENT:'extent',Z_INDEX:'zIndex',MAX_RESOLUTION:'maxResolution',MIN_RESOLUTION:'minResolution',SOURCE:'source'};const j_=function(e){Wd.call(this);const t=Ad({},e);t[Y_.OPACITY]=e.opacity===void 0?1:e.opacity,t[Y_.VISIBLE]=!(e.visible!==void 0)||e.visible,t[Y_.Z_INDEX]=e.zIndex===void 0?0:e.zIndex,t[Y_.MAX_RESOLUTION]=e.maxResolution===void 0?Infinity:e.maxResolution,t[Y_.MIN_RESOLUTION]=e.minResolution===void 0?0:e.minResolution,this.setProperties(t),this.state_={layer:this,managed:!0},this.type};i(j_,Wd),j_.prototype.getType=function(){return this.type},j_.prototype.getLayerState=function(){return this.state_.opacity=me(this.getOpacity(),0,1),this.state_.sourceState=this.getSourceState(),this.state_.visible=this.getVisible(),this.state_.extent=this.getExtent(),this.state_.zIndex=this.getZIndex(),this.state_.maxResolution=this.getMaxResolution(),this.state_.minResolution=id(this.getMinResolution(),0),this.state_},j_.prototype.getLayersArray=function(){},j_.prototype.getLayerStatesArray=function(){},j_.prototype.getExtent=function(){return this.get(Y_.EXTENT)},j_.prototype.getMaxResolution=function(){return this.get(Y_.MAX_RESOLUTION)},j_.prototype.getMinResolution=function(){return this.get(Y_.MIN_RESOLUTION)},j_.prototype.getOpacity=function(){return this.get(Y_.OPACITY)},j_.prototype.getSourceState=function(){},j_.prototype.getVisible=function(){return this.get(Y_.VISIBLE)},j_.prototype.getZIndex=function(){return this.get(Y_.Z_INDEX)},j_.prototype.setExtent=function(e){this.set(Y_.EXTENT,e)},j_.prototype.setMaxResolution=function(e){this.set(Y_.MAX_RESOLUTION,e)},j_.prototype.setMinResolution=function(e){this.set(Y_.MIN_RESOLUTION,e)},j_.prototype.setOpacity=function(e){this.set(Y_.OPACITY,e)},j_.prototype.setVisible=function(e){this.set(Y_.VISIBLE,e)},j_.prototype.setZIndex=function(e){this.set(Y_.Z_INDEX,e)};var B_=j_,V_={UNDEFINED:'undefined',LOADING:'loading',READY:'ready',ERROR:'error'};const z_={LAYERS:'layers'},X_=function(e){const t=e||{},o=Ad({},t);delete o.layers;let r=t.layers;B_.call(this,o),this.layersListenerKeys_=[],this.listenerKeys_={},c(this,C(z_.LAYERS),this.handleLayersChanged_,this),r?Array.isArray(r)?r=new qd(r.slice(),{unique:!0}):(R(r instanceof qd,43),r=r):r=new qd(void 0,{unique:!0}),this.setLayers(r)};i(X_,B_),X_.prototype.handleLayerChange_=function(){this.changed()},X_.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(h),this.layersListenerKeys_.length=0;const e=this.getLayers();for(const t in this.layersListenerKeys_.push(c(e,wd.ADD,this.handleLayersAdd_,this),c(e,wd.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(h);a(this.listenerKeys_);const t=e.getArray();for(let e=0,o=t.length;e<o;e++){const o=t[e];this.listenerKeys_[n(o).toString()]=[c(o,Nd.PROPERTYCHANGE,this.handleLayerChange_,this),c(o,Yd.CHANGE,this.handleLayerChange_,this)]}this.changed()},X_.prototype.handleLayersAdd_=function(e){const t=e.element,o=n(t).toString();this.listenerKeys_[o]=[c(t,Nd.PROPERTYCHANGE,this.handleLayerChange_,this),c(t,Yd.CHANGE,this.handleLayerChange_,this)],this.changed()},X_.prototype.handleLayersRemove_=function(e){const t=e.element,o=n(t).toString();this.listenerKeys_[o].forEach(h),delete this.listenerKeys_[o],this.changed()},X_.prototype.getLayers=function(){return this.get(z_.LAYERS)},X_.prototype.setLayers=function(e){this.set(z_.LAYERS,e)},X_.prototype.getLayersArray=function(e){const t=void 0===e?[]:e;return this.getLayers().forEach(function(e){e.getLayersArray(t)}),t},X_.prototype.getLayerStatesArray=function(e){const t=e===void 0?[]:e,o=t.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(t)});const r=this.getLayerState();for(let n=o,i=t.length;n<i;n++){const e=t[n];e.opacity*=r.opacity,e.visible=e.visible&&r.visible,e.maxResolution=$l(e.maxResolution,r.maxResolution),e.minResolution=id(e.minResolution,r.minResolution),r.extent!==void 0&&(e.extent===void 0?e.extent=r.extent:e.extent=oe(e.extent,r.extent))}return t},X_.prototype.getSourceState=function(){return V_.READY};var W_=X_;const K_=function(e){Wd.call(this);const t=Ar(e);this.maxTilesLoading_=void 0===e.maxTilesLoading?16:e.maxTilesLoading,this.loadTilesWhileAnimating_=void 0!==e.loadTilesWhileAnimating&&e.loadTilesWhileAnimating,this.loadTilesWhileInteracting_=void 0!==e.loadTilesWhileInteracting&&e.loadTilesWhileInteracting,this.pixelRatio_=void 0===e.pixelRatio?Fp:e.pixelRatio,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_.call(this,Date.now())}.bind(this),this.coordinateToPixelTransform_=tt(),this.pixelToCoordinateTransform_=tt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement('DIV'),this.viewport_.className='ol-viewport'+(Np?' ol-touch':''),this.viewport_.style.position='relative',this.viewport_.style.overflow='hidden',this.viewport_.style.width='100%',this.viewport_.style.height='100%',this.viewport_.style.msTouchAction='none',this.viewport_.style.touchAction='none',this.overlayContainer_=document.createElement('DIV'),this.overlayContainer_.className='ol-overlaycontainer',this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement('DIV'),this.overlayContainerStopEvent_.className='ol-overlaycontainer-stopevent';const o=[Yd.CLICK,Yd.DBLCLICK,Yd.MOUSEDOWN,Yd.TOUCHSTART,Yd.MSPOINTERDOWN,n_.POINTERDOWN,Yd.MOUSEWHEEL,Yd.WHEEL];for(let t=0,r=o.length;t<r;++t)c(this.overlayContainerStopEvent_,o[t],S);for(const t in this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new I_(this,e.moveTolerance),n_)c(this.mapBrowserEventHandler_,n_[t],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=t.keyboardEventTarget,this.keyHandlerKeys_=null,c(this.viewport_,Yd.CONTEXTMENU,this.handleBrowserEvent,this),c(this.viewport_,Yd.WHEEL,this.handleBrowserEvent,this),c(this.viewport_,Yd.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=t.controls||new qd,this.interactions=t.interactions||new qd,this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=this.createRenderer(this.viewport_,this),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new N_(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},c(this,C(P_.LAYERGROUP),this.handleLayerGroupChanged_,this),c(this,C(P_.VIEW),this.handleViewChanged_,this),c(this,C(P_.SIZE),this.handleSizeChanged_,this),c(this,C(P_.TARGET),this.handleTargetChanged_,this),this.setProperties(t.values),this.controls.forEach(function(e){e.setMap(this)}.bind(this)),c(this.controls,wd.ADD,function(e){e.element.setMap(this)},this),c(this.controls,wd.REMOVE,function(e){e.element.setMap(null)},this),this.interactions.forEach(function(e){e.setMap(this)}.bind(this)),c(this.interactions,wd.ADD,function(e){e.element.setMap(this)},this),c(this.interactions,wd.REMOVE,function(e){e.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),c(this.overlays_,wd.ADD,function(e){this.addOverlayInternal_(e.element)},this),c(this.overlays_,wd.REMOVE,function(e){const t=e.element,o=t.getId();void 0!==o&&delete this.overlayIdIndex_[o.toString()],e.element.setMap(null)},this)};i(K_,Wd),K_.prototype.createRenderer=function(){throw new Error('Use a map type that has a createRenderer method')},K_.prototype.addControl=function(e){this.getControls().push(e)},K_.prototype.addInteraction=function(e){this.getInteractions().push(e)},K_.prototype.addLayer=function(e){const t=this.getLayerGroup().getLayers();t.push(e)},K_.prototype.addOverlay=function(e){this.getOverlays().push(e)},K_.prototype.addOverlayInternal_=function(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)},K_.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),m(this.viewport_,Yd.CONTEXTMENU,this.handleBrowserEvent,this),m(this.viewport_,Yd.WHEEL,this.handleBrowserEvent,this),m(this.viewport_,Yd.MOUSEWHEEL,this.handleBrowserEvent,this),this.handleResize_!==void 0&&(removeEventListener(Yd.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),Wd.prototype.disposeInternal.call(this)},K_.prototype.forEachFeatureAtPixel=function(e,t,o){if(this.frameState_){const r=this.getCoordinateFromPixel(e);o=void 0===o?{}:o;const i=void 0===o.hitTolerance?0:o.hitTolerance*this.frameState_.pixelRatio,n=void 0===o.layerFilter?E:o.layerFilter;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,i,t,null,n,null)}},K_.prototype.getFeaturesAtPixel=function(e,t){let o=null;return this.forEachFeatureAtPixel(e,function(e){o||(o=[]),o.push(e)},t),o},K_.prototype.forEachLayerAtPixel=function(e,t,o,r,i){if(this.frameState_){const n=void 0===o?null:o,a=void 0===r?E:r,s=void 0===i?null:i;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,t,n,a,s)}},K_.prototype.hasFeatureAtPixel=function(e,t){if(!this.frameState_)return!1;const o=this.getCoordinateFromPixel(e);t=t===void 0?{}:t;const r=t.layerFilter===void 0?E:t.layerFilter,i=t.hitTolerance===void 0?0:t.hitTolerance*this.frameState_.pixelRatio;return this.renderer_.hasFeatureAtCoordinate(o,this.frameState_,i,r,null)},K_.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},K_.prototype.getEventPixel=function(e){const t=this.viewport_.getBoundingClientRect(),o=e.changedTouches?e.changedTouches[0]:e;return[o.clientX-t.left,o.clientY-t.top]},K_.prototype.getTarget=function(){return this.get(P_.TARGET)},K_.prototype.getTargetElement=function(){const e=this.getTarget();return void 0===e?null:'string'==typeof e?document.getElementById(e):e},K_.prototype.getCoordinateFromPixel=function(e){const t=this.frameState_;return t?at(t.pixelToCoordinateTransform,e.slice()):null},K_.prototype.getControls=function(){return this.controls},K_.prototype.getOverlays=function(){return this.overlays_},K_.prototype.getOverlayById=function(e){const t=this.overlayIdIndex_[e.toString()];return t===void 0?null:t},K_.prototype.getInteractions=function(){return this.interactions},K_.prototype.getLayerGroup=function(){return this.get(P_.LAYERGROUP)},K_.prototype.getLayers=function(){const e=this.getLayerGroup().getLayers();return e},K_.prototype.getPixelFromCoordinate=function(e){const t=this.frameState_;return t?at(t.coordinateToPixelTransform,e.slice(0,2)):null},K_.prototype.getRenderer=function(){return this.renderer_},K_.prototype.getSize=function(){return this.get(P_.SIZE)},K_.prototype.getView=function(){return this.get(P_.VIEW)},K_.prototype.getViewport=function(){return this.viewport_},K_.prototype.getOverlayContainer=function(){return this.overlayContainer_},K_.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},K_.prototype.getTilePriority=function(e,t,o,r){const i=this.frameState_;if(!i||!(t in i.wantedTiles))return F_;if(!i.wantedTiles[t][e.getKey()])return F_;const n=o[0]-i.focus[0],a=o[1]-i.focus[1];return 65536*od(r)+ed(n*n+a*a)/r},K_.prototype.handleBrowserEvent=function(e,t){const o=t||e.type,r=new i_(o,this,e);this.handleMapBrowserEvent(r)},K_.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){this.focus_=e.coordinate,e.frameState=this.frameState_;const t=this.getInteractions().getArray();if(!1!==this.dispatchEvent(e))for(let o=t.length-1;0<=o;o--){const r=t[o];if(!r.getActive())continue;const i=r.handleEvent(e);if(!i)break}}},K_.prototype.handlePostRender=function(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let o=this.maxTilesLoading_,r=o;if(e){const t=e.viewHints;t[M_.ANIMATING]&&(o=this.loadTilesWhileAnimating_?8:0,r=2),t[M_.INTERACTING]&&(o=this.loadTilesWhileInteracting_?8:0,r=2)}t.getTilesLoading()<o&&(t.reprioritize(),t.loadMoreTiles(o,r))}const o=this.postRenderFunctions_;for(let t=0,r=o.length;t<r;++t)o[t](this,e);o.length=0},K_.prototype.handleSizeChanged_=function(){this.render()},K_.prototype.handleTargetChanged_=function(){let e;if(this.getTarget()&&(e=this.getTargetElement()),this.keyHandlerKeys_){for(let e=0,t=this.keyHandlerKeys_.length;e<t;++e)h(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null}if(!e)this.renderer_.removeLayerRenderers(),It(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(Yd.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);else{e.appendChild(this.viewport_);const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.keyHandlerKeys_=[c(t,Yd.KEYDOWN,this.handleBrowserEvent,this),c(t,Yd.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),addEventListener(Yd.RESIZE,this.handleResize_,!1))}this.updateSize()},K_.prototype.handleTileChange_=function(){this.render()},K_.prototype.handleViewPropertyChanged_=function(){this.render()},K_.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(h(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(h(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.viewport_.setAttribute('data-view',n(e)),this.viewPropertyListenerKey_=c(e,Nd.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=c(e,Yd.CHANGE,this.handleViewPropertyChanged_,this)),this.render()},K_.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(h),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[c(e,Nd.PROPERTYCHANGE,this.render,this),c(e,Yd.CHANGE,this.render,this)]),this.render()},K_.prototype.isRendered=function(){return!!this.frameState_},K_.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},K_.prototype.render=function(){this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},K_.prototype.removeControl=function(e){return this.getControls().remove(e)},K_.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},K_.prototype.removeLayer=function(e){const t=this.getLayerGroup().getLayers();return t.remove(e)},K_.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},K_.prototype.renderFrame_=function(e){let t;const o=this.getSize(),r=this.getView(),i=b(),a=this.frameState_;let s=null;if(void 0!==o&&Fr(o)&&r&&r.isDef()){const a=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=this.getLayerGroup().getLayerStatesArray(),d={};for(let e=0,t=l.length;e<t;++e)d[n(l[e].layer)]=l[e];t=r.getState();let p=this.focus_;if(!p){p=t.center;const e=t.resolution/this.pixelRatio_;p[0]=Vl(p[0]/e)*e,p[1]=Vl(p[1]/e)*e}s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:i,focus:p,index:this.frameIndex_++,layerStates:d,layerStatesArray:l,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:o,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:t,viewHints:a,wantedTiles:{}}}if(s&&(s.extent=ee(t.center,t.resolution,t.rotation,s.size,i)),this.frameState_=s,this.renderer_.renderFrame(s),s){if(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),a){const e=!this.previousExtent_||!se(this.previousExtent_)&&!j(s.extent,this.previousExtent_);e&&(this.dispatchEvent(new o_(L_.MOVESTART,this,a)),this.previousExtent_=D(this.previousExtent_))}const e=this.previousExtent_&&!s.viewHints[M_.ANIMATING]&&!s.viewHints[M_.INTERACTING]&&!j(s.extent,this.previousExtent_);e&&(this.dispatchEvent(new o_(L_.MOVEEND,this,s)),v(s.extent,this.previousExtent_))}this.dispatchEvent(new o_(L_.POSTRENDER,this,s)),setTimeout(this.handlePostRender.bind(this),0)},K_.prototype.setLayerGroup=function(e){this.set(P_.LAYERGROUP,e)},K_.prototype.setSize=function(e){this.set(P_.SIZE,e)},K_.prototype.setTarget=function(e){this.set(P_.TARGET,e)},K_.prototype.setView=function(e){this.set(P_.VIEW,e)},K_.prototype.skipFeature=function(e){const t=n(e).toString();this.skippedFeatureUids_[t]=!0,this.render()},K_.prototype.updateSize=function(){const e=this.getTargetElement();if(!e)this.setSize(void 0);else{const t=getComputedStyle(e);this.setSize([e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)])}},K_.prototype.unskipFeature=function(e){const t=n(e).toString();delete this.skippedFeatureUids_[t],this.render()};var H_=K_;const Z_=function(e){Wd.call(this),this.element=e.element?e.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=e.render?e.render:T,e.target&&this.setTarget(e.target)};i(Z_,Wd),Z_.prototype.disposeInternal=function(){It(this.element),Wd.prototype.disposeInternal.call(this)},Z_.prototype.getMap=function(){return this.map_},Z_.prototype.setMap=function(e){this.map_&&It(this.element);for(let t=0,o=this.listenerKeys.length;t<o;++t)h(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,this.map_){const t=this.target_?this.target_:e.getOverlayContainerStopEvent();t.appendChild(this.element),this.render!==T&&this.listenerKeys.push(c(e,L_.POSTRENDER,this.render,this)),e.render()}},Z_.prototype.setTarget=function(e){this.target_='string'==typeof e?document.getElementById(e):e};var q_=Z_;const J_=function(e){const t=Ad({},e);delete t.source,B_.call(this,t),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,e.map&&this.setMap(e.map),c(this,C(Y_.SOURCE),this.handleSourcePropertyChange_,this);const o=e.source?e.source:null;this.setSource(o)};i(J_,B_),J_.prototype.getLayersArray=function(e){const t=e?e:[];return t.push(this),t},J_.prototype.getLayerStatesArray=function(e){const t=e?e:[];return t.push(this.getLayerState()),t},J_.prototype.getSource=function(){const e=this.get(Y_.SOURCE);return e||null},J_.prototype.getSourceState=function(){const e=this.getSource();return e?e.getState():V_.UNDEFINED},J_.prototype.handleSourceChange_=function(){this.changed()},J_.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(h(this.sourceChangeKey_),this.sourceChangeKey_=null);const e=this.getSource();e&&(this.sourceChangeKey_=c(e,Yd.CHANGE,this.handleSourceChange_,this)),this.changed()},J_.prototype.setMap=function(e){this.mapPrecomposeKey_&&(h(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(h(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=c(e,Dg.PRECOMPOSE,function(e){const t=this.getLayerState();t.managed=!1,t.zIndex=Infinity,e.frameState.layerStatesArray.push(t),e.frameState.layerStates[n(this)]=t},this),this.mapRenderKey_=c(this,Yd.CHANGE,e.render,e),this.changed())},J_.prototype.setSource=function(e){this.set(Y_.SOURCE,e)};var Q_=J_;const $_=function(e){const t=e?e:{};this.ulElement_=document.createElement('UL'),this.collapsed_=!(t.collapsed!==void 0)||t.collapsed,this.collapsible_=!(t.collapsible!==void 0)||t.collapsible,this.collapsible_||(this.collapsed_=!1);const o=t.className===void 0?'ol-attribution':t.className,r=t.tipLabel===void 0?'Attributions':t.tipLabel,i=t.collapseLabel===void 0?'\xBB':t.collapseLabel;'string'==typeof i?(this.collapseLabel_=document.createElement('span'),this.collapseLabel_.textContent=i):this.collapseLabel_=i;const n=t.label===void 0?'i':t.label;'string'==typeof n?(this.label_=document.createElement('span'),this.label_.textContent=n):this.label_=n;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,s=document.createElement('button');s.setAttribute('type','button'),s.title=r,s.appendChild(a),c(s,Yd.CLICK,this.handleClick_,this);const l=o+' '+kp+' '+Up+(this.collapsed_&&this.collapsible_?' '+Yp:'')+(this.collapsible_?'':' ol-uncollapsible'),d=document.createElement('div');d.className=l,d.appendChild(this.ulElement_),d.appendChild(s),q_.call(this,{element:d,render:t.render||Mr,target:t.target}),this.renderedAttributions_=[],this.renderedVisible_=!0};i($_,q_),$_.prototype.getSourceAttributions_=function(e){const t={},o=[],r=e.layerStatesArray,n=e.viewState.resolution;for(let a=0,i=r.length;a<i;++a){const i=r[a];if(!br(i,n))continue;const s=i.layer.getSource();if(!s)continue;const l=s.getAttributions();if(!l)continue;const d=l(e);if(d)if(Array.isArray(d))for(let e=0,r=d.length;e<r;++e)d[e]in t||(o.push(d[e]),t[d[e]]=!0);else d in t||(o.push(d),t[d]=!0)}return o},$_.prototype.updateElement_=function(e){if(!e)return void(this.renderedVisible_&&(this.element.style.display='none',this.renderedVisible_=!1));const t=this.getSourceAttributions_(e),o=0<t.length;if(this.renderedVisible_!=o&&(this.element.style.display=o?'':'none',this.renderedVisible_=o),!zt(t,this.renderedAttributions_)){Lt(this.ulElement_);for(let e=0,o=t.length;e<o;++e){const o=document.createElement('LI');o.innerHTML=t[e],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}},$_.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},$_.prototype.handleToggle_=function(){this.element.classList.toggle(Yp),this.collapsed_?Rt(this.collapseLabel_,this.label_):Rt(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},$_.prototype.getCollapsible=function(){return this.collapsible_},$_.prototype.setCollapsible=function(e){this.collapsible_===e||(this.collapsible_=e,this.element.classList.toggle('ol-uncollapsible'),!e&&this.collapsed_&&this.handleToggle_())},$_.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},$_.prototype.getCollapsed=function(){return this.collapsed_};var eu=$_;const tu=function(e){const t=e?e:{},o=t.className===void 0?'ol-rotate':t.className,r=t.label===void 0?'\u21E7':t.label;this.label_=null,'string'==typeof r?(this.label_=document.createElement('span'),this.label_.className='ol-compass',this.label_.textContent=r):(this.label_=r,this.label_.classList.add('ol-compass'));const i=t.tipLabel?t.tipLabel:'Reset rotation',n=document.createElement('button');n.className=o+'-reset',n.setAttribute('type','button'),n.title=i,n.appendChild(this.label_),c(n,Yd.CLICK,tu.prototype.handleClick_,this);const a=document.createElement('div');a.className=o+' '+kp+' '+Up,a.appendChild(n),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,q_.call(this,{element:a,render:t.render||Gr,target:t.target}),this.duration_=t.duration===void 0?250:t.duration,this.autoHide_=!(t.autoHide!==void 0)||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Dp)};i(tu,q_),tu.prototype.handleClick_=function(e){e.preventDefault(),this.callResetNorth_===void 0?this.resetNorth_():this.callResetNorth_()},tu.prototype.resetNorth_=function(){const e=this.getMap(),t=e.getView();t&&(t.getRotation()===void 0||(0<this.duration_?t.animate({rotation:0,duration:this.duration_,easing:gr}):t.setRotation(0)))};var ou=tu;const ru=function(e){const t=e?e:{},o=t.className===void 0?'ol-zoom':t.className,r=t.delta===void 0?1:t.delta,i=t.zoomInLabel===void 0?'+':t.zoomInLabel,n=t.zoomOutLabel===void 0?'\u2212':t.zoomOutLabel,a=t.zoomInTipLabel===void 0?'Zoom in':t.zoomInTipLabel,s=t.zoomOutTipLabel===void 0?'Zoom out':t.zoomOutTipLabel,l=document.createElement('button');l.className=o+'-in',l.setAttribute('type','button'),l.title=a,l.appendChild('string'==typeof i?document.createTextNode(i):i),c(l,Yd.CLICK,ru.prototype.handleClick_.bind(this,r));const d=document.createElement('button');d.className=o+'-out',d.setAttribute('type','button'),d.title=s,d.appendChild('string'==typeof n?document.createTextNode(n):n),c(d,Yd.CLICK,ru.prototype.handleClick_.bind(this,-r));const p=document.createElement('div');p.className=o+' '+kp+' '+Up,p.appendChild(l),p.appendChild(d),q_.call(this,{element:p,target:t.target}),this.duration_=t.duration===void 0?250:t.duration};i(ru,q_),ru.prototype.handleClick_=function(e,t){t.preventDefault(),this.zoomByDelta_(e)},ru.prototype.zoomByDelta_=function(e){const t=this.getMap(),o=t.getView();if(o){const t=o.getResolution();if(t){const r=o.constrainResolution(t,e);0<this.duration_?(o.getAnimating()&&o.cancelAnimations(),o.animate({resolution:r,duration:this.duration_,easing:gr})):o.setResolution(r)}}};var iu=ru,nu={ACTIVE:'active'};const au=function(e){Wd.call(this),this.map_=null,this.setActive(!0),this.handleEvent=e.handleEvent};i(au,Wd),au.prototype.getActive=function(){return this.get(nu.ACTIVE)},au.prototype.getMap=function(){return this.map_},au.prototype.setActive=function(e){this.set(nu.ACTIVE,e)},au.prototype.setMap=function(e){this.map_=e};var su=au;const lu=function(e){const t=e?e:{};this.delta_=t.delta?t.delta:1,su.call(this,{handleEvent:zr}),this.duration_=t.duration===void 0?250:t.duration};i(lu,su);var du=lu;const pu=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},gu=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},_u=E,uu=function(e){const t=e.originalEvent;return 0==t.button&&!(Pp&&vp&&t.ctrlKey)},cu=x,yu=function(e){return'pointermove'==e.type},mu=function(e){return e.type==n_.SINGLECLICK},hu=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},fu=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},xu=function(e){const t=e.originalEvent.target,o=t.tagName;return'INPUT'!==o&&'SELECT'!==o&&'TEXTAREA'!==o},Eu=function(e){return R(e.pointerEvent,56),'mouse'==e.pointerEvent.pointerType},Tu=function(e){const t=e.pointerEvent;return t.isPrimary&&0===t.button},Su=function(e){const t=e?e:{};su.call(this,{handleEvent:t.handleEvent||Kr}),this.handleDownEvent_=t.handleDownEvent?t.handleDownEvent:x,this.handleDragEvent_=t.handleDragEvent?t.handleDragEvent:T,this.handleMoveEvent_=t.handleMoveEvent?t.handleMoveEvent:T,this.handleUpEvent_=t.handleUpEvent?t.handleUpEvent:x,this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]};i(Su,su),Su.prototype.updateTrackedPointers_=function(e){if(Wr(e)){const t=e.pointerEvent,o=t.pointerId.toString();e.type==n_.POINTERUP?delete this.trackedPointers_[o]:e.type==n_.POINTERDOWN?this.trackedPointers_[o]=t:o in this.trackedPointers_&&(this.trackedPointers_[o]=t),this.targetPointers=s(this.trackedPointers_)}},Su.prototype.shouldStopEvent=function(e){return e};var Cu=Su;const Ru=function(e){Cu.call(this,{handleDownEvent:qr,handleDragEvent:Hr,handleUpEvent:Zr});const t=e?e:{};this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.condition_=t.condition?t.condition:hu,this.noKinetic_=!1};i(Ru,Cu),Ru.prototype.shouldStopEvent=x;var Iu=Ru;const Lu=function(e){const t=e?e:{};Cu.call(this,{handleDownEvent:$r,handleDragEvent:Jr,handleUpEvent:Qr}),this.condition_=t.condition?t.condition:gu,this.lastAngle_=void 0,this.duration_=t.duration===void 0?250:t.duration};i(Lu,Cu),Lu.prototype.shouldStopEvent=x;var Pu=Lu;const vu=function(e){this.geometry_=null,this.element_=document.createElement('div'),this.element_.style.position='absolute',this.element_.className='ol-box '+e,this.map_=null,this.startPixel_=null,this.endPixel_=null};i(vu,Md),vu.prototype.disposeInternal=function(){this.setMap(null)},vu.prototype.render_=function(){const e=this.startPixel_,t=this.endPixel_,o='px',r=this.element_.style;r.left=$l(e[0],t[0])+o,r.top=$l(e[1],t[1])+o,r.width=Hl(t[0]-e[0])+o,r.height=Hl(t[1]-e[1])+o},vu.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left=e.top=e.width=e.height='inherit'}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},vu.prototype.setPixels=function(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()},vu.prototype.createOrUpdateGeometry=function(){const e=this.startPixel_,t=this.endPixel_,o=[e,[e[0],t[1]],t,[t[0],e[1]]],r=o.map(this.map_.getCoordinateFromPixel,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Ag([r])},vu.prototype.getGeometry=function(){return this.geometry_};const Fu={BOXSTART:'boxstart',BOXDRAG:'boxdrag',BOXEND:'boxend'},Ou=function(e,t,o){Dd.call(this,e),this.coordinate=t,this.mapBrowserEvent=o};i(Ou,Dd);const wu=function(e){Cu.call(this,{handleDownEvent:ri,handleDragEvent:ti,handleUpEvent:oi});const t=e?e:{};this.box_=new vu(t.className||'ol-dragbox'),this.minArea_=t.minArea===void 0?64:t.minArea,this.startPixel_=null,this.condition_=t.condition?t.condition:_u,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:ei};i(wu,Cu),wu.prototype.getGeometry=function(){return this.box_.getGeometry()},wu.prototype.onBoxEnd=T;var Nu=wu;const Au=function(e){const t=e?e:{},o=t.condition?t.condition:fu;this.duration_=t.duration===void 0?200:t.duration,this.out_=t.out!==void 0&&t.out,Nu.call(this,{condition:o,className:t.className||'ol-dragzoom'})};i(Au,Nu),Au.prototype.onBoxEnd=function(){const e=this.getMap(),t=e.getView(),o=e.getSize();let r=this.getGeometry().getExtent();if(this.out_){const i=t.calculateExtent(o),n=U([e.getPixelFromCoordinate(q(r)),e.getPixelFromCoordinate(ie(r))]),a=t.getResolutionForExtent(n,o);de(i,1/a),r=i}const i=t.constrainResolution(t.getResolutionForExtent(r,o));let n=Q(r);n=t.constrainCenter(n),t.animate({resolution:i,center:n,duration:this.duration_,easing:gr})};var bu=Au,Mu={LEFT:37,UP:38,RIGHT:39,DOWN:40};const Gu=function(e){su.call(this,{handleEvent:ii});const t=e||{};this.defaultCondition_=function(e){return hu(e)&&xu(e)},this.condition_=t.condition===void 0?this.defaultCondition_:t.condition,this.duration_=t.duration===void 0?100:t.duration,this.pixelDelta_=t.pixelDelta===void 0?128:t.pixelDelta};i(Gu,su);var Du=Gu;const ku=function(e){su.call(this,{handleEvent:ni});const t=e?e:{};this.condition_=t.condition?t.condition:xu,this.delta_=t.delta?t.delta:1,this.duration_=t.duration===void 0?100:t.duration};i(ku,su);var Uu=ku;const Yu={TRACKPAD:'trackpad',WHEEL:'wheel'},ju=function(e){su.call(this,{handleEvent:ai});const t=e||{};this.delta_=0,this.duration_=t.duration===void 0?250:t.duration,this.timeout_=t.timeout===void 0?80:t.timeout,this.useAnchor_=!(t.useAnchor!==void 0)||t.useAnchor,this.constrainResolution_=t.constrainResolution||!1,this.condition_=t.condition?t.condition:_u,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_=void 0,this.trackpadDeltaPerZoom_=300,this.trackpadZoomBuffer_=1.5};i(ju,su),ju.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;const e=this.getMap().getView();e.setHint(M_.INTERACTING,-1)},ju.prototype.handleWheelZoom_=function(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();const o=1,r=me(this.delta_,-o,o);Br(t,-r,this.lastAnchor_,this.duration_),this.mode_=void 0,this.delta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},ju.prototype.setMouseAnchor=function(e){this.useAnchor_=e,e||(this.lastAnchor_=null)};var Bu=ju;const Vu=function(e){Cu.call(this,{handleDownEvent:di,handleDragEvent:si,handleUpEvent:li});const t=e||{};this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold===void 0?.3:t.threshold,this.duration_=t.duration===void 0?250:t.duration};i(Vu,Cu),Vu.prototype.shouldStopEvent=x;var zu=Vu;const Xu=function(e){Cu.call(this,{handleDownEvent:_i,handleDragEvent:pi,handleUpEvent:gi});const t=e?e:{};this.constrainResolution_=t.constrainResolution||!1,this.anchor_=null,this.duration_=t.duration===void 0?400:t.duration,this.lastDistance_=void 0,this.lastScaleDelta_=1};i(Xu,Cu),Xu.prototype.shouldStopEvent=x;var Wu=Xu;const Ku={ADD_FEATURES:'addfeatures'},Hu=function(e,t,o,r){Dd.call(this,e),this.features=o,this.file=t,this.projection=r};i(Hu,Dd);const Zu=function(e){const t=e?e:{};su.call(this,{handleEvent:E}),this.formatConstructors_=t.formatConstructors?t.formatConstructors:[],this.projection_=t.projection?Ve(t.projection):null,this.dropListenKeys_=null,this.source_=t.source||null,this.target=t.target?t.target:null};i(Zu,su),Zu.prototype.handleResult_=function(e,t){const o=t.target.result,r=this.getMap();let n=this.projection_;if(!n){const e=r.getView();n=e.getProjection()}const a=this.formatConstructors_;let s=[];for(let r=0,i=a.length;r<i;++r){const e=a[r],t=new e;if(s=this.tryReadFeatures_(t,o,{featureProjection:n}),s&&0<s.length)break}this.source_&&(this.source_.clear(),this.source_.addFeatures(s)),this.dispatchEvent(new Hu(Ku.ADD_FEATURES,e,s,n))},Zu.prototype.registerListeners_=function(){const e=this.getMap();if(e){const t=this.target?this.target:e.getViewport();this.dropListenKeys_=[c(t,Yd.DROP,ui,this),c(t,Yd.DRAGENTER,ci,this),c(t,Yd.DRAGOVER,ci,this),c(t,Yd.DROP,ci,this)]}},Zu.prototype.setActive=function(e){su.prototype.setActive.call(this,e),e?this.registerListeners_():this.unregisterListeners_()},Zu.prototype.setMap=function(e){this.unregisterListeners_(),su.prototype.setMap.call(this,e),this.getActive()&&this.registerListeners_()},Zu.prototype.tryReadFeatures_=function(e,t,o){try{return e.readFeatures(t,o)}catch(t){return null}},Zu.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(h),this.dropListenKeys_=null)};const qu=function(e){const t=e?e:{};Cu.call(this,{handleDownEvent:hi,handleDragEvent:yi,handleUpEvent:mi}),this.condition_=t.condition?t.condition:fu,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=t.duration===void 0?400:t.duration};i(qu,Cu);const Ju=function(e,t,o){Pg.call(this);const r=t?t:0;this.setCenterAndRadius(e,r,o)};i(Ju,Pg),Ju.prototype.clone=function(){const e=new Ju(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},Ju.prototype.closestPointXY=function(e,t,o,r){const n=this.flatCoordinates,i=e-n[0],a=t-n[1],s=i*i+a*a;if(s<r){if(0==s)for(let e=0;e<this.stride;++e)o[e]=n[e];else{const e=this.getRadius()/ed(s);o[0]=n[0]+e*i,o[1]=n[1]+e*a;for(let e=2;e<this.stride;++e)o[e]=n[e]}return o.length=this.stride,s}return r},Ju.prototype.containsXY=function(e,t){const o=this.flatCoordinates,r=e-o[0],i=t-o[1];return r*r+i*i<=this.getRadiusSquared_()},Ju.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},Ju.prototype.computeExtent=function(e){const t=this.flatCoordinates,o=t[this.stride]-t[0];return G(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)},Ju.prototype.getRadius=function(){return ed(this.getRadiusSquared_())},Ju.prototype.getRadiusSquared_=function(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t},Ju.prototype.getType=function(){return ep.CIRCLE},Ju.prototype.intersectsExtent=function(e){const t=this.getExtent();if(ae(e,t)){const t=this.getCenter();return!!(e[0]<=t[0]&&e[2]>=t[0])||!!(e[1]<=t[1]&&e[3]>=t[1])||K(e,this.intersectsCoordinate,this)}return!1},Ju.prototype.setCenter=function(e){const t=this.stride,o=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+o;for(let o=1;o<t;++o)r[t+o]=e[o];this.setFlatCoordinates(this.layout,r)},Ju.prototype.setCenterAndRadius=function(e,t,o){if(!e)this.setFlatCoordinates(Ig.XY,null);else{this.setLayout(o,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let n=so(r,0,e,this.stride);r[n++]=r[0]+t;for(let e=1,t=this.stride;e<t;++e)r[n++]=r[e];r.length=n,this.changed()}},Ju.prototype.getCoordinates=function(){},Ju.prototype.setCoordinates=function(){},Ju.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()},Ju.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()},Ju.prototype.transform;var Qu=Ju;const $u=function(e,t){Pg.call(this),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(e,t)};i($u,Pg),$u.prototype.appendLineString=function(e){this.flatCoordinates?jt(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},$u.prototype.clone=function(){const e=new $u(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),e},$u.prototype.closestPointXY=function(e,t,o,r){return r<F(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=ed(oo(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),no(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,o,r))},$u.prototype.getCoordinateAtM=function(e,t,o){if(this.layout!=Ig.XYM&&this.layout!=Ig.XYZM||0===this.flatCoordinates.length)return null;return nr(this.flatCoordinates,0,this.ends_,this.stride,e,t!==void 0&&t,o!==void 0&&o)},$u.prototype.getCoordinates=function(){return uo(this.flatCoordinates,0,this.ends_,this.stride)},$u.prototype.getEnds=function(){return this.ends_},$u.prototype.getLineString=function(e){if(0>e||this.ends_.length<=e)return null;const t=new Gg(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e])),t},$u.prototype.getLineStrings=function(){const e=this.flatCoordinates,t=this.ends_,o=this.layout,r=[];let n=0;for(let a=0,i=t.length;a<i;++a){const i=t[a],s=new Gg(null);s.setFlatCoordinates(o,e.slice(n,i)),r.push(s),n=i}return r},$u.prototype.getFlatMidpoints=function(){const e=[],t=this.flatCoordinates;let o=0;const r=this.ends_,n=this.stride;for(let a=0,i=r.length;a<i;++a){const i=r[a],s=rr(t,o,i,n,.5);jt(e,s),o=i}return e},$u.prototype.getSimplifiedGeometryInternal=function(e){const t=[],o=[];t.length=mo(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,o);const r=new $u(null);return r.setFlatCoordinates(Ig.XY,t,o),r},$u.prototype.getType=function(){return ep.MULTI_LINE_STRING},$u.prototype.intersectsExtent=function(e){return Fo(this.flatCoordinates,0,this.ends_,this.stride,e)},$u.prototype.setCoordinates=function(e,t){if(!e)this.setFlatCoordinates(Ig.XY,null,this.ends_);else{this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const o=po(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===o.length?0:o[o.length-1],this.changed()}},$u.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t),this.ends_=o,this.changed()},$u.prototype.setLineStrings=function(e){let t=this.getLayout();const o=[],r=[];for(let n=0,i=e.length;n<i;++n){const i=e[n];0===n&&(t=i.getLayout()),jt(o,i.getFlatCoordinates()),r.push(o.length)}this.setFlatCoordinates(t,o,r)};var ec=$u;const tc=function(e,t){Pg.call(this),this.setCoordinates(e,t)};i(tc,Pg),tc.prototype.appendPoint=function(e){this.flatCoordinates?jt(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()},tc.prototype.clone=function(){const e=new tc(null);return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),e},tc.prototype.closestPointXY=function(e,t,o,r){if(r<F(this.getExtent(),e,t))return r;const n=this.flatCoordinates,a=this.stride;for(let s=0,i=n.length;s<i;s+=a){const i=xe(e,t,n[s],n[s+1]);if(i<r){r=i;for(let e=0;e<a;++e)o[e]=n[s+e];o.length=a}}return r},tc.prototype.getCoordinates=function(){return _o(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},tc.prototype.getPoint=function(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;if(0>e||t<=e)return null;const o=new wg(null);return o.setFlatCoordinates(this.layout,this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride)),o},tc.prototype.getPoints=function(){const e=this.flatCoordinates,t=this.layout,o=this.stride,r=[];for(let n=0,i=e.length;n<i;n+=o){const i=new wg(null);i.setFlatCoordinates(t,e.slice(n,n+o)),r.push(i)}return r},tc.prototype.getType=function(){return ep.MULTI_POINT},tc.prototype.intersectsExtent=function(e){const t=this.flatCoordinates,o=this.stride;for(let r=0,i=t.length;r<i;r+=o){const o=t[r],i=t[r+1];if(N(e,o,i))return!0}return!1},tc.prototype.setCoordinates=function(e,t){e?(this.setLayout(t,e,1),!this.flatCoordinates&&(this.flatCoordinates=[]),this.flatCoordinates.length=lo(this.flatCoordinates,0,e,this.stride),this.changed()):this.setFlatCoordinates(Ig.XY,null)},tc.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t),this.changed()};var oc=tc;const rc=function(e,t){Pg.call(this),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(e,t)};i(rc,Pg),rc.prototype.appendPolygon=function(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const o=this.flatCoordinates.length;jt(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let e=0,r=t.length;e<r;++e)t[e]+=o}this.endss_.push(t),this.changed()},rc.prototype.clone=function(){const e=new rc(null),t=this.endss_.length,o=Array(t);for(let e=0;e<t;++e)o[e]=this.endss_[e].slice();return e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),o),e},rc.prototype.closestPointXY=function(e,t,o,r){return r<F(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=ed(ro(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ao(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,o,r))},rc.prototype.containsXY=function(e,t){return Ro(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)},rc.prototype.getArea=function(){return $t(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},rc.prototype.getCoordinates=function(e){let t;return void 0===e?t=this.flatCoordinates:(t=this.getOrientedFlatCoordinates().slice(),ko(t,0,this.endss_,this.stride,e)),co(t,0,this.endss_,this.stride)},rc.prototype.getEndss=function(){return this.endss_},rc.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=fi(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Lo(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},rc.prototype.getInteriorPoints=function(){const e=new oc(null);return e.setFlatCoordinates(Ig.XYM,this.getFlatInteriorPoints().slice()),e},rc.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Go(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ko(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},rc.prototype.getSimplifiedGeometryInternal=function(e){const t=[],o=[];t.length=Eo(this.flatCoordinates,0,this.endss_,this.stride,ed(e),t,0,o);const r=new rc(null);return r.setFlatCoordinates(Ig.XY,t,o),r},rc.prototype.getPolygon=function(e){if(0>e||this.endss_.length<=e)return null;let t;if(0===e)t=0;else{const o=this.endss_[e-1];t=o[o.length-1]}const o=this.endss_[e].slice(),r=o[o.length-1];if(0!==t)for(let e=0,r=o.length;e<r;++e)o[e]-=t;const i=new Ag(null);return i.setFlatCoordinates(this.layout,this.flatCoordinates.slice(t,r),o),i},rc.prototype.getPolygons=function(){const e=this.layout,t=this.flatCoordinates,o=this.endss_,r=[];let n=0;for(let a=0,i=o.length;a<i;++a){const i=o[a].slice(),s=i[i.length-1];if(0!==n)for(let e=0,t=i.length;e<t;++e)i[e]-=n;const l=new Ag(null);l.setFlatCoordinates(e,t.slice(n,s),i),r.push(l),n=s}return r},rc.prototype.getType=function(){return ep.MULTI_POLYGON},rc.prototype.intersectsExtent=function(e){return No(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)},rc.prototype.setCoordinates=function(e,t){if(!e)this.setFlatCoordinates(Ig.XY,null,this.endss_);else{this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const o=go(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===o.length)this.flatCoordinates.length=0;else{const e=o[o.length-1];this.flatCoordinates.length=0===e.length?0:e[e.length-1]}this.changed()}},rc.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t),this.endss_=o,this.changed()},rc.prototype.setPolygons=function(e){let t=this.getLayout();const o=[],r=[];for(let n=0,i=e.length;n<i;++n){const i=e[n];0===n&&(t=i.getLayout());const a=o.length,s=i.getEnds();for(let e=0,t=s.length;e<t;++e)s[e]+=a;jt(o,i.getFlatCoordinates()),r.push(s)}this.setFlatCoordinates(t,o,r)};var ic=rc,nc={IMAGE:'IMAGE',TILE:'TILE',VECTOR_TILE:'VECTOR_TILE',VECTOR:'VECTOR'},ac={IMAGE:'image',VECTOR:'vector'};const sc={RENDER_ORDER:'renderOrder'},lc=function(e){const t=e?e:{},o=Ad({},t);delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,Q_.call(this,o),this.declutter_=t.declutter!==void 0&&t.declutter,this.renderBuffer_=t.renderBuffer===void 0?100:t.renderBuffer,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0&&t.updateWhileAnimating,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0&&t.updateWhileInteracting,this.renderMode_=t.renderMode||ac.VECTOR,this.type=nc.VECTOR};i(lc,Q_),lc.prototype.getDeclutter=function(){return this.declutter_},lc.prototype.setDeclutter=function(e){this.declutter_=e},lc.prototype.getRenderBuffer=function(){return this.renderBuffer_},lc.prototype.getRenderOrder=function(){return this.get(sc.RENDER_ORDER)},lc.prototype.getSource,lc.prototype.getStyle=function(){return this.style_},lc.prototype.getStyleFunction=function(){return this.styleFunction_},lc.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},lc.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},lc.prototype.setRenderOrder=function(e){this.set(sc.RENDER_ORDER,e)},lc.prototype.setStyle=function(e){this.style_=e===void 0?Nt:e,this.styleFunction_=null===e?void 0:wt(this.style_),this.changed()},lc.prototype.getRenderMode=function(){return this.renderMode_};var dc=lc,pc={ARRAY_BUFFER:'arraybuffer',JSON:'json',TEXT:'text',XML:'xml'};const gc=function(e){Wd.call(this),this.projection_=Ve(e.projection),this.attributions_=this.adaptAttributions_(e.attributions),this.state_=e.state===void 0?V_.READY:e.state,this.wrapX_=e.wrapX!==void 0&&e.wrapX};i(gc,Wd),gc.prototype.adaptAttributions_=function(e){return e?Array.isArray(e)?function(){return e}:'function'==typeof e?e:function(){return[e]}:null},gc.prototype.forEachFeatureAtCoordinate=T,gc.prototype.getAttributions=function(){return this.attributions_},gc.prototype.getProjection=function(){return this.projection_},gc.prototype.getResolutions=function(){},gc.prototype.getState=function(){return this.state_},gc.prototype.getWrapX=function(){return this.wrapX_},gc.prototype.refresh=function(){this.changed()},gc.prototype.setAttributions=function(e){this.attributions_=this.adaptAttributions_(e),this.changed()},gc.prototype.setState=function(e){this.state_=e,this.changed()};var _c=gc,uc={ADDFEATURE:'addfeature',CHANGEFEATURE:'changefeature',CLEAR:'clear',REMOVEFEATURE:'removefeature'},cc=o(0),yc=o.n(cc);const mc=function(e){this.rbush_=yc()(e,void 0),this.items_={}};mc.prototype.insert=function(e,t){const o={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(o),this.items_[n(t)]=o},mc.prototype.load=function(e,t){const o=Array(t.length);for(let r=0,i=t.length;r<i;r++){const i=e[r],a=t[r],s={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],value:a};o[r]=s,this.items_[n(a)]=s}this.rbush_.load(o)},mc.prototype.remove=function(e){const t=n(e),o=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(o)},mc.prototype.update=function(e,t){const o=this.items_[n(t)],r=[o.minX,o.minY,o.maxX,o.maxY];j(r,e)||(this.remove(t),this.insert(e,t))},mc.prototype.getAll=function(){const e=this.rbush_.all();return e.map(function(e){return e.value})},mc.prototype.getInExtent=function(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},o=this.rbush_.search(t);return o.map(function(e){return e.value})},mc.prototype.forEach=function(e,t){return this.forEach_(this.getAll(),e,t)},mc.prototype.forEachInExtent=function(e,t,o){return this.forEach_(this.getInExtent(e),t,o)},mc.prototype.forEach_=function(e,t,o){let r;for(let n=0,i=e.length;n<i;n++)if(r=t.call(o,e[n]),r)return r;return r},mc.prototype.isEmpty=function(){return l(this.items_)},mc.prototype.clear=function(){this.rbush_.clear(),this.items_={}},mc.prototype.getExtent=function(e){const t=this.rbush_.data;return G(t.minX,t.minY,t.maxX,t.maxY,e)},mc.prototype.concat=function(e){for(const t in this.rbush_.load(e.rbush_.all()),e.items_)this.items_[0|t]=e.items_[0|t]};var hc=mc;const fc=function(e,t){Dd.call(this,e),this.feature=t};i(fc,Dd);const xc=function(e){const t=e||{};_c.call(this,{attributions:t.attributions,projection:void 0,state:V_.READY,wrapX:!(t.wrapX!==void 0)||t.wrapX}),this.loader_=T,this.format_=t.format,this.overlaps_=!(t.overlaps!=void 0)||t.overlaps,this.url_=t.url,t.loader===void 0?this.url_!==void 0&&(R(this.format_,7),this.loader_=Ei(this.url_,this.format_)):this.loader_=t.loader,this.strategy_=t.strategy===void 0?Ti:t.strategy;const o=!(t.useSpatialIndex!==void 0)||t.useSpatialIndex;this.featuresRtree_=o?new hc:null,this.loadedExtentsRtree_=new hc,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let r,i;t.features instanceof qd?(r=t.features,i=r.getArray()):Array.isArray(t.features)&&(i=t.features),o||r!==void 0||(r=new qd(i)),i!==void 0&&this.addFeaturesInternal(i),r!==void 0&&this.bindFeaturesCollection_(r)};i(xc,_c),xc.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},xc.prototype.addFeatureInternal=function(e){const t=n(e).toString();if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);const o=e.getGeometry();if(o){const t=o.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(t,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new fc(uc.ADDFEATURE,e))}},xc.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[c(t,Yd.CHANGE,this.handleFeatureChange_,this),c(t,Nd.PROPERTYCHANGE,this.handleFeatureChange_,this)]},xc.prototype.addToIndex_=function(e,t){let o=!0;const r=t.getId();return void 0===r?(R(!(e in this.undefIdIndex_),30),this.undefIdIndex_[e]=t):r.toString()in this.idIndex_?o=!1:this.idIndex_[r.toString()]=t,o},xc.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},xc.prototype.addFeaturesInternal=function(e){const t=[],o=[],r=[];for(let t=0,r=e.length;t<r;t++){const r=e[t],i=n(r).toString();this.addToIndex_(i,r)&&o.push(r)}for(let a=0,i=o.length;a<i;a++){const e=o[a],i=n(e).toString();this.setupChangeEvents_(i,e);const s=e.getGeometry();if(s){const o=s.getExtent();t.push(o),r.push(e)}else this.nullGeometryFeatures_[i]=e}this.featuresRtree_&&this.featuresRtree_.load(t,r);for(let t=0,r=o.length;t<r;t++)this.dispatchEvent(new fc(uc.ADDFEATURE,o[t]))},xc.prototype.bindFeaturesCollection_=function(e){let t=!1;c(this,uc.ADDFEATURE,function(o){t||(t=!0,e.push(o.feature),t=!1)}),c(this,uc.REMOVEFEATURE,function(o){t||(t=!0,e.remove(o.feature),t=!1)}),c(e,wd.ADD,function(e){t||(t=!0,this.addFeature(e.element),t=!1)},this),c(e,wd.REMOVE,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)},this),this.featuresCollection_=e},xc.prototype.clear=function(e){if(e){for(const e in this.featureChangeKeys_){const t=this.featureChangeKeys_[e];t.forEach(h)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_)for(const e in this.featuresRtree_.forEach(this.removeFeatureInternal,this),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[e]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.loadedExtentsRtree_.clear(),this.nullGeometryFeatures_={};const t=new fc(uc.CLEAR);this.dispatchEvent(t),this.changed()},xc.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);return this.featuresCollection_?this.featuresCollection_.forEach(e):void 0},xc.prototype.forEachFeatureAtCoordinateDirect=function(e,t){const o=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(o,function(o){const r=o.getGeometry();return r.intersectsCoordinate(e)?t(o):void 0})},xc.prototype.forEachFeatureInExtent=function(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);return this.featuresCollection_?this.featuresCollection_.forEach(t):void 0},xc.prototype.forEachFeatureIntersectingExtent=function(e,t){return this.forEachFeatureInExtent(e,function(o){const r=o.getGeometry();if(r.intersectsExtent(e)){const e=t(o);if(e)return e}})},xc.prototype.getFeaturesCollection=function(){return this.featuresCollection_},xc.prototype.getFeatures=function(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray():this.featuresRtree_&&(e=this.featuresRtree_.getAll(),!l(this.nullGeometryFeatures_)&&jt(e,s(this.nullGeometryFeatures_))),e},xc.prototype.getFeaturesAtCoordinate=function(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(e){t.push(e)}),t},xc.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_.getInExtent(e)},xc.prototype.getClosestFeatureToCoordinate=function(e,t){const o=e[0],r=e[1];let i=null;const n=[NaN,NaN];let a=Infinity;const s=[-Infinity,-Infinity,Infinity,Infinity],l=t?t:E;return this.featuresRtree_.forEachInExtent(s,function(e){if(l(e)){const t=e.getGeometry(),l=a;if(a=t.closestPointXY(o,r,n,a),a<l){i=e;const t=ed(a);s[0]=o-t,s[1]=r-t,s[2]=o+t,s[3]=r+t}}}),i},xc.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},xc.prototype.getFeatureById=function(e){const t=this.idIndex_[e.toString()];return t===void 0?null:t},xc.prototype.getFormat=function(){return this.format_},xc.prototype.getOverlaps=function(){return this.overlaps_},xc.prototype.getResolutions=function(){},xc.prototype.getUrl=function(){return this.url_},xc.prototype.handleFeatureChange_=function(e){const t=e.target,o=n(t).toString(),r=t.getGeometry();if(!r)o in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[o]=t);else{const e=r.getExtent();o in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[o],this.featuresRtree_&&this.featuresRtree_.insert(e,t)):this.featuresRtree_&&this.featuresRtree_.update(e,t)}const i=t.getId();if(i!==void 0){const e=i.toString();o in this.undefIdIndex_?(delete this.undefIdIndex_[o],this.idIndex_[e]=t):this.idIndex_[e]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[e]=t)}else o in this.undefIdIndex_||(this.removeFromIdIndex_(t),this.undefIdIndex_[o]=t);this.changed(),this.dispatchEvent(new fc(uc.CHANGEFEATURE,t))},xc.prototype.hasFeature=function(e){const t=e.getId();if(t!==void 0)return t in this.idIndex_;else{const t=n(e).toString();return t in this.undefIdIndex_}},xc.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&l(this.nullGeometryFeatures_)},xc.prototype.loadFeatures=function(e,t,o){const r=this.loadedExtentsRtree_,n=this.strategy_(e,t);for(let a=0,i=n.length;a<i;++a){const e=n[a],i=r.forEachInExtent(e,function(t){return w(t.extent,e)});i||(this.loader_.call(this,e,t,o),r.insert(e,{extent:e.slice()}))}},xc.prototype.removeLoadedExtent=function(e){const t=this.loadedExtentsRtree_;let o;t.forEachInExtent(e,function(t){if(j(t.extent,e))return o=t,!0}),o&&t.remove(o)},xc.prototype.removeFeature=function(e){const t=n(e).toString();t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e),this.changed()},xc.prototype.removeFeatureInternal=function(e){const t=n(e).toString();this.featureChangeKeys_[t].forEach(h),delete this.featureChangeKeys_[t];const o=e.getId();o===void 0?delete this.undefIdIndex_[t]:delete this.idIndex_[o.toString()],this.dispatchEvent(new fc(uc.REMOVEFEATURE,e))},xc.prototype.removeFromIdIndex_=function(e){let t=!1;for(const o in this.idIndex_)if(this.idIndex_[o]===e){delete this.idIndex_[o],t=!0;break}return t},xc.prototype.setLoader=function(e){this.loader_=e};var Ec=xc;const Tc={POINT:'Point',LINE_STRING:'LineString',POLYGON:'Polygon',CIRCLE:'Circle'},Sc={DRAWSTART:'drawstart',DRAWEND:'drawend'},Cc=function(e,t){Dd.call(this,e),this.feature=t};i(Cc,Dd);const Rc=function(e){Cu.call(this,{handleDownEvent:Ri,handleEvent:Ci,handleUpEvent:Ii}),this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Li(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_===Tc.POLYGON?3:2,this.maxPoints_=e.maxPoints?e.maxPoints:Infinity,this.finishCondition_=e.finishCondition?e.finishCondition:E;let t=e.geometryFunction;if(!t)if(this.type_===ep.CIRCLE)t=function(e,t){const o=t?t:new Qu([NaN,NaN]),r=$o(e[0],e[1]);return o.setCenterAndRadius(e[0],ed(r)),o};else{let e;const o=this.mode_;o===Tc.POINT?e=wg:o===Tc.LINE_STRING?e=Gg:o===Tc.POLYGON&&(e=Ag),t=function(t,r){let i=r;return i?o===Tc.POLYGON?t[0].length?i.setCoordinates([t[0].concat([t[0][0]])]):i.setCoordinates([]):i.setCoordinates(t):i=new e(t),i}}this.geometryFunction_=t,this.dragVertexDelay_=e.dragVertexDelay===void 0?500:e.dragVertexDelay,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new dc({source:new Ec({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:Si(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:hu,this.freehandCondition_,this.freehandCondition_=e.freehand?_u:e.freehandCondition?e.freehandCondition:fu,c(this,C(nu.ACTIVE),this.updateState_,this)};i(Rc,Cu),Rc.prototype.setMap=function(e){Cu.prototype.setMap.call(this,e),this.updateState_()},Rc.prototype.handlePointerMove_=function(e){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,o=e.pixel,r=t[0]-o[0],i=t[1]-o[1],n=r*r+i*i;if(this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e),!0},Rc.prototype.atFinish_=function(e){let t=!1;if(this.sketchFeature_){let o=!1,r=[this.finishCoordinate_];if(this.mode_===Tc.LINE_STRING?o=this.sketchCoords_.length>this.minPoints_:this.mode_===Tc.POLYGON&&(o=this.sketchCoords_[0].length>this.minPoints_,r=[this.sketchCoords_[0][0],this.sketchCoords_[0][this.sketchCoords_[0].length-2]]),o){const o=e.map;for(let n=0,i=r.length;n<i;n++){const i=r[n],a=o.getPixelFromCoordinate(i),s=e.pixel,l=s[0]-a[0],d=s[1]-a[1],p=this.freehand_?1:this.snapTolerance_;if(t=ed(l*l+d*d)<=p,t){this.finishCoordinate_=i;break}}}}return t},Rc.prototype.createOrUpdateSketchPoint_=function(e){const t=e.coordinate.slice();if(!this.sketchPoint_)this.sketchPoint_=new Cg(new wg(t)),this.updateSketchFeatures_();else{const e=this.sketchPoint_.getGeometry();e.setCoordinates(t)}},Rc.prototype.startDrawing_=function(e){const t=e.coordinate;this.finishCoordinate_=t,this.mode_===Tc.POINT?this.sketchCoords_=t.slice():this.mode_===Tc.POLYGON?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Cg(new Gg(this.sketchLineCoords_)));const o=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new Cg,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new Cc(Sc.DRAWSTART,this.sketchFeature_))},Rc.prototype.modifyDrawing_=function(e){let t=e.coordinate;const o=this.sketchFeature_.getGeometry();let r,i;if(this.mode_===Tc.POINT?i=this.sketchCoords_:this.mode_===Tc.POLYGON?(r=this.sketchCoords_[0],i=r[r.length-1],this.atFinish_(e)&&(t=this.finishCoordinate_.slice())):(r=this.sketchCoords_,i=r[r.length-1]),i[0]=t[0],i[1]=t[1],this.geometryFunction_(this.sketchCoords_,o),this.sketchPoint_){const e=this.sketchPoint_.getGeometry();e.setCoordinates(t)}let n;if(o instanceof Ag&&this.mode_!==Tc.POLYGON){this.sketchLine_||(this.sketchLine_=new Cg(new Gg(null)));const e=o.getLinearRing(0);n=this.sketchLine_.getGeometry(),n.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates())}else this.sketchLineCoords_&&(n=this.sketchLine_.getGeometry(),n.setCoordinates(this.sketchLineCoords_));this.updateSketchFeatures_()},Rc.prototype.addToDrawing_=function(e){const t=e.coordinate,o=this.sketchFeature_.getGeometry();let r,i;this.mode_===Tc.LINE_STRING?(this.finishCoordinate_=t.slice(),i=this.sketchCoords_,i.length>=this.maxPoints_&&(this.freehand_?i.pop():r=!0),i.push(t.slice()),this.geometryFunction_(i,o)):this.mode_===Tc.POLYGON&&(i=this.sketchCoords_[0],i.length>=this.maxPoints_&&(this.freehand_?i.pop():r=!0),i.push(t.slice()),r&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,o)),this.updateSketchFeatures_(),r&&this.finishDrawing()},Rc.prototype.removeLastPoint=function(){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry();let t,o;this.mode_===Tc.LINE_STRING?(t=this.sketchCoords_,t.splice(-2,1),this.geometryFunction_(t,e),2<=t.length&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===Tc.POLYGON&&(t=this.sketchCoords_[0],t.splice(-2,1),o=this.sketchLine_.getGeometry(),o.setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e)),0===t.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()},Rc.prototype.finishDrawing=function(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const o=e.getGeometry();this.mode_===Tc.LINE_STRING?(t.pop(),this.geometryFunction_(t,o)):this.mode_===Tc.POLYGON&&(t[0].pop(),this.geometryFunction_(t,o),t=o.getCoordinates()),this.type_===ep.MULTI_POINT?e.setGeometry(new oc([t])):this.type_===ep.MULTI_LINE_STRING?e.setGeometry(new ec([t])):this.type_===ep.MULTI_POLYGON&&e.setGeometry(new ic([t])),this.dispatchEvent(new Cc(Sc.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)},Rc.prototype.abortDrawing_=function(){this.finishCoordinate_=null;const e=this.sketchFeature_;return e&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),e},Rc.prototype.extend=function(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new Cc(Sc.DRAWSTART,this.sketchFeature_))},Rc.prototype.shouldStopEvent=x,Rc.prototype.updateSketchFeatures_=function(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)},Rc.prototype.updateState_=function(){const e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing_(),this.overlay_.setMap(t?e:null)};const Ic={EXTENTCHANGED:'extentchanged'},Lc=function(e){Dd.call(this,Ic.EXTENTCHANGED),this.extent=e};i(Lc,Dd);const Pc=function(e){const t=e||{};this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=t.pixelTolerance===void 0?10:t.pixelTolerance,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),Cu.call(this,{handleDownEvent:vi,handleDragEvent:Fi,handleEvent:Pi,handleUpEvent:Oi}),this.extentOverlay_=new dc({source:new Ec({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:wi(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new dc({source:new Ec({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:Ni(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)};i(Pc,Cu),Pc.prototype.snapToVertex_=function(e,t){const o=t.getCoordinateFromPixel(e),r=function(e,t){return tr(o,e)-tr(o,t)},i=this.getExtent();if(i){const n=Mi(i);n.sort(r);const a=n[0];let s=Ko(o,a);const l=t.getPixelFromCoordinate(s);if(er(e,l)<=this.pixelTolerance_){const e=t.getPixelFromCoordinate(a[0]),o=t.getPixelFromCoordinate(a[1]),r=$o(l,e),i=$o(l,o),n=ed($l(r,i));return this.snappedToVertex_=n<=this.pixelTolerance_,this.snappedToVertex_&&(s=r>i?a[1]:a[0]),s}}return null},Pc.prototype.handlePointerMove_=function(e){const t=e.pixel,o=e.map;let r=this.snapToVertex_(t,o);r||(r=o.getCoordinateFromPixel(t)),this.createOrUpdatePointerFeature_(r)},Pc.prototype.createOrUpdateExtentFeature_=function(e){let t=this.extentFeature_;return t?e?t.setGeometry(Yo(e)):t.setGeometry(void 0):(t=e?new Cg(Yo(e)):new Cg({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t},Pc.prototype.createOrUpdatePointerFeature_=function(e){let t=this.vertexFeature_;if(!t)t=new Cg(new wg(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t);else{const o=t.getGeometry();o.setCoordinates(e)}return t},Pc.prototype.setMap=function(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),Cu.prototype.setMap.call(this,e)},Pc.prototype.getExtent=function(){return this.extent_},Pc.prototype.setExtent=function(e){this.extent_=e?e:null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new Lc(this.extent_))};const vc={MODIFYSTART:'modifystart',MODIFYEND:'modifyend'},Fc=function(e,t,o){Dd.call(this,e),this.features=t,this.mapBrowserEvent=o};i(Fc,Dd);const Oc=function(e){Cu.call(this,{handleDownEvent:Di,handleDragEvent:ki,handleEvent:Yi,handleUpEvent:Ui}),this.condition_=e.condition?e.condition:Tu,this.defaultDeleteCondition_=function(e){return pu(e)&&mu(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:_u,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new hc,this.pixelTolerance_=void 0===e.pixelTolerance?10:e.pixelTolerance,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new dc({source:new Ec({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Vi(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null;let t;if(e.source?(this.source_=e.source,t=new qd(this.source_.getFeatures()),c(this.source_,uc.ADDFEATURE,this.handleSourceAdd_,this),c(this.source_,uc.REMOVEFEATURE,this.handleSourceRemove_,this)):t=e.features,!t)throw new Error('The modify interaction requires features or a source');this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),c(this.features_,wd.ADD,this.handleFeatureAdd_,this),c(this.features_,wd.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null};i(Oc,Cu);const wc=0,Nc=1;Oc.prototype.addFeature_=function(e){const t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);const o=this.getMap();o&&o.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,o),c(e,Yd.CHANGE,this.handleFeatureChange_,this)},Oc.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new Fc(vc.MODIFYSTART,this.features_,e)))},Oc.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),m(e,Yd.CHANGE,this.handleFeatureChange_,this)},Oc.prototype.removeFeatureSegmentData_=function(e){const t=this.rBush_,o=[];t.forEach(function(t){e===t.feature&&o.push(t)});for(let r=o.length-1;0<=r;--r)t.remove(o[r])},Oc.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),Cu.prototype.setActive.call(this,e)},Oc.prototype.setMap=function(e){this.overlay_.setMap(e),Cu.prototype.setMap.call(this,e)},Oc.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},Oc.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},Oc.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},Oc.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}},Oc.prototype.handleFeatureRemove_=function(e){const t=e.element;this.removeFeature_(t)},Oc.prototype.writePointGeometry_=function(e,t){const o=t.getCoordinates();this.rBush_.insert(t.getExtent(),{feature:e,geometry:t,segment:[o,o]})},Oc.prototype.writeMultiPointGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,n=o.length;r<n;++r){const n=o[r],a={feature:e,geometry:t,depth:[r],index:r,segment:[n,n]};this.rBush_.insert(t.getExtent(),a)}},Oc.prototype.writeLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,n=o.length-1;r<n;++r){const n=o.slice(r,r+2),a={feature:e,geometry:t,index:r,segment:n};this.rBush_.insert(I(n),a)}},Oc.prototype.writeMultiLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const n=o[r];for(let o=0,a=n.length-1;o<a;++o){const a=n.slice(o,o+2),s={feature:e,geometry:t,depth:[r],index:o,segment:a};this.rBush_.insert(I(a),s)}}},Oc.prototype.writePolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const n=o[r];for(let o=0,a=n.length-1;o<a;++o){const a=n.slice(o,o+2),s={feature:e,geometry:t,depth:[r],index:o,segment:a};this.rBush_.insert(I(a),s)}}},Oc.prototype.writeMultiPolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const i=o[r];for(let o=0,n=i.length;o<n;++o){const n=i[o];for(let a=0,s=n.length-1;a<s;++a){const s=n.slice(a,a+2),l={feature:e,geometry:t,depth:[o,r],index:a,segment:s};this.rBush_.insert(I(s),l)}}}},Oc.prototype.writeCircleGeometry_=function(e,t){const o=t.getCenter(),r={feature:e,geometry:t,index:wc,segment:[o,o]},i={feature:e,geometry:t,index:Nc,segment:[o,o]};r.featureSegments=i.featureSegments=[r,i],this.rBush_.insert(k(o),r),this.rBush_.insert(t.getExtent(),i)},Oc.prototype.writeGeometryCollectionGeometry_=function(e,t){const o=t.getGeometriesArray();for(let r=0;r<o.length;++r)this.SEGMENT_WRITERS_[o[r].getType()].call(this,e,o[r])},Oc.prototype.createOrUpdateVertexFeature_=function(e){let t=this.vertexFeature_;if(!t)t=new Cg(new wg(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t);else{const o=t.getGeometry();o.setCoordinates(e)}return t},Oc.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},Oc.prototype.handlePointerAtPixel_=function(e,t){const o=t.getCoordinateFromPixel(e),r=function(e,t){return ji(o,e)-ji(o,t)},i=P(k(o),t.getView().getResolution()*this.pixelTolerance_),a=this.rBush_,s=a.getInExtent(i);if(0<s.length){s.sort(r);const i=s[0],a=i.segment;let l=Bi(o,i);const d=t.getPixelFromCoordinate(l);let p=er(e,d);if(p<=this.pixelTolerance_){const e={};if(i.geometry.getType()===ep.CIRCLE&&i.index===Nc)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l);else{const o=t.getPixelFromCoordinate(a[0]),r=t.getPixelFromCoordinate(a[1]),i=$o(d,o),g=$o(d,r);p=ed($l(i,g)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(l=i>g?a[1]:a[0]),this.createOrUpdateVertexFeature_(l);for(let t=1,o=s.length;t<o;++t){const o=s[t].segment;if(qo(a[0],o[0])&&qo(a[1],o[1])||qo(a[0],o[1])&&qo(a[1],o[0]))e[n(o)]=!0;else break}}return e[n(a)]=!0,void(this.vertexSegments_=e)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},Oc.prototype.insertVertex_=function(e,t){const o=e.segment,r=e.feature,i=e.geometry,n=e.depth,a=e.index;let s;for(;t.length<i.getStride();)t.push(0);switch(i.getType()){case ep.MULTI_LINE_STRING:s=i.getCoordinates(),s[n[0]].splice(a+1,0,t);break;case ep.POLYGON:s=i.getCoordinates(),s[n[0]].splice(a+1,0,t);break;case ep.MULTI_POLYGON:s=i.getCoordinates(),s[n[1]][n[0]].splice(a+1,0,t);break;case ep.LINE_STRING:s=i.getCoordinates(),s.splice(a+1,0,t);break;default:return;}this.setGeometryCoordinates_(i,s);const l=this.rBush_;l.remove(e),this.updateSegmentIndices_(i,a,n,1);const d={segment:[o[0],t],feature:r,geometry:i,depth:n,index:a};l.insert(I(d.segment),d),this.dragSegments_.push([d,1]);const p={segment:[t,o[1]],feature:r,geometry:i,depth:n,index:a+1};l.insert(I(p.segment),p),this.dragSegments_.push([p,0]),this.ignoreNextSingleClick_=!0},Oc.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=n_.POINTERDRAG){const e=this.lastPointerEvent_;return this.willModifyFeatures_(e),this.removeVertex_(),this.dispatchEvent(new Fc(vc.MODIFYEND,this.features_,e)),this.modified_=!1,!0}return!1},Oc.prototype.removeVertex_=function(){const e=this.dragSegments_,t={};let o=!1,r,a,s,l,d,i,p,g,_,u,c;for(d=e.length-1;0<=d;--d)s=e[d],u=s[0],c=n(u.feature),u.depth&&(c+='-'+u.depth.join('-')),c in t||(t[c]={}),0===s[1]?(t[c].right=u,t[c].index=u.index):1==s[1]&&(t[c].left=u,t[c].index=u.index+1);for(c in t){switch(_=t[c].right,p=t[c].left,i=t[c].index,g=i-1,u=void 0===p?_:p,0>g&&(g=0),l=u.geometry,a=l.getCoordinates(),r=a,o=!1,l.getType()){case ep.MULTI_LINE_STRING:2<a[u.depth[0]].length&&(a[u.depth[0]].splice(i,1),o=!0);break;case ep.LINE_STRING:2<a.length&&(a.splice(i,1),o=!0);break;case ep.MULTI_POLYGON:r=r[u.depth[1]];case ep.POLYGON:r=r[u.depth[0]],4<r.length&&(i==r.length-1&&(i=0),r.splice(i,1),o=!0,0===i&&(r.pop(),r.push(r[0]),g=r.length-1));break;default:}if(o){this.setGeometryCoordinates_(l,a);const t=[];if(void 0!==p&&(this.rBush_.remove(p),t.push(p.segment[0])),void 0!==_&&(this.rBush_.remove(_),t.push(_.segment[1])),void 0!==p&&void 0!==_){const e={depth:u.depth,feature:u.feature,geometry:u.geometry,index:g,segment:t};this.rBush_.insert(I(e.segment),e)}this.updateSegmentIndices_(l,i,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return o},Oc.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},Oc.prototype.updateSegmentIndices_=function(e,t,o,r){this.rBush_.forEachInExtent(e.getExtent(),function(i){i.geometry===e&&(o===void 0||i.depth===void 0||zt(i.depth,o))&&i.index>t&&(i.index+=r)})};const Ac={SELECT:'select'},bc=function(e,t,o,r){Dd.call(this,e),this.selected=t,this.deselected=o,this.mapBrowserEvent=r};i(bc,Dd);const Mc=function(e){su.call(this,{handleEvent:zi});const t=e?e:{};this.condition_=t.condition?t.condition:mu,this.addCondition_=t.addCondition?t.addCondition:cu,this.removeCondition_=t.removeCondition?t.removeCondition:cu,this.toggleCondition_=t.toggleCondition?t.toggleCondition:fu,this.multi_=!!t.multi&&t.multi,this.filter_=t.filter?t.filter:E,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0;const o=new dc({source:new Ec({useSpatialIndex:!1,features:t.features,wrapX:t.wrapX}),style:t.style?t.style:Xi(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.featureOverlay_=o;let r;if(!t.layers)r=E;else if('function'==typeof t.layers)r=t.layers;else{const e=t.layers;r=function(t){return kt(e,t)}}this.layerFilter_=r,this.featureLayerAssociation_={};const i=this.featureOverlay_.getSource().getFeaturesCollection();c(i,wd.ADD,this.addFeature_,this),c(i,wd.REMOVE,this.removeFeature_,this)};i(Mc,su),Mc.prototype.addFeatureLayerAssociation_=function(e,t){const o=n(e);this.featureLayerAssociation_[o]=t},Mc.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},Mc.prototype.getHitTolerance=function(){return this.hitTolerance_},Mc.prototype.getLayer=function(e){const t=n(e);return this.featureLayerAssociation_[t]},Mc.prototype.setHitTolerance=function(e){this.hitTolerance_=e},Mc.prototype.setMap=function(e){const t=this.getMap(),o=this.featureOverlay_.getSource().getFeaturesCollection();t&&o.forEach(t.unskipFeature.bind(t)),su.prototype.setMap.call(this,e),this.featureOverlay_.setMap(e),e&&o.forEach(e.skipFeature.bind(e))},Mc.prototype.addFeature_=function(e){const t=this.getMap();t&&t.skipFeature(e.element)},Mc.prototype.removeFeature_=function(e){const t=this.getMap();t&&t.unskipFeature(e.element)},Mc.prototype.removeFeatureLayerAssociation_=function(e){const t=n(e);delete this.featureLayerAssociation_[t]};const Gc=function(e){Cu.call(this,{handleEvent:Wi,handleDownEvent:E,handleUpEvent:Ki});const t=e?e:{};this.source_=t.source?t.source:null,this.vertex_=!(t.vertex!==void 0)||t.vertex,this.edge_=!(t.edge!==void 0)||t.edge,this.features_=t.features?t.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelCoordinate_=null,this.pixelTolerance_=t.pixelTolerance===void 0?10:t.pixelTolerance,this.sortByDistance_=Hi.bind(this),this.rBush_=new hc,this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}};i(Gc,Cu),Gc.prototype.addFeature=function(e,t){const o=n(e),r=e.getGeometry();if(r){const t=this.SEGMENT_WRITERS_[r.getType()];t&&(this.indexedFeaturesExtents_[o]=r.getExtent(b()),t.call(this,e,r))}(!(t!==void 0)||t)&&(this.featureChangeListenerKeys_[o]=c(e,Yd.CHANGE,this.handleFeatureChange_,this))},Gc.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},Gc.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},Gc.prototype.getFeatures_=function(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},Gc.prototype.handleFeatureAdd_=function(e){let t;e instanceof fc?t=e.feature:e instanceof Hd&&(t=e.element),this.addFeature(t)},Gc.prototype.handleFeatureRemove_=function(e){let t;e instanceof fc?t=e.feature:e instanceof Hd&&(t=e.element),this.removeFeature(t)},Gc.prototype.handleFeatureChange_=function(e){const t=e.target;if(this.handlingDownUpSequence){const e=n(t);e in this.pendingFeatures_||(this.pendingFeatures_[e]=t)}else this.updateFeature_(t)},Gc.prototype.removeFeature=function(e,t){const o=n(e),r=this.indexedFeaturesExtents_[o];if(r){const t=this.rBush_,o=[];t.forEachInExtent(r,function(t){e===t.feature&&o.push(t)});for(let e=o.length-1;0<=e;--e)t.remove(o[e])}(!(t!==void 0)||t)&&(h(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])},Gc.prototype.setMap=function(e){const t=this.getMap(),o=this.featuresListenerKeys_,r=this.getFeatures_();t&&(o.forEach(h),o.length=0,r.forEach(this.forEachFeatureRemove_.bind(this))),Cu.prototype.setMap.call(this,e),e&&(this.features_?o.push(c(this.features_,wd.ADD,this.handleFeatureAdd_,this),c(this.features_,wd.REMOVE,this.handleFeatureRemove_,this)):this.source_&&o.push(c(this.source_,uc.ADDFEATURE,this.handleFeatureAdd_,this),c(this.source_,uc.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(this.forEachFeatureAdd_.bind(this)))},Gc.prototype.shouldStopEvent=x,Gc.prototype.snapTo=function(e,t,o){const r=o.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),i=o.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),n=I([r,i]);let a=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(a=a.filter(function(e){return e.feature.getGeometry().getType()!==ep.CIRCLE}));let s=!1,l=!1,d=null,p=null,g,_,u,c,y;if(0<a.length){this.pixelCoordinate_=t,a.sort(this.sortByDistance_);const r=a[0].segment,i=a[0].feature.getGeometry().getType()===ep.CIRCLE;this.vertex_&&!this.edge_?(_=o.getPixelFromCoordinate(r[0]),u=o.getPixelFromCoordinate(r[1]),c=$o(e,_),y=$o(e,u),g=ed($l(c,y)),s=g<=this.pixelTolerance_,s&&(l=!0,d=c>y?r[1]:r[0],p=o.getPixelFromCoordinate(d))):this.edge_&&(d=i?Wo(t,a[0].feature.getGeometry()):Ko(t,r),p=o.getPixelFromCoordinate(d),er(e,p)<=this.pixelTolerance_&&(l=!0,this.vertex_&&!i&&(_=o.getPixelFromCoordinate(r[0]),u=o.getPixelFromCoordinate(r[1]),c=$o(p,_),y=$o(p,u),g=ed($l(c,y)),s=g<=this.pixelTolerance_,s&&(d=c>y?r[1]:r[0],p=o.getPixelFromCoordinate(d))))),l&&(p=[Vl(p[0]),Vl(p[1])])}return{snapped:l,vertex:d,vertexPixel:p}},Gc.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},Gc.prototype.writeCircleGeometry_=function(e,t){const o=jo(t),r=o.getCoordinates()[0];for(let o=0,i=r.length-1;o<i;++o){const t=r.slice(o,o+2);this.rBush_.insert(I(t),{feature:e,segment:t})}},Gc.prototype.writeGeometryCollectionGeometry_=function(e,t){const o=t.getGeometriesArray();for(let r=0;r<o.length;++r){const t=this.SEGMENT_WRITERS_[o[r].getType()];t&&t.call(this,e,o[r])}},Gc.prototype.writeLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length-1;r<i;++r){const t=o.slice(r,r+2);this.rBush_.insert(I(t),{feature:e,segment:t})}},Gc.prototype.writeMultiLineStringGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const t=o[r];for(let o=0,r=t.length-1;o<r;++o){const r=t.slice(o,o+2);this.rBush_.insert(I(r),{feature:e,segment:r})}}},Gc.prototype.writeMultiPointGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const i=o[r];this.rBush_.insert(t.getExtent(),{feature:e,segment:[i,i]})}},Gc.prototype.writeMultiPolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const t=o[r];for(let o=0,r=t.length;o<r;++o){const r=t[o];for(let t=0,o=r.length-1;t<o;++t){const o=r.slice(t,t+2);this.rBush_.insert(I(o),{feature:e,segment:o})}}}},Gc.prototype.writePointGeometry_=function(e,t){const o=t.getCoordinates();this.rBush_.insert(t.getExtent(),{feature:e,segment:[o,o]})},Gc.prototype.writePolygonGeometry_=function(e,t){const o=t.getCoordinates();for(let r=0,i=o.length;r<i;++r){const t=o[r];for(let o=0,r=t.length-1;o<r;++o){const r=t.slice(o,o+2);this.rBush_.insert(I(r),{feature:e,segment:r})}}};const Dc={TRANSLATESTART:'translatestart',TRANSLATING:'translating',TRANSLATEEND:'translateend'},kc=function(e,t,o){Dd.call(this,e),this.features=t,this.coordinate=o};i(kc,Dd);const Uc=function(e){Cu.call(this,{handleDownEvent:Zi,handleDragEvent:Ji,handleMoveEvent:Qi,handleUpEvent:qi});const t=e?e:{};this.lastCoordinate_=null,this.features_=t.features===void 0?null:t.features;let o;if(!t.layers)o=E;else if('function'==typeof t.layers)o=t.layers;else{const e=t.layers;o=function(t){return kt(e,t)}}this.layerFilter_=o,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.lastFeature_=null,c(this,C(nu.ACTIVE),this.handleActiveChanged_,this)};i(Uc,Cu),Uc.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){if(!this.features_||kt(this.features_.getArray(),e))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},Uc.prototype.getHitTolerance=function(){return this.hitTolerance_},Uc.prototype.setHitTolerance=function(e){this.hitTolerance_=e},Uc.prototype.setMap=function(e){const t=this.getMap();Cu.prototype.setMap.call(this,e),this.updateState_(t)},Uc.prototype.handleActiveChanged_=function(){this.updateState_(null)},Uc.prototype.updateState_=function(e){let t=this.getMap();const o=this.getActive();if((!t||!o)&&(t=t||e,t)){const e=t.getViewport();e.classList.remove('ol-grab','ol-grabbing')}};const Yc=.5,jc=function(e,t,o,r,i){this.loader_=i===void 0?null:i;const n=i===void 0?Gp.LOADED:Gp.IDLE;Xg.call(this,e,t,o,n),this.canvas_=r,this.error_=null};i(jc,Xg),jc.prototype.getError=function(){return this.error_},jc.prototype.handleLoad_=function(e){e?(this.error_=e,this.state=Gp.ERROR):this.state=Gp.LOADED,this.changed()},jc.prototype.load=function(){this.state==Gp.IDLE&&(this.state=Gp.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},jc.prototype.getImage=function(){return this.canvas_};var Bc=jc;const Vc=function(e,t,o,r,i){Dd.call(this,e),this.vectorContext=t,this.frameState=o,this.context=r,this.glContext=i};i(Vc,Dd);var zc=Vc;const Xc=function(){};Xc.prototype.drawCustom=function(){},Xc.prototype.drawGeometry=function(){},Xc.prototype.setStyle=function(){},Xc.prototype.drawCircle=function(){},Xc.prototype.drawFeature=function(){},Xc.prototype.drawGeometryCollection=function(){},Xc.prototype.drawLineString=function(){},Xc.prototype.drawMultiLineString=function(){},Xc.prototype.drawMultiPoint=function(){},Xc.prototype.drawMultiPolygon=function(){},Xc.prototype.drawPoint=function(){},Xc.prototype.drawPolygon=function(){},Xc.prototype.drawText=function(){},Xc.prototype.setFillStrokeStyle=function(){},Xc.prototype.setImageStyle=function(){},Xc.prototype.setTextStyle=function(){};var Wc=Xc;const Kc=function(e,t,o,r,i){Wc.call(this),this.context_=e,this.pixelRatio_=t,this.extent_=o,this.transform_=r,this.viewRotation_=i,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=0,this.imageSnapToPixel_=!1,this.imageWidth_=0,this.text_='',this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=0,this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=tt()};i(Kc,Wc),Kc.prototype.drawImages_=function(e,t,o){if(!this.image_)return;const r=_e(e,t,o,2,this.transform_,this.pixelCoordinates_),n=this.context_,i=this.tmpLocalTransform_,a=n.globalAlpha;1!=this.imageOpacity_&&(n.globalAlpha=a*this.imageOpacity_);let s=this.imageRotation_;this.imageRotateWithView_&&(s+=this.viewRotation_);for(let a=0,l=r.length;a<l;a+=2){let e=r[a]-this.imageAnchorX_,t=r[a+1]-this.imageAnchorY_;if(this.imageSnapToPixel_&&(e=Vl(e),t=Vl(t)),0!==s||1!=this.imageScale_){const o=e+this.imageAnchorX_,r=t+this.imageAnchorY_;pt(i,o,r,this.imageScale_,this.imageScale_,s,-o,-r),n.setTransform.apply(n,i)}n.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,e,t,this.imageWidth_,this.imageHeight_)}(0!==s||1!=this.imageScale_)&&n.setTransform(1,0,0,1,0,0),1!=this.imageOpacity_&&(n.globalAlpha=a)},Kc.prototype.drawText_=function(e,t,o,r){if(!this.textState_||''===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const i=_e(e,t,o,r,this.transform_,this.pixelCoordinates_),n=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);t<o;t+=r){const e=i[t]+this.textOffsetX_,o=i[t+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_){const t=pt(this.tmpLocalTransform_,e,o,this.textScale_,this.textScale_,a,-e,-o);n.setTransform.apply(n,t)}this.textStrokeState_&&n.strokeText(this.text_,e,o),this.textFillState_&&n.fillText(this.text_,e,o)}(0!==a||1!=this.textScale_)&&n.setTransform(1,0,0,1,0,0)},Kc.prototype.moveToLineTo_=function(e,t,o,r,i){const n=this.context_,a=_e(e,t,o,r,this.transform_,this.pixelCoordinates_);n.moveTo(a[0],a[1]);let s=a.length;i&&(s-=2);for(let l=2;l<s;l+=2)n.lineTo(a[l],a[l+1]);return i&&n.closePath(),o},Kc.prototype.drawRings_=function(e,t,o,r){for(let n=0,i=o.length;n<i;++n)t=this.moveToLineTo_(e,t,o[n],r,!0);return t},Kc.prototype.drawCircle=function(e){if(ae(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=qt(e,this.transform_,this.pixelCoordinates_),o=t[2]-t[0],r=t[3]-t[1],i=ed(o*o+r*r),n=this.context_;n.beginPath(),n.arc(t[0],t[1],i,0,2*Kl),this.fillState_&&n.fill(),this.strokeState_&&n.stroke()}''!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}},Kc.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())},Kc.prototype.drawGeometry=function(e){const t=e.getType();switch(t){case ep.POINT:this.drawPoint(e);break;case ep.LINE_STRING:this.drawLineString(e);break;case ep.POLYGON:this.drawPolygon(e);break;case ep.MULTI_POINT:this.drawMultiPoint(e);break;case ep.MULTI_LINE_STRING:this.drawMultiLineString(e);break;case ep.MULTI_POLYGON:this.drawMultiPolygon(e);break;case ep.GEOMETRY_COLLECTION:this.drawGeometryCollection(e);break;case ep.CIRCLE:this.drawCircle(e);break;default:}},Kc.prototype.drawFeature=function(e,t){const o=t.getGeometryFunction()(e);o&&ae(this.extent_,o.getExtent())&&(this.setStyle(t),this.drawGeometry(o))},Kc.prototype.drawGeometryCollection=function(e){const t=e.getGeometriesArray();for(let o=0,r=t.length;o<r;++o)this.drawGeometry(t[o])},Kc.prototype.drawPoint=function(e){const t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o),''!==this.text_&&this.drawText_(t,0,t.length,o)},Kc.prototype.drawMultiPoint=function(e){const t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o),''!==this.text_&&this.drawText_(t,0,t.length,o)},Kc.prototype.drawLineString=function(e){if(ae(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(o,0,o.length,e.getStride(),!1),t.stroke()}if(''!==this.text_){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}},Kc.prototype.drawMultiLineString=function(e){const t=e.getExtent();if(ae(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getFlatCoordinates();let r=0;const n=e.getEnds(),a=e.getStride();t.beginPath();for(let e=0,t=n.length;e<t;++e)r=this.moveToLineTo_(o,r,n[e],a,!1);t.stroke()}if(''!==this.text_){const t=e.getFlatMidpoints();this.drawText_(t,0,t.length,2)}}},Kc.prototype.drawPolygon=function(e){if(ae(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(''!==this.text_){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}},Kc.prototype.drawMultiPolygon=function(e){if(ae(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,o=e.getOrientedFlatCoordinates();let r=0;const n=e.getEndss(),a=e.getStride();t.beginPath();for(let e=0,t=n.length;e<t;++e){const t=n[e];r=this.drawRings_(o,r,t,a)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(''!==this.text_){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}},Kc.prototype.setContextFillState_=function(e){const t=this.context_,o=this.contextFillState_;o?o.fillStyle!=e.fillStyle&&(o.fillStyle=t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})},Kc.prototype.setContextStrokeState_=function(e){const t=this.context_,o=this.contextStrokeState_;o?(o.lineCap!=e.lineCap&&(o.lineCap=t.lineCap=e.lineCap),Op&&(!zt(o.lineDash,e.lineDash)&&t.setLineDash(o.lineDash=e.lineDash),o.lineDashOffset!=e.lineDashOffset&&(o.lineDashOffset=t.lineDashOffset=e.lineDashOffset)),o.lineJoin!=e.lineJoin&&(o.lineJoin=t.lineJoin=e.lineJoin),o.lineWidth!=e.lineWidth&&(o.lineWidth=t.lineWidth=e.lineWidth),o.miterLimit!=e.miterLimit&&(o.miterLimit=t.miterLimit=e.miterLimit),o.strokeStyle!=e.strokeStyle&&(o.strokeStyle=t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,Op&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})},Kc.prototype.setContextTextState_=function(e){const t=this.context_,o=this.contextTextState_,r=e.textAlign?e.textAlign:Qp;o?(o.font!=e.font&&(o.font=t.font=e.font),o.textAlign!=r&&(o.textAlign=t.textAlign=r),o.textBaseline!=e.textBaseline&&(o.textBaseline=t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})},Kc.prototype.setFillStrokeStyle=function(e,t){if(!e)this.fillState_=null;else{const t=e.getColor();this.fillState_={fillStyle:xt(t?t:Xp)}}if(!t)this.strokeState_=null;else{const e=t.getColor(),o=t.getLineCap(),r=t.getLineDash(),i=t.getLineDashOffset(),n=t.getLineJoin(),a=t.getWidth(),s=t.getMiterLimit();this.strokeState_={lineCap:void 0===o?Wp:o,lineDash:r?r:Kp,lineDashOffset:i?i:Hp,lineJoin:void 0===n?Zp:n,lineWidth:this.pixelRatio_*(void 0===a?tg:a),miterLimit:void 0===s?qp:s,strokeStyle:xt(e?e:Jp)}}},Kc.prototype.setImageStyle=function(e){if(!e)this.image_=null;else{const t=e.getAnchor(),o=e.getImage(1),r=e.getOrigin(),i=e.getSize();this.imageAnchorX_=t[0],this.imageAnchorY_=t[1],this.imageHeight_=i[1],this.image_=o,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation(),this.imageScale_=e.getScale()*this.pixelRatio_,this.imageSnapToPixel_=e.getSnapToPixel(),this.imageWidth_=i[0]}},Kc.prototype.setTextStyle=function(e){if(!e)this.text_='';else{const t=e.getFill();if(!t)this.textFillState_=null;else{const e=t.getColor();this.textFillState_={fillStyle:xt(e?e:Xp)}}const o=e.getStroke();if(!o)this.textStrokeState_=null;else{const e=o.getColor(),t=o.getLineCap(),r=o.getLineDash(),i=o.getLineDashOffset(),n=o.getLineJoin(),a=o.getWidth(),s=o.getMiterLimit();this.textStrokeState_={lineCap:t===void 0?Wp:t,lineDash:r?r:Kp,lineDashOffset:i?i:Hp,lineJoin:n===void 0?Zp:n,lineWidth:a===void 0?tg:a,miterLimit:s===void 0?qp:s,strokeStyle:xt(e?e:Jp)}}const r=e.getFont(),i=e.getOffsetX(),n=e.getOffsetY(),a=e.getRotateWithView(),s=e.getRotation(),l=e.getScale(),d=e.getText(),p=e.getTextAlign(),g=e.getTextBaseline();this.textState_={font:r===void 0?zp:r,textAlign:p===void 0?Qp:p,textBaseline:g===void 0?$p:g},this.text_=d===void 0?'':d,this.textOffsetX_=i===void 0?0:this.pixelRatio_*i,this.textOffsetY_=n===void 0?0:this.pixelRatio_*n,this.textRotateWithView_=a!==void 0&&a,this.textRotation_=s===void 0?0:s,this.textScale_=this.pixelRatio_*(l===void 0?1:l)}};var Hc=Kc;const Zc=function(e){Bd.call(this),this.layer_=e};i(Zc,Bd),Zc.prototype.forEachFeatureAtCoordinate=T,Zc.prototype.hasFeatureAtCoordinate=x,Zc.prototype.createLoadedTileFinder=function(e,t,o){return function(r,i){return e.forEachLoadedTile(t,r,i,function(e){o[r]||(o[r]={}),o[r][e.tileCoord.toString()]=e})}},Zc.prototype.getLayer=function(){return this.layer_},Zc.prototype.handleImageChange_=function(e){const t=e.target;t.getState()===Gp.LOADED&&this.renderIfReadyAndVisible()},Zc.prototype.loadImage=function(e){let t=e.getState();return t!=Gp.LOADED&&t!=Gp.ERROR&&c(e,Yd.CHANGE,this.handleImageChange_,this),t==Gp.IDLE&&(e.load(),t=e.getState()),t==Gp.LOADED},Zc.prototype.renderIfReadyAndVisible=function(){const e=this.getLayer();e.getVisible()&&e.getSourceState()==V_.READY&&this.changed()},Zc.prototype.scheduleExpireCache=function(e,t){if(t.canExpireCache()){const o=function(e,t,o){const r=n(e).toString();r in o.usedTiles&&e.expireCache(o.viewState.projection,o.usedTiles[r])}.bind(null,t);e.postRenderFunctions.push(o)}},Zc.prototype.updateUsedTiles=function(e,t,o,r){const i=n(t).toString(),a=o.toString();i in e?a in e[i]?e[i][a].extend(r):e[i][a]=r:(e[i]={},e[i][a]=r)},Zc.prototype.manageTilePyramid=function(e,t,o,r,i,a,s,l,d,p){const g=n(t).toString();g in e.wantedTiles||(e.wantedTiles[g]={});const _=e.wantedTiles[g],u=e.tileQueue,c=o.getMinZoom();let m,h,f,E,x,y;for(y=c;y<=s;++y)for(h=o.getTileRangeForExtentAndZ(a,y,h),f=o.getResolution(y),E=h.minX;E<=h.maxX;++E)for(x=h.minY;x<=h.maxY;++x)s-y<=l?(m=t.getTile(y,E,x,r,i),m.getState()==Hg.IDLE&&(_[m.getKey()]=!0,!u.isKeyQueued(m.getKey())&&u.enqueue([m,g,o.getTileCoordCenter(m.tileCoord),f])),void 0!==d&&d.call(p,m)):t.useTile(y,E,x,i)};var qc=Zc;const Jc=function(e){qc.call(this,e),this.renderedResolution,this.transform_=tt()};i(Jc,qc),Jc.prototype.clip=function(e,t,o){const r=t.pixelRatio,i=t.size[0]*r,n=t.size[1]*r,a=t.viewState.rotation,s=re(o),l=ie(o),d=J(o),p=q(o);at(t.coordinateToPixelTransform,s),at(t.coordinateToPixelTransform,l),at(t.coordinateToPixelTransform,d),at(t.coordinateToPixelTransform,p),e.save(),Ft(e,-a,i/2,n/2),e.beginPath(),e.moveTo(s[0]*r,s[1]*r),e.lineTo(l[0]*r,l[1]*r),e.lineTo(d[0]*r,d[1]*r),e.lineTo(p[0]*r,p[1]*r),e.clip(),Ft(e,a,i/2,n/2)},Jc.prototype.dispatchComposeEvent_=function(e,t,o,r){const i=this.getLayer();if(i.hasListener(e)){const n=o.size[0]*o.pixelRatio,a=o.size[1]*o.pixelRatio,s=o.viewState.rotation;Ft(t,-s,n/2,a/2);const l=r===void 0?this.getTransform(o,0):r,d=new Hc(t,o.pixelRatio,o.extent,l,o.viewState.rotation),p=new zc(e,d,o,t,null);i.dispatchEvent(p),Ft(t,s,n/2,a/2)}},Jc.prototype.forEachLayerAtCoordinate=function(e,t,o,r){const i=this.forEachFeatureAtCoordinate(e,t,0,E,this);return i?o.call(r,this.getLayer(),null):void 0},Jc.prototype.postCompose=function(e,t,o,r){this.dispatchComposeEvent_(Dg.POSTCOMPOSE,e,t,r)},Jc.prototype.preCompose=function(e,t,o){this.dispatchComposeEvent_(Dg.PRECOMPOSE,e,t,o)},Jc.prototype.dispatchRenderEvent=function(e,t,o){this.dispatchComposeEvent_(Dg.RENDER,e,t,o)},Jc.prototype.getTransform=function(e,t){const o=e.viewState,r=e.pixelRatio,i=r*e.size[0]/2,n=r*e.size[1]/2,a=r/o.resolution,s=-o.rotation,l=-o.center[0]+t,d=-o.center[1];return pt(this.transform_,i,n,a,-a,s,l,d)},Jc.prototype.composeFrame=function(){},Jc.prototype.prepareFrame=function(){};var Qc=Jc;const $c=function(e){Qc.call(this,e),this.coordinateToCanvasPixelTransform=tt(),this.hitCanvasContext_=null};i($c,Qc),$c.prototype.composeFrame=function(e,t,o){this.preCompose(o,e);const r=this.getImage();if(r){const i=t.extent,n=i!==void 0&&!w(i,e.extent)&&ae(i,e.extent);n&&this.clip(o,e,i);const a=this.getImageTransform(),s=o.globalAlpha;o.globalAlpha=t.opacity;const l=a[4],d=a[5],p=r.width*a[0],g=r.height*a[3];o.drawImage(r,0,0,+r.width,+r.height,Vl(l),Vl(d),Vl(p),Vl(g)),o.globalAlpha=s,n&&o.restore()}this.postCompose(o,e,t)},$c.prototype.getImage=function(){},$c.prototype.getImageTransform=function(){},$c.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){const n=this.getLayer(),a=n.getSource(),s=t.viewState.resolution,l=t.viewState.rotation,d=t.skippedFeatureUids;return a.forEachFeatureAtCoordinate(e,s,l,o,d,function(e){return r.call(i,e,n)})},$c.prototype.forEachLayerAtCoordinate=function(e,t,o,r){if(this.getImage())if(this.getLayer().getSource().forEachFeatureAtCoordinate!==T)return Qc.prototype.forEachLayerAtCoordinate.apply(this,arguments);else{const i=at(this.coordinateToCanvasPixelTransform,e.slice());Qo(i,t.viewState.resolution/this.renderedResolution),this.hitCanvasContext_||(this.hitCanvasContext_=Tt(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.getImage(),i[0],i[1],1,1,0,0,1,1);const n=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<n[3]?o.call(r,this.getLayer(),n):void 0}};var ey=$c;const ty=function(e){ey.call(this,e),this.image_=null,this.imageTransform_=tt(),this.skippedFeatures_=[],this.vectorRenderer_=null};i(ty,ey),ty.handles=function(e){return e.getType()===nc.IMAGE||e.getType()===nc.VECTOR&&e.getRenderMode()===ac.IMAGE},ty.create=function(e,t){const o=new ty(t);if(t.getType()===nc.VECTOR){const r=e.getLayerRendererConstructors();for(let n=0,i=r.length;n<i;++n){const i=r[n];if(i!==ty&&i.handles(t)){o.setVectorRenderer(i.create(e,t));break}}}return o},ty.prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose(),ey.prototype.disposeInternal.call(this)},ty.prototype.getImage=function(){return this.image_?this.image_.getImage():null},ty.prototype.getImageTransform=function(){return this.imageTransform_},ty.prototype.prepareFrame=function(e,t){const o=e.pixelRatio,r=e.size,i=e.viewState,n=i.center,a=i.resolution;let s;const l=this.getLayer(),d=l.getSource(),p=e.viewHints;let g=e.extent;if(void 0!==t.extent&&(g=oe(g,t.extent)),!p[M_.ANIMATING]&&!p[M_.INTERACTING]&&!se(g)){let r=i.projection;const n=this.vectorRenderer_;if(n){const r=n.context,i=Ad({},e,{size:[ne(g)/a,te(g)/a],viewState:Ad({},e.viewState,{rotation:0})}),s=Object.keys(i.skippedFeatureUids).sort();n.prepareFrame(i,t)&&(n.replayGroupChanged||!zt(s,this.skippedFeatures_))&&(r.canvas.width=i.size[0]*o,r.canvas.height=i.size[1]*o,n.composeFrame(i,t,r),this.image_=new Bc(g,a,o,r.canvas),this.skippedFeatures_=s)}else if(s=d.getImage(g,a,o,r),s){const e=this.loadImage(s);e&&(this.image_=s)}}if(this.image_){s=this.image_;const e=s.getExtent(),t=s.getResolution(),i=s.getPixelRatio(),l=o*t/(a*i),d=pt(this.imageTransform_,o*r[0]/2,o*r[1]/2,l,l,0,i*(e[0]-n[0])/t,i*(n[1]-e[3])/t);pt(this.coordinateToCanvasPixelTransform,o*r[0]/2-d[4],o*r[1]/2-d[5],o/a,-o/a,0,-n[0],-n[1]),this.renderedResolution=t*o/i}return!!this.image_},ty.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,o,r,i):ey.prototype.forEachFeatureAtCoordinate.call(this,e,t,o,r,i)},ty.prototype.setVectorRenderer=function(e){this.vectorRenderer_&&this.vectorRenderer_.dispose(),this.vectorRenderer_=e};var oy=ty;const ry=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32};ry.prototype.clear=function(){this.cache_={},this.cacheSize_=0},ry.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){let e=0;for(const t in this.cache_){const o=this.cache_[t];0!=(3&e++)||o.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}},ry.prototype.get=function(e,t,o){const r=en(e,t,o);return r in this.cache_?this.cache_[r]:null},ry.prototype.set=function(e,t,o,r){const i=en(e,t,o);this.cache_[i]=r,++this.cacheSize_},ry.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()};const iy=new ry,ny=function(e){Md.call(this),this.map_=e,this.layerRenderers_={},this.layerRendererListeners_={},this.layerRendererConstructors_=[]};i(ny,Md),ny.prototype.registerLayerRenderers=function(e){this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_,e)},ny.prototype.getLayerRendererConstructors=function(){return this.layerRendererConstructors_},ny.prototype.calculateMatrices2D=function(e){const t=e.viewState,o=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;pt(o,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),gt(nt(r,o))},ny.prototype.removeLayerRenderers=function(){for(const e in this.layerRenderers_)this.removeLayerRendererByKey_(e).dispose()},ny.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,a,s,l){function d(e,o){const i=n(e).toString(),s=t.layerStates[n(o)].managed;if(!(i in t.skippedFeatureUids)||s)return r.call(a,e,s?o:null)}let p;const g=t.viewState,_=g.resolution,u=g.projection;let c=e;if(u.canWrapX()){const t=u.getExtent(),o=ne(t),r=e[0];if(r<t[0]||r>t[2]){const i=rd((t[0]-r)/o);c=[r+o*i,e[1]]}}const y=t.layerStatesArray,m=y.length;let h;for(h=m-1;0<=h;--h){const r=y[h],i=r.layer;if(br(r,_)&&s.call(l,i)){const r=this.getLayerRenderer(i);if(i.getSource()&&(p=r.forEachFeatureAtCoordinate(i.getSource().getWrapX()?c:e,t,o,d,a)),p)return p}}},ny.prototype.forEachLayerAtPixel=function(){},ny.prototype.hasFeatureAtCoordinate=function(e,t,o,r,i){const n=this.forEachFeatureAtCoordinate(e,t,o,E,this,r,i);return n!==void 0},ny.prototype.getLayerRenderer=function(e){const t=n(e).toString();if(t in this.layerRenderers_)return this.layerRenderers_[t];else{let o;for(let t=0,r=this.layerRendererConstructors_.length;t<r;++t){const r=this.layerRendererConstructors_[t];if(r.handles(e)){o=r.create(this,e);break}}if(o)this.layerRenderers_[t]=o,this.layerRendererListeners_[t]=c(o,Yd.CHANGE,this.handleLayerRendererChange_,this);else throw new Error('Unable to create renderer for layer: '+e.getType());return o}},ny.prototype.getLayerRendererByKey=function(e){return this.layerRenderers_[e]},ny.prototype.getLayerRenderers=function(){return this.layerRenderers_},ny.prototype.getMap=function(){return this.map_},ny.prototype.handleLayerRendererChange_=function(){this.map_.render()},ny.prototype.removeLayerRendererByKey_=function(e){const t=this.layerRenderers_[e];return delete this.layerRenderers_[e],h(this.layerRendererListeners_[e]),delete this.layerRendererListeners_[e],t},ny.prototype.renderFrame=T,ny.prototype.removeUnusedLayerRenderers_=function(e,t){for(const o in this.layerRenderers_)t&&o in t.layerStates||this.removeLayerRendererByKey_(o).dispose()},ny.prototype.scheduleExpireIconCache=function(e){e.postRenderFunctions.push(tn)},ny.prototype.scheduleRemoveUnusedLayerRenderers=function(e){for(const t in this.layerRenderers_)if(!(t in e.layerStates))return void e.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this))};var ay=ny;const sy=function(e){ay.call(this,e);const t=e.getViewport();this.context_=Tt(),this.canvas_=this.context_.canvas,this.canvas_.style.width='100%',this.canvas_.style.height='100%',this.canvas_.style.display='block',this.canvas_.className=kp,t.insertBefore(this.canvas_,t.childNodes[0]||null),this.renderedVisible_=!0,this.transform_=tt()};i(sy,ay),sy.prototype.dispatchComposeEvent_=function(e,t){const o=this.getMap(),r=this.context_;if(o.hasListener(e)){const i=t.extent,n=t.pixelRatio,a=t.viewState,s=a.rotation,l=this.getTransform(t),d=new Hc(r,n,i,l,s),p=new zc(e,d,t,r,null);o.dispatchEvent(p)}},sy.prototype.getTransform=function(e){const t=e.viewState,o=this.canvas_.width/2,r=this.canvas_.height/2,i=e.pixelRatio/t.resolution,n=-t.rotation,a=-t.center[0],s=-t.center[1];return pt(this.transform_,o,r,i,-i,n,a,s)},sy.prototype.renderFrame=function(e){if(!e)return void(this.renderedVisible_&&(this.canvas_.style.display='none',this.renderedVisible_=!1));const t=this.context_,o=e.pixelRatio,r=Vl(e.size[0]*o),n=Vl(e.size[1]*o);this.canvas_.width!=r||this.canvas_.height!=n?(this.canvas_.width=r,this.canvas_.height=n):t.clearRect(0,0,r,n);const a=e.viewState.rotation;this.calculateMatrices2D(e),this.dispatchComposeEvent_(Dg.PRECOMPOSE,e);const s=e.layerStatesArray;Xt(s,on),a&&(t.save(),Ft(t,a,r/2,n/2));const l=e.viewState.resolution;let d,i,p,g,_;for(d=0,i=s.length;d<i;++d)(_=s[d],p=_.layer,g=this.getLayerRenderer(p),br(_,l)&&_.sourceState==V_.READY)&&g.prepareFrame(e,_)&&g.composeFrame(e,_,t);a&&t.restore(),this.dispatchComposeEvent_(Dg.POSTCOMPOSE,e),this.renderedVisible_||(this.canvas_.style.display='',this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(e),this.scheduleExpireIconCache(e)},sy.prototype.forEachLayerAtPixel=function(e,t,o,r,n,a){let s;const l=t.viewState,d=l.resolution,p=t.layerStatesArray,g=p.length,_=at(t.pixelToCoordinateTransform,e.slice());let u;for(u=g-1;0<=u;--u){const e=p[u],i=e.layer;if(br(e,d)&&n.call(a,i)){const e=this.getLayerRenderer(i);if(s=e.forEachLayerAtCoordinate(_,t,o,r),s)return s}}};var ly=sy;const dy=function(e,t,o,r){this.minX=e,this.maxX=t,this.minY=o,this.maxY=r};dy.prototype.contains=function(e){return this.containsXY(e[1],e[2])},dy.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY},dy.prototype.containsXY=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY},dy.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY},dy.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)},dy.prototype.getHeight=function(){return this.maxY-this.minY+1},dy.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},dy.prototype.getWidth=function(){return this.maxX-this.minX+1},dy.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY};var py=dy;const gy=function(e){ey.call(this,e),this.context=null===this.context?null:Tt(),this.oversampling_,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.tmpExtent=b(),this.tmpTileRange_=new py(0,0,0,0),this.imageTransform_=tt(),this.zDirection=0};i(gy,ey),gy.handles=function(e){return e.getType()===nc.TILE},gy.create=function(e,t){return new gy(t)},gy.prototype.isDrawableTile_=function(e){const t=e.getState(),o=this.getLayer().getUseInterimTilesOnError();return t==Hg.LOADED||t==Hg.EMPTY||t==Hg.ERROR&&!o},gy.prototype.prepareFrame=function(e,t){const o=e.pixelRatio,r=e.size,i=e.viewState,a=i.projection,s=i.resolution,l=i.center,d=this.getLayer(),p=d.getSource(),g=p.getRevision(),_=p.getTileGridForProjection(a),u=_.getZForResolution(s,this.zDirection),c=_.getResolution(u);let m=Vl(s/c)||1,h=e.extent;if(void 0!==t.extent&&(h=oe(h,t.extent)),se(h))return!1;const f=_.getTileRangeForExtentAndZ(h,u),E=_.getTileRangeExtent(u,f),T=p.getTilePixelRatio(o),S={};S[u]={};const C=this.createLoadedTileFinder(p,a,S),R=this.tmpExtent,I=this.tmpTileRange_;let L=!1,P,v,x;for(v=f.minX;v<=f.maxX;++v)for(x=f.minY;x<=f.maxY;++x){if(P=p.getTile(u,v,x,o,a),P.getState()==Hg.ERROR&&(d.getUseInterimTilesOnError()?0<d.getPreload()&&(L=!0):P.setState(Hg.LOADED)),this.isDrawableTile_(P)||(P=P.getInterimTile()),this.isDrawableTile_(P)){const t=n(this);if(P.getState()==Hg.LOADED){S[u][P.tileCoord.toString()]=P;const e=P.inTransition(t);!L&&(e||-1===this.renderedTiles.indexOf(P))&&(L=!0)}if(1===P.getAlpha(t,e.time))continue}const t=_.getTileCoordChildTileRange(P.tileCoord,I,R);let r=!1;t&&(r=C(u+1,t)),r||_.forEachTileCoordParentTileRange(P.tileCoord,C,null,I,R)}const y=c*o/T*m,F=e.viewHints,O=F[M_.ANIMATING]||F[M_.INTERACTING];if(!(this.renderedResolution&&16<Date.now()-e.time&&O)&&(L||!(this.renderedExtent_&&w(this.renderedExtent_,h))||this.renderedRevision!=g||m!=this.oversampling_||!O&&y!=this.renderedResolution)){const r=this.context;if(r){const e=p.getTilePixelSize(u,o,a),t=Vl(f.getWidth()*e[0]/m),i=Vl(f.getHeight()*e[1]/m),n=r.canvas;n.width!=t||n.height!=i?(this.oversampling_=m,n.width=t,n.height=i):(this.renderedExtent_&&!j(E,this.renderedExtent_)&&r.clearRect(0,0,t,i),m=this.oversampling_)}this.renderedTiles.length=0;const n=Object.keys(S).map(Number);n.sort(function(e,t){return e===u?1:t===u?-1:e>t?1:e<t?-1:0});let s,l,d,y,C,i,I,L,F,O,w;for(C=0,i=n.length;C<i;++C)for(const r in y=n[C],d=p.getTilePixelSize(y,o,a),s=_.getResolution(y),l=s/c,L=T*p.getGutter(a),F=S[y],F)P=F[r],I=_.getTileCoordExtent(P.getTileCoord(),R),v=(I[0]-E[0])/c*T/m,x=(E[3]-I[3])/c*T/m,O=d[0]*l/m,w=d[1]*l/m,this.drawTileImage(P,e,t,v,x,O,w,L,u===y),this.renderedTiles.push(P);this.renderedRevision=g,this.renderedResolution=c*o/T*m,this.renderedExtent_=E}const N=this.renderedResolution/s,A=pt(this.imageTransform_,o*r[0]/2,o*r[1]/2,N,N,0,(this.renderedExtent_[0]-l[0])/this.renderedResolution*o,(l[1]-this.renderedExtent_[3])/this.renderedResolution*o);return pt(this.coordinateToCanvasPixelTransform,o*r[0]/2-A[4],o*r[1]/2-A[5],o/s,-o/s,0,-l[0],-l[1]),this.updateUsedTiles(e.usedTiles,p,u,f),this.manageTilePyramid(e,p,_,o,a,h,u,d.getPreload()),this.scheduleExpireCache(e,p),0<this.renderedTiles.length},gy.prototype.drawTileImage=function(e,t,o,r,i,a,s,l,d){const p=e.getImage(this.getLayer());if(p){const o=n(this),g=d?e.getAlpha(o,t.time):1;1!==g||this.getLayer().getSource().getOpaque(t.viewState.projection)||this.context.clearRect(r,i,a,s);const _=g!==this.context.globalAlpha;_&&(this.context.save(),this.context.globalAlpha=g),this.context.drawImage(p,l,l,p.width-2*l,p.height-2*l,r,i,a,s),_&&this.context.restore(),1===g?d&&e.endTransition(o):t.animate=!0}},gy.prototype.getImage=function(){const e=this.context;return e?e.canvas:null},gy.prototype.getLayer,gy.prototype.getImageTransform=function(){return this.imageTransform_};var _y=gy;const uy=function(){};uy.prototype.getReplay=function(){},uy.prototype.isEmpty=function(){};var cy=uy,yy={CIRCLE:'Circle',DEFAULT:'Default',IMAGE:'Image',LINE_STRING:'LineString',POLYGON:'Polygon',TEXT:'Text'};const my={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},hy=[my.FILL],fy=[my.STROKE],xy=[my.BEGIN_PATH],Ey=[my.CLOSE_PATH];var Ty=my;const Sy=[yy.POLYGON,yy.CIRCLE,yy.LINE_STRING,yy.IMAGE,yy.TEXT,yy.DEFAULT],Cy={};Cy.left=0,Cy.end=0,Cy.center=.5,Cy.right=1,Cy.start=1,Cy.top=0,Cy.middle=.5,Cy.hanging=.2,Cy.alphabetic=.8,Cy.ideographic=.8,Cy.bottom=1;const Ry=function(e,t,o,r,i,n){Wc.call(this),this.declutterTree=n,this.tolerance=e,this.maxExtent=t,this.overlaps=i,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=o,this.alignFill_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=tt(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0};i(Ry,Wc);const Iy=b(),Ly=tt();Ry.prototype.replayTextBackground_=function(e,t,o,r,i,n,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,o),e.lineTo.apply(e,r),e.lineTo.apply(e,i),e.lineTo.apply(e,t),n&&(this.alignFill_=n[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())},Ry.prototype.replayImage_=function(e,t,o,r,i,n,a,s,l,d,p,g,_,u,c,y,m,f){const x=m||f;i*=_,n*=_,t-=i,o-=n;const E=c+d>r.width?r.width-d:c,T=s+p>r.height?r.height-p:s,h=y[3]+E*_+y[1],S=y[0]+T*_+y[2],C=t-y[3],R=o-y[0];let I,L,P,v;(x||0!==g)&&(I=[C,R],L=[C+h,R],P=[C+h,R+S],v=[C,R+S]);let F=null;if(0!==g){const e=t+i,r=o+n;F=pt(Ly,e,r,1,1,g,-e,-r),D(Iy),V(Iy,at(Ly,I)),V(Iy,at(Ly,L)),V(Iy,at(Ly,P)),V(Iy,at(Ly,v))}else G(C,R,C+h,R+S,Iy);const O=e.canvas,w=f?f[2]*_/2:0,N=Iy[0]-w<=O.width&&0<=Iy[2]+w&&Iy[1]-w<=O.height&&0<=Iy[3]+w;if(u&&(t=Vl(t),o=Vl(o)),a){if(!N&&1==a[4])return;B(a,Iy);const i=N?[e,F?F.slice(0):null,l,r,d,p,E,T,t,o,_]:null;i&&x&&i.push(m,f,I,L,P,v),a.push(i)}else N&&(x&&this.replayTextBackground_(e,I,L,P,v,m,f),Ot(e,F,l,r,d,p,E,T,t,o,_))},Ry.prototype.applyPixelRatio=function(e){const t=this.pixelRatio;return 1==t?e:e.map(function(e){return e*t})},Ry.prototype.appendFlatCoordinates=function(e,t,o,r,n,a){let s=this.coordinates.length;const l=this.getBufferedMaxExtent();a&&(t+=r);const d=[e[t],e[t+1]],p=[NaN,NaN];let g=!0,_,i,u;for(_=t+r;_<o;_+=r)p[0]=e[_],p[1]=e[_+1],u=A(l,p),u===i?u===Qd.INTERSECTING?(this.coordinates[s++]=p[0],this.coordinates[s++]=p[1],g=!1):g=!0:(g&&(this.coordinates[s++]=d[0],this.coordinates[s++]=d[1]),this.coordinates[s++]=p[0],this.coordinates[s++]=p[1],g=!1),d[0]=p[0],d[1]=p[1],i=u;return(n&&g||_===t+r)&&(this.coordinates[s++]=d[0],this.coordinates[s++]=d[1]),s},Ry.prototype.drawCustomCoordinates_=function(e,t,o,r,n){for(let a=0,i=o.length;a<i;++a){const i=o[a],s=this.appendFlatCoordinates(e,t,i,r,!1,!1);n.push(s),t=i}return t},Ry.prototype.drawCustom=function(e,t,o){this.beginGeometry(e,t);const r=e.getType(),n=e.getStride(),i=this.coordinates.length;let a,s,l,d,p;if(r==ep.MULTI_POLYGON){e=e,a=e.getOrientedFlatCoordinates(),d=[];const t=e.getEndss();p=0;for(let e=0,o=t.length;e<o;++e){const o=[];p=this.drawCustomCoordinates_(a,p,t[e],n,o),d.push(o)}this.instructions.push([Ty.CUSTOM,i,d,e,o,co])}else r==ep.POLYGON||r==ep.MULTI_LINE_STRING?(l=[],a=r==ep.POLYGON?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),p=this.drawCustomCoordinates_(a,0,e.getEnds(),n,l),this.instructions.push([Ty.CUSTOM,i,l,e,o,uo])):r==ep.LINE_STRING||r==ep.MULTI_POINT?(a=e.getFlatCoordinates(),s=this.appendFlatCoordinates(a,0,a.length,n,!1,!1),this.instructions.push([Ty.CUSTOM,i,s,e,o,_o])):r==ep.POINT&&(a=e.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),s=this.coordinates.length,this.instructions.push([Ty.CUSTOM,i,s,e,o]));this.endGeometry(e,t)},Ry.prototype.beginGeometry=function(e,t){this.beginGeometryInstruction1_=[Ty.BEGIN_GEOMETRY,t,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Ty.BEGIN_GEOMETRY,t,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},Ry.prototype.fill_=function(e){if(this.alignFill_){const t=at(this.renderedTransform_,[0,0]),o=512*this.pixelRatio;e.translate(t[0]%o,t[1]%o),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.setTransform.apply(e,lg)},Ry.prototype.setStrokeStyle_=function(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],Op&&(e.lineDashOffset=t[7],e.setLineDash(t[6]))},Ry.prototype.renderDeclutter_=function(e,t){if(e&&5<e.length){const o=e[4];if(1==o||o==e.length-5){const o={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};if(!this.declutterTree.collides(o)){this.declutterTree.insert(o);for(let t=5,o=e.length;t<o;++t){const o=e[t];o&&(11<o.length&&this.replayTextBackground_(o[0],o[13],o[14],o[15],o[16],o[11],o[12]),Ot.apply(void 0,o))}}e.length=5,D(e)}}},Ry.prototype.replay_=function(e,t,o,r,a,s){let p;this.pixelCoordinates_&&zt(t,this.renderedTransform_)?p=this.pixelCoordinates_:(!this.pixelCoordinates_&&(this.pixelCoordinates_=[]),p=_e(this.coordinates,0,this.coordinates.length,2,t,this.pixelCoordinates_),nt(this.renderedTransform_,t));const g=!l(o);let _=0;const i=r.length;let u=0,d=0,c=0,m=null,h=null,f,E,T,S,C,R,I,L,P;const v=this.coordinateCache_,y=this.viewRotation_,F={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:y},O=this.instructions!=r||this.overlaps?0:200;for(let l,w,x;_<i;){const t=r[_],i=t[0];switch(i){case Ty.BEGIN_GEOMETRY:l=t[1],g&&o[n(l).toString()]||!l.getGeometry()?_=t[2]:void 0===s||ae(s,l.getGeometry().getExtent())?++_:_=t[2]+1;break;case Ty.BEGIN_PATH:d>O&&(this.fill_(e),d=0),c>O&&(e.stroke(),c=0),d||c||(e.beginPath(),S=C=NaN),++_;break;case Ty.CIRCLE:u=t[1];const N=p[u],A=p[u+1],b=p[u+2],M=p[u+3],G=b-N,D=M-A,k=ed(G*G+D*D);e.moveTo(N+k,A),e.arc(N,A,k,0,2*Kl,!0),++_;break;case Ty.CLOSE_PATH:e.closePath(),++_;break;case Ty.CUSTOM:u=t[1],f=t[2];const r=t[3],U=t[4],Y=6==t.length?t[5]:void 0;F.geometry=r,F.feature=l,_ in v||(v[_]=[]);const j=v[_];Y?Y(p,u,f,2,j):(j[0]=p[u],j[1]=p[u+1],j.length=2),U(j,F),++_;break;case Ty.DRAW_IMAGE:u=t[1],f=t[2],P=t[3],E=t[4],T=t[5],L=a?null:t[6];const B=t[7],V=t[8],z=t[9],X=t[10],W=t[11];let K=t[12];const H=t[13],Z=t[14],q=t[15];let J,Q,$;for(16<t.length?(J=t[16],Q=t[17],$=t[18]):(J=eg,Q=$=!1),W&&(K+=y);u<f;u+=2)this.replayImage_(e,p[u],p[u+1],P,E,T,L,B,V,z,X,K,H,Z,q,J,Q?m:null,$?h:null);this.renderDeclutter_(L,l),++_;break;case Ty.DRAW_CHARS:const ee=t[1],te=t[2],oe=t[3];L=a?null:t[4];const re=t[5],ie=t[6],ne=t[7],se=t[8],le=t[9],de=t[10],pe=t[11],ge=t[12],_e=t[13],ue=t[14],ce=ar(p,ee,te,2),ye=se(ge);if(re||ye<=ce){const t=this.textStates[_e].textAlign,o=(ce-ye)*Cy[t],r=nn(p,ee,te,2,ge,se,o,ne);if(r){let t,o,i,n,a;if(de)for(t=0,o=r.length;t<o;++t)a=r[t],i=a[4],n=this.getImage(i,_e,'',de),E=a[2]+pe,T=oe*n.height+2*(.5-oe)*pe-le,this.replayImage_(e,a[0],a[1],n,E,T,L,n.height,1,0,0,a[3],ue,!1,n.width,eg,null,null);if(ie)for(t=0,o=r.length;t<o;++t)a=r[t],i=a[4],n=this.getImage(i,_e,ie,''),E=a[2],T=oe*n.height-le,this.replayImage_(e,a[0],a[1],n,E,T,L,n.height,1,0,0,a[3],ue,!1,n.width,eg,null,null)}}this.renderDeclutter_(L,l),++_;break;case Ty.END_GEOMETRY:if(void 0!==a){l=t[1];const e=a(l);if(e)return e}++_;break;case Ty.FILL:O?d++:this.fill_(e),++_;break;case Ty.MOVE_TO_LINE_TO:for(u=t[1],f=t[2],w=p[u],x=p[u+1],R=0|w+.5,I=0|x+.5,(R!==S||I!==C)&&(e.moveTo(w,x),S=R,C=I),u+=2;u<f;u+=2)w=p[u],x=p[u+1],R=0|w+.5,I=0|x+.5,(u==f-2||R!==S||I!==C)&&(e.lineTo(w,x),S=R,C=I);++_;break;case Ty.SET_FILL_STYLE:m=t,this.alignFill_=t[2],d&&(this.fill_(e),d=0,c&&(e.stroke(),c=0)),e.fillStyle=t[1],++_;break;case Ty.SET_STROKE_STYLE:h=t,c&&(e.stroke(),c=0),this.setStrokeStyle_(e,t),++_;break;case Ty.STROKE:O?c++:e.stroke(),++_;break;default:++_;}}return d&&this.fill_(e),void(c&&e.stroke())},Ry.prototype.replay=function(e,t,o,r){this.viewRotation_=o,this.replay_(e,t,r,this.instructions,void 0,void 0)},Ry.prototype.replayHitDetection=function(e,t,o,r,i,n){return this.viewRotation_=o,this.replay_(e,t,r,this.hitDetectionInstructions,i,n)},Ry.prototype.reverseHitDetectionInstructions=function(){const e=this.hitDetectionInstructions;e.reverse();let t;const o=e.length;let r=-1,i,n;for(t=0;t<o;++t)i=e[t],n=i[0],n==Ty.END_GEOMETRY?r=t:n==Ty.BEGIN_GEOMETRY&&(i[2]=t,Yt(this.hitDetectionInstructions,r,t),r=-1)},Ry.prototype.setFillStrokeStyle=function(e,t){const o=this.state;if(e){const t=e.getColor();o.fillStyle=xt(t?t:Xp)}else o.fillStyle=void 0;if(t){const e=t.getColor();o.strokeStyle=xt(e?e:Jp);const r=t.getLineCap();o.lineCap=void 0===r?Wp:r;const i=t.getLineDash();o.lineDash=i?i.slice():Kp;const n=t.getLineDashOffset();o.lineDashOffset=n?n:Hp;const a=t.getLineJoin();o.lineJoin=void 0===a?Zp:a;const s=t.getWidth();o.lineWidth=void 0===s?tg:s;const l=t.getMiterLimit();o.miterLimit=void 0===l?qp:l,o.lineWidth>this.maxLineWidth&&(this.maxLineWidth=o.lineWidth,this.bufferedMaxExtent_=null)}else o.strokeStyle=void 0,o.lineCap=void 0,o.lineDash=null,o.lineDashOffset=void 0,o.lineJoin=void 0,o.lineWidth=void 0,o.miterLimit=void 0},Ry.prototype.createFill=function(e){const t=e.fillStyle,o=[Ty.SET_FILL_STYLE,t];return'string'!=typeof t&&o.push(!0),o},Ry.prototype.applyStroke=function(e){this.instructions.push(this.createStroke(e))},Ry.prototype.createStroke=function(e){return[Ty.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]},Ry.prototype.updateFillStyle=function(e,t,o){const r=e.fillStyle;('string'!=typeof r||e.currentFillStyle!=r)&&(r!==void 0&&this.instructions.push(t.call(this,e,o)),e.currentFillStyle=r)},Ry.prototype.updateStrokeStyle=function(e,t){const o=e.strokeStyle,r=e.lineCap,i=e.lineDash,n=e.lineDashOffset,a=e.lineJoin,s=e.lineWidth,l=e.miterLimit;e.currentStrokeStyle==o&&e.currentLineCap==r&&(i==e.currentLineDash||zt(e.currentLineDash,i))&&e.currentLineDashOffset==n&&e.currentLineJoin==a&&e.currentLineWidth==s&&e.currentMiterLimit==l||(o!==void 0&&t.call(this,e),e.currentStrokeStyle=o,e.currentLineCap=r,e.currentLineDash=i,e.currentLineDashOffset=n,e.currentLineJoin=a,e.currentLineWidth=s,e.currentMiterLimit=l)},Ry.prototype.endGeometry=function(e,t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const o=[Ty.END_GEOMETRY,t];this.instructions.push(o),this.hitDetectionInstructions.push(o)},Ry.prototype.finish=T,Ry.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=v(this.maxExtent),0<this.maxLineWidth)){const e=this.resolution*(this.maxLineWidth+1)/2;P(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_};var Py=Ry;const vy=function(e,t,o,r,i,n){Py.call(this,e,t,o,r,i,n),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.snapToPixel_=void 0,this.width_=void 0};i(vy,Py),vy.prototype.drawCoordinates_=function(e,t,o,r){return this.appendFlatCoordinates(e,t,o,r,!1,!1)},vy.prototype.drawPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);const o=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,n=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([Ty.DRAW_IMAGE,i,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([Ty.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(e,t)}},vy.prototype.drawMultiPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);const o=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,n=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([Ty.DRAW_IMAGE,i,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([Ty.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(e,t)}},vy.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.snapToPixel_=void 0,this.width_=void 0},vy.prototype.setImageStyle=function(e,t){const o=e.getAnchor(),r=e.getSize(),i=e.getHitDetectionImage(1),n=e.getImage(1),a=e.getOrigin();this.anchorX_=o[0],this.anchorY_=o[1],this.declutterGroup_=t,this.hitDetectionImage_=i,this.image_=n,this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=a[0],this.originY_=a[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScale(),this.snapToPixel_=e.getSnapToPixel(),this.width_=r[0]};const Fy=function(e,t,o,r,i,n){Py.call(this,e,t,o,r,i,n)};i(Fy,Py),Fy.prototype.drawFlatCoordinates_=function(e,t,o,r){const i=this.coordinates.length,n=this.appendFlatCoordinates(e,t,o,r,!1,!1),a=[Ty.MOVE_TO_LINE_TO,i,n];return this.instructions.push(a),this.hitDetectionInstructions.push(a),o},Fy.prototype.drawLineString=function(e,t){const o=this.state,r=o.strokeStyle,i=o.lineWidth;if(void 0!==r&&void 0!==i){this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Ty.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],xy);const r=e.getFlatCoordinates(),i=e.getStride();this.drawFlatCoordinates_(r,0,r.length,i),this.hitDetectionInstructions.push(fy),this.endGeometry(e,t)}},Fy.prototype.drawMultiLineString=function(e,t){const o=this.state,r=o.strokeStyle,i=o.lineWidth;if(void 0===r||void 0===i)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Ty.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],xy);const n=e.getEnds(),a=e.getFlatCoordinates(),s=e.getStride();let l=0;for(let o=0,r=n.length;o<r;++o)l=this.drawFlatCoordinates_(a,l,n[o],s);this.hitDetectionInstructions.push(fy),this.endGeometry(e,t)},Fy.prototype.finish=function(){const e=this.state;e.lastStroke!=void 0&&e.lastStroke!=this.coordinates.length&&this.instructions.push(fy),this.reverseHitDetectionInstructions(),this.state=null},Fy.prototype.applyStroke=function(e){e.lastStroke!=void 0&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(fy),e.lastStroke=this.coordinates.length),e.lastStroke=0,Py.prototype.applyStroke.call(this,e),this.instructions.push(xy)};const Oy=function(e,t,o,r,i,n){Py.call(this,e,t,o,r,i,n)};i(Oy,Py),Oy.prototype.drawFlatCoordinatess_=function(e,t,o,r){const i=this.state,n=void 0!==i.fillStyle,a=void 0!=i.strokeStyle,s=o.length;this.instructions.push(xy),this.hitDetectionInstructions.push(xy);for(let n=0;n<s;++n){const i=o[n],s=this.coordinates.length,l=this.appendFlatCoordinates(e,t,i,r,!0,!a),d=[Ty.MOVE_TO_LINE_TO,s,l];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(Ey),this.hitDetectionInstructions.push(Ey)),t=i}return this.hitDetectionInstructions.push(hy),n&&this.instructions.push(hy),a&&(this.instructions.push(fy),this.hitDetectionInstructions.push(fy)),t},Oy.prototype.drawCircle=function(e,t){const o=this.state,r=o.fillStyle,i=o.strokeStyle;if(void 0!==r||void 0!==i){this.setFillStrokeStyles_(e),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Ty.SET_FILL_STYLE,ut(Xp)]),void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([Ty.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);const r=e.getFlatCoordinates(),i=e.getStride(),n=this.coordinates.length;this.appendFlatCoordinates(r,0,r.length,i,!1,!1);const a=[Ty.CIRCLE,n];this.instructions.push(xy,a),this.hitDetectionInstructions.push(xy,a),this.hitDetectionInstructions.push(hy),void 0!==o.fillStyle&&this.instructions.push(hy),void 0!==o.strokeStyle&&(this.instructions.push(fy),this.hitDetectionInstructions.push(fy)),this.endGeometry(e,t)}},Oy.prototype.drawPolygon=function(e,t){const o=this.state;this.setFillStrokeStyles_(e),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Ty.SET_FILL_STYLE,ut(Xp)]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Ty.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);const r=e.getEnds(),i=e.getOrientedFlatCoordinates(),n=e.getStride();this.drawFlatCoordinatess_(i,0,r,n),this.endGeometry(e,t)},Oy.prototype.drawMultiPolygon=function(e,t){const o=this.state,r=o.fillStyle,i=o.strokeStyle;if(void 0===r&&void 0===i)return;this.setFillStrokeStyles_(e),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Ty.SET_FILL_STYLE,ut(Xp)]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Ty.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);const n=e.getEndss(),a=e.getOrientedFlatCoordinates(),s=e.getStride();let l=0;for(let o=0,r=n.length;o<r;++o)l=this.drawFlatCoordinatess_(a,l,n[o],s);this.endGeometry(e,t)},Oy.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(0!==e){const t=this.coordinates;for(let o=0,r=t.length;o<r;++o)t[o]=ho(t[o],e)}},Oy.prototype.setFillStrokeStyles_=function(e){const t=this.state,o=t.fillStyle;o!==void 0&&this.updateFillStyle(t,this.createFill,e),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)};var wy=Oy;const Ny=function(e,t,o,r,i,n){Py.call(this,e,t,o,r,i,n),this.declutterGroup_,this.labels_=null,this.text_='',this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_='',this.fillKey_='',this.strokeKey_='',this.widths_={},og.prune()};i(Ny,Py),Ny.prototype.drawText=function(e,t){const o=this.textFillState_,r=this.textStrokeState_,n=this.textState_;if(''===this.text_||!n||!o&&!r)return;let a=this.coordinates.length;const s=e.getType();let l=null,d=2,p=2,g,i;if(n.placement===kg.LINE){if(!ae(this.getBufferedMaxExtent(),e.getExtent()))return;let r;if(l=e.getFlatCoordinates(),p=e.getStride(),s==ep.LINE_STRING)r=[l.length];else if(s==ep.MULTI_LINE_STRING)r=e.getEnds();else if(s==ep.POLYGON)r=e.getEnds().slice(0,1);else if(s==ep.MULTI_POLYGON){const t=e.getEndss();for(r=[],g=0,i=t.length;g<i;++g)r.push(t[g][0])}this.beginGeometry(e,t);const _=n.textAlign;let u=0,c;for(let e=0,t=r.length;e<t;++e){if(void 0==_){const t=an(n.maxAngle,l,u,r[e],p);u=t[0],c=t[1]}else c=r[e];for(g=u;g<c;g+=p)this.coordinates.push(l[g],l[g+1]);d=this.coordinates.length,u=r[e],this.drawChars_(a,d,this.declutterGroup_),a=d}this.endGeometry(e,t)}else{const o=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),r=o.width/this.pixelRatio;switch(s){case ep.POINT:case ep.MULTI_POINT:l=e.getFlatCoordinates(),d=l.length;break;case ep.LINE_STRING:l=e.getFlatMidpoint();break;case ep.CIRCLE:l=e.getCenter();break;case ep.MULTI_LINE_STRING:l=e.getFlatMidpoints(),d=l.length;break;case ep.POLYGON:if(l=e.getFlatInteriorPoint(),!n.overflow&&l[2]/this.resolution<r)return;p=3;break;case ep.MULTI_POLYGON:const t=e.getFlatInteriorPoints();for(l=[],g=0,i=t.length;g<i;g+=3)(n.overflow||t[g+2]/this.resolution>=r)&&l.push(t[g],t[g+1]);if(d=l.length,0==d)return;break;default:}d=this.appendFlatCoordinates(l,0,d,p,!1,!1),(n.backgroundFill||n.backgroundStroke)&&(this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke),n.backgroundFill&&(this.updateFillStyle(this.state,this.createFill,e),this.hitDetectionInstructions.push(this.createFill(this.state,e))),n.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t),this.drawTextImage_(o,a,d),this.endGeometry(e,t)}},Ny.prototype.getImage=function(e,t,o,r){let n;const a=r+t+e+o+this.pixelRatio;if(!og.containsKey(a)){const s=r?this.strokeStates[r]||this.textStrokeState_:null,l=o?this.fillStates[o]||this.textFillState_:null,d=this.textStates[t]||this.textState_,p=this.pixelRatio,g=d.scale*p,_=Cy[d.textAlign||Qp],u=r&&s.lineWidth?s.lineWidth:0,c=e.split('\n'),y=c.length,m=[],h=sn(d.font,c,m),f=sg(d.font),E=Tt(rd((h+u)*g),rd((f*y+u)*g));n=E.canvas,og.set(a,n),1!=g&&E.scale(g,g),E.font=d.font,r&&(E.strokeStyle=s.strokeStyle,E.lineWidth=u,E.lineCap=s.lineCap,E.lineJoin=s.lineJoin,E.miterLimit=s.miterLimit,Op&&s.lineDash.length&&(E.setLineDash(s.lineDash),E.lineDashOffset=s.lineDashOffset)),o&&(E.fillStyle=l.fillStyle),E.textBaseline='middle',E.textAlign='center';const T=.5-_,S=_*n.width/g+T*u;let x;if(r)for(x=0;x<y;++x)E.strokeText(c[x],S+T*m[x],.5*(u+f)+x*f);if(o)for(x=0;x<y;++x)E.fillText(c[x],S+T*m[x],.5*(u+f)+x*f)}return og.get(a)},Ny.prototype.drawTextImage_=function(e,t,o){const r=this.textState_,i=this.textStrokeState_,n=this.pixelRatio,a=Cy[r.textAlign||Qp],s=Cy[r.textBaseline],l=i&&i.lineWidth?i.lineWidth:0,d=a*e.width/n+2*(.5-a)*l,p=s*e.height/n+2*(.5-s)*l;this.instructions.push([Ty.DRAW_IMAGE,t,o,e,(d-this.textOffsetX_)*n,(p-this.textOffsetY_)*n,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,!0,e.width,r.padding==eg?eg:r.padding.map(function(e){return e*n}),!!r.backgroundFill,!!r.backgroundStroke]),this.hitDetectionInstructions.push([Ty.DRAW_IMAGE,t,o,e,(d-this.textOffsetX_)*n,(p-this.textOffsetY_)*n,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/n,!0,e.width,r.padding,!!r.backgroundFill,!!r.backgroundStroke])},Ny.prototype.drawChars_=function(e,t,o){const r=this.textStrokeState_,i=this.textState_,n=this.textFillState_,a=this.strokeKey_;r&&!(a in this.strokeStates)&&(this.strokeStates[a]={strokeStyle:r.strokeStyle,lineCap:r.lineCap,lineDashOffset:r.lineDashOffset,lineWidth:r.lineWidth,lineJoin:r.lineJoin,miterLimit:r.miterLimit,lineDash:r.lineDash});const s=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:i.font,textAlign:i.textAlign||Qp,scale:i.scale});const l=this.fillKey_;n&&!(l in this.fillStates)&&(this.fillStates[l]={fillStyle:n.fillStyle});const d=this.pixelRatio,p=Cy[i.textBaseline],g=this.textOffsetY_*d,_=this.text_,u=i.font,c=i.scale,y=r?r.lineWidth*c/2:0;let m=this.widths_[u];m||(this.widths_[u]=m={}),this.instructions.push([Ty.DRAW_CHARS,e,t,p,o,i.overflow,l,i.maxAngle,function(e){let t=m[e];return t||(t=m[e]=vt(u,e)),t*c*d},g,a,y*d,_,s,1]),this.hitDetectionInstructions.push([Ty.DRAW_CHARS,e,t,p,o,i.overflow,l,i.maxAngle,function(e){let t=m[e];return t||(t=m[e]=vt(u,e)),t*c},g,a,y,_,s,1/d])},Ny.prototype.setTextStyle=function(e,t){let o,r,i;if(!e)this.text_='';else{this.declutterGroup_=t;const a=e.getFill();a?(r=this.textFillState_,!r&&(r=this.textFillState_={}),r.fillStyle=xt(a.getColor()||Xp)):r=this.textFillState_=null;const s=e.getStroke();if(!s)i=this.textStrokeState_=null;else{i=this.textStrokeState_,i||(i=this.textStrokeState_={});const e=s.getLineDash(),t=s.getLineDashOffset(),o=s.getWidth(),r=s.getMiterLimit();i.lineCap=s.getLineCap()||Wp,i.lineDash=e?e.slice():Kp,i.lineDashOffset=t===void 0?Hp:t,i.lineJoin=s.getLineJoin()||Zp,i.lineWidth=o===void 0?tg:o,i.miterLimit=r===void 0?qp:r,i.strokeStyle=xt(s.getColor()||Jp)}o=this.textState_;const l=e.getFont()||zp;ag(l);const d=e.getScale();o.overflow=e.getOverflow(),o.font=l,o.maxAngle=e.getMaxAngle(),o.placement=e.getPlacement(),o.textAlign=e.getTextAlign(),o.textBaseline=e.getTextBaseline()||$p,o.backgroundFill=e.getBackgroundFill(),o.backgroundStroke=e.getBackgroundStroke(),o.padding=e.getPadding()||eg,o.scale=d===void 0?1:d;const p=e.getOffsetX(),g=e.getOffsetY(),_=e.getRotateWithView(),u=e.getRotation();this.text_=e.getText()||'',this.textOffsetX_=p===void 0?0:p,this.textOffsetY_=g===void 0?0:g,this.textRotateWithView_=_!==void 0&&_,this.textRotation_=u===void 0?0:u,this.strokeKey_=i?('string'==typeof i.strokeStyle?i.strokeStyle:n(i.strokeStyle))+i.lineCap+i.lineDashOffset+'|'+i.lineWidth+i.lineJoin+i.miterLimit+'['+i.lineDash.join()+']':'',this.textKey_=o.font+o.scale+(o.textAlign||'?'),this.fillKey_=r?'string'==typeof r.fillStyle?r.fillStyle:'|'+n(r.fillStyle):''}};const Ay={Circle:wy,Default:Py,Image:vy,LineString:Fy,Polygon:wy,Text:Ny},by=function(e,t,o,r,i,n,a){cy.call(this),this.declutterTree_=n,this.declutterGroup_=null,this.tolerance_=e,this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=r,this.resolution_=o,this.renderBuffer_=a,this.replaysByZIndex_={},this.hitDetectionContext_=Tt(1,1),this.hitDetectionTransform_=tt()};i(by,cy);const My={0:[[!0]]};by.prototype.addDeclutter=function(e){let t=null;return this.declutterTree_&&(e?(t=this.declutterGroup_,t[4]++):(t=this.declutterGroup_=b(),t.push(1))),t},by.prototype.clip=function(e,t){const o=this.getClipCoords(t);e.beginPath(),e.moveTo(o[0],o[1]),e.lineTo(o[2],o[3]),e.lineTo(o[4],o[5]),e.lineTo(o[6],o[7]),e.clip()},by.prototype.hasReplays=function(e){for(const t in this.replaysByZIndex_){const o=this.replaysByZIndex_[t];for(let t=0,r=e.length;t<r;++t)if(e[t]in o)return!0}return!1},by.prototype.finish=function(){for(const e in this.replaysByZIndex_){const t=this.replaysByZIndex_[e];for(const e in t)t[e].finish()}},by.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,a,s){function l(e){const t=g.getImageData(0,0,d,d).data;for(let o=0;o<d;o++)for(let r=0;r<d;r++)if(u[o][r]&&0<t[4*(r*d+o)+3]){let t;return c&&(y==yy.IMAGE||y==yy.TEXT)&&-1===c.indexOf(e)||(t=a(e)),t?t:void g.clearRect(0,0,d,d)}}r=Vl(r);const d=2*r+1,p=pt(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-o,-e[0],-e[1]),g=this.hitDetectionContext_;g.canvas.width!==d||g.canvas.height!==d?(g.canvas.width=d,g.canvas.height=d):g.clearRect(0,0,d,d);let _;this.renderBuffer_!==void 0&&(_=b(),V(_,e),P(_,t*(this.renderBuffer_+r),_));const u=dn(r);let c;this.declutterTree_&&(c=this.declutterTree_.all().map(function(e){return e.value}));let y;const m=Object.keys(this.replaysByZIndex_).map(Number);m.sort(Dt);let h,i,f,x,E;for(h=m.length-1;0<=h;--h){const e=m[h].toString();for(f=this.replaysByZIndex_[e],i=Sy.length-1;0<=i;--i)if(y=Sy[i],x=f[y],void 0!==x)if(s&&(y==yy.IMAGE||y==yy.TEXT)){const t=s[e];t?t.push(x,p.slice(0)):s[e]=[x,p.slice(0)]}else if(E=x.replayHitDetection(g,p,o,n,l,_),E)return E}},by.prototype.getClipCoords=function(e){const t=this.maxExtent_,o=t[0],r=t[1],i=t[2],n=t[3],a=[o,r,o,n,i,n,i,r];return _e(a,0,8,2,e,a),a},by.prototype.getReplay=function(e,t){const o=e===void 0?'0':e.toString();let r=this.replaysByZIndex_[o];r===void 0&&(r={},this.replaysByZIndex_[o]=r);let i=r[t];if(i===void 0){const e=Ay[t];i=new e(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),r[t]=i}return i},by.prototype.getReplays=function(){return this.replaysByZIndex_},by.prototype.isEmpty=function(){return l(this.replaysByZIndex_)},by.prototype.replay=function(e,t,o,r,n,a){const s=Object.keys(this.replaysByZIndex_).map(Number);s.sort(Dt),e.save(),this.clip(e,t);const l=n?n:Sy;let d,i,p,g,_,u;for(d=0,i=s.length;d<i;++d){const i=s[d].toString();for(_=this.replaysByZIndex_[i],p=0,g=l.length;p<g;++p){const n=l[p];if(u=_[n],void 0!==u)if(a&&(n==yy.IMAGE||n==yy.TEXT)){const e=a[i];e?e.push(u,t.slice(0)):a[i]=[u,t.slice(0)]}else u.replay(e,t,o,r)}}e.restore()};var Gy=by;const Dy=.5,ky={Point:function(e,t,o,r){const i=o.getImage();if(i){if(i.getImageState()!=Gp.LOADED)return;const n=e.getReplay(o.getZIndex(),yy.IMAGE);n.setImageStyle(i,e.addDeclutter(!1)),n.drawPoint(t,r)}const n=o.getText();if(n){const a=e.getReplay(o.getZIndex(),yy.TEXT);a.setTextStyle(n,e.addDeclutter(!!i)),a.drawText(t,r)}},LineString:function(e,t,o,r){const i=o.getStroke();if(i){const n=e.getReplay(o.getZIndex(),yy.LINE_STRING);n.setFillStrokeStyle(null,i),n.drawLineString(t,r)}const n=o.getText();if(n){const i=e.getReplay(o.getZIndex(),yy.TEXT);i.setTextStyle(n,e.addDeclutter(!1)),i.drawText(t,r)}},Polygon:function(e,t,o,r){const i=o.getFill(),n=o.getStroke();if(i||n){const a=e.getReplay(o.getZIndex(),yy.POLYGON);a.setFillStrokeStyle(i,n),a.drawPolygon(t,r)}const a=o.getText();if(a){const i=e.getReplay(o.getZIndex(),yy.TEXT);i.setTextStyle(a,e.addDeclutter(!1)),i.drawText(t,r)}},MultiPoint:function(e,t,o,r){const i=o.getImage();if(i){if(i.getImageState()!=Gp.LOADED)return;const n=e.getReplay(o.getZIndex(),yy.IMAGE);n.setImageStyle(i,e.addDeclutter(!1)),n.drawMultiPoint(t,r)}const n=o.getText();if(n){const a=e.getReplay(o.getZIndex(),yy.TEXT);a.setTextStyle(n,e.addDeclutter(!!i)),a.drawText(t,r)}},MultiLineString:function(e,t,o,r){const i=o.getStroke();if(i){const n=e.getReplay(o.getZIndex(),yy.LINE_STRING);n.setFillStrokeStyle(null,i),n.drawMultiLineString(t,r)}const n=o.getText();if(n){const i=e.getReplay(o.getZIndex(),yy.TEXT);i.setTextStyle(n,e.addDeclutter(!1)),i.drawText(t,r)}},MultiPolygon:function(e,t,o,r){const i=o.getFill(),n=o.getStroke();if(n||i){const a=e.getReplay(o.getZIndex(),yy.POLYGON);a.setFillStrokeStyle(i,n),a.drawMultiPolygon(t,r)}const a=o.getText();if(a){const i=e.getReplay(o.getZIndex(),yy.TEXT);i.setTextStyle(a,e.addDeclutter(!1)),i.drawText(t,r)}},GeometryCollection:function(e,t,o,r){const n=t.getGeometriesArray();let a,i;for(a=0,i=n.length;a<i;++a){const t=ky[n[a].getType()];t(e,n[a],o,r)}},Circle:function(e,t,o,r){const i=o.getFill(),n=o.getStroke();if(i||n){const a=e.getReplay(o.getZIndex(),yy.CIRCLE);a.setFillStrokeStyle(i,n),a.drawCircle(t,r)}const a=o.getText();if(a){const i=e.getReplay(o.getZIndex(),yy.TEXT);i.setTextStyle(a,e.addDeclutter(!1)),i.drawText(t,r)}}},Uy=function(e){Qc.call(this,e),this.declutterTree_=e.getDeclutter()?yc()(9,void 0):null,this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=b(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.context=Tt(),c(og,Yd.CLEAR,this.handleFontsChanged_,this)};i(Uy,Qc),Uy.handles=function(e){return e.getType()===nc.VECTOR},Uy.create=function(e,t){return new Uy(t)},Uy.prototype.disposeInternal=function(){m(og,Yd.CLEAR,this.handleFontsChanged_,this),Qc.prototype.disposeInternal.call(this)},Uy.prototype.composeFrame=function(e,t,o){const r=e.extent,i=e.pixelRatio,n=t.managed?e.skippedFeatureUids:{},a=e.viewState,s=a.projection,l=a.rotation,d=s.getExtent(),p=this.getLayer().getSource();let g=this.getTransform(e,0);this.preCompose(o,e,g);const _=t.extent,u=_!==void 0;u&&this.clip(o,e,_);const c=this.replayGroup_;if(c&&!c.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();const a=this.getLayer();let _=0,u=0,y;const m=1!==t.opacity,h=a.hasListener(Dg.RENDER);if(m||h){let e=o.canvas.width,t=o.canvas.height;if(l){const o=Vl(ed(e*e+t*t));_=(o-e)/2,u=(o-t)/2,e=t=o}this.context.canvas.width=e,this.context.canvas.height=t,y=this.context}else y=o;const f=y.globalAlpha;m||(y.globalAlpha=t.opacity),y!=o&&y.translate(_,u);const x=e.size[0]*i,E=e.size[1]*i;if(Ft(y,-l,x/2,E/2),c.replay(y,g,l,n),p.getWrapX()&&s.canWrapX()&&!w(d,r)){let t=r[0];const o=ne(d);let i=0,a;for(;t<d[0];)--i,a=o*i,g=this.getTransform(e,a),c.replay(y,g,l,n),t+=o;for(i=0,t=r[2];t>d[2];)++i,a=o*i,g=this.getTransform(e,a),c.replay(y,g,l,n),t-=o;g=this.getTransform(e,0)}if(Ft(y,l,x/2,E/2),y!=o){if(h&&this.dispatchRenderEvent(y,e,g),m){const e=o.globalAlpha;o.globalAlpha=t.opacity,o.drawImage(y.canvas,-_,-u),o.globalAlpha=e}else o.drawImage(y.canvas,-_,-u);y.translate(-_,-u)}m||(y.globalAlpha=f)}u&&o.restore(),this.postCompose(o,e,t,g)},Uy.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){if(!this.replayGroup_)return;else{const a=t.viewState.resolution,s=t.viewState.rotation,l=this.getLayer(),d={},p=this.replayGroup_.forEachFeatureAtCoordinate(e,a,s,o,{},function(e){const t=n(e).toString();if(!(t in d))return d[t]=!0,r.call(i,e,l)},null);return p}},Uy.prototype.handleFontsChanged_=function(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},Uy.prototype.handleStyleImageChange_=function(){this.renderIfReadyAndVisible()},Uy.prototype.prepareFrame=function(e){const t=this.getLayer(),o=t.getSource(),r=e.viewHints[M_.ANIMATING],i=e.viewHints[M_.INTERACTING],n=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(!this.dirty_&&!n&&r||!a&&i)return!0;const s=e.extent,l=e.viewState,d=l.projection,p=l.resolution,g=e.pixelRatio,_=t.getRevision(),u=t.getRenderBuffer();let c=t.getRenderOrder();void 0===c&&(c=gn);const y=P(s,u*p),m=l.projection.getExtent();if(o.getWrapX()&&l.projection.canWrapX()&&!w(m,e.extent)){const e=ne(m),t=id(ne(y)/2,e);y[0]=m[0]-t,y[2]=m[2]+t}if(!this.dirty_&&this.renderedResolution_==p&&this.renderedRevision_==_&&this.renderedRenderOrder_==c&&w(this.renderedExtent_,y))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;const h=new Gy(un(p,g),y,p,g,o.getOverlaps(),this.declutterTree_,t.getRenderBuffer());o.loadFeatures(y,p,d);const f=function(e){let o;const r=e.getStyleFunction()||t.getStyleFunction();if(r&&(o=r(e,p)),o){const t=this.renderFeature(e,p,g,o,h);this.dirty_=this.dirty_||t}}.bind(this);if(c){const e=[];o.forEachFeatureInExtent(y,function(t){e.push(t)},this),e.sort(c);for(let t=0,o=e.length;t<o;++t)f(e[t])}else o.forEachFeatureInExtent(y,f,this);return h.finish(),this.renderedResolution_=p,this.renderedRevision_=_,this.renderedRenderOrder_=c,this.renderedExtent_=y,this.replayGroup_=h,this.replayGroupChanged=!0,!0},Uy.prototype.renderFeature=function(e,t,o,r,n){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let s=0,i=r.length;s<i;++s)a=cn(n,e,r[s],_n(t,o),this.handleStyleImageChange_,this)||a;else a=cn(n,e,r,_n(t,o),this.handleStyleImageChange_,this);return a};var Yy=Uy,jy={IMAGE:'image',HYBRID:'hybrid',VECTOR:'vector'};const By={image:[yy.POLYGON,yy.CIRCLE,yy.LINE_STRING,yy.IMAGE,yy.TEXT],hybrid:[yy.POLYGON,yy.LINE_STRING]},Vy={image:[yy.DEFAULT],hybrid:[yy.IMAGE,yy.TEXT,yy.DEFAULT],vector:Sy},zy=function(e){this.context=null,_y.call(this,e),this.declutterTree_=e.getDeclutter()?yc()(9,void 0):null,this.dirty_=!1,this.renderedLayerRevision_,this.tmpTransform_=tt(),this.zDirection=e.getRenderMode()==jy.VECTOR?1:0,c(og,Yd.CLEAR,this.handleFontsChanged_,this)};i(zy,_y),zy.handles=function(e){return e.getType()===nc.VECTOR_TILE},zy.create=function(e,t){return new zy(t)},zy.prototype.disposeInternal=function(){m(og,Yd.CLEAR,this.handleFontsChanged_,this),_y.prototype.disposeInternal.call(this)},zy.prototype.prepareFrame=function(){const e=this.getLayer(),t=e.getRevision();if(this.renderedLayerRevision_!=t){this.renderedTiles.length=0;const t=e.getRenderMode();this.context||t==jy.VECTOR||(this.context=Tt()),this.context&&t==jy.VECTOR&&(this.context=null)}return this.renderedLayerRevision_=t,_y.prototype.prepareFrame.apply(this,arguments)},zy.prototype.createReplayGroup_=function(e,t){const o=this.getLayer(),r=t.pixelRatio,n=t.viewState.projection,i=o.getRevision(),a=o.getRenderOrder()||null,s=e.getReplayState(o);if(!s.dirty&&s.renderedRevision==i&&s.renderedRenderOrder==a)return;const l=o.getSource(),d=l.getTileGrid(),p=l.getTileGridForProjection(n),g=p.getResolution(e.tileCoord[0]),_=p.getTileCoordExtent(e.wrappedTileCoord),u={};for(let i=0,p=e.tileKeys.length;i<p;++i){const t=e.getTile(e.tileKeys[i]);if(t.getState()!=Hg.LOADED)continue;const p=t.tileCoord,c=d.getTileCoordExtent(p),y=oe(_,c),m=j(c,y)?null:P(y,o.getRenderBuffer()*g,this.tmpExtent),h=t.getProjection();let f=!1;qe(n,h)||(f=!0,t.setProjection(n)),s.dirty=!1;const x=new Gy(0,y,g,r,l.getOverlaps(),this.declutterTree_,o.getRenderBuffer()),E=_n(g,r),T=function(e){let t;const r=e.getStyleFunction()||o.getStyleFunction();if(r&&(t=r(e,g)),t){const o=this.renderFeature(e,E,t,x);this.dirty_=this.dirty_||o,s.dirty=s.dirty||o}},S=t.getFeatures();a&&a!==s.renderedRenderOrder&&S.sort(a);for(let e=0,o=S.length;e<o;++e){const o=S[e];f&&(h.getUnits()==ip.TILE_PIXELS&&(h.setWorldExtent(c),h.setExtent(t.getExtent())),o.getGeometry().transform(h,n)),(!m||ae(m,o.getGeometry().getExtent()))&&T.call(this,o)}for(const e in x.finish(),x.getReplays())u[e]=!0;t.setReplayGroup(o,e.tileCoord.toString(),x)}s.renderedRevision=i,s.renderedRenderOrder=a},zy.prototype.drawTileImage=function(e,t,o){const r=e;this.createReplayGroup_(r,t),this.context&&(this.renderTileImage_(r,t,o),_y.prototype.drawTileImage.apply(this,arguments))},zy.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,a){const s=t.viewState.resolution,l=t.viewState.rotation;o=o==void 0?0:o;const d=this.getLayer(),p={},g=this.renderedTiles,_=d.getSource(),u=_.getTileGridForProjection(t.viewState.projection);let c,y,m,i,h,f,x,E;for(m=0,i=g.length;m<i;++m)if(f=g[m],x=f.wrappedTileCoord,E=u.getTileCoordExtent(x,this.tmpExtent),c=P(E,o*s,c),!!O(c,e))for(let i=0,t=f.tileKeys.length;i<t;++i){const t=f.getTile(f.tileKeys[i]);t.getState()==Hg.LOADED&&(h=t.getReplayGroup(d,f.tileCoord.toString()),y=y||h.forEachFeatureAtCoordinate(e,s,l,o,{},function(e){const t=n(e).toString();if(!(t in p))return p[t]=!0,r.call(a,e,d)},null))}return y},zy.prototype.getReplayTransform_=function(e,t){const o=this.getLayer(),r=o.getSource(),i=r.getTileGrid(),n=e.tileCoord,a=i.getResolution(n[0]),s=t.viewState,l=t.pixelRatio,d=s.resolution/l,p=i.getTileCoordExtent(n,this.tmpExtent),g=s.center,_=re(p),u=t.size,c=Vl(l*u[0]/2),y=Vl(l*u[1]/2);return pt(this.tmpTransform_,c,y,a/d,a/d,s.rotation,(_[0]-g[0])/a,(g[1]-_[1])/a)},zy.prototype.handleFontsChanged_=function(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()},zy.prototype.handleStyleImageChange_=function(){this.renderIfReadyAndVisible()},zy.prototype.postCompose=function(e,o,r){const i=this.getLayer(),n=i.getDeclutter()?{}:null,t=i.getSource(),a=i.getRenderMode(),s=Vy[a],l=o.pixelRatio,d=o.viewState.rotation,p=o.size;let g,_;d&&(g=Vl(l*p[0]/2),_=Vl(l*p[1]/2),Ft(e,-d,g,_)),n&&this.declutterTree_.clear();const u=this.renderedTiles,c=t.getTileGridForProjection(o.viewState.projection),y=[],m=[];for(let t=u.length-1;0<=t;--t){const l=u[t];if(l.getState()==Hg.ABORT)continue;const p=l.tileCoord,g=c.getTileCoordExtent(p,this.tmpExtent)[0]-c.getTileCoordExtent(l.wrappedTileCoord,this.tmpExtent)[0];let _;for(let u=0,t=l.tileKeys.length;u<t;++u){const t=l.getTile(l.tileKeys[u]);if(t.getState()!=Hg.LOADED)continue;const c=t.getReplayGroup(i,p.toString());if(a!=jy.VECTOR&&!c.hasReplays(s))continue;_||(_=this.getTransform(o,g));const h=t.tileCoord[0],f=c.getClipCoords(_);e.save(),e.globalAlpha=r.opacity;for(let t=0,o=y.length;t<o;++t){const o=y[t];h<m[t]&&(e.beginPath(),e.moveTo(f[0],f[1]),e.lineTo(f[2],f[3]),e.lineTo(f[4],f[5]),e.lineTo(f[6],f[7]),e.moveTo(o[6],o[7]),e.lineTo(o[4],o[5]),e.lineTo(o[2],o[3]),e.lineTo(o[0],o[1]),e.clip())}c.replay(e,_,d,{},s,n),e.restore(),y.push(f),m.push(h)}}n&&pn(n,e,d),d&&Ft(e,d,g,_),_y.prototype.postCompose.apply(this,arguments)},zy.prototype.renderFeature=function(e,t,o,r){if(!o)return!1;let n=!1;if(Array.isArray(o))for(let a=0,i=o.length;a<i;++a)n=cn(r,e,o[a],t,this.handleStyleImageChange_,this)||n;else n=cn(r,e,o,t,this.handleStyleImageChange_,this);return n},zy.prototype.renderTileImage_=function(e,t){const o=this.getLayer(),r=e.getReplayState(o),i=o.getRevision(),n=By[o.getRenderMode()];if(n&&r.renderedTileRevision!==i){r.renderedTileRevision=i;const a=e.wrappedTileCoord,s=a[0],l=t.pixelRatio,d=o.getSource(),p=d.getTileGridForProjection(t.viewState.projection),g=p.getResolution(s),_=e.getContext(o),u=d.getTilePixelSize(s,l,t.viewState.projection);_.canvas.width=u[0],_.canvas.height=u[1];const c=p.getTileCoordExtent(a,this.tmpExtent);for(let t=0,r=e.tileKeys.length;t<r;++t){const r=e.getTile(e.tileKeys[t]);if(r.getState()!=Hg.LOADED)continue;const i=l/g,a=ot(this.tmpTransform_);lt(a,i,-i),dt(a,-c[0],-c[3]);const s=r.getReplayGroup(o,e.tileCoord.toString());s.replay(_,a,0,{},n)}}};var Xy=zy;const Wy=function(e){e=Ad({},e),e.controls||(e.controls=Dr()),e.interactions||(e.interactions=$i()),H_.call(this,e)};i(Wy,H_),Wy.prototype.createRenderer=function(){const e=new ly(this);return e.registerLayerRenderers([oy,_y,Yy,Xy]),e};var Ky=Wy,Hy={BOTTOM_LEFT:'bottom-left',BOTTOM_CENTER:'bottom-center',BOTTOM_RIGHT:'bottom-right',CENTER_LEFT:'center-left',CENTER_CENTER:'center-center',CENTER_RIGHT:'center-right',TOP_LEFT:'top-left',TOP_CENTER:'top-center',TOP_RIGHT:'top-right'};const Zy={ELEMENT:'element',MAP:'map',OFFSET:'offset',POSITION:'position',POSITIONING:'positioning'},qy=function(e){Wd.call(this),this.options=e,this.id=e.id,this.insertFirst=!(e.insertFirst!==void 0)||e.insertFirst,this.stopEvent=!(e.stopEvent!==void 0)||e.stopEvent,this.element=document.createElement('DIV'),this.element.className=e.className===void 0?'ol-overlay-container '+'ol-selectable':e.className,this.element.style.position='absolute',this.autoPan=e.autoPan!==void 0&&e.autoPan,this.autoPanAnimation=e.autoPanAnimation||{},this.autoPanMargin=e.autoPanMargin===void 0?20:e.autoPanMargin,this.rendered={bottom_:'',left_:'',right_:'',top_:'',visible:!0},this.mapPostrenderListenerKey=null,c(this,C(Zy.ELEMENT),this.handleElementChanged,this),c(this,C(Zy.MAP),this.handleMapChanged,this),c(this,C(Zy.OFFSET),this.handleOffsetChanged,this),c(this,C(Zy.POSITION),this.handlePositionChanged,this),c(this,C(Zy.POSITIONING),this.handlePositioningChanged,this),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset===void 0?[0,0]:e.offset),this.setPositioning(e.positioning===void 0?Hy.TOP_LEFT:e.positioning),e.position!==void 0&&this.setPosition(e.position)};i(qy,Wd),qy.prototype.getElement=function(){return this.get(Zy.ELEMENT)},qy.prototype.getId=function(){return this.id},qy.prototype.getMap=function(){return this.get(Zy.MAP)},qy.prototype.getOffset=function(){return this.get(Zy.OFFSET)},qy.prototype.getPosition=function(){return this.get(Zy.POSITION)},qy.prototype.getPositioning=function(){return this.get(Zy.POSITIONING)},qy.prototype.handleElementChanged=function(){Lt(this.element);const e=this.getElement();e&&this.element.appendChild(e)},qy.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(It(this.element),h(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=c(e,L_.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}},qy.prototype.render=function(){this.updatePixelPosition()},qy.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},qy.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.get(Zy.POSITION)&&this.autoPan&&this.panIntoView()},qy.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},qy.prototype.setElement=function(e){this.set(Zy.ELEMENT,e)},qy.prototype.setMap=function(e){this.set(Zy.MAP,e)},qy.prototype.setOffset=function(e){this.set(Zy.OFFSET,e)},qy.prototype.setPosition=function(e){this.set(Zy.POSITION,e)},qy.prototype.panIntoView=function(){const e=this.getMap();if(e&&e.getTargetElement()){const t=this.getRect(e.getTargetElement(),e.getSize()),o=this.getElement(),r=this.getRect(o,[St(o),Ct(o)]),i=this.autoPanMargin;if(!w(t,r)){const o=r[0]-t[0],n=t[2]-r[2],a=r[1]-t[1],s=t[3]-r[3],l=[0,0];if(0>o?l[0]=o-i:0>n&&(l[0]=Hl(n)+i),0>a?l[1]=a-i:0>s&&(l[1]=Hl(s)+i),0!==l[0]||0!==l[1]){const t=e.getView().getCenter(),o=e.getPixelFromCoordinate(t),r=[o[0]+l[0],o[1]+l[1]];e.getView().animate({center:e.getCoordinateFromPixel(r),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}},qy.prototype.getRect=function(e,t){const o=e.getBoundingClientRect(),r=o.left+window.pageXOffset,i=o.top+window.pageYOffset;return[r,i,r+t[0],i+t[1]]},qy.prototype.setPositioning=function(e){this.set(Zy.POSITIONING,e)},qy.prototype.setVisible=function(e){this.rendered.visible!==e&&(this.element.style.display=e?'':'none',this.rendered.visible=e)},qy.prototype.updatePixelPosition=function(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const o=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(o,r)},qy.prototype.updateRenderedPosition=function(e,t){const o=this.element.style,r=this.getOffset(),i=this.getPositioning();this.setVisible(!0);let n=r[0],a=r[1];if(i==Hy.BOTTOM_RIGHT||i==Hy.CENTER_RIGHT||i==Hy.TOP_RIGHT){''!==this.rendered.left_&&(this.rendered.left_=o.left='');const r=Vl(t[0]-e[0]-n)+'px';this.rendered.right_!=r&&(this.rendered.right_=o.right=r)}else{''!==this.rendered.right_&&(this.rendered.right_=o.right=''),(i==Hy.BOTTOM_CENTER||i==Hy.CENTER_CENTER||i==Hy.TOP_CENTER)&&(n-=this.element.offsetWidth/2);const t=Vl(e[0]+n)+'px';this.rendered.left_!=t&&(this.rendered.left_=o.left=t)}if(i==Hy.BOTTOM_LEFT||i==Hy.BOTTOM_CENTER||i==Hy.BOTTOM_RIGHT){''!==this.rendered.top_&&(this.rendered.top_=o.top='');const r=Vl(t[1]-e[1]-a)+'px';this.rendered.bottom_!=r&&(this.rendered.bottom_=o.bottom=r)}else{''!==this.rendered.bottom_&&(this.rendered.bottom_=o.bottom=''),(i==Hy.CENTER_LEFT||i==Hy.CENTER_CENTER||i==Hy.CENTER_RIGHT)&&(a-=this.element.offsetHeight/2);const t=Vl(e[1]+a)+'px';this.rendered.top_!=t&&(this.rendered.top_=o.top=t)}},qy.prototype.getOptions=function(){return this.options};var Jy=qy;const Qy=function(e,t,o,r,i,n){qg.call(this,e,t,n),this.consumers=0,this.extent_=null,this.format_=r,this.features_=null,this.loader_,this.projection_,this.replayGroups_={},this.tileLoadFunction_=i,this.url_=o};i(Qy,qg);const $y=[0,0,4096,4096];Qy.prototype.disposeInternal=function(){this.features_=null,this.replayGroups_={},this.state=Hg.ABORT,this.changed(),qg.prototype.disposeInternal.call(this)},Qy.prototype.getExtent=function(){return this.extent_||$y},Qy.prototype.getFormat=function(){return this.format_},Qy.prototype.getFeatures=function(){return this.features_},Qy.prototype.getKey=function(){return this.url_},Qy.prototype.getProjection=function(){return this.projection_},Qy.prototype.getReplayGroup=function(e,t){return this.replayGroups_[n(e)+','+t]},Qy.prototype.load=function(){this.state==Hg.IDLE&&(this.setState(Hg.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_(null,NaN,null))},Qy.prototype.onLoad=function(e,t,o){this.setProjection(t),this.setFeatures(e),this.setExtent(o)},Qy.prototype.onError=function(){this.setState(Hg.ERROR)},Qy.prototype.setExtent=function(e){this.extent_=e},Qy.prototype.setFeatures=function(e){this.features_=e,this.setState(Hg.LOADED)},Qy.prototype.setProjection=function(e){this.projection_=e},Qy.prototype.setReplayGroup=function(e,t,o){this.replayGroups_[n(e)+','+t]=o},Qy.prototype.setLoader=function(e){this.loader_=e};const em=function(){let e;return function(){if(!e){const t=document.body;t.webkitRequestFullscreen?e='webkitfullscreenchange':t.mozRequestFullScreen?e='mozfullscreenchange':t.msRequestFullscreen?e='MSFullscreenChange':t.requestFullscreen&&(e='fullscreenchange')}return e}}(),tm=function(e){const t=e?e:{};this.cssClassName_=t.className===void 0?'ol-full-screen':t.className;const o=t.label===void 0?'\u2922':t.label;this.labelNode_='string'==typeof o?document.createTextNode(o):o;const r=t.labelActive===void 0?'\xD7':t.labelActive;this.labelActiveNode_='string'==typeof r?document.createTextNode(r):r;const i=t.tipLabel?t.tipLabel:'Toggle full-screen',n=document.createElement('button');n.className=this.cssClassName_+'-'+fn(),n.setAttribute('type','button'),n.title=i,n.appendChild(this.labelNode_),c(n,Yd.CLICK,this.handleClick_,this);const a=this.cssClassName_+' '+kp+' '+Up+' '+(hn()?'':'ol-unsupported'),s=document.createElement('div');s.className=a,s.appendChild(n),q_.call(this,{element:s,target:t.target}),this.keys_=t.keys!==void 0&&t.keys,this.source_=t.source};i(tm,q_),tm.prototype.handleClick_=function(e){e.preventDefault(),this.handleFullScreen_()},tm.prototype.handleFullScreen_=function(){if(hn()){const e=this.getMap();if(e)if(fn())Tn();else{let t;t=this.source_?'string'==typeof this.source_?document.getElementById(this.source_):this.source_:e.getTargetElement(),this.keys_?En(t):xn(t)}}},tm.prototype.handleFullScreenChange_=function(){const e=this.element.firstElementChild,t=this.getMap();fn()?(e.className=this.cssClassName_+'-true',Rt(this.labelActiveNode_,this.labelNode_)):(e.className=this.cssClassName_+'-false',Rt(this.labelNode_,this.labelActiveNode_)),t&&t.updateSize()},tm.prototype.setMap=function(e){q_.prototype.setMap.call(this,e),e&&this.listenerKeys.push(c(document,em(),this.handleFullScreenChange_,this))};const om=.75,rm=.1,im=function(e){const t=e?e:{};this.collapsed_=!(t.collapsed!==void 0)||t.collapsed,this.collapsible_=!(t.collapsible!==void 0)||t.collapsible,this.collapsible_||(this.collapsed_=!1);const o=t.className===void 0?'ol-overviewmap':t.className,r=t.tipLabel===void 0?'Overview map':t.tipLabel,i=t.collapseLabel===void 0?'\xAB':t.collapseLabel;'string'==typeof i?(this.collapseLabel_=document.createElement('span'),this.collapseLabel_.textContent=i):this.collapseLabel_=i;const n=t.label===void 0?'\xBB':t.label;'string'==typeof n?(this.label_=document.createElement('span'),this.label_.textContent=n):this.label_=n;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,s=document.createElement('button');s.setAttribute('type','button'),s.title=r,s.appendChild(a),c(s,Yd.CLICK,this.handleClick_,this),this.ovmapDiv_=document.createElement('DIV'),this.ovmapDiv_.className='ol-overviewmap-map',this.ovmap_=new Ky({controls:new qd,interactions:new qd,view:t.view});const l=this.ovmap_;t.layers&&t.layers.forEach(function(e){l.addLayer(e)}.bind(this));const d=document.createElement('DIV');d.className='ol-overviewmap-box',d.style.boxSizing='border-box',this.boxOverlay_=new Jy({position:[0,0],positioning:Hy.BOTTOM_LEFT,element:d}),this.ovmap_.addOverlay(this.boxOverlay_);const p=o+' '+kp+' '+Up+(this.collapsed_&&this.collapsible_?' '+Yp:'')+(this.collapsible_?'':' ol-uncollapsible'),g=document.createElement('div');g.className=p,g.appendChild(this.ovmapDiv_),g.appendChild(s),q_.call(this,{element:g,render:t.render||Sn,target:t.target});const _=this,u=this.boxOverlay_,y=this.boxOverlay_.getElement(),m=function(e){return{clientX:e.clientX-y.offsetWidth/2,clientY:e.clientY+y.offsetHeight/2}},h=function(e){const t=l.getEventCoordinate(m(e));u.setPosition(t)},f=function(e){const t=l.getEventCoordinate(e);_.getMap().getView().setCenter(t),window.removeEventListener('mousemove',h),window.removeEventListener('mouseup',f)};y.addEventListener('mousedown',function(){window.addEventListener('mousemove',h),window.addEventListener('mouseup',f)})};i(im,q_),im.prototype.setMap=function(e){const t=this.getMap();if(e!==t){if(t){const e=t.getView();e&&this.unbindView_(e),this.ovmap_.setTarget(null)}if(q_.prototype.setMap.call(this,e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(c(e,Nd.PROPERTYCHANGE,this.handleMapPropertyChange_,this)),0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(e.getLayerGroup());const t=e.getView();t&&(this.bindView_(t),t.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))}}},im.prototype.handleMapPropertyChange_=function(e){if(e.key===P_.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const o=this.getMap().getView();this.bindView_(o)}},im.prototype.bindView_=function(e){c(e,C(G_.ROTATION),this.handleRotationChanged_,this)},im.prototype.unbindView_=function(e){m(e,C(G_.ROTATION),this.handleRotationChanged_,this)},im.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},im.prototype.validateExtent_=function(){const e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){const o=e.getSize(),r=e.getView(),i=r.calculateExtent(o),n=t.getSize(),a=t.getView(),s=a.calculateExtent(n),l=t.getPixelFromCoordinate(re(i)),d=t.getPixelFromCoordinate(J(i)),p=Hl(l[0]-d[0]),g=Hl(l[1]-d[1]),_=n[0],u=n[1];p<_*rm||g<u*rm||p>_*om||g>u*om?this.resetExtent_():!w(s,i)&&this.recenter_()}},im.prototype.resetExtent_=function(){const e=this.getMap(),t=this.ovmap_,o=e.getSize(),r=e.getView(),i=r.calculateExtent(o),n=t.getView(),a=1/(td(2,2.0149030205422647/Zl/2)*rm);de(i,a),n.fit(i)},im.prototype.recenter_=function(){const e=this.getMap(),t=this.ovmap_,o=e.getView(),r=t.getView();r.setCenter(o.getCenter())},im.prototype.updateBox_=function(){const e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){const o=e.getSize(),r=e.getView(),i=t.getView(),n=r.getRotation(),a=this.boxOverlay_,s=this.boxOverlay_.getElement(),l=r.calculateExtent(o),d=i.getResolution(),p=q(l),g=ie(l),_=this.calculateCoordinateRotate_(n,p);a.setPosition(_),s&&(s.style.width=Hl((p[0]-g[0])/d)+'px',s.style.height=Hl((g[1]-p[1])/d)+'px')}},im.prototype.calculateCoordinateRotate_=function(e,t){let o;const r=this.getMap(),i=r.getView(),n=i.getCenter();return n&&(o=[t[0]-n[0],t[1]-n[1]],Jo(o,e),Xo(o,n)),o},im.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},im.prototype.handleToggle_=function(){this.element.classList.toggle(Yp),this.collapsed_?Rt(this.collapseLabel_,this.label_):Rt(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;this.collapsed_||e.isRendered()||(e.updateSize(),this.resetExtent_(),y(e,L_.POSTRENDER,function(){this.updateBox_()},this))},im.prototype.getCollapsible=function(){return this.collapsible_},im.prototype.setCollapsible=function(e){this.collapsible_===e||(this.collapsible_=e,this.element.classList.toggle('ol-uncollapsible'),!e&&this.collapsed_&&this.handleToggle_())},im.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},im.prototype.getCollapsed=function(){return this.collapsed_},im.prototype.getOverviewMap=function(){return this.ovmap_};const nm='units',am={DEGREES:'degrees',IMPERIAL:'imperial',NAUTICAL:'nautical',METRIC:'metric',US:'us'},sm=[1,2,5],lm=function(e){const t=e?e:{},o=t.className===void 0?'ol-scale-line':t.className;this.innerElement_=document.createElement('DIV'),this.innerElement_.className=o+'-inner',this.element_=document.createElement('DIV'),this.element_.className=o+' '+kp,this.element_.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth===void 0?64:t.minWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_='',q_.call(this,{element:this.element_,render:t.render||Cn,target:t.target}),c(this,C(nm),this.handleUnitsChanged_,this),this.setUnits(t.units||am.METRIC)};i(lm,q_),lm.prototype.getUnits=function(){return this.get(nm)},lm.prototype.handleUnitsChanged_=function(){this.updateElement_()},lm.prototype.setUnits=function(e){this.set(nm,e)},lm.prototype.updateElement_=function(){const e=this.viewState_;if(!e)return void(this.renderedVisible_&&(this.element_.style.display='none',this.renderedVisible_=!1));const t=e.center,o=e.projection,r=this.getUnits(),n=r==am.DEGREES?ip.DEGREES:ip.METERS;let a=ze(o,e.resolution,t,n);o.getUnits()!=ip.DEGREES&&o.getMetersPerUnit()&&n==ip.METERS&&(a*=o.getMetersPerUnit());let s=this.minWidth_*a,l='';if(r==am.DEGREES){const e=rp[ip.DEGREES];o.getUnits()==ip.DEGREES?s*=e:a/=e,s<e/60?(l='\u2033',a*=3600):s<e?(l='\u2032',a*=60):l='\xB0'}else r==am.IMPERIAL?.9144>s?(l='in',a/=.0254):1609.344>s?(l='ft',a/=.3048):(l='mi',a/=1609.344):r==am.NAUTICAL?(a/=1852,l='nm'):r==am.METRIC?.001>s?(l='\u03BCm',a*=1e6):1>s?(l='mm',a*=1e3):1e3>s?l='m':(l='km',a/=1e3):r==am.US?.9144>s?(l='in',a*=39.37):1609.344>s?(l='ft',a/=.30480061):(l='mi',a/=1609.3472):R(!1,33);let d=3*Bl(od(this.minWidth_*a)/2.302585092994046),i,p;for(;;){if(i=sm[(d%3+3)%3]*td(10,Bl(d/3)),p=Vl(i/a),isNaN(p))return this.element_.style.display='none',void(this.renderedVisible_=!1);if(p>=this.minWidth_)break;++d}const g=i+' '+l;this.renderedHTML_!=g&&(this.innerElement_.innerHTML=g,this.renderedHTML_=g),this.renderedWidth_!=p&&(this.innerElement_.style.width=p+'px',this.renderedWidth_=p),this.renderedVisible_||(this.element_.style.display='',this.renderedVisible_=!0)};const dm={VERTICAL:0,HORIZONTAL:1},pm=function(e){const t=e?e:{};this.currentResolution_=void 0,this.direction_=dm.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.previousX_,this.previousY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=t.duration===void 0?200:t.duration;const o=t.className===void 0?'ol-zoomslider':t.className,r=document.createElement('button');r.setAttribute('type','button'),r.className=o+'-thumb '+kp;const i=document.createElement('div');i.className=o+' '+kp+' '+Up,i.appendChild(r),this.dragger_=new R_(i),c(this.dragger_,l_.POINTERDOWN,this.handleDraggerStart_,this),c(this.dragger_,l_.POINTERMOVE,this.handleDraggerDrag_,this),c(this.dragger_,l_.POINTERUP,this.handleDraggerEnd_,this),c(i,Yd.CLICK,this.handleContainerClick_,this),c(r,Yd.CLICK,S),q_.call(this,{element:i,render:t.render||Rn})};i(pm,q_),pm.prototype.disposeInternal=function(){this.dragger_.dispose(),q_.prototype.disposeInternal.call(this)},pm.prototype.setMap=function(e){q_.prototype.setMap.call(this,e),e&&e.render()},pm.prototype.initSlider_=function(){const e=this.element,t={width:e.offsetWidth,height:e.offsetHeight},o=e.firstElementChild,r=getComputedStyle(o),i=o.offsetWidth+parseFloat(r.marginRight)+parseFloat(r.marginLeft),n=o.offsetHeight+parseFloat(r.marginTop)+parseFloat(r.marginBottom);this.thumbSize_=[i,n],t.width>t.height?(this.direction_=dm.HORIZONTAL,this.widthLimit_=t.width-i):(this.direction_=dm.VERTICAL,this.heightLimit_=t.height-n),this.sliderInitialized_=!0},pm.prototype.handleContainerClick_=function(e){const t=this.getMap().getView(),o=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(o);t.animate({resolution:t.constrainResolution(r),duration:this.duration_,easing:gr})},pm.prototype.handleDraggerStart_=function(e){this.dragging_||e.originalEvent.target!==this.element.firstElementChild||(this.getMap().getView().setHint(M_.INTERACTING,1),this.previousX_=e.clientX,this.previousY_=e.clientY,this.dragging_=!0)},pm.prototype.handleDraggerDrag_=function(e){if(this.dragging_){const t=this.element.firstElementChild,o=e.clientX-this.previousX_+parseInt(t.style.left,10),r=e.clientY-this.previousY_+parseInt(t.style.top,10),i=this.getRelativePosition_(o,r);this.currentResolution_=this.getResolutionForPosition_(i),this.getMap().getView().setResolution(this.currentResolution_),this.setThumbPosition_(this.currentResolution_),this.previousX_=e.clientX,this.previousY_=e.clientY}},pm.prototype.handleDraggerEnd_=function(){if(this.dragging_){const e=this.getMap().getView();e.setHint(M_.INTERACTING,-1),e.animate({resolution:e.constrainResolution(this.currentResolution_),duration:this.duration_,easing:gr}),this.dragging_=!1,this.previousX_=void 0,this.previousY_=void 0}},pm.prototype.setThumbPosition_=function(e){const t=this.getPositionForResolution_(e),o=this.element.firstElementChild;this.direction_==dm.HORIZONTAL?o.style.left=this.widthLimit_*t+'px':o.style.top=this.heightLimit_*t+'px'},pm.prototype.getRelativePosition_=function(e,t){let o;return o=this.direction_===dm.HORIZONTAL?e/this.widthLimit_:t/this.heightLimit_,me(o,0,1)},pm.prototype.getResolutionForPosition_=function(e){const t=this.getMap().getView().getResolutionForValueFunction();return t(1-e)},pm.prototype.getPositionForResolution_=function(e){const t=this.getMap().getView().getValueForResolutionFunction();return 1-t(e)};const gm=function(e){const t=e?e:{};this.extent=t.extent?t.extent:null;const o=t.className===void 0?'ol-zoom-extent':t.className,r=t.label===void 0?'E':t.label,i=t.tipLabel===void 0?'Fit to extent':t.tipLabel,n=document.createElement('button');n.setAttribute('type','button'),n.title=i,n.appendChild('string'==typeof r?document.createTextNode(r):r),c(n,Yd.CLICK,this.handleClick_,this);const a=document.createElement('div');a.className=o+' '+kp+' '+Up,a.appendChild(n),q_.call(this,{element:a,target:t.target})};i(gm,q_),gm.prototype.handleClick_=function(e){e.preventDefault(),this.handleZoomToExtent()},gm.prototype.handleZoomToExtent=function(){const e=this.getMap(),t=e.getView(),o=this.extent?this.extent:t.getProjection().getExtent();t.fit(o)};const _m=function(e){this.source_=e};_m.prototype.getType=function(){},_m.prototype.getSource=function(){return this.source_},_m.prototype.isAnimated=x;var um=_m;const cm=function(e){um.call(this,e)};i(cm,um),cm.prototype.getType=function(){return 35632};var ym=cm;const mm=function(e){um.call(this,e)};i(mm,um),mm.prototype.getType=function(){return 35633};var hm=mm;const fm=new ym('precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n'),xm=new hm('varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n');var Em=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_lineWidth=e.getUniformLocation(t,'u_lineWidth'),this.u_pixelRatio=e.getUniformLocation(t,'u_pixelRatio'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_fillColor=e.getUniformLocation(t,'u_fillColor'),this.u_strokeColor=e.getUniformLocation(t,'u_strokeColor'),this.u_size=e.getUniformLocation(t,'u_size'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_instruction=e.getAttribLocation(t,'a_instruction'),this.a_radius=e.getAttribLocation(t,'a_radius')};const Tm=function(e,t){Wc.call(this),this.tolerance=e,this.maxExtent=t,this.origin=Q(t),this.projectionMatrix_=tt(),this.offsetRotateMatrix_=tt(),this.offsetScaleMatrix_=tt(),this.tmpMat4_=In(),this.indices=[],this.indicesBuffer=null,this.startIndices=[],this.startIndicesFeature=[],this.vertices=[],this.verticesBuffer=null,this.lineStringReplay=void 0};i(Tm,Wc),Tm.prototype.getDeleteResourcesFunction=function(){},Tm.prototype.finish=function(){},Tm.prototype.setUpProgram=function(){},Tm.prototype.shutDownProgram=function(){},Tm.prototype.drawReplay=function(){},Tm.prototype.drawHitDetectionReplayOneByOne=function(){},Tm.prototype.drawHitDetectionReplay=function(e,t,o,r,i,n){return i?this.drawHitDetectionReplayOneByOne(e,t,o,r,n):this.drawHitDetectionReplayAll(e,t,o,r)},Tm.prototype.drawHitDetectionReplayAll=function(e,t,o,r){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawReplay(e,t,o,!0);const i=r(null);return i?i:void 0},Tm.prototype.replay=function(e,t,o,r,i,n,a,s,l,d,p){const g=e.getGL();let _,u,c,y,m,h,f,x;this.lineStringReplay&&(_=g.isEnabled(g.STENCIL_TEST),u=g.getParameter(g.STENCIL_FUNC),c=g.getParameter(g.STENCIL_VALUE_MASK),y=g.getParameter(g.STENCIL_REF),m=g.getParameter(g.STENCIL_WRITEMASK),h=g.getParameter(g.STENCIL_FAIL),f=g.getParameter(g.STENCIL_PASS_DEPTH_PASS),x=g.getParameter(g.STENCIL_PASS_DEPTH_FAIL),g.enable(g.STENCIL_TEST),g.clear(g.STENCIL_BUFFER_BIT),g.stencilMask(255),g.stencilFunc(g.ALWAYS,1,255),g.stencilOp(g.KEEP,g.KEEP,g.REPLACE),this.lineStringReplay.replay(e,t,o,r,i,n,a,s,l,d,p),g.stencilMask(0),g.stencilFunc(g.NOTEQUAL,1,255)),e.bindBuffer(ld,this.verticesBuffer),e.bindBuffer(dd,this.indicesBuffer);const E=this.setUpProgram(g,e,i,n),T=ot(this.projectionMatrix_);lt(T,2/(o*i[0]),2/(o*i[1])),st(T,-r),dt(T,-(t[0]-this.origin[0]),-(t[1]-this.origin[1]));const S=ot(this.offsetScaleMatrix_);lt(S,2/i[0],2/i[1]);const C=ot(this.offsetRotateMatrix_);0!==r&&st(C,-r),g.uniformMatrix4fv(E.u_projectionMatrix,!1,Ln(this.tmpMat4_,T)),g.uniformMatrix4fv(E.u_offsetScaleMatrix,!1,Ln(this.tmpMat4_,S)),g.uniformMatrix4fv(E.u_offsetRotateMatrix,!1,Ln(this.tmpMat4_,C)),g.uniform1f(E.u_opacity,a);let R;return void 0===l?this.drawReplay(g,e,s,!1):R=this.drawHitDetectionReplay(g,e,s,l,d,p),this.shutDownProgram(g,E),this.lineStringReplay&&(!_&&g.disable(g.STENCIL_TEST),g.clear(g.STENCIL_BUFFER_BIT),g.stencilFunc(u,y,c),g.stencilMask(m),g.stencilOp(h,x,f)),R},Tm.prototype.drawElements=function(e,t,o,r){const i=t.hasOESElementIndexUint?5125:5123,n=t.hasOESElementIndexUint?4:2;e.drawElements(4,r-o,i,o*n)};var Sm=Tm;const Cm=[0,0,0,1],Rm='round',Im=[],Lm=0,Pm='round',vm=10,Fm=[0,0,0,1],Om=1,wm=Number.EPSILON||2220446049250313e-31,Nm=function(e,t,o,r,i,n){const a=(o-e)*(n-t)-(i-e)*(r-t);return a<=wm&&a>=-wm?void 0:0<a},Am={STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048},bm=function(e,t){this.arr_=e===void 0?[]:e,this.usage_=t===void 0?Am.STATIC_DRAW:t};bm.prototype.getArray=function(){return this.arr_},bm.prototype.getUsage=function(){return this.usage_};var Mm=bm;const Gm=function(e,t){Sm.call(this,e,t),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.radius_=0,this.state_={fillColor:null,strokeColor:null,lineDash:null,lineDashOffset:void 0,lineWidth:void 0,changed:!1}};i(Gm,Sm),Gm.prototype.drawCoordinates_=function(e,t,o,r){let a=this.vertices.length,s=this.indices.length,l=a/4,n,i;for(n=t,i=o;n<i;n+=r)this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=0,this.vertices[a++]=this.radius_,this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=1,this.vertices[a++]=this.radius_,this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=2,this.vertices[a++]=this.radius_,this.vertices[a++]=e[n],this.vertices[a++]=e[n+1],this.vertices[a++]=3,this.vertices[a++]=this.radius_,this.indices[s++]=l,this.indices[s++]=l+1,this.indices[s++]=l+2,this.indices[s++]=l+2,this.indices[s++]=l+3,this.indices[s++]=l,l+=4},Gm.prototype.drawCircle=function(e,t){const o=e.getRadius(),r=e.getStride();if(o){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.radius_=o;let i=e.getFlatCoordinates();i=ye(i,0,2,r,-this.origin[0],-this.origin[1]),this.drawCoordinates_(i,0,2,r)}else if(this.state_.changed&&(this.styles_.pop(),this.styles_.length)){const e=this.styles_[this.styles_.length-1];this.state_.fillColor=e[0],this.state_.strokeColor=e[1],this.state_.lineWidth=e[2],this.state_.changed=!1}},Gm.prototype.finish=function(){this.verticesBuffer=new Mm(this.vertices),this.indicesBuffer=new Mm(this.indices),this.startIndices.push(this.indices.length),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},Gm.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t),e.deleteBuffer(o)}},Gm.prototype.setUpProgram=function(e,t,o,r){const i=t.getProgram(fm,xm);let n;return this.defaultLocations_?n=this.defaultLocations_:(n=new Em(e,i),this.defaultLocations_=n),t.useProgram(i),e.enableVertexAttribArray(n.a_position),e.vertexAttribPointer(n.a_position,2,_d,!1,16,0),e.enableVertexAttribArray(n.a_instruction),e.vertexAttribPointer(n.a_instruction,1,_d,!1,16,8),e.enableVertexAttribArray(n.a_radius),e.vertexAttribPointer(n.a_radius,1,_d,!1,16,12),e.uniform2fv(n.u_size,o),e.uniform1f(n.u_pixelRatio,r),n},Gm.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position),e.disableVertexAttribArray(t.a_instruction),e.disableVertexAttribArray(t.a_radius)},Gm.prototype.drawReplay=function(e,t,o){if(!l(o))this.drawReplaySkipping_(e,t,o);else{let o,r,i,n;for(i=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;0<=o;--o)r=this.styleIndices_[o],n=this.styles_[o],this.setFillStyle_(e,n[0]),this.setStrokeStyle_(e,n[1],n[2]),this.drawElements(e,t,r,i),i=r}},Gm.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s,i,l,d,p,g,_,u;for(u=this.startIndices.length-2,l=this.startIndices[u+1],s=this.styleIndices_.length-1;0<=s;--s)for(d=this.styles_[s],this.setFillStyle_(e,d[0]),this.setStrokeStyle_(e,d[1],d[2]),p=this.styleIndices_[s];0<=u&&this.startIndices[u]>=p;){if(i=this.startIndices[u],g=this.startIndicesFeature[u],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||ae(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,i,l);const o=r(g);if(o)return o}u--,l=i}},Gm.prototype.drawReplaySkipping_=function(e,t,o){let r,i,a,s,l,d,p,g,_;for(g=this.startIndices.length-2,a=i=this.startIndices[g+1],r=this.styleIndices_.length-1;0<=r;--r){for(s=this.styles_[r],this.setFillStyle_(e,s[0]),this.setStrokeStyle_(e,s[1],s[2]),l=this.styleIndices_[r];0<=g&&this.startIndices[g]>=l;)_=this.startIndices[g],d=this.startIndicesFeature[g],p=n(d).toString(),o[p]&&(i!==a&&this.drawElements(e,t,i,a),a=_),g--,i=_;i!==a&&this.drawElements(e,t,i,a),i=a=l}},Gm.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_fillColor,t)},Gm.prototype.setStrokeStyle_=function(e,t,o){e.uniform4fv(this.defaultLocations_.u_strokeColor,t),e.uniform1f(this.defaultLocations_.u_lineWidth,o)},Gm.prototype.setFillStrokeStyle=function(e,t){let o,r;if(t){const e=t.getLineDash();this.state_.lineDash=e?e:Im;const i=t.getLineDashOffset();this.state_.lineDashOffset=i?i:Lm,o=t.getColor(),o=o instanceof CanvasGradient||o instanceof CanvasPattern?Fm:yt(o).map(function(e,t){return 3==t?e:e/255})||Fm,r=t.getWidth(),r=r===void 0?Om:r}else o=[0,0,0,0],r=0;let i=e?e.getColor():[0,0,0,0];i=i instanceof CanvasGradient||i instanceof CanvasPattern?Cm:yt(i).map(function(e,t){return 3==t?e:e/255})||Cm,this.state_.strokeColor&&zt(this.state_.strokeColor,o)&&this.state_.fillColor&&zt(this.state_.fillColor,i)&&this.state_.lineWidth===r||(this.state_.changed=!0,this.state_.fillColor=i,this.state_.strokeColor=o,this.state_.lineWidth=r,this.styles_.push([i,o,r]))};const Dm=new ym('precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n'),km=new hm('varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n');var Um=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_image=e.getUniformLocation(t,'u_image'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_texCoord=e.getAttribLocation(t,'a_texCoord'),this.a_offsets=e.getAttribLocation(t,'a_offsets'),this.a_opacity=e.getAttribLocation(t,'a_opacity'),this.a_rotateWithView=e.getAttribLocation(t,'a_rotateWithView')},Ym={LOST:'webglcontextlost',RESTORED:'webglcontextrestored'};const jm=function(e,t){this.canvas_=e,this.gl_=t,this.bufferCache_={},this.shaderCache_={},this.programCache_={},this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null,this.hasOESElementIndexUint=kt(Ld,'OES_element_index_uint'),this.hasOESElementIndexUint&&t.getExtension('OES_element_index_uint'),c(this.canvas_,Ym.LOST,this.handleWebGLContextLost,this),c(this.canvas_,Ym.RESTORED,this.handleWebGLContextRestored,this)};i(jm,Md),jm.prototype.bindBuffer=function(e,t){const o=this.getGL(),r=t.getArray(),i=n(t)+'';if(i in this.bufferCache_){const t=this.bufferCache_[i];o.bindBuffer(e,t.buffer)}else{const n=o.createBuffer();o.bindBuffer(e,n);let a;e==ld?a=new Float32Array(r):e==dd&&(a=this.hasOESElementIndexUint?new Uint32Array(r):new Uint16Array(r)),o.bufferData(e,a,t.getUsage()),this.bufferCache_[i]={buf:t,buffer:n}}},jm.prototype.deleteBuffer=function(e){const t=this.getGL(),o=n(e)+'',r=this.bufferCache_[o];t.isContextLost()||t.deleteBuffer(r.buffer),delete this.bufferCache_[o]},jm.prototype.disposeInternal=function(){f(this.canvas_);const e=this.getGL();if(!e.isContextLost()){for(const t in this.bufferCache_)e.deleteBuffer(this.bufferCache_[t].buffer);for(const t in this.programCache_)e.deleteProgram(this.programCache_[t]);for(const t in this.shaderCache_)e.deleteShader(this.shaderCache_[t]);e.deleteFramebuffer(this.hitDetectionFramebuffer_),e.deleteRenderbuffer(this.hitDetectionRenderbuffer_),e.deleteTexture(this.hitDetectionTexture_)}},jm.prototype.getCanvas=function(){return this.canvas_},jm.prototype.getGL=function(){return this.gl_},jm.prototype.getHitDetectionFramebuffer=function(){return this.hitDetectionFramebuffer_||this.initHitDetectionFramebuffer_(),this.hitDetectionFramebuffer_},jm.prototype.getShader=function(e){const t=n(e)+'';if(t in this.shaderCache_)return this.shaderCache_[t];else{const o=this.getGL(),r=o.createShader(e.getType());return o.shaderSource(r,e.getSource()),o.compileShader(r),this.shaderCache_[t]=r,r}},jm.prototype.getProgram=function(e,t){const o=n(e)+'/'+n(t);if(o in this.programCache_)return this.programCache_[o];else{const r=this.getGL(),i=r.createProgram();return r.attachShader(i,this.getShader(e)),r.attachShader(i,this.getShader(t)),r.linkProgram(i),this.programCache_[o]=i,i}},jm.prototype.handleWebGLContextLost=function(){a(this.bufferCache_),a(this.shaderCache_),a(this.programCache_),this.currentProgram_=null,this.hitDetectionFramebuffer_=null,this.hitDetectionTexture_=null,this.hitDetectionRenderbuffer_=null},jm.prototype.handleWebGLContextRestored=function(){},jm.prototype.initHitDetectionFramebuffer_=function(){const e=this.gl_,t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const o=vn(e,1,1),r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,1,1),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this.hitDetectionFramebuffer_=t,this.hitDetectionTexture_=o,this.hitDetectionRenderbuffer_=r},jm.prototype.useProgram=function(e){if(e==this.currentProgram_)return!1;else{const t=this.getGL();return t.useProgram(e),this.currentProgram_=e,!0}};const Bm=function(e,t){Sm.call(this,e,t),this.anchorX=void 0,this.anchorY=void 0,this.groupIndices=[],this.hitDetectionGroupIndices=[],this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.defaultLocations=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.width=void 0};i(Bm,Sm),Bm.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer,r=this.getTextures(!0),n=e.getGL();return function(){if(!n.isContextLost()){let e,t;for(e=0,t=r.length;e<t;++e)n.deleteTexture(r[e])}e.deleteBuffer(t),e.deleteBuffer(o)}},Bm.prototype.drawCoordinates=function(e,t,o,r){const a=this.anchorX,s=this.anchorY,l=this.height,d=this.imageHeight,p=this.imageWidth,g=this.opacity,_=this.originX,u=this.originY,c=this.rotateWithView?1:0,m=-this.rotation,h=this.scale,f=this.width,E=Ql(m),T=Jl(m);let S=this.indices.length,C=this.vertices.length,R,i,n,I,L,x;for(R=t;R<o;R+=r)L=e[R]-this.origin[0],x=e[R+1]-this.origin[1],i=C/8,n=-h*a,I=-h*(l-s),this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=_/p,this.vertices[C++]=(u+l)/d,this.vertices[C++]=g,this.vertices[C++]=c,n=h*(f-a),I=-h*(l-s),this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=(_+f)/p,this.vertices[C++]=(u+l)/d,this.vertices[C++]=g,this.vertices[C++]=c,n=h*(f-a),I=h*s,this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=(_+f)/p,this.vertices[C++]=u/d,this.vertices[C++]=g,this.vertices[C++]=c,n=-h*a,I=h*s,this.vertices[C++]=L,this.vertices[C++]=x,this.vertices[C++]=n*E-I*T,this.vertices[C++]=n*T+I*E,this.vertices[C++]=_/p,this.vertices[C++]=u/d,this.vertices[C++]=g,this.vertices[C++]=c,this.indices[S++]=i,this.indices[S++]=i+1,this.indices[S++]=i+2,this.indices[S++]=i,this.indices[S++]=i+2,this.indices[S++]=i+3;return C},Bm.prototype.createTextures=function(e,t,o,r){let a,s,l,d;const i=t.length;for(d=0;d<i;++d)s=t[d],l=n(s).toString(),l in o?a=o[l]:(a=Fn(r,s,Ed,Ed),o[l]=a),e[d]=a},Bm.prototype.setUpProgram=function(e,t){const o=t.getProgram(Dm,km);let r;return this.defaultLocations?r=this.defaultLocations:(r=new Um(e,o),this.defaultLocations=r),t.useProgram(o),e.enableVertexAttribArray(r.a_position),e.vertexAttribPointer(r.a_position,2,_d,!1,32,0),e.enableVertexAttribArray(r.a_offsets),e.vertexAttribPointer(r.a_offsets,2,_d,!1,32,8),e.enableVertexAttribArray(r.a_texCoord),e.vertexAttribPointer(r.a_texCoord,2,_d,!1,32,16),e.enableVertexAttribArray(r.a_opacity),e.vertexAttribPointer(r.a_opacity,1,_d,!1,32,24),e.enableVertexAttribArray(r.a_rotateWithView),e.vertexAttribPointer(r.a_rotateWithView,1,_d,!1,32,28),r},Bm.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position),e.disableVertexAttribArray(t.a_offsets),e.disableVertexAttribArray(t.a_texCoord),e.disableVertexAttribArray(t.a_opacity),e.disableVertexAttribArray(t.a_rotateWithView)},Bm.prototype.drawReplay=function(e,t,o,r){const n=r?this.getHitDetectionTextures():this.getTextures(),a=r?this.hitDetectionGroupIndices:this.groupIndices;if(!l(o))this.drawReplaySkipping(e,t,o,n,a);else{let o,r,i;for(o=0,r=n.length,i=0;o<r;++o){e.bindTexture(xd,n[o]);const r=a[o];this.drawElements(e,t,i,r),i=r}}},Bm.prototype.drawReplaySkipping=function(e,t,o,r,a){let s=0,l,i;for(l=0,i=r.length;l<i;++l){e.bindTexture(xd,r[l]);const i=0<l?a[l-1]:0,d=a[l];let p=i,g=i;for(;s<this.startIndices.length&&this.startIndices[s]<=d;){const r=this.startIndicesFeature[s],i=n(r).toString();o[i]===void 0?g=s==this.startIndices.length-1?d:this.startIndices[s+1]:(p!==g&&this.drawElements(e,t,p,g),p=s==this.startIndices.length-1?d:this.startIndices[s+1],g=p),s++}p!==g&&this.drawElements(e,t,p,g)}},Bm.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s=this.startIndices.length-1,l,i,d,p,g,_;const u=this.getHitDetectionTextures();for(l=u.length-1;0<=l;--l)for(e.bindTexture(xd,u[l]),i=0<l?this.hitDetectionGroupIndices[l-1]:0,p=this.hitDetectionGroupIndices[l];0<=s&&this.startIndices[s]>=i;){if(d=this.startIndices[s],g=this.startIndicesFeature[s],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||ae(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,d,p);const o=r(g);if(o)return o}p=d,s--}},Bm.prototype.finish=function(){this.anchorX=void 0,this.anchorY=void 0,this.height=void 0,this.imageHeight=void 0,this.imageWidth=void 0,this.indices=null,this.opacity=void 0,this.originX=void 0,this.originY=void 0,this.rotateWithView=void 0,this.rotation=void 0,this.scale=void 0,this.vertices=null,this.width=void 0},Bm.prototype.getTextures=function(){},Bm.prototype.getHitDetectionTextures=function(){};var Vm=Bm;const zm=function(e,t){Vm.call(this,e,t),this.images_=[],this.hitDetectionImages_=[],this.textures_=[],this.hitDetectionTextures_=[]};i(zm,Vm),zm.prototype.drawMultiPoint=function(e,t){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t);const o=e.getFlatCoordinates(),r=e.getStride();this.drawCoordinates(o,0,o.length,r)},zm.prototype.drawPoint=function(e,t){this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t);const o=e.getFlatCoordinates(),r=e.getStride();this.drawCoordinates(o,0,o.length,r)},zm.prototype.finish=function(e){const t=e.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices.push(this.indices.length),this.verticesBuffer=new Mm(this.vertices);const o=this.indices;this.indicesBuffer=new Mm(o);const r={};this.createTextures(this.textures_,this.images_,r,t),this.createTextures(this.hitDetectionTextures_,this.hitDetectionImages_,r,t),this.images_=null,this.hitDetectionImages_=null,Vm.prototype.finish.call(this,e)},zm.prototype.setImageStyle=function(e){const t=e.getAnchor(),o=e.getImage(1),r=e.getImageSize(),i=e.getHitDetectionImage(1),a=e.getOpacity(),s=e.getOrigin(),l=e.getRotateWithView(),d=e.getRotation(),p=e.getSize(),g=e.getScale();let _;0===this.images_.length?this.images_.push(o):(_=this.images_[this.images_.length-1],n(_)!=n(o)&&(this.groupIndices.push(this.indices.length),this.images_.push(o))),0===this.hitDetectionImages_.length?this.hitDetectionImages_.push(i):(_=this.hitDetectionImages_[this.hitDetectionImages_.length-1],n(_)!=n(i)&&(this.hitDetectionGroupIndices.push(this.indices.length),this.hitDetectionImages_.push(i))),this.anchorX=t[0],this.anchorY=t[1],this.height=p[1],this.imageHeight=r[1],this.imageWidth=r[0],this.opacity=a,this.originX=s[0],this.originY=s[1],this.rotation=d,this.rotateWithView=l,this.scale=g,this.width=p[0]},zm.prototype.getTextures=function(e){return e?this.textures_.concat(this.hitDetectionTextures_):this.textures_},zm.prototype.getHitDetectionTextures=function(){return this.hitDetectionTextures_};const Xm=new ym('precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n'),Wm=new hm('varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n');var Km=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_lineWidth=e.getUniformLocation(t,'u_lineWidth'),this.u_miterLimit=e.getUniformLocation(t,'u_miterLimit'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_color=e.getUniformLocation(t,'u_color'),this.u_size=e.getUniformLocation(t,'u_size'),this.u_pixelRatio=e.getUniformLocation(t,'u_pixelRatio'),this.a_lastPos=e.getAttribLocation(t,'a_lastPos'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_nextPos=e.getAttribLocation(t,'a_nextPos'),this.a_direction=e.getAttribLocation(t,'a_direction')};const Hm={ROUND:2,BEGIN_LINE:3,END_LINE:5,BEGIN_LINE_CAP:7,END_LINE_CAP:11,BEVEL_FIRST:13,BEVEL_SECOND:17,MITER_BOTTOM:19,MITER_TOP:23},Zm=function(e,t){Sm.call(this,e,t),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,changed:!1}};i(Zm,Sm),Zm.prototype.drawCoordinates_=function(e,t,o,r){let a=this.vertices.length,s=this.indices.length,l,i;const d='bevel'===this.state_.lineJoin?0:'miter'===this.state_.lineJoin?1:2,p='butt'===this.state_.lineCap?0:'square'===this.state_.lineCap?1:2,g=On(e,t,o,r);let _=s,u=1,c,y,m,n,h,f;for(l=t,i=o;l<i;l+=r){if(m=a/7,n=h,h=f||[e[l],e[l+1]],l===t){if(f=[e[l+r],e[l+r+1]],o-t==2*r&&zt(h,f))break;if(g)n=[e[o-2*r],e[o-2*r+1]],c=f;else{p&&(a=this.addVertices_([0,0],h,f,u*Hm.BEGIN_LINE_CAP*p,a),a=this.addVertices_([0,0],h,f,-u*Hm.BEGIN_LINE_CAP*p,a),this.indices[s++]=m+2,this.indices[s++]=m,this.indices[s++]=m+1,this.indices[s++]=m+1,this.indices[s++]=m+3,this.indices[s++]=m+2),a=this.addVertices_([0,0],h,f,u*Hm.BEGIN_LINE*(p||1),a),a=this.addVertices_([0,0],h,f,-u*Hm.BEGIN_LINE*(p||1),a),_=a/7-1;continue}}else if(l!==o-r)f=[e[l+r],e[l+r+1]];else if(g){f=c;break}else{n=n||[0,0],a=this.addVertices_(n,h,[0,0],u*Hm.END_LINE*(p||1),a),a=this.addVertices_(n,h,[0,0],-u*Hm.END_LINE*(p||1),a),this.indices[s++]=m,this.indices[s++]=_-1,this.indices[s++]=_,this.indices[s++]=_,this.indices[s++]=m+1,this.indices[s++]=m,p&&(a=this.addVertices_(n,h,[0,0],u*Hm.END_LINE_CAP*p,a),a=this.addVertices_(n,h,[0,0],-u*Hm.END_LINE_CAP*p,a),this.indices[s++]=m+2,this.indices[s++]=m,this.indices[s++]=m+1,this.indices[s++]=m+1,this.indices[s++]=m+3,this.indices[s++]=m+2);break}y=Nm(n[0],n[1],h[0],h[1],f[0],f[1])?-1:1,a=this.addVertices_(n,h,f,y*Hm.BEVEL_FIRST*(d||1),a),a=this.addVertices_(n,h,f,y*Hm.BEVEL_SECOND*(d||1),a),a=this.addVertices_(n,h,f,-y*Hm.MITER_BOTTOM*(d||1),a),l>t&&(this.indices[s++]=m,this.indices[s++]=_-1,this.indices[s++]=_,this.indices[s++]=m+2,this.indices[s++]=m,this.indices[s++]=0<u*y?_:_-1),this.indices[s++]=m,this.indices[s++]=m+2,this.indices[s++]=m+1,_=m+2,u=y,d&&(a=this.addVertices_(n,h,f,y*Hm.MITER_TOP*d,a),this.indices[s++]=m+1,this.indices[s++]=m+3,this.indices[s++]=m)}g&&(m=m||a/7,y=bo([n[0],n[1],h[0],h[1],f[0],f[1]],0,6,2)?1:-1,a=this.addVertices_(n,h,f,y*Hm.BEVEL_FIRST*(d||1),a),a=this.addVertices_(n,h,f,-y*Hm.MITER_BOTTOM*(d||1),a),this.indices[s++]=m,this.indices[s++]=_-1,this.indices[s++]=_,this.indices[s++]=m+1,this.indices[s++]=m,this.indices[s++]=0<u*y?_:_-1)},Zm.prototype.addVertices_=function(e,t,o,r,i){return this.vertices[i++]=e[0],this.vertices[i++]=e[1],this.vertices[i++]=t[0],this.vertices[i++]=t[1],this.vertices[i++]=o[0],this.vertices[i++]=o[1],this.vertices[i++]=r,i},Zm.prototype.isValid_=function(e,t,o,r){const i=o-t;if(i<2*r)return!1;if(i==2*r){const o=[e[t],e[t+1]],i=[e[t+r],e[t+r+1]];return!zt(o,i)}return!0},Zm.prototype.drawLineString=function(e,t){let o=e.getFlatCoordinates();const r=e.getStride();this.isValid_(o,0,o.length,r)&&(o=ye(o,0,o.length,r,-this.origin[0],-this.origin[1]),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.drawCoordinates_(o,0,o.length,r))},Zm.prototype.drawMultiLineString=function(e,t){const o=this.indices.length,r=e.getEnds();r.unshift(0);const n=e.getFlatCoordinates(),a=e.getStride();let s,i;if(1<r.length)for(s=1,i=r.length;s<i;++s)if(this.isValid_(n,r[s-1],r[s],a)){const e=ye(n,r[s-1],r[s],a,-this.origin[0],-this.origin[1]);this.drawCoordinates_(e,0,e.length,a)}this.indices.length>o&&(this.startIndices.push(o),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(o),this.state_.changed=!1))},Zm.prototype.drawPolygonCoordinates=function(e,t,o){if(On(e,0,e.length,o)||(e.push(e[0]),e.push(e[1])),this.drawCoordinates_(e,0,e.length,o),t.length){let e,r;for(e=0,r=t.length;e<r;++e)On(t[e],0,t[e].length,o)||(t[e].push(t[e][0]),t[e].push(t[e][1])),this.drawCoordinates_(t[e],0,t[e].length,o)}},Zm.prototype.setPolygonStyle=function(e,t){const o=t===void 0?this.indices.length:t;this.startIndices.push(o),this.startIndicesFeature.push(e),this.state_.changed&&(this.styleIndices_.push(o),this.state_.changed=!1)},Zm.prototype.getCurrentIndex=function(){return this.indices.length},Zm.prototype.finish=function(){this.verticesBuffer=new Mm(this.vertices),this.indicesBuffer=new Mm(this.indices),this.startIndices.push(this.indices.length),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},Zm.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t),e.deleteBuffer(o)}},Zm.prototype.setUpProgram=function(e,t,o,r){const i=t.getProgram(Xm,Wm);let n;return this.defaultLocations_?n=this.defaultLocations_:(n=new Km(e,i),this.defaultLocations_=n),t.useProgram(i),e.enableVertexAttribArray(n.a_lastPos),e.vertexAttribPointer(n.a_lastPos,2,_d,!1,28,0),e.enableVertexAttribArray(n.a_position),e.vertexAttribPointer(n.a_position,2,_d,!1,28,8),e.enableVertexAttribArray(n.a_nextPos),e.vertexAttribPointer(n.a_nextPos,2,_d,!1,28,16),e.enableVertexAttribArray(n.a_direction),e.vertexAttribPointer(n.a_direction,1,_d,!1,28,24),e.uniform2fv(n.u_size,o),e.uniform1f(n.u_pixelRatio,r),n},Zm.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_lastPos),e.disableVertexAttribArray(t.a_position),e.disableVertexAttribArray(t.a_nextPos),e.disableVertexAttribArray(t.a_direction)},Zm.prototype.drawReplay=function(e,t,o,r){const i=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK);if(r||(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.NOTEQUAL)),!l(o))this.drawReplaySkipping_(e,t,o);else{let o,r,i,n;for(i=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;0<=o;--o)r=this.styleIndices_[o],n=this.styles_[o],this.setStrokeStyle_(e,n[0],n[1],n[2]),this.drawElements(e,t,r,i),e.clear(e.DEPTH_BUFFER_BIT),i=r}r||(e.disable(e.DEPTH_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.depthMask(n),e.depthFunc(i))},Zm.prototype.drawReplaySkipping_=function(e,t,o){let r,i,a,s,l,d,p,g,_;for(g=this.startIndices.length-2,a=i=this.startIndices[g+1],r=this.styleIndices_.length-1;0<=r;--r){for(s=this.styles_[r],this.setStrokeStyle_(e,s[0],s[1],s[2]),l=this.styleIndices_[r];0<=g&&this.startIndices[g]>=l;)_=this.startIndices[g],d=this.startIndicesFeature[g],p=n(d).toString(),o[p]&&(i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),a=_),g--,i=_;i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),i=a=l}},Zm.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s,i,l,d,p,g,_,u;for(u=this.startIndices.length-2,l=this.startIndices[u+1],s=this.styleIndices_.length-1;0<=s;--s)for(d=this.styles_[s],this.setStrokeStyle_(e,d[0],d[1],d[2]),p=this.styleIndices_[s];0<=u&&this.startIndices[u]>=p;){if(i=this.startIndices[u],g=this.startIndicesFeature[u],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||ae(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,i,l);const o=r(g);if(o)return o}u--,l=i}},Zm.prototype.setStrokeStyle_=function(e,t,o,r){e.uniform4fv(this.defaultLocations_.u_color,t),e.uniform1f(this.defaultLocations_.u_lineWidth,o),e.uniform1f(this.defaultLocations_.u_miterLimit,r)},Zm.prototype.setFillStrokeStyle=function(e,t){const o=t.getLineCap();this.state_.lineCap=o===void 0?Rm:o;const r=t.getLineDash();this.state_.lineDash=r?r:Im;const i=t.getLineDashOffset();this.state_.lineDashOffset=i?i:Lm;const n=t.getLineJoin();this.state_.lineJoin=n===void 0?Pm:n;let a=t.getColor();a=a instanceof CanvasGradient||a instanceof CanvasPattern?Fm:yt(a).map(function(e,t){return 3==t?e:e/255})||Fm;let s=t.getWidth();s=s===void 0?Om:s;let l=t.getMiterLimit();l=l===void 0?vm:l,this.state_.strokeColor&&zt(this.state_.strokeColor,a)&&this.state_.lineWidth===s&&this.state_.miterLimit===l||(this.state_.changed=!0,this.state_.strokeColor=a,this.state_.lineWidth=s,this.state_.miterLimit=l,this.styles_.push([a,s,l]))};var qm=Zm;const Jm=new ym('precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n'),Qm=new hm('\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n');var $m=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_offsetScaleMatrix=e.getUniformLocation(t,'u_offsetScaleMatrix'),this.u_offsetRotateMatrix=e.getUniformLocation(t,'u_offsetRotateMatrix'),this.u_color=e.getUniformLocation(t,'u_color'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.a_position=e.getAttribLocation(t,'a_position')};const eh=function(e){this.first_,this.last_,this.head_,this.circular_=!(e!==void 0)||e,this.length_=0};eh.prototype.insertItem=function(e){const t={prev:void 0,next:void 0,data:e},o=this.head_;if(!o)this.first_=t,this.last_=t,this.circular_&&(t.next=t,t.prev=t);else{const e=o.next;t.prev=o,t.next=e,o.next=t,e&&(e.prev=t),o===this.last_&&(this.last_=t)}this.head_=t,this.length_++},eh.prototype.removeItem=function(){const e=this.head_;if(e){const t=e.next,o=e.prev;t&&(t.prev=o),o&&(o.next=t),this.head_=t||o,this.first_===this.last_?(this.head_=void 0,this.first_=void 0,this.last_=void 0):this.first_===e?this.first_=this.head_:this.last_===e&&(this.last_=o?this.head_.prev:this.head_),this.length_--}},eh.prototype.firstItem=function(){return this.head_=this.first_,this.head_?this.head_.data:void 0},eh.prototype.lastItem=function(){return this.head_=this.last_,this.head_?this.head_.data:void 0},eh.prototype.nextItem=function(){return this.head_&&this.head_.next?(this.head_=this.head_.next,this.head_.data):void 0},eh.prototype.getNextItem=function(){return this.head_&&this.head_.next?this.head_.next.data:void 0},eh.prototype.prevItem=function(){return this.head_&&this.head_.prev?(this.head_=this.head_.prev,this.head_.data):void 0},eh.prototype.getPrevItem=function(){return this.head_&&this.head_.prev?this.head_.prev.data:void 0},eh.prototype.getCurrItem=function(){return this.head_?this.head_.data:void 0},eh.prototype.setFirstItem=function(){this.circular_&&this.head_&&(this.first_=this.head_,this.last_=this.head_.prev)},eh.prototype.concat=function(e){if(e.head_){if(this.head_){const t=this.head_.next;this.head_.next=e.first_,e.first_.prev=this.head_,t.prev=e.last_,e.last_.next=t,this.length_+=e.length_}else this.head_=e.head_,this.first_=e.first_,this.last_=e.last_,this.length_=e.length_;e.head_=void 0,e.first_=void 0,e.last_=void 0,e.length_=0}},eh.prototype.getLength=function(){return this.length_};var th=eh;const oh=function(e,t){Sm.call(this,e,t),this.lineStringReplay=new qm(e,t),this.defaultLocations_=null,this.styles_=[],this.styleIndices_=[],this.state_={fillColor:null,changed:!1}};i(oh,Sm),oh.prototype.drawCoordinates_=function(e,t,o){const r=new th,n=new hc;this.processFlatCoordinates_(e,o,r,n,!0);const a=this.getMaxCoords_(r);if(t.length){let e,i;const s=[];for(e=0,i=t.length;e<i;++e){const r={list:new th,maxCoords:void 0,rtree:new hc};s.push(r),this.processFlatCoordinates_(t[e],o,r.list,r.rtree,!1),this.classifyPoints_(r.list,r.rtree,!0),r.maxCoords=this.getMaxCoords_(r.list)}for(s.sort(function(e,t){return t.maxCoords[0]===e.maxCoords[0]?e.maxCoords[1]-t.maxCoords[1]:t.maxCoords[0]-e.maxCoords[0]}),e=0;e<s.length;++e){const t=s[e].list,o=t.firstItem();let i=o,l;do{if(this.getIntersections_(i,n).length){l=!0;break}i=t.nextItem()}while(o!==i);!l&&this.bridgeHole_(t,s[e].maxCoords[0],r,a[0],n)&&(n.concat(s[e].rtree),this.classifyPoints_(r,n,!1))}}else this.classifyPoints_(r,n,!1);this.triangulate_(r,n)},oh.prototype.processFlatCoordinates_=function(e,t,o,r,a){const s=bo(e,0,e.length,t);let l=this.vertices.length/2,n,i,d,p,g;const _=[],u=[];if(a===s){for(d=this.createPoint_(e[0],e[1],l++),p=d,(n=t,i=e.length);n<i;n+=t)g=this.createPoint_(e[n],e[n+1],l++),u.push(this.insertItem_(p,g,o)),_.push([$l(p.x,g.x),$l(p.y,g.y),id(p.x,g.x),id(p.y,g.y)]),p=g;u.push(this.insertItem_(g,d,o)),_.push([$l(p.x,g.x),$l(p.y,g.y),id(p.x,g.x),id(p.y,g.y)])}else{const r=e.length-t;for(d=this.createPoint_(e[r],e[r+1],l++),p=d,(n=r-t,i=0);n>=i;n-=t)g=this.createPoint_(e[n],e[n+1],l++),u.push(this.insertItem_(p,g,o)),_.push([$l(p.x,g.x),$l(p.y,g.y),id(p.x,g.x),id(p.y,g.y)]),p=g;u.push(this.insertItem_(g,d,o)),_.push([$l(p.x,g.x),$l(p.y,g.y),id(p.x,g.x),id(p.y,g.y)])}r.load(_,u)},oh.prototype.getMaxCoords_=function(e){const t=e.firstItem();let o=t,r=[o.p0.x,o.p0.y];do o=e.nextItem(),o.p0.x>r[0]&&(r=[o.p0.x,o.p0.y]);while(o!==t);return r},oh.prototype.classifyPoints_=function(e,t,o){let r=e.firstItem(),i=r,n=e.nextItem(),a=!1;do{const s=o?Nm(n.p1.x,n.p1.y,i.p1.x,i.p1.y,i.p0.x,i.p0.y):Nm(i.p0.x,i.p0.y,i.p1.x,i.p1.y,n.p1.x,n.p1.y);s===void 0?(this.removeItem_(i,n,e,t),a=!0,n===r&&(r=e.getNextItem()),n=i,e.prevItem()):i.p1.reflex!==s&&(i.p1.reflex=s,a=!0),i=n,n=e.nextItem()}while(i!==r);return a},oh.prototype.bridgeHole_=function(e,t,o,r,n){let a=e.firstItem();for(;a.p1.x!==t;)a=e.nextItem();const s=a.p1,l={x:r,y:s.y,i:-1};let d=Infinity,p,i,g,_;const u=this.getIntersections_({p0:s,p1:l},n,!0);for(p=0,i=u.length;p<i;++p){const e=u[p],t=this.calculateIntersection_(s,l,e.p0,e.p1,!0),o=Hl(s.x-t[0]);o<d&&void 0!==Nm(s.x,s.y,e.p0.x,e.p0.y,e.p1.x,e.p1.y)&&(d=o,_={x:t[0],y:t[1],i:-1},a=e)}if(d===Infinity)return!1;if(g=a.p1,0<d){const e=this.getPointsInTriangle_(s,_,a.p1,n);if(e.length){let t=Infinity;for(p=0,i=e.length;p<i;++p){const o=e[p],r=Wl(s.y-o.y,l.x-o.x);(r<t||r===t&&o.x<g.x)&&(t=r,g=o)}}}for(a=o.firstItem();a.p1.x!==g.x||a.p1.y!==g.y;)a=o.nextItem();const c={x:s.x,y:s.y,i:s.i,reflex:void 0},y={x:a.p1.x,y:a.p1.y,i:a.p1.i,reflex:void 0};return e.getNextItem().p0=c,this.insertItem_(s,a.p1,e,n),this.insertItem_(y,c,e,n),a.p1=y,e.setFirstItem(),o.concat(e),!0},oh.prototype.triangulate_=function(e,t){for(let o=!1,r=this.isSimple_(e,t);3<e.getLength();)if(r){if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t,!0))break;}else if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t))if(r=this.isSimple_(e,t),!r){this.splitPolygon_(e,t);break}else o=!this.isClockwise_(e),this.classifyPoints_(e,t,o);if(3===e.getLength()){let t=this.indices.length;this.indices[t++]=e.getPrevItem().p0.i,this.indices[t++]=e.getCurrItem().p0.i,this.indices[t++]=e.getNextItem().p0.i}},oh.prototype.clipEars_=function(e,t,o,r){let i=this.indices.length,n=e.firstItem(),a=e.getPrevItem(),s=n,l=e.nextItem(),d=e.getNextItem(),p=!1,g,_,u;do{if(g=s.p0,_=s.p1,u=l.p1,!1===_.reflex){let c;c=o?0===this.getPointsInTriangle_(g,_,u,t,!0).length:r?this.diagonalIsInside_(d.p1,u,_,g,a.p0):this.diagonalIsInside_(a.p0,g,_,u,d.p1),(o||0===this.getIntersections_({p0:g,p1:u},t).length)&&c&&(o||!1===g.reflex||!1===u.reflex||bo([a.p0.x,a.p0.y,g.x,g.y,_.x,_.y,u.x,u.y,d.p1.x,d.p1.y],0,10,2)===!r)&&(this.indices[i++]=g.i,this.indices[i++]=_.i,this.indices[i++]=u.i,this.removeItem_(s,l,e,t),l===n&&(n=d),p=!0)}a=e.getPrevItem(),s=e.getCurrItem(),l=e.nextItem(),d=e.getNextItem()}while(s!==n&&3<e.getLength());return p},oh.prototype.resolveSelfIntersections_=function(e,t,o){const r=e.firstItem();e.nextItem();let i=r,n=e.nextItem(),a=!1;do{const s=this.calculateIntersection_(i.p0,i.p1,n.p0,n.p1,o);if(s){let l=!1;const d=this.vertices.length;let g=this.indices.length;const _=e.prevItem();e.removeItem(),t.remove(_),l=_===r;let u;if(o?(s[0]===i.p0.x&&s[1]===i.p0.y?(e.prevItem(),u=i.p0,n.p0=u,t.remove(i),l=l||i===r):(u=n.p1,i.p1=u,t.remove(n),l=l||n===r),e.removeItem()):(u=this.createPoint_(s[0],s[1],d/2),i.p1=u,n.p0=u,t.update([$l(i.p0.x,i.p1.x),$l(i.p0.y,i.p1.y),id(i.p0.x,i.p1.x),id(i.p0.y,i.p1.y)],i),t.update([$l(n.p0.x,n.p1.x),$l(n.p0.y,n.p1.y),id(n.p0.x,n.p1.x),id(n.p0.y,n.p1.y)],n)),this.indices[g++]=_.p0.i,this.indices[g++]=_.p1.i,this.indices[g++]=u.i,a=!0,l)break}i=e.getPrevItem(),n=e.nextItem()}while(i!==r);return a},oh.prototype.isSimple_=function(e,t){const o=e.firstItem();let r=o;do{if(this.getIntersections_(r,t).length)return!1;r=e.nextItem()}while(r!==o);return!0},oh.prototype.isClockwise_=function(e){const t=2*e.getLength(),o=Array(t),r=e.firstItem();let n=r,a=0;do o[a++]=n.p0.x,o[a++]=n.p0.y,n=e.nextItem();while(n!==r);return bo(o,0,t,2)},oh.prototype.splitPolygon_=function(e,t){const o=e.firstItem();let r=o;do{const o=this.getIntersections_(r,t);if(o.length){const i=o[0],a=this.vertices.length/2,n=this.calculateIntersection_(r.p0,r.p1,i.p0,i.p1),s=this.createPoint_(n[0],n[1],a),l=new th,d=new hc;this.insertItem_(s,r.p1,l,d),r.p1=s,t.update([$l(r.p0.x,s.x),$l(r.p0.y,s.y),id(r.p0.x,s.x),id(r.p0.y,s.y)],r);for(let o=e.nextItem();o!==i;)this.insertItem_(o.p0,o.p1,l,d),t.remove(o),e.removeItem(),o=e.getCurrItem();this.insertItem_(i.p0,s,l,d),i.p0=s,t.update([$l(i.p1.x,s.x),$l(i.p1.y,s.y),id(i.p1.x,s.x),id(i.p1.y,s.y)],i),this.classifyPoints_(e,t,!1),this.triangulate_(e,t),this.classifyPoints_(l,d,!1),this.triangulate_(l,d);break}r=e.nextItem()}while(r!==o)},oh.prototype.createPoint_=function(e,t,o){let r=this.vertices.length;this.vertices[r++]=e,this.vertices[r++]=t;return{x:e,y:t,i:o,reflex:void 0}},oh.prototype.insertItem_=function(e,t,o,r){const i={p0:e,p1:t};return o.insertItem(i),r&&r.insert([$l(e.x,t.x),$l(e.y,t.y),id(e.x,t.x),id(e.y,t.y)],i),i},oh.prototype.removeItem_=function(e,t,o,r){o.getCurrItem()===t&&(o.removeItem(),e.p1=t.p1,r.remove(t),r.update([$l(e.p0.x,e.p1.x),$l(e.p0.y,e.p1.y),id(e.p0.x,e.p1.x),id(e.p0.y,e.p1.y)],e))},oh.prototype.getPointsInTriangle_=function(e,t,o,r,n){const a=[],s=r.getInExtent([$l(e.x,t.x,o.x),$l(e.y,t.y,o.y),id(e.x,t.x,o.x),id(e.y,t.y,o.y)]);for(let l=0,i=s.length;l<i;++l)for(const r in s[l]){const i=s[l][r];'object'==typeof i&&(!n||i.reflex)&&(i.x!==e.x||i.y!==e.y)&&(i.x!==t.x||i.y!==t.y)&&(i.x!==o.x||i.y!==o.y)&&-1===a.indexOf(i)&&So([e.x,e.y,t.x,t.y,o.x,o.y],0,6,2,i.x,i.y)&&a.push(i)}return a},oh.prototype.getIntersections_=function(e,t,o){const r=e.p0,n=e.p1,a=t.getInExtent([$l(r.x,n.x),$l(r.y,n.y),id(r.x,n.x),id(r.y,n.y)]),s=[];for(let l=0,i=a.length;l<i;++l){const t=a[l];e!==t&&(o||t.p0!==n||t.p1!==r)&&this.calculateIntersection_(r,n,t.p0,t.p1,o)&&s.push(t)}return s},oh.prototype.calculateIntersection_=function(e,t,o,r,i){const n=(r.y-o.y)*(t.x-e.x)-(r.x-o.x)*(t.y-e.y);if(0!=n){const a=((r.x-o.x)*(e.y-o.y)-(r.y-o.y)*(e.x-o.x))/n,s=((t.x-e.x)*(e.y-o.y)-(t.y-e.y)*(e.x-o.x))/n;if(!i&&a>wm&&a<1-wm&&s>wm&&s<1-wm||i&&0<=a&&1>=a&&0<=s&&1>=s)return[e.x+a*(t.x-e.x),e.y+a*(t.y-e.y)]}},oh.prototype.diagonalIsInside_=function(e,t,o,r,i){if(t.reflex===void 0||r.reflex===void 0)return!1;const n=(o.x-r.x)*(t.y-r.y)>(o.y-r.y)*(t.x-r.x),a=(i.x-r.x)*(t.y-r.y)<(i.y-r.y)*(t.x-r.x),s=(e.x-t.x)*(r.y-t.y)>(e.y-t.y)*(r.x-t.x),l=(o.x-t.x)*(r.y-t.y)<(o.y-t.y)*(r.x-t.x),d=r.reflex?a||n:a&&n,p=t.reflex?l||s:l&&s;return d&&p},oh.prototype.drawMultiPolygon=function(e,t){const o=e.getEndss(),r=e.getStride(),n=this.indices.length,a=this.lineStringReplay.getCurrentIndex(),s=e.getFlatCoordinates();let l=0,d,i,p,g;for(d=0,i=o.length;d<i;++d){const e=o[d];if(0<e.length){const t=ye(s,l,e[0],r,-this.origin[0],-this.origin[1]);if(t.length){const o=[];let i;for(p=1,g=e.length;p<g;++p)e[p]!==e[p-1]&&(i=ye(s,e[p-1],e[p],r,-this.origin[0],-this.origin[1]),o.push(i));this.lineStringReplay.drawPolygonCoordinates(t,o,r),this.drawCoordinates_(t,o,r)}}l=e[e.length-1]}this.indices.length>n&&(this.startIndices.push(n),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(n),this.state_.changed=!1)),this.lineStringReplay.getCurrentIndex()>a&&this.lineStringReplay.setPolygonStyle(t,a)},oh.prototype.drawPolygon=function(e,t){const o=e.getEnds(),r=e.getStride();if(0<o.length){const n=e.getFlatCoordinates().map(Number),a=ye(n,0,o[0],r,-this.origin[0],-this.origin[1]);if(a.length){const e=[];let s,i,l;for(s=1,i=o.length;s<i;++s)o[s]!==o[s-1]&&(l=ye(n,o[s-1],o[s],r,-this.origin[0],-this.origin[1]),e.push(l));this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t),this.state_.changed&&(this.styleIndices_.push(this.indices.length),this.state_.changed=!1),this.lineStringReplay.setPolygonStyle(t),this.lineStringReplay.drawPolygonCoordinates(a,e,r),this.drawCoordinates_(a,e,r)}}},oh.prototype.finish=function(e){this.verticesBuffer=new Mm(this.vertices),this.indicesBuffer=new Mm(this.indices),this.startIndices.push(this.indices.length),this.lineStringReplay.finish(e),0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]),this.vertices=null,this.indices=null},oh.prototype.getDeleteResourcesFunction=function(e){const t=this.verticesBuffer,o=this.indicesBuffer,r=this.lineStringReplay.getDeleteResourcesFunction(e);return function(){e.deleteBuffer(t),e.deleteBuffer(o),r()}},oh.prototype.setUpProgram=function(e,t){const o=t.getProgram(Jm,Qm);let r;return this.defaultLocations_?r=this.defaultLocations_:(r=new $m(e,o),this.defaultLocations_=r),t.useProgram(o),e.enableVertexAttribArray(r.a_position),e.vertexAttribPointer(r.a_position,2,_d,!1,8,0),r},oh.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position)},oh.prototype.drawReplay=function(e,t,o,r){const i=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK);if(r||(e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.NOTEQUAL)),!l(o))this.drawReplaySkipping_(e,t,o);else{let o,r,i,n;for(i=this.startIndices[this.startIndices.length-1],o=this.styleIndices_.length-1;0<=o;--o)r=this.styleIndices_[o],n=this.styles_[o],this.setFillStyle_(e,n),this.drawElements(e,t,r,i),i=r}r||(e.disable(e.DEPTH_TEST),e.clear(e.DEPTH_BUFFER_BIT),e.depthMask(n),e.depthFunc(i))},oh.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,a){let s,i,l,d,p,g,_,u;for(u=this.startIndices.length-2,l=this.startIndices[u+1],s=this.styleIndices_.length-1;0<=s;--s)for(d=this.styles_[s],this.setFillStyle_(e,d),p=this.styleIndices_[s];0<=u&&this.startIndices[u]>=p;){if(i=this.startIndices[u],g=this.startIndicesFeature[u],_=n(g).toString(),void 0===o[_]&&g.getGeometry()&&(void 0===a||ae(a,g.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.drawElements(e,t,i,l);const o=r(g);if(o)return o}u--,l=i}},oh.prototype.drawReplaySkipping_=function(e,t,o){let r,i,a,s,l,d,p,g,_;for(g=this.startIndices.length-2,a=i=this.startIndices[g+1],r=this.styleIndices_.length-1;0<=r;--r){for(s=this.styles_[r],this.setFillStyle_(e,s),l=this.styleIndices_[r];0<=g&&this.startIndices[g]>=l;)_=this.startIndices[g],d=this.startIndicesFeature[g],p=n(d).toString(),o[p]&&(i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),a=_),g--,i=_;i!==a&&(this.drawElements(e,t,i,a),e.clear(e.DEPTH_BUFFER_BIT)),i=a=l}},oh.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_color,t)},oh.prototype.setFillStrokeStyle=function(e,t){let o=e?e.getColor():[0,0,0,0];if(o=o instanceof CanvasGradient||o instanceof CanvasPattern?Cm:yt(o).map(function(e,t){return 3==t?e:e/255})||Cm,this.state_.fillColor&&zt(o,this.state_.fillColor)||(this.state_.fillColor=o,this.state_.changed=!0,this.styles_.push(o)),t)this.lineStringReplay.setFillStrokeStyle(null,t);else{const e=new fg({color:[0,0,0,0],lineWidth:0});this.lineStringReplay.setFillStrokeStyle(null,e)}};const rh=function(e,t){this.space_=t,this.emptyBlocks_=[{x:0,y:0,width:e,height:e}],this.entries_={},this.context_=Tt(e,e),this.canvas_=this.context_.canvas};rh.prototype.get=function(e){return this.entries_[e]||null},rh.prototype.add=function(e,t,o,r,n){for(let a=0,i=this.emptyBlocks_.length;a<i;++a){const i=this.emptyBlocks_[a];if(i.width>=t+this.space_&&i.height>=o+this.space_){const s={offsetX:i.x+this.space_,offsetY:i.y+this.space_,image:this.canvas_};return this.entries_[e]=s,r.call(n,this.context_,i.x+this.space_,i.y+this.space_),this.split_(a,i,t+this.space_,o+this.space_),s}}return null},rh.prototype.split_=function(e,t,o,r){const i=t.width-o,n=t.height-r;let a,s;i>n?(a={x:t.x+o,y:t.y,width:t.width-o,height:t.height},s={x:t.x,y:t.y+r,width:o,height:t.height-r},this.updateBlocks_(e,a,s)):(a={x:t.x+o,y:t.y,width:t.width-o,height:r},s={x:t.x,y:t.y+r,width:t.width,height:t.height-r},this.updateBlocks_(e,a,s))},rh.prototype.updateBlocks_=function(e,t,o){const r=[e,1];0<t.width&&0<t.height&&r.push(t),0<o.width&&0<o.height&&r.push(o),this.emptyBlocks_.splice.apply(this.emptyBlocks_,r)};var ih=rh;const nh=-1,ah=function(e){const t=e||{};this.currentSize_=t.initialSize===void 0?256:t.initialSize,this.maxSize_=t.maxSize===void 0?Id===void 0?2048:Id:t.maxSize,this.space_=t.space===void 0?1:t.space,this.atlases_=[new ih(this.currentSize_,this.space_)],this.currentHitSize_=this.currentSize_,this.hitAtlases_=[new ih(this.currentHitSize_,this.space_)]};ah.prototype.getInfo=function(e){const t=this.getInfo_(this.atlases_,e);if(!t)return null;const o=this.getInfo_(this.hitAtlases_,e);return this.mergeInfos_(t,o)},ah.prototype.getInfo_=function(e,t){for(let o=0,r=e.length;o<r;++o){const r=e[o],i=r.get(t);if(i)return i}return null},ah.prototype.mergeInfos_=function(e,t){return{offsetX:e.offsetX,offsetY:e.offsetY,image:e.image,hitImage:t.image}},ah.prototype.add=function(e,t,o,r,i,n){if(t+this.space_>this.maxSize_||o+this.space_>this.maxSize_)return null;const a=this.add_(!1,e,t,o,r,n);if(!a)return null;const s=i===void 0?T:i,l=this.add_(!0,e,t,o,s,n);return this.mergeInfos_(a,l)},ah.prototype.add_=function(e,t,o,r,n,a){const s=e?this.hitAtlases_:this.atlases_;let l,d,p,i;for(p=0,i=s.length;p<i;++p){if(l=s[p],d=l.add(t,o,r,n,a),d)return d;if(!d&&p===i-1){let t;e?(t=$l(2*this.currentHitSize_,this.maxSize_),this.currentHitSize_=t):(t=$l(2*this.currentSize_,this.maxSize_),this.currentSize_=t),l=new ih(t,this.space_),s.push(l),++i}}return null};var sh=ah;const lh=function(e,t){Vm.call(this,e,t),this.images_=[],this.textures_=[],this.measureCanvas_=Tt(0,0).canvas,this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_='',this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.atlases_={},this.currAtlas_=void 0,this.scale=1,this.opacity=1};i(lh,Vm),lh.prototype.drawText=function(e,t){if(this.text_){let o=null;let r=2,a=2;switch(e.getType()){case ep.POINT:case ep.MULTI_POINT:o=e.getFlatCoordinates(),r=o.length,a=e.getStride();break;case ep.CIRCLE:o=e.getCenter();break;case ep.LINE_STRING:o=e.getFlatMidpoint();break;case ep.MULTI_LINE_STRING:o=e.getFlatMidpoints(),r=o.length;break;case ep.POLYGON:o=e.getFlatInteriorPoint();break;case ep.MULTI_POLYGON:o=e.getFlatInteriorPoints(),r=o.length;break;default:}this.startIndices.push(this.indices.length),this.startIndicesFeature.push(t);const s=this.currAtlas_,l=this.text_.split('\n'),d=this.getTextSize_(l);let p,i,g,_,u,c,y,m;const h=Vl(d[0]*this.textAlign_-this.offsetX_),f=Vl(d[1]*this.textBaseline_-this.offsetY_),x=this.state_.lineWidth/2*this.state_.scale;for(p=0,i=l.length;p<i;++p)for(u=0,c=s.height*p,y=l[p].split(''),(g=0,_=y.length);g<_;++g){if(m=s.atlas.getInfo(y[g]),m){const e=m.image;if(this.anchorX=h-u,this.anchorY=f-c,this.originX=0===g?m.offsetX-x:m.offsetX,this.originY=m.offsetY,this.height=s.height,this.width=0===g||g===y.length-1?s.width[y[g]]+x:s.width[y[g]],this.imageHeight=e.height,this.imageWidth=e.width,0===this.images_.length)this.images_.push(e);else{const t=this.images_[this.images_.length-1];n(t)!=n(e)&&(this.groupIndices.push(this.indices.length),this.images_.push(e))}this.drawText_(o,0,r,a)}u+=this.width}}},lh.prototype.getTextSize_=function(e){const t=this,o=this.currAtlas_,r=e.length*o.height,i=e.map(function(e){let r=0;for(let n=0,i=e.length;n<i;++n){const i=e[n];o.width[i]||t.addCharToAtlas_(i),r+=o.width[i]?o.width[i]:0}return r}).reduce(function(e,t){return id(e,t)});return[i,r]},lh.prototype.drawText_=function(e,t,o,r){for(let n=t;n<o;n+=r)this.drawCoordinates(e,t,o,r)},lh.prototype.addCharToAtlas_=function(e){if(1===e.length){const t=this.currAtlas_,o=this.state_,r=this.measureCanvas_.getContext('2d');r.font=o.font;const i=rd(r.measureText(e).width*o.scale),n=t.atlas.add(e,i,t.height,function(t,r,i){t.font=o.font,t.fillStyle=o.fillColor,t.strokeStyle=o.strokeColor,t.lineWidth=o.lineWidth,t.lineCap=o.lineCap,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.textAlign='left',t.textBaseline='top',Op&&o.lineDash&&(t.setLineDash(o.lineDash),t.lineDashOffset=o.lineDashOffset),1!==o.scale&&t.setTransform(o.scale,0,0,o.scale,0,0),o.strokeColor&&t.strokeText(e,r,i),o.fillColor&&t.fillText(e,r,i)});n&&(t.width[e]=i)}},lh.prototype.finish=function(e){const t=e.getGL();this.groupIndices.push(this.indices.length),this.hitDetectionGroupIndices=this.groupIndices,this.verticesBuffer=new Mm(this.vertices),this.indicesBuffer=new Mm(this.indices);this.createTextures(this.textures_,this.images_,{},t),this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0},this.text_='',this.textAlign_=void 0,this.textBaseline_=void 0,this.offsetX_=void 0,this.offsetY_=void 0,this.images_=null,this.atlases_={},this.currAtlas_=void 0,Vm.prototype.finish.call(this,e)},lh.prototype.setTextStyle=function(e){const t=this.state_,o=e.getFill(),r=e.getStroke();if(!e||!e.getText()||!o&&!r)this.text_='';else{if(!o)t.fillColor=null;else{const e=o.getColor();t.fillColor=xt(e?e:Cm)}if(!r)t.strokeColor=null,t.lineWidth=0;else{const e=r.getColor();t.strokeColor=xt(e?e:Fm),t.lineWidth=r.getWidth()||Om,t.lineCap=r.getLineCap()||Rm,t.lineDashOffset=r.getLineDashOffset()||Lm,t.lineJoin=r.getLineJoin()||Pm,t.miterLimit=r.getMiterLimit()||vm;const o=r.getLineDash();t.lineDash=o?o.slice():Im}t.font=e.getFont()||'10px sans-serif',t.scale=e.getScale()||1,this.text_=e.getText();const i=Cy[e.getTextAlign()],n=Cy[e.getTextBaseline()];this.textAlign_=i===void 0?.5:i,this.textBaseline_=n===void 0?.5:n,this.offsetX_=e.getOffsetX()||0,this.offsetY_=e.getOffsetY()||0,this.rotateWithView=!!e.getRotateWithView(),this.rotation=e.getRotation()||0,this.currAtlas_=this.getAtlas_(t)}},lh.prototype.getAtlas_=function(e){let t=[];for(const o in e)(e[o]||0===e[o])&&(Array.isArray(e[o])?t=t.concat(e[o]):t.push(e[o]));const o=this.calculateHash_(t);if(!this.atlases_[o]){const t=this.measureCanvas_.getContext('2d');t.font=e.font;const r=rd((1.5*t.measureText('M').width+e.lineWidth/2)*e.scale);this.atlases_[o]={atlas:new sh({space:e.lineWidth+1}),width:{},height:r}}return this.atlases_[o]},lh.prototype.calculateHash_=function(e){let t='';for(let o=0,r=e.length;o<r;++o)t+=e[o];return t},lh.prototype.getTextures=function(){return this.textures_},lh.prototype.getHitDetectionTextures=function(){return this.textures_};const dh=[1,1],ph={Circle:Gm,Image:zm,LineString:qm,Polygon:oh,Text:lh},gh=function(e,t,o){cy.call(this),this.maxExtent_=t,this.tolerance_=e,this.renderBuffer_=o,this.replaysByZIndex_={}};i(gh,cy),gh.prototype.addDeclutter=function(){},gh.prototype.getDeleteResourcesFunction=function(e){const t=[];for(var o in this.replaysByZIndex_){const r=this.replaysByZIndex_[o];for(const o in r)t.push(r[o].getDeleteResourcesFunction(e))}return function(){const e=t.length;let o;for(let r=0;r<e;r++)o=t[r].apply(this,arguments);return o}},gh.prototype.finish=function(e){for(var t in this.replaysByZIndex_){const o=this.replaysByZIndex_[t];for(const t in o)o[t].finish(e)}},gh.prototype.getReplay=function(e,t){const o=e===void 0?'0':e.toString();let r=this.replaysByZIndex_[o];r===void 0&&(r={},this.replaysByZIndex_[o]=r);let i=r[t];if(i===void 0){const e=ph[t];i=new e(this.tolerance_,this.maxExtent_),r[t]=i}return i},gh.prototype.isEmpty=function(){return l(this.replaysByZIndex_)},gh.prototype.replay=function(e,t,o,r,n,a,s,l){const d=Object.keys(this.replaysByZIndex_).map(Number);d.sort(Dt);let p,i,g,_,u,c;for(p=0,i=d.length;p<i;++p)for(u=this.replaysByZIndex_[d[p].toString()],g=0,_=Sy.length;g<_;++g)c=u[Sy[g]],void 0!==c&&c.replay(e,t,o,r,n,a,s,l,void 0,!1)},gh.prototype.replayHitDetection_=function(e,t,o,r,n,a,s,l,d,p,g){const _=Object.keys(this.replaysByZIndex_).map(Number);_.sort(function(e,t){return t-e});let u,i,c,y,m,h;for(u=0,i=_.length;u<i;++u)for(y=this.replaysByZIndex_[_[u].toString()],c=Sy.length-1;0<=c;--c)if(m=y[Sy[c]],void 0!==m&&(h=m.replay(e,t,o,r,n,a,s,l,d,p,g),h))return h},gh.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i,n,a,s,l,d){const p=t.getGL();p.bindFramebuffer(p.FRAMEBUFFER,t.getHitDetectionFramebuffer());let g;return void 0!==this.renderBuffer_&&(g=P(k(e),r*this.renderBuffer_)),this.replayHitDetection_(t,e,r,i,dh,a,s,l,function(e){const t=new Uint8Array(4);if(p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,t),0<t[3]){const t=d(e);if(t)return t}},!0,g)},gh.prototype.hasFeatureAtCoordinate=function(e,t,o,r,i,n,a,s,l){const d=t.getGL();d.bindFramebuffer(d.FRAMEBUFFER,t.getHitDetectionFramebuffer());const p=this.replayHitDetection_(t,e,r,i,dh,a,s,l,function(){const e=new Uint8Array(4);return d.readPixels(0,0,1,1,d.RGBA,d.UNSIGNED_BYTE,e),0<e[3]},!1);return p!==void 0};var _h=gh;const uh=function(e,t,o,r,i,n,a){Wc.call(this),this.context_=e,this.center_=t,this.extent_=n,this.pixelRatio_=a,this.size_=i,this.rotation_=r,this.resolution_=o,this.imageStyle_=null,this.fillStyle_=null,this.strokeStyle_=null,this.textStyle_=null};i(uh,Wc),uh.prototype.drawText_=function(e,t){const o=this.context_,r=e.getReplay(0,yy.TEXT);r.setTextStyle(this.textStyle_),r.drawText(t,null),r.finish(o);let i;r.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},i,!1),r.getDeleteResourcesFunction(o)()},uh.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())},uh.prototype.drawGeometry=function(e){const t=e.getType();switch(t){case ep.POINT:this.drawPoint(e,null);break;case ep.LINE_STRING:this.drawLineString(e,null);break;case ep.POLYGON:this.drawPolygon(e,null);break;case ep.MULTI_POINT:this.drawMultiPoint(e,null);break;case ep.MULTI_LINE_STRING:this.drawMultiLineString(e,null);break;case ep.MULTI_POLYGON:this.drawMultiPolygon(e,null);break;case ep.GEOMETRY_COLLECTION:this.drawGeometryCollection(e,null);break;case ep.CIRCLE:this.drawCircle(e,null);break;default:}},uh.prototype.drawFeature=function(e,t){const o=t.getGeometryFunction()(e);o&&ae(this.extent_,o.getExtent())&&(this.setStyle(t),this.drawGeometry(o))},uh.prototype.drawGeometryCollection=function(e){const t=e.getGeometriesArray();let o,r;for(o=0,r=t.length;o<r;++o)this.drawGeometry(t[o])},uh.prototype.drawPoint=function(e,t){const o=this.context_,r=new _h(1,this.extent_),i=r.getReplay(0,yy.IMAGE);i.setImageStyle(this.imageStyle_),i.drawPoint(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},uh.prototype.drawMultiPoint=function(e,t){const o=this.context_,r=new _h(1,this.extent_),i=r.getReplay(0,yy.IMAGE);i.setImageStyle(this.imageStyle_),i.drawMultiPoint(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},uh.prototype.drawLineString=function(e,t){const o=this.context_,r=new _h(1,this.extent_),i=r.getReplay(0,yy.LINE_STRING);i.setFillStrokeStyle(null,this.strokeStyle_),i.drawLineString(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},uh.prototype.drawMultiLineString=function(e,t){const o=this.context_,r=new _h(1,this.extent_),i=r.getReplay(0,yy.LINE_STRING);i.setFillStrokeStyle(null,this.strokeStyle_),i.drawMultiLineString(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},uh.prototype.drawPolygon=function(e,t){const o=this.context_,r=new _h(1,this.extent_),i=r.getReplay(0,yy.POLYGON);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),i.drawPolygon(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},uh.prototype.drawMultiPolygon=function(e,t){const o=this.context_,r=new _h(1,this.extent_),i=r.getReplay(0,yy.POLYGON);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),i.drawMultiPolygon(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},uh.prototype.drawCircle=function(e,t){const o=this.context_,r=new _h(1,this.extent_),i=r.getReplay(0,yy.CIRCLE);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_),i.drawCircle(e,t),i.finish(o);let n;i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},n,!1),i.getDeleteResourcesFunction(o)(),this.textStyle_&&this.drawText_(r,e)},uh.prototype.setImageStyle=function(e){this.imageStyle_=e},uh.prototype.setFillStrokeStyle=function(e,t){this.fillStyle_=e,this.strokeStyle_=t},uh.prototype.setTextStyle=function(e){this.textStyle_=e};var ch=uh;const yh=new ym('precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n'),mh=new hm('varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n');var hh=function(e,t){this.u_texCoordMatrix=e.getUniformLocation(t,'u_texCoordMatrix'),this.u_projectionMatrix=e.getUniformLocation(t,'u_projectionMatrix'),this.u_opacity=e.getUniformLocation(t,'u_opacity'),this.u_texture=e.getUniformLocation(t,'u_texture'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_texCoord=e.getAttribLocation(t,'a_texCoord')};const fh=function(e,t){qc.call(this,t),this.mapRenderer=e,this.arrayBuffer_=new Mm([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0,this.texCoordMatrix=tt(),this.projectionMatrix=tt(),this.tmpMat4_=In(),this.defaultLocations_=null};i(fh,qc),fh.prototype.bindFramebuffer=function(e,t){const o=this.mapRenderer.getGL();if(this.framebufferDimension===void 0||this.framebufferDimension!=t){const r=function(e,t,o){e.isContextLost()||(e.deleteFramebuffer(t),e.deleteTexture(o))}.bind(null,o,this.framebuffer,this.texture);e.postRenderFunctions.push(r);const i=vn(o,t,t),n=o.createFramebuffer();o.bindFramebuffer(Td,n),o.framebufferTexture2D(Td,36064,xd,i,0),this.texture=i,this.framebuffer=n,this.framebufferDimension=t}else o.bindFramebuffer(Td,this.framebuffer)},fh.prototype.composeFrame=function(e,t,o){this.dispatchComposeEvent_(Dg.PRECOMPOSE,o,e),o.bindBuffer(ld,this.arrayBuffer_);const r=o.getGL(),i=o.getProgram(yh,mh);let n;this.defaultLocations_?n=this.defaultLocations_:(n=new hh(r,i),this.defaultLocations_=n),o.useProgram(i)&&(r.enableVertexAttribArray(n.a_position),r.vertexAttribPointer(n.a_position,2,_d,!1,16,0),r.enableVertexAttribArray(n.a_texCoord),r.vertexAttribPointer(n.a_texCoord,2,_d,!1,16,8),r.uniform1i(n.u_texture,0)),r.uniformMatrix4fv(n.u_texCoordMatrix,!1,Ln(this.tmpMat4_,this.getTexCoordMatrix())),r.uniformMatrix4fv(n.u_projectionMatrix,!1,Ln(this.tmpMat4_,this.getProjectionMatrix())),r.uniform1f(n.u_opacity,t.opacity),r.bindTexture(xd,this.getTexture()),r.drawArrays(ad,0,4),this.dispatchComposeEvent_(Dg.POSTCOMPOSE,o,e)},fh.prototype.dispatchComposeEvent_=function(e,t,o){const r=this.getLayer();if(r.hasListener(e)){const i=o.viewState,n=i.resolution,a=o.pixelRatio,s=o.extent,l=i.center,d=i.rotation,p=o.size,g=new ch(t,l,n,d,p,s,a),_=new zc(e,g,o,null,t);r.dispatchEvent(_)}},fh.prototype.getTexCoordMatrix=function(){return this.texCoordMatrix},fh.prototype.getTexture=function(){return this.texture},fh.prototype.getProjectionMatrix=function(){return this.projectionMatrix},fh.prototype.handleWebGLContextLost=function(){this.texture=null,this.framebuffer=null,this.framebufferDimension=void 0},fh.prototype.prepareFrame=function(){},fh.prototype.forEachLayerAtPixel=function(){};var xh=fh;const Eh=function(e,t){xh.call(this,e,t),this.image_=null,this.hitCanvasContext_=null,this.hitTransformationMatrix_=null};i(Eh,xh),Eh.handles=function(e){return e.getType()===nc.IMAGE},Eh.create=function(e,t){return new Eh(e,t)},Eh.prototype.createTexture_=function(e){const t=e.getImage(),o=this.mapRenderer.getGL();return Fn(o,t,Ed,Ed)},Eh.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){const n=this.getLayer(),a=n.getSource(),s=t.viewState.resolution,l=t.viewState.rotation,d=t.skippedFeatureUids;return a.forEachFeatureAtCoordinate(e,s,l,o,d,function(e){return r.call(i,e,n)})},Eh.prototype.prepareFrame=function(e,t){const o=this.mapRenderer.getGL(),r=e.pixelRatio,i=e.viewState,n=i.center,a=i.resolution,s=i.rotation;let l=this.image_,d=this.texture;const p=this.getLayer(),g=p.getSource(),_=e.viewHints;let u=e.extent;if(void 0!==t.extent&&(u=oe(u,t.extent)),!_[M_.ANIMATING]&&!_[M_.INTERACTING]&&!se(u)){let t=i.projection;const n=g.getImage(u,a,r,t);if(n){const t=this.loadImage(n);if(t&&(l=n,d=this.createTexture_(n),this.texture)){const t=function(e,t){e.isContextLost()||e.deleteTexture(t)}.bind(null,o,this.texture);e.postRenderFunctions.push(t)}}}if(l){const e=this.mapRenderer.getContext().getCanvas();this.updateProjectionMatrix_(e.width,e.height,r,n,a,s,l.getExtent()),this.hitTransformationMatrix_=null;const t=this.texCoordMatrix;ot(t),lt(t,1,-1),dt(t,0,-1),this.image_=l,this.texture=d}return!!l},Eh.prototype.updateProjectionMatrix_=function(e,t,o,r,i,n,a){const s=this.projectionMatrix;ot(s),lt(s,2*o/(e*i),2*o/(t*i)),st(s,-n),dt(s,a[0]-r[0],a[1]-r[1]),lt(s,(a[2]-a[0])/2,(a[3]-a[1])/2),dt(s,1,1)},Eh.prototype.hasFeatureAtCoordinate=function(e,t){const o=this.forEachFeatureAtCoordinate(e,t,0,E,this);return o!==void 0},Eh.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.image_&&this.image_.getImage())if(this.getLayer().getSource().forEachFeatureAtCoordinate!==T){const i=at(t.pixelToCoordinateTransform,e.slice()),n=this.forEachFeatureAtCoordinate(i,t,0,E,this);return n?o.call(r,this.getLayer(),null):void 0}else{const i=[this.image_.getImage().width,this.image_.getImage().height];this.hitTransformationMatrix_||(this.hitTransformationMatrix_=this.getHitTransformationMatrix_(t.size,i));const n=at(this.hitTransformationMatrix_,e.slice());if(0>n[0]||n[0]>i[0]||0>n[1]||n[1]>i[1])return;this.hitCanvasContext_||(this.hitCanvasContext_=Tt(1,1)),this.hitCanvasContext_.clearRect(0,0,1,1),this.hitCanvasContext_.drawImage(this.image_.getImage(),n[0],n[1],1,1,0,0,1,1);const a=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<a[3]?o.call(r,this.getLayer(),a):void 0}},Eh.prototype.getHitTransformationMatrix_=function(e,t){const o=tt();dt(o,-1,-1),lt(o,2/e[0],2/e[1]),dt(o,0,e[1]),lt(o,1,-1);const r=gt(this.projectionMatrix.slice()),i=tt();return dt(i,0,t[1]),lt(i,1,-1),lt(i,t[0]/2,t[1]/2),dt(i,1,1),rt(i,r),rt(i,o),i};var Th=Eh;const Sh=1024,Ch=function(e){ay.call(this,e);const t=e.getViewport();this.canvas_=document.createElement('CANVAS'),this.canvas_.style.width='100%',this.canvas_.style.height='100%',this.canvas_.style.display='block',this.canvas_.className=kp,t.insertBefore(this.canvas_,t.childNodes[0]||null),this.clipTileCanvasWidth_=0,this.clipTileCanvasHeight_=0,this.clipTileContext_=Tt(),this.renderedVisible_=!0,this.gl_=r(this.canvas_,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0}),this.context_=new jm(this.canvas_,this.gl_),c(this.canvas_,Ym.LOST,this.handleWebGLContextLost,this),c(this.canvas_,Ym.RESTORED,this.handleWebGLContextRestored,this),this.textureCache_=new Vp,this.focus_=null,this.tileTextureQueue_=new O_(function(e){const t=e[1],o=e[2],r=t[0]-this.focus_[0],i=t[1]-this.focus_[1];return 65536*od(o)+ed(r*r+i*i)/o}.bind(this),function(e){return e[0].getKey()}),this.loadNextTileTexture_=function(){if(!this.tileTextureQueue_.isEmpty()){this.tileTextureQueue_.reprioritize();const e=this.tileTextureQueue_.dequeue(),t=e[0],o=e[3],r=e[4];this.bindTileTexture(t,o,r,cd,cd)}return!1}.bind(this),this.textureCacheFrameMarkerCount_=0,this.initializeGL_()};i(Ch,ay),Ch.prototype.bindTileTexture=function(e,t,o,r,i){const n=this.getGL(),a=e.getKey();if(this.textureCache_.containsKey(a)){const e=this.textureCache_.get(a);n.bindTexture(xd,e.texture),e.magFilter!=r&&(n.texParameteri(xd,yd,r),e.magFilter=r),e.minFilter!=i&&(n.texParameteri(xd,md,i),e.minFilter=i)}else{const s=n.createTexture();if(n.bindTexture(xd,s),0<o){const r=this.clipTileContext_.canvas,i=this.clipTileContext_;this.clipTileCanvasWidth_!==t[0]||this.clipTileCanvasHeight_!==t[1]?(r.width=t[0],r.height=t[1],this.clipTileCanvasWidth_=t[0],this.clipTileCanvasHeight_=t[1]):i.clearRect(0,0,t[0],t[1]),i.drawImage(e.getImage(),o,o,t[0],t[1],0,0,t[0],t[1]),n.texImage2D(xd,0,ud,ud,gd,r)}else n.texImage2D(xd,0,ud,ud,gd,e.getImage());n.texParameteri(xd,yd,r),n.texParameteri(xd,md,i),n.texParameteri(xd,hd,Ed),n.texParameteri(xd,fd,Ed),this.textureCache_.set(a,{texture:s,magFilter:r,minFilter:i})}},Ch.prototype.dispatchComposeEvent_=function(e,t){const o=this.getMap();if(o.hasListener(e)){const r=this.context_,i=t.extent,n=t.size,a=t.viewState,s=t.pixelRatio,l=a.resolution,d=a.center,p=a.rotation,g=new ch(r,d,l,p,n,i,s),_=new zc(e,g,t,null,r);o.dispatchEvent(_)}},Ch.prototype.disposeInternal=function(){const e=this.getGL();e.isContextLost()||this.textureCache_.forEach(function(t){t&&e.deleteTexture(t.texture)}),this.context_.dispose(),ay.prototype.disposeInternal.call(this)},Ch.prototype.expireCache_=function(e,t){const o=this.getGL();for(let r;this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>Sh;){if(r=this.textureCache_.peekLast(),!!r)o.deleteTexture(r.texture);else if(+this.textureCache_.peekLastKey()==t.index)break;else--this.textureCacheFrameMarkerCount_;this.textureCache_.pop()}},Ch.prototype.getContext=function(){return this.context_},Ch.prototype.getGL=function(){return this.gl_},Ch.prototype.getTileTextureQueue=function(){return this.tileTextureQueue_},Ch.prototype.handleWebGLContextLost=function(e){e.preventDefault(),this.textureCache_.clear(),this.textureCacheFrameMarkerCount_=0;const t=this.getLayerRenderers();for(const o in t){const e=t[o];e.handleWebGLContextLost()}},Ch.prototype.handleWebGLContextRestored=function(){this.initializeGL_(),this.getMap().render()},Ch.prototype.initializeGL_=function(){const e=this.gl_;e.activeTexture(33984),e.blendFuncSeparate(770,sd,1,sd),e.disable(2884),e.disable(2929),e.disable(3089),e.disable(2960)},Ch.prototype.isTileTextureLoaded=function(e){return this.textureCache_.containsKey(e.getKey())},Ch.prototype.renderFrame=function(e){const t=this.getContext(),o=this.getGL();if(o.isContextLost())return!1;if(!e)return this.renderedVisible_&&(this.canvas_.style.display='none',this.renderedVisible_=!1),!1;this.focus_=e.focus,this.textureCache_.set((-e.index).toString(),null),++this.textureCacheFrameMarkerCount_,this.dispatchComposeEvent_(Dg.PRECOMPOSE,e);const r=[],n=e.layerStatesArray;Xt(n,on);const a=e.viewState.resolution;let s,i,l,d;for(s=0,i=n.length;s<i;++s)d=n[s],br(d,a)&&d.sourceState==V_.READY&&(l=this.getLayerRenderer(d.layer),l.prepareFrame(e,d,t)&&r.push(d));const p=e.size[0]*e.pixelRatio,g=e.size[1]*e.pixelRatio;for((this.canvas_.width!=p||this.canvas_.height!=g)&&(this.canvas_.width=p,this.canvas_.height=g),o.bindFramebuffer(Td,null),o.clearColor(0,0,0,0),o.clear(nd),o.enable(pd),o.viewport(0,0,this.canvas_.width,this.canvas_.height),(s=0,i=r.length);s<i;++s)d=r[s],l=this.getLayerRenderer(d.layer),l.composeFrame(e,d,t);this.renderedVisible_||(this.canvas_.style.display='',this.renderedVisible_=!0),this.calculateMatrices2D(e),this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>Sh&&e.postRenderFunctions.push(this.expireCache_.bind(this)),this.tileTextureQueue_.isEmpty()||(e.postRenderFunctions.push(this.loadNextTileTexture_),e.animate=!0),this.dispatchComposeEvent_(Dg.POSTCOMPOSE,e),this.scheduleRemoveUnusedLayerRenderers(e),this.scheduleExpireIconCache(e)},Ch.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,n,a,s){let l;if(this.getGL().isContextLost())return!1;const d=t.viewState,p=t.layerStatesArray,g=p.length;let _;for(_=g-1;0<=_;--_){const i=p[_],g=i.layer;if(br(i,d.resolution)&&a.call(s,g)){const i=this.getLayerRenderer(g);if(l=i.forEachFeatureAtCoordinate(e,t,o,r,n),l)return l}}},Ch.prototype.hasFeatureAtCoordinate=function(e,t,o,r,n){let a=!1;if(this.getGL().isContextLost())return!1;const s=t.viewState,l=t.layerStatesArray,d=l.length;let p;for(p=d-1;0<=p;--p){const o=l[p],i=o.layer;if(br(o,s.resolution)&&r.call(n,i)){const o=this.getLayerRenderer(i);if(a=o.hasFeatureAtCoordinate(e,t),a)return!0}}return a},Ch.prototype.forEachLayerAtPixel=function(e,t,o,r,n){if(this.getGL().isContextLost())return!1;const a=t.viewState;let s;const l=t.layerStatesArray,d=l.length;let p;for(p=d-1;0<=p;--p){const i=l[p],d=i.layer;if(br(i,a.resolution)&&n.call(r,d)){const i=this.getLayerRenderer(d);if(s=i.forEachLayerAtPixel(e,t,o,r),s)return s}}};var Rh=Ch;const Ih=new ym('precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n'),Lh=new hm('varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n');var Ph=function(e,t){this.u_tileOffset=e.getUniformLocation(t,'u_tileOffset'),this.u_texture=e.getUniformLocation(t,'u_texture'),this.a_position=e.getAttribLocation(t,'a_position'),this.a_texCoord=e.getAttribLocation(t,'a_texCoord')};const vh=function(e,t){xh.call(this,e,t),this.fragmentShader_=Ih,this.vertexShader_=Lh,this.locations_=null,this.renderArrayBuffer_=new Mm([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]),this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,this.tmpSize_=[0,0]};i(vh,xh),vh.handles=function(e){return e.getType()===nc.TILE},vh.create=function(e,t){return new vh(e,t)},vh.prototype.disposeInternal=function(){const e=this.mapRenderer.getContext();e.deleteBuffer(this.renderArrayBuffer_),xh.prototype.disposeInternal.call(this)},vh.prototype.createLoadedTileFinder=function(e,t,o){const r=this.mapRenderer;return function(i,n){return e.forEachLoadedTile(t,i,n,function(e){const t=r.isTileTextureLoaded(e);return t&&(!o[i]&&(o[i]={}),o[i][e.tileCoord.toString()]=e),t})}},vh.prototype.handleWebGLContextLost=function(){xh.prototype.handleWebGLContextLost.call(this),this.locations_=null},vh.prototype.prepareFrame=function(e,t,o){const r=this.mapRenderer,i=o.getGL(),n=e.viewState,a=n.projection,s=this.getLayer(),l=s.getSource(),d=l.getTileGridForProjection(a),p=d.getZForResolution(n.resolution),g=d.getResolution(p),_=l.getTilePixelSize(p,e.pixelRatio,a),u=_[0]/Nr(d.getTileSize(p),this.tmpSize_)[0],c=g/u,y=l.getTilePixelRatio(u)*l.getGutter(a),m=n.center,h=e.extent,f=d.getTileRangeForExtentAndZ(h,p);let E;if(this.renderedTileRange_&&this.renderedTileRange_.equals(f)&&this.renderedRevision_==l.getRevision())E=this.renderedFramebufferExtent_;else{const n=f.getSize(),g=id(n[0]*_[0],n[1]*_[1]),m=he(g),h=c*m,T=d.getOrigin(p),S=T[0]+f.minX*_[0]*c,C=T[1]+f.minY*_[1]*c;E=[S,C,S+h,C+h],this.bindFramebuffer(e,m),i.viewport(0,0,m,m),i.clearColor(0,0,0,0),i.clear(nd),i.disable(pd);const R=o.getProgram(this.fragmentShader_,this.vertexShader_);o.useProgram(R),this.locations_||(this.locations_=new Ph(i,R)),o.bindBuffer(ld,this.renderArrayBuffer_),i.enableVertexAttribArray(this.locations_.a_position),i.vertexAttribPointer(this.locations_.a_position,2,_d,!1,16,0),i.enableVertexAttribArray(this.locations_.a_texCoord),i.vertexAttribPointer(this.locations_.a_texCoord,2,_d,!1,16,8),i.uniform1i(this.locations_.u_texture,0);const I={};I[p]={};const L=this.createLoadedTileFinder(l,a,I),P=s.getUseInterimTilesOnError();let v=!0;const F=b(),O=new py(0,0,0,0);let w,N,A,M,G,D,x,k;for(D=f.minX;D<=f.maxX;++D)for(x=f.minY;x<=f.maxY;++x)if(M=l.getTile(p,D,x,u,a),!(void 0!==t.extent&&(k=d.getTileCoordExtent(M.tileCoord,F),!ae(k,t.extent)))){if(G=M.getState(),N=G==Hg.LOADED||G==Hg.EMPTY||G==Hg.ERROR&&!P,N||(M=M.getInterimTile()),G=M.getState(),G==Hg.LOADED){if(r.isTileTextureLoaded(M)){I[p][M.tileCoord.toString()]=M;continue}}else if(G==Hg.EMPTY||G==Hg.ERROR&&!P)continue;v=!1,A=d.forEachTileCoordParentTileRange(M.tileCoord,L,null,O,F),A||(w=d.getTileCoordChildTileRange(M.tileCoord,O,F),w&&L(p+1,w))}const U=Object.keys(I).map(Number);U.sort(Dt);const Y=new Float32Array(4);for(let e=0,t=U.length;e<t;++e){const t=I[U[e]];for(const e in t)M=t[e],k=d.getTileCoordExtent(M.tileCoord,F),Y[0]=2*(k[2]-k[0])/h,Y[1]=2*(k[3]-k[1])/h,Y[2]=2*(k[0]-E[0])/h-1,Y[3]=2*(k[1]-E[1])/h-1,i.uniform4fv(this.locations_.u_tileOffset,Y),r.bindTileTexture(M,_,y*u,cd,cd),i.drawArrays(ad,0,4)}v?(this.renderedTileRange_=f,this.renderedFramebufferExtent_=E,this.renderedRevision_=l.getRevision()):(this.renderedTileRange_=null,this.renderedFramebufferExtent_=null,this.renderedRevision_=-1,e.animate=!0)}this.updateUsedTiles(e.usedTiles,l,p,f);const x=r.getTileTextureQueue();this.manageTilePyramid(e,l,d,u,a,h,p,s.getPreload(),function(e){e.getState()!=Hg.LOADED||r.isTileTextureLoaded(e)||x.isKeyQueued(e.getKey())||x.enqueue([e,d.getTileCoordCenter(e.tileCoord),d.getResolution(e.tileCoord[0]),_,y*u])},this),this.scheduleExpireCache(e,l);const T=this.texCoordMatrix;return ot(T),dt(T,(Vl(m[0]/g)*g-E[0])/(E[2]-E[0]),(Vl(m[1]/g)*g-E[1])/(E[3]-E[1])),0!==n.rotation&&st(T,n.rotation),lt(T,e.size[0]*n.resolution/(E[2]-E[0]),e.size[1]*n.resolution/(E[3]-E[1])),dt(T,-.5,-.5),!0},vh.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.framebuffer){const i=[e[0]/t.size[0],(t.size[1]-e[1])/t.size[1]],n=at(this.texCoordMatrix,i.slice()),a=[n[0]*this.framebufferDimension,n[1]*this.framebufferDimension],s=this.mapRenderer.getContext().getGL();s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffer);const l=new Uint8Array(4);return s.readPixels(a[0],a[1],1,1,s.RGBA,s.UNSIGNED_BYTE,l),0<l[3]?o.call(r,this.getLayer(),l):void 0}};var Fh=vh;const Oh=function(e,t){xh.call(this,e,t),this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=b(),this.renderedRenderOrder_=null,this.replayGroup_=null,this.layerState_=null};i(Oh,xh),Oh.handles=function(e){return e.getType()===nc.VECTOR},Oh.create=function(e,t){return new Oh(e,t)},Oh.prototype.composeFrame=function(e,t,o){this.layerState_=t;const r=e.viewState,i=this.replayGroup_,n=e.size,a=e.pixelRatio,s=this.mapRenderer.getGL();i&&!i.isEmpty()&&(s.enable(s.SCISSOR_TEST),s.scissor(0,0,n[0]*a,n[1]*a),i.replay(o,r.center,r.resolution,r.rotation,n,a,t.opacity,t.managed?e.skippedFeatureUids:{}),s.disable(s.SCISSOR_TEST))},Oh.prototype.disposeInternal=function(){const e=this.replayGroup_;if(e){const t=this.mapRenderer.getContext();e.getDeleteResourcesFunction(t)(),this.replayGroup_=null}xh.prototype.disposeInternal.call(this)},Oh.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){if(!this.replayGroup_||!this.layerState_)return;else{const o=this.mapRenderer.getContext(),a=t.viewState,s=this.getLayer(),l=this.layerState_,d={};return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a.center,a.resolution,a.rotation,t.size,t.pixelRatio,l.opacity,{},function(e){const t=n(e).toString();if(!(t in d))return d[t]=!0,r.call(i,e,s)})}},Oh.prototype.hasFeatureAtCoordinate=function(e,t){if(!this.replayGroup_||!this.layerState_)return!1;else{const o=this.mapRenderer.getContext(),r=t.viewState,i=this.layerState_;return this.replayGroup_.hasFeatureAtCoordinate(e,o,r.center,r.resolution,r.rotation,t.size,t.pixelRatio,i.opacity,t.skippedFeatureUids)}},Oh.prototype.forEachLayerAtPixel=function(e,t,o,r){const i=at(t.pixelToCoordinateTransform,e.slice()),n=this.hasFeatureAtCoordinate(i,t);return n?o.call(r,this.getLayer(),null):void 0},Oh.prototype.handleStyleImageChange_=function(){this.renderIfReadyAndVisible()},Oh.prototype.prepareFrame=function(e,t,o){const r=this.getLayer(),i=r.getSource(),n=e.viewHints[M_.ANIMATING],a=e.viewHints[M_.INTERACTING],s=r.getUpdateWhileAnimating(),l=r.getUpdateWhileInteracting();if(!this.dirty_&&!s&&n||!l&&a)return!0;const d=e.extent,p=e.viewState,g=p.projection,_=p.resolution,u=e.pixelRatio,c=r.getRevision(),y=r.getRenderBuffer();let m=r.getRenderOrder();void 0===m&&(m=gn);const h=P(d,y*_);if(!this.dirty_&&this.renderedResolution_==_&&this.renderedRevision_==c&&this.renderedRenderOrder_==m&&w(this.renderedExtent_,h))return!0;this.replayGroup_&&e.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(o)),this.dirty_=!1;const f=new _h(un(_,u),h,r.getRenderBuffer());i.loadFeatures(h,_,g);const x=function(e){let t;const o=e.getStyleFunction()||r.getStyleFunction();if(o&&(t=o(e,_)),t){const o=this.renderFeature(e,_,u,t,f);this.dirty_=this.dirty_||o}};if(m){const e=[];i.forEachFeatureInExtent(h,function(t){e.push(t)},this),e.sort(m),e.forEach(x.bind(this))}else i.forEachFeatureInExtent(h,x,this);return f.finish(o),this.renderedResolution_=_,this.renderedRevision_=c,this.renderedRenderOrder_=m,this.renderedExtent_=h,this.replayGroup_=f,!0},Oh.prototype.renderFeature=function(e,t,o,r,n){if(!r)return!1;let a=!1;if(Array.isArray(r))for(let s=r.length-1;s>=0;--s)a=cn(n,e,r[s],_n(t,o),this.handleStyleImageChange_,this)||a;else a=cn(n,e,r,_n(t,o),this.handleStyleImageChange_,this)||a;return a};var wh=Oh;const Nh=function(e){e=Ad({},e),e.controls||(e.controls=Dr()),e.interactions||(e.interactions=$i()),H_.call(this,e)};i(Nh,H_),Nh.prototype.createRenderer=function(){const e=new Rh(this);return e.registerLayerRenderers([Th,Fh,wh]),e};const Ah='projection',bh='coordinateFormat',Mh=function(e){const t=e?e:{},o=document.createElement('DIV');o.className=t.className===void 0?'ol-mouse-position':t.className,q_.call(this,{element:o,render:t.render||wn,target:t.target}),c(this,C(Ah),this.handleProjectionChanged_,this),t.coordinateFormat&&this.setCoordinateFormat(t.coordinateFormat),t.projection&&this.setProjection(t.projection),this.undefinedHTML_='undefinedHTML'in t?t.undefinedHTML:'&nbsp;',this.renderOnMouseOut_=!!this.undefinedHTML_,this.renderedHTML_=o.innerHTML,this.mapProjection_=null,this.transform_=null,this.lastMouseMovePixel_=null};i(Mh,q_),Mh.prototype.handleProjectionChanged_=function(){this.transform_=null},Mh.prototype.getCoordinateFormat=function(){return this.get(bh)},Mh.prototype.getProjection=function(){return this.get(Ah)},Mh.prototype.handleMouseMove=function(e){const t=this.getMap();this.lastMouseMovePixel_=t.getEventPixel(e),this.updateHTML_(this.lastMouseMovePixel_)},Mh.prototype.handleMouseOut=function(){this.updateHTML_(null),this.lastMouseMovePixel_=null},Mh.prototype.setMap=function(e){if(q_.prototype.setMap.call(this,e),e){const t=e.getViewport();this.listenerKeys.push(c(t,Yd.MOUSEMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(c(t,Yd.MOUSEOUT,this.handleMouseOut,this))}},Mh.prototype.setCoordinateFormat=function(e){this.set(bh,e)},Mh.prototype.setProjection=function(e){this.set(Ah,Ve(e))},Mh.prototype.updateHTML_=function(e){let t=this.undefinedHTML_;if(e&&this.mapProjection_){if(!this.transform_){const e=this.getProjection();this.transform_=e?Je(this.mapProjection_,e):Ye}const o=this.getMap(),r=o.getCoordinateFromPixel(e);if(r){this.transform_(r,r);const e=this.getCoordinateFormat();t=e?e(r):r.toString()}}this.renderedHTML_&&t===this.renderedHTML_||(this.element.innerHTML=t,this.renderedHTML_=t)};const Gh=function(){this.defaultDataProjection=null,this.defaultFeatureProjection=null};Gh.prototype.getReadOptions=function(e,t){let o;return t&&(o={dataProjection:t.dataProjection?t.dataProjection:this.readProjection(e),featureProjection:t.featureProjection}),this.adaptOptions(o)},Gh.prototype.adaptOptions=function(e){return Ad({dataProjection:this.defaultDataProjection,featureProjection:this.defaultFeatureProjection},e)},Gh.prototype.getLastExtent=function(){return null},Gh.prototype.getType=function(){},Gh.prototype.readFeature=function(){},Gh.prototype.readFeatures=function(){},Gh.prototype.readGeometry=function(){},Gh.prototype.readProjection=function(){},Gh.prototype.writeFeature=function(){},Gh.prototype.writeFeatures=function(){},Gh.prototype.writeGeometry=function(){};var Dh=Gh;const kh=function(){Dh.call(this)};i(kh,Dh),kh.prototype.getType=function(){return pc.JSON},kh.prototype.readFeature=function(e,t){return this.readFeatureFromObject(An(e),this.getReadOptions(e,t))},kh.prototype.readFeatures=function(e,t){return this.readFeaturesFromObject(An(e),this.getReadOptions(e,t))},kh.prototype.readFeatureFromObject=function(){},kh.prototype.readFeaturesFromObject=function(){},kh.prototype.readGeometry=function(e,t){return this.readGeometryFromObject(An(e),this.getReadOptions(e,t))},kh.prototype.readGeometryFromObject=function(){},kh.prototype.readProjection=function(e){return this.readProjectionFromObject(An(e))},kh.prototype.readProjectionFromObject=function(){},kh.prototype.writeFeature=function(e,t){return JSON.stringify(this.writeFeatureObject(e,t))},kh.prototype.writeFeatureObject=function(){},kh.prototype.writeFeatures=function(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))},kh.prototype.writeFeaturesObject=function(){},kh.prototype.writeGeometry=function(e,t){return JSON.stringify(this.writeGeometryObject(e,t))},kh.prototype.writeGeometryObject=function(){};var Uh=kh;const Yh={};Yh[ep.POINT]=function(e){let t;return t=void 0!==e.m&&void 0!==e.z?new wg([e.x,e.y,e.z,e.m],Ig.XYZM):void 0===e.z?void 0===e.m?new wg([e.x,e.y]):new wg([e.x,e.y,e.m],Ig.XYM):new wg([e.x,e.y,e.z],Ig.XYZ),t},Yh[ep.LINE_STRING]=function(e){const t=Gn(e);return new Gg(e.paths[0],t)},Yh[ep.POLYGON]=function(e){const t=Gn(e);return new Ag(e.rings,t)},Yh[ep.MULTI_POINT]=function(e){const t=Gn(e);return new oc(e.points,t)},Yh[ep.MULTI_LINE_STRING]=function(e){const t=Gn(e);return new ec(e.paths,t)},Yh[ep.MULTI_POLYGON]=function(e){const t=Gn(e);return new ic(e.rings,t)};const jh={};jh[ep.POINT]=function(e){const t=e.getCoordinates();let o;const r=e.getLayout();return r===Ig.XYZ?o={x:t[0],y:t[1],z:t[2]}:r===Ig.XYM?o={x:t[0],y:t[1],m:t[2]}:r===Ig.XYZM?o={x:t[0],y:t[1],z:t[2],m:t[3]}:r===Ig.XY?o={x:t[0],y:t[1]}:R(!1,34),o},jh[ep.LINE_STRING]=function(e){const t=Dn(e);return{hasZ:t.hasZ,hasM:t.hasM,paths:[e.getCoordinates()]}},jh[ep.POLYGON]=function(e){const t=Dn(e);return{hasZ:t.hasZ,hasM:t.hasM,rings:e.getCoordinates(!1)}},jh[ep.MULTI_POINT]=function(e){const t=Dn(e);return{hasZ:t.hasZ,hasM:t.hasM,points:e.getCoordinates()}},jh[ep.MULTI_LINE_STRING]=function(e){const t=Dn(e);return{hasZ:t.hasZ,hasM:t.hasM,paths:e.getCoordinates()}},jh[ep.MULTI_POLYGON]=function(e){const t=Dn(e),o=e.getCoordinates(!1),r=[];for(let t=0;t<o.length;t++)for(let e=o[t].length-1;0<=e;e--)r.push(o[t][e]);return{hasZ:t.hasZ,hasM:t.hasM,rings:r}};const Bh=function(e){const t=e?e:{};Uh.call(this),this.geometryName_=t.geometryName};i(Bh,Uh),Bh.prototype.readFeature,Bh.prototype.readFeatures,Bh.prototype.readFeatureFromObject=function(e,t){const o=e,r=bn(o.geometry,t),i=new Cg;return this.geometryName_&&i.setGeometryName(this.geometryName_),i.setGeometry(r),t&&t.idField&&o.attributes[t.idField]&&i.setId(o.attributes[t.idField]),o.attributes&&i.setProperties(o.attributes),i},Bh.prototype.readFeaturesFromObject=function(e,t){const o=t?t:{};if(e.features){const t=[],r=e.features;o.idField=e.objectIdFieldName;for(let e=0,i=r.length;e<i;++e)t.push(this.readFeatureFromObject(r[e],o));return t}return[this.readFeatureFromObject(e,o)]},Bh.prototype.readGeometry,Bh.prototype.readGeometryFromObject=function(e,t){return bn(e,t)},Bh.prototype.readProjection,Bh.prototype.readProjectionFromObject=function(e){const t=e;if(t.spatialReference&&t.spatialReference.wkid){const e=t.spatialReference.wkid;return Ve('EPSG:'+e)}return null},Bh.prototype.writeGeometry,Bh.prototype.writeGeometryObject=function(e,t){return kn(e,this.adaptOptions(t))},Bh.prototype.writeFeature,Bh.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);const o={},r=e.getGeometry();r&&(o.geometry=kn(r,t),t&&t.featureProjection&&(o.geometry.spatialReference={wkid:Ve(t.featureProjection).getCode().split(':').pop()}));const i=e.getProperties();return delete i[e.getGeometryName()],o.attributes=l(i)?{}:i,o},Bh.prototype.writeFeatures,Bh.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);const o=[];for(let r=0,i=e.length;r<i;++r)o.push(this.writeFeatureObject(e[r],t));return{features:o}};const Vh=document.implementation.createDocument('','',null),zh='http://www.w3.org/2001/XMLSchema-instance',Xh=$n(),Wh=function(){this.xmlSerializer_=new XMLSerializer,Dh.call(this)};i(Wh,Dh),Wh.prototype.getType=function(){return pc.XML},Wh.prototype.readFeature=function(e,t){if(Bn(e))return this.readFeatureFromDocument(e,t);if(Vn(e))return this.readFeatureFromNode(e,t);if('string'==typeof e){const o=Xn(e);return this.readFeatureFromDocument(o,t)}return null},Wh.prototype.readFeatureFromDocument=function(e,t){const o=this.readFeaturesFromDocument(e,t);return 0<o.length?o[0]:null},Wh.prototype.readFeatureFromNode=function(){return null},Wh.prototype.readFeatures=function(e,t){if(Bn(e))return this.readFeaturesFromDocument(e,t);if(Vn(e))return this.readFeaturesFromNode(e,t);if('string'==typeof e){const o=Xn(e);return this.readFeaturesFromDocument(o,t)}return[]},Wh.prototype.readFeaturesFromDocument=function(e,t){const o=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&jt(o,this.readFeaturesFromNode(r,t));return o},Wh.prototype.readFeaturesFromNode=function(){},Wh.prototype.readGeometry=function(e,t){if(Bn(e))return this.readGeometryFromDocument(e,t);if(Vn(e))return this.readGeometryFromNode(e,t);if('string'==typeof e){const o=Xn(e);return this.readGeometryFromDocument(o,t)}return null},Wh.prototype.readGeometryFromDocument=function(){return null},Wh.prototype.readGeometryFromNode=function(){return null},Wh.prototype.readProjection=function(e){if(Bn(e))return this.readProjectionFromDocument(e);if(Vn(e))return this.readProjectionFromNode(e);if('string'==typeof e){const t=Xn(e);return this.readProjectionFromDocument(t)}return null},Wh.prototype.readProjectionFromDocument=function(){return this.defaultDataProjection},Wh.prototype.readProjectionFromNode=function(){return this.defaultDataProjection},Wh.prototype.writeFeature=function(e,t){const o=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(o)},Wh.prototype.writeFeatureNode=function(){return null},Wh.prototype.writeFeatures=function(e,t){const o=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(o)},Wh.prototype.writeFeaturesNode=function(){return null},Wh.prototype.writeGeometry=function(e,t){const o=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(o)},Wh.prototype.writeGeometryNode=function(){return null};var Kh=Wh;const Hh='http://www.opengis.net/gml',Zh=function(e){const t=e?e:{};this.featureType=t.featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation='',this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[Hh]={featureMember:Hn(Zh.prototype.readFeaturesInternal),featureMembers:Hn(Zh.prototype.readFeaturesInternal)},Kh.call(this)};i(Zh,Kh);const qh=/^[\s\xa0]*$/;Zh.prototype.readFeaturesInternal=function(e,t){const o=e.localName;let r=null;if('FeatureCollection'==o)r='http://www.opengis.net/wfs'===e.namespaceURI?ra([],this.FEATURE_COLLECTION_PARSERS,e,t,this):ra(null,this.FEATURE_COLLECTION_PARSERS,e,t,this);else if('featureMembers'==o||'featureMember'==o){const i=t[0];let n=i.featureType,a=i.featureNS;const s='p0';if(!n&&e.childNodes){n=[],a={};for(let t=0,o=e.childNodes.length;t<o;++t){const o=e.childNodes[t];if(1===o.nodeType){const e=o.nodeName.split(':').pop();if(-1===n.indexOf(e)){let t='',r=0;const i=o.namespaceURI;for(const e in a){if(a[e]===i){t=e;break}++r}t||(t='p'+r,a[t]=i),n.push(t+':'+e)}}}'featureMember'!=o&&(i.featureType=n,i.featureNS=a)}if('string'==typeof a){const e=a;a={},a[s]=e}const l={},d=Array.isArray(n)?n:[n];for(const e in a){const t={};for(let r=0,i=d.length;r<i;++r){const i=-1===d[r].indexOf(':')?s:d[r].split(':')[0];i===e&&(t[d[r].split(':').pop()]='featureMembers'==o?Kn(this.readFeatureElement,this):Hn(this.readFeatureElement,this))}l[a[e]]=t}r='featureMember'==o?ra(void 0,l,e,t):ra([],l,e,t)}return null===r&&(r=[]),r},Zh.prototype.readGeometryElement=function(e,t){const o=t[0];o.srsName=e.firstElementChild.getAttribute('srsName'),o.srsDimension=e.firstElementChild.getAttribute('srsDimension');const r=ra(null,this.GEOMETRY_PARSERS_,e,t,this);return r?Nn(r,!1,o):void 0},Zh.prototype.readFeatureElement=function(e,t){let o;const r=e.getAttribute('fid')||zn(e,Hh,'id'),i={};let n;for(o=e.firstElementChild;o;o=o.nextElementSibling){const e=o.localName;if(0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)){let t=Yn(o,!1);qh.test(t)&&(t=void 0),i[e]=t}else'boundedBy'!==e&&(n=e),i[e]=this.readGeometryElement(o,t)}const a=new Cg(i);return n&&a.setGeometryName(n),r&&a.setId(r),a},Zh.prototype.readPoint=function(e,t){const o=this.readFlatCoordinatesFromNode_(e,t);if(o){const e=new wg(null);return e.setFlatCoordinates(Ig.XYZ,o),e}},Zh.prototype.readMultiPoint=function(e,t){const o=ra([],this.MULTIPOINT_PARSERS_,e,t,this);return o?new oc(o):void 0},Zh.prototype.readMultiLineString=function(e,t){const o=ra([],this.MULTILINESTRING_PARSERS_,e,t,this);if(o){const e=new ec(null);return e.setLineStrings(o),e}},Zh.prototype.readMultiPolygon=function(e,t){const o=ra([],this.MULTIPOLYGON_PARSERS_,e,t,this);if(o){const e=new ic(null);return e.setPolygons(o),e}},Zh.prototype.pointMemberParser_=function(e,t){oa(this.POINTMEMBER_PARSERS_,e,t,this)},Zh.prototype.lineStringMemberParser_=function(e,t){oa(this.LINESTRINGMEMBER_PARSERS_,e,t,this)},Zh.prototype.polygonMemberParser_=function(e,t){oa(this.POLYGONMEMBER_PARSERS_,e,t,this)},Zh.prototype.readLineString=function(e,t){const o=this.readFlatCoordinatesFromNode_(e,t);if(o){const e=new Gg(null);return e.setFlatCoordinates(Ig.XYZ,o),e}},Zh.prototype.readFlatLinearRing_=function(e,t){const o=ra(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this);return o?o:void 0},Zh.prototype.readLinearRing=function(e,t){const o=this.readFlatCoordinatesFromNode_(e,t);if(o){const e=new Fg(null);return e.setFlatCoordinates(Ig.XYZ,o),e}},Zh.prototype.readPolygon=function(e,t){const o=ra([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this);if(o&&o[0]){const e=new Ag(null),t=o[0],r=[t.length];let n,i;for(n=1,i=o.length;n<i;++n)jt(t,o[n]),r.push(t.length);return e.setFlatCoordinates(Ig.XYZ,t,r),e}},Zh.prototype.readFlatCoordinatesFromNode_=function(e,t){return ra(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)},Zh.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:Kn(Zh.prototype.pointMemberParser_),pointMembers:Kn(Zh.prototype.pointMemberParser_)}},Zh.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:Kn(Zh.prototype.lineStringMemberParser_),lineStringMembers:Kn(Zh.prototype.lineStringMemberParser_)}},Zh.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:Kn(Zh.prototype.polygonMemberParser_),polygonMembers:Kn(Zh.prototype.polygonMemberParser_)}},Zh.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:Kn(Zh.prototype.readFlatCoordinatesFromNode_)}},Zh.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Kn(Zh.prototype.readLineString)}},Zh.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Kn(Zh.prototype.readPolygon)}},Zh.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Hn(Zh.prototype.readFlatLinearRing_)}},Zh.prototype.readGeometryFromNode=function(e,t){const o=this.readGeometryElement(e,[this.getReadOptions(e,t?t:{})]);return o?o:null},Zh.prototype.readFeatures,Zh.prototype.readFeaturesFromNode=function(e,t){const o={featureType:this.featureType,featureNS:this.featureNS};t&&Ad(o,this.getReadOptions(e,t));const r=this.readFeaturesInternal(e,[o]);return r||[]},Zh.prototype.readProjectionFromNode=function(e){return Ve(this.srsName?this.srsName:e.firstElementChild.getAttribute('srsName'))};var Jh=Zh;const Qh=function(e){const t=e?e:{};Jh.call(this,t),this.surface_=t.surface!==void 0&&t.surface,this.curve_=t.curve!==void 0&&t.curve,this.multiCurve_=!(t.multiCurve!==void 0)||t.multiCurve,this.multiSurface_=!(t.multiSurface!==void 0)||t.multiSurface,this.schemaLocation=t.schemaLocation?t.schemaLocation:Hh+' http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd',this.hasZ=t.hasZ!==void 0&&t.hasZ};i(Qh,Jh),Qh.prototype.readMultiCurve_=function(e,t){const o=ra([],this.MULTICURVE_PARSERS_,e,t,this);if(o){const e=new ec(null);return e.setLineStrings(o),e}},Qh.prototype.readMultiSurface_=function(e,t){const o=ra([],this.MULTISURFACE_PARSERS_,e,t,this);if(o){const e=new ic(null);return e.setPolygons(o),e}},Qh.prototype.curveMemberParser_=function(e,t){oa(this.CURVEMEMBER_PARSERS_,e,t,this)},Qh.prototype.surfaceMemberParser_=function(e,t){oa(this.SURFACEMEMBER_PARSERS_,e,t,this)},Qh.prototype.readPatch_=function(e,t){return ra([null],this.PATCHES_PARSERS_,e,t,this)},Qh.prototype.readSegment_=function(e,t){return ra([null],this.SEGMENTS_PARSERS_,e,t,this)},Qh.prototype.readPolygonPatch_=function(e,t){return ra([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this)},Qh.prototype.readLineStringSegment_=function(e,t){return ra([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)},Qh.prototype.interiorParser_=function(e,t){const o=ra(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e.push(o)}},Qh.prototype.exteriorParser_=function(e,t){const o=ra(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e[0]=o}},Qh.prototype.readSurface_=function(e,t){const o=ra([null],this.SURFACE_PARSERS_,e,t,this);if(o&&o[0]){const e=new Ag(null),t=o[0],r=[t.length];let n,i;for(n=1,i=o.length;n<i;++n)jt(t,o[n]),r.push(t.length);return e.setFlatCoordinates(Ig.XYZ,t,r),e}},Qh.prototype.readCurve_=function(e,t){const o=ra([null],this.CURVE_PARSERS_,e,t,this);if(o){const e=new Gg(null);return e.setFlatCoordinates(Ig.XYZ,o),e}},Qh.prototype.readEnvelope_=function(e,t){const o=ra([null],this.ENVELOPE_PARSERS_,e,t,this);return G(o[1][0],o[1][1],o[2][0],o[2][1])},Qh.prototype.readFlatPos_=function(e,t){let o=Yn(e,!1);const r=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];for(let i;i=r.exec(o);)n.push(parseFloat(i[1])),o=o.substr(i[0].length);if(''!==o)return;const i=t[0],a=i.srsName;let s='enu';if(a){const e=Ve(a);s=e.getAxisOrientation()}if('neu'===s){let e,t;for(e=0,t=n.length;e<t;e+=3){const t=n[e],o=n[e+1];n[e]=o,n[e+1]=t}}const l=n.length;return 2==l&&n.push(0),0===l?void 0:n},Qh.prototype.readFlatPosList_=function(e,t){const o=Yn(e,!1).replace(/^\s*|\s*$/g,''),r=t[0],i=r.srsName,n=r.srsDimension;let a='enu';if(i){const e=Ve(i);a=e.getAxisOrientation()}const s=o.split(/\s+/);let l=2;e.getAttribute('srsDimension')?l=_a(e.getAttribute('srsDimension')):e.getAttribute('dimension')?l=_a(e.getAttribute('dimension')):e.parentNode.getAttribute('srsDimension')?l=_a(e.parentNode.getAttribute('srsDimension')):n&&(l=_a(n));let d,p,g;const _=[];for(let o=0,r=s.length;o<r;o+=l)d=parseFloat(s[o]),p=parseFloat(s[o+1]),g=3===l?parseFloat(s[o+2]):0,'en'===a.substr(0,2)?_.push(d,p,g):_.push(p,d,g);return _},Qh.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{pos:Hn(Qh.prototype.readFlatPos_),posList:Hn(Qh.prototype.readFlatPosList_)}},Qh.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{interior:Qh.prototype.interiorParser_,exterior:Qh.prototype.exteriorParser_}},Qh.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:Hn(Jh.prototype.readPoint),MultiPoint:Hn(Jh.prototype.readMultiPoint),LineString:Hn(Jh.prototype.readLineString),MultiLineString:Hn(Jh.prototype.readMultiLineString),LinearRing:Hn(Jh.prototype.readLinearRing),Polygon:Hn(Jh.prototype.readPolygon),MultiPolygon:Hn(Jh.prototype.readMultiPolygon),Surface:Hn(Qh.prototype.readSurface_),MultiSurface:Hn(Qh.prototype.readMultiSurface_),Curve:Hn(Qh.prototype.readCurve_),MultiCurve:Hn(Qh.prototype.readMultiCurve_),Envelope:Hn(Qh.prototype.readEnvelope_)}},Qh.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:Kn(Qh.prototype.curveMemberParser_),curveMembers:Kn(Qh.prototype.curveMemberParser_)}},Qh.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:Kn(Qh.prototype.surfaceMemberParser_),surfaceMembers:Kn(Qh.prototype.surfaceMemberParser_)}},Qh.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Kn(Jh.prototype.readLineString),Curve:Kn(Qh.prototype.readCurve_)}},Qh.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Kn(Jh.prototype.readPolygon),Surface:Kn(Qh.prototype.readSurface_)}},Qh.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:Hn(Qh.prototype.readPatch_)}},Qh.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:Hn(Qh.prototype.readSegment_)}},Qh.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:Kn(Qh.prototype.readFlatPosList_),upperCorner:Kn(Qh.prototype.readFlatPosList_)}},Qh.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:Hn(Qh.prototype.readPolygonPatch_)}},Qh.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:Hn(Qh.prototype.readLineStringSegment_)}},Qh.prototype.writePos_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=i?3:2;e.setAttribute('srsDimension',n);const a=r.srsName;let s='enu';a&&(s=Ve(a).getAxisOrientation());const l=t.getCoordinates();let d;if(d='en'===s.substr(0,2)?l[0]+' '+l[1]:l[1]+' '+l[0],i){const e=l[2]||0;d+=' '+e}fa(e,d)},Qh.prototype.getCoords_=function(e,t,o){let r='enu';t&&(r=Ve(t).getAxisOrientation());let i='en'===r.substr(0,2)?e[0]+' '+e[1]:e[1]+' '+e[0];if(o){const t=e[2]||0;i+=' '+t}return i},Qh.prototype.writePosList_=function(e,t,o){const r=o[o.length-1],n=r.hasZ,i=n?3:2;e.setAttribute('srsDimension',i);const a=r.srsName,s=t.getCoordinates(),l=s.length,d=Array(l);let p;for(let r=0;r<l;++r)p=s[r],d[r]=this.getCoords_(p,a,n);fa(e,d.join(' '))},Qh.prototype.writePoint_=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=Un(e.namespaceURI,'pos');e.appendChild(n),this.writePos_(n,t,o)},Qh.prototype.writeEnvelope=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=[t[0]+' '+t[1],t[2]+' '+t[3]];na({node:e},this.ENVELOPE_SERIALIZERS_,Xh,n,o,['lowerCorner','upperCorner'],this)},Qh.prototype.writeLinearRing_=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=Un(e.namespaceURI,'posList');e.appendChild(n),this.writePosList_(n,t,o)},Qh.prototype.RING_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.node,i=o.exteriorWritten;return void 0===i&&(o.exteriorWritten=!0),Un(r.namespaceURI,void 0===i?'exterior':'interior')},Qh.prototype.writeSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;if('PolygonPatch'!==e.nodeName&&n&&e.setAttribute('srsName',n),'Polygon'===e.nodeName||'PolygonPatch'===e.nodeName){const r=t.getLinearRings();na({node:e,hasZ:i,srsName:n},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,r,o,void 0,this)}else if('Surface'===e.nodeName){const r=Un(e.namespaceURI,'patches');e.appendChild(r),this.writeSurfacePatches_(r,t,o)}},Qh.prototype.writeCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.srsName;if('LineStringSegment'!==e.nodeName&&i&&e.setAttribute('srsName',i),'LineString'===e.nodeName||'LineStringSegment'===e.nodeName){const r=Un(e.namespaceURI,'posList');e.appendChild(r),this.writePosList_(r,t,o)}else if('Curve'===e.nodeName){const r=Un(e.namespaceURI,'segments');e.appendChild(r),this.writeCurveSegments_(r,t,o)}},Qh.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.surface;n&&e.setAttribute('srsName',n);const s=t.getPolygons();na({node:e,hasZ:i,srsName:n,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},Qh.prototype.writeMultiPoint_=function(e,t,o){const r=o[o.length-1],i=r.srsName,n=r.hasZ;i&&e.setAttribute('srsName',i);const a=t.getPoints();na({node:e,hasZ:n,srsName:i},this.POINTMEMBER_SERIALIZERS_,$n('pointMember'),a,o,void 0,this)},Qh.prototype.writeMultiCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.curve;n&&e.setAttribute('srsName',n);const s=t.getLineStrings();na({node:e,hasZ:i,srsName:n,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},Qh.prototype.writeRing_=function(e,t,o){const r=Un(e.namespaceURI,'LinearRing');e.appendChild(r),this.writeLinearRing_(r,t,o)},Qh.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o))},Qh.prototype.writePointMember_=function(e,t,o){const r=Un(e.namespaceURI,'Point');e.appendChild(r),this.writePoint_(r,t,o)},Qh.prototype.writeLineStringOrCurveMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeCurveOrLineString_(r,t,o))},Qh.prototype.writeSurfacePatches_=function(e,t,o){const r=Un(e.namespaceURI,'PolygonPatch');e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o)},Qh.prototype.writeCurveSegments_=function(e,t,o){const r=Un(e.namespaceURI,'LineStringSegment');e.appendChild(r),this.writeCurveOrLineString_(r,t,o)},Qh.prototype.writeGeometryElement=function(e,t,o){const r=o[o.length-1],i=Ad({},r);i.node=e;let n;n=Array.isArray(t)?r.dataProjection?et(t,r.featureProjection,r.dataProjection):t:Nn(t,!0,r),na(i,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],o,void 0,this)},Qh.prototype.writeFeatureElement=function(e,t,o){const r=t.getId();r&&e.setAttribute('fid',r);const i=o[o.length-1],n=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[n]={});const s=t.getProperties(),l=[],d=[];for(const r in s){const e=s[r];null!==e&&(l.push(r),d.push(e),r==a||e instanceof Ep?!(r in i.serializers[n])&&(i.serializers[n][r]=Jn(this.writeGeometryElement,this)):!(r in i.serializers[n])&&(i.serializers[n][r]=Jn(fa)))}const p=Ad({},i);p.node=e,na(p,i.serializers,$n(void 0,n),d,o,l)},Qh.prototype.writeFeatureMembers_=function(e,t,o){const r=o[o.length-1],i=r.featureType,n=r.featureNS,a={};a[n]={},a[n][i]=Jn(this.writeFeatureElement,this);const s=Ad({},r);s.node=e,na(s,a,$n(i,n),t,o)};const $h={MultiLineString:'lineStringMember',MultiCurve:'curveMember',MultiPolygon:'polygonMember',MultiSurface:'surfaceMember'};Qh.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t){const o=t[t.length-1].node;return Un('http://www.opengis.net/gml',$h[o.nodeName])},Qh.prototype.GEOMETRY_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.multiSurface,i=o.surface,n=o.curve,a=o.multiCurve;let s;return Array.isArray(e)?s='Envelope':(s=e.getType(),'MultiPolygon'===s&&!0===r?s='MultiSurface':'Polygon'===s&&!0===i?s='Surface':'LineString'===s&&!0===n?s='Curve':'MultiLineString'===s&&!0===a&&(s='MultiCurve')),Un('http://www.opengis.net/gml',s)},Qh.prototype.writeGeometryNode=function(e,t){t=this.adaptOptions(t);const o=Un('http://www.opengis.net/gml','geom'),r={node:o,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Ad(r,t),this.writeGeometryElement(o,e,[r]),o},Qh.prototype.writeFeatures,Qh.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);const o=Un('http://www.opengis.net/gml','featureMembers');o.setAttributeNS(zh,'xsi:schemaLocation',this.schemaLocation);const r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Ad(r,t),this.writeFeatureMembers_(o,e,[r]),o},Qh.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:Jn(Qh.prototype.writeRing_),interior:Jn(Qh.prototype.writeRing_)}},Qh.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Jn(fa),upperCorner:Jn(fa)}},Qh.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Jn(Qh.prototype.writeSurfaceOrPolygonMember_),polygonMember:Jn(Qh.prototype.writeSurfaceOrPolygonMember_)}},Qh.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Jn(Qh.prototype.writePointMember_)}},Qh.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Jn(Qh.prototype.writeLineStringOrCurveMember_),curveMember:Jn(Qh.prototype.writeLineStringOrCurveMember_)}},Qh.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Jn(Qh.prototype.writeCurveOrLineString_),MultiCurve:Jn(Qh.prototype.writeMultiCurveOrLineString_),Point:Jn(Qh.prototype.writePoint_),MultiPoint:Jn(Qh.prototype.writeMultiPoint_),LineString:Jn(Qh.prototype.writeCurveOrLineString_),MultiLineString:Jn(Qh.prototype.writeMultiCurveOrLineString_),LinearRing:Jn(Qh.prototype.writeLinearRing_),Polygon:Jn(Qh.prototype.writeSurfaceOrPolygon_),MultiPolygon:Jn(Qh.prototype.writeMultiSurfaceOrPolygon_),Surface:Jn(Qh.prototype.writeSurfaceOrPolygon_),MultiSurface:Jn(Qh.prototype.writeMultiSurfaceOrPolygon_),Envelope:Jn(Qh.prototype.writeEnvelope)}};var ef=Qh;const tf=ef;tf.prototype.writeFeatures,tf.prototype.writeFeaturesNode;const of=function(e){const t=e?e:{};Jh.call(this,t),this.FEATURE_COLLECTION_PARSERS[Hh].featureMember=Kn(Jh.prototype.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:Hh+' http://schemas.opengis.net/gml/2.1.2/feature.xsd'};i(of,Jh),of.prototype.readFlatCoordinates_=function(e,t){const o=Yn(e,!1).replace(/^\s*|\s*$/g,''),r=t[0],i=r.srsName;let n='enu';if(i){const e=Ve(i);e&&(n=e.getAxisOrientation())}const a=o.trim().split(/\s+/),s=[];for(let o=0,r=a.length;o<r;o++){const e=a[o].split(/,+/),t=parseFloat(e[0]),r=parseFloat(e[1]),i=3===e.length?parseFloat(e[2]):0;'en'===n.substr(0,2)?s.push(t,r,i):s.push(r,t,i)}return s},of.prototype.readBox_=function(e,t){const o=ra([null],this.BOX_PARSERS_,e,t,this);return G(o[1][0],o[1][1],o[1][3],o[1][4])},of.prototype.innerBoundaryIsParser_=function(e,t){const o=ra(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e.push(o)}},of.prototype.outerBoundaryIsParser_=function(e,t){const o=ra(void 0,this.RING_PARSERS,e,t,this);if(o){const e=t[t.length-1];e[0]=o}},of.prototype.GEOMETRY_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.multiSurface,i=o.surface,n=o.multiCurve;let a;return Array.isArray(e)?a='Envelope':(a=e.getType(),'MultiPolygon'===a&&!0===r?a='MultiSurface':'Polygon'===a&&!0===i?a='Surface':'MultiLineString'===a&&!0===n&&(a='MultiCurve')),Un('http://www.opengis.net/gml',a)},of.prototype.writeFeatureElement=function(e,t,o){const r=t.getId();r&&e.setAttribute('fid',r);const i=o[o.length-1],n=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[n]={});const s=t.getProperties(),l=[],d=[];for(const r in s){const e=s[r];null!==e&&(l.push(r),d.push(e),r==a||e instanceof Ep?!(r in i.serializers[n])&&(i.serializers[n][r]=Jn(this.writeGeometryElement,this)):!(r in i.serializers[n])&&(i.serializers[n][r]=Jn(fa)))}const p=Ad({},i);p.node=e,na(p,i.serializers,$n(void 0,n),d,o,l)},of.prototype.writeCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.srsName;if('LineStringSegment'!==e.nodeName&&i&&e.setAttribute('srsName',i),'LineString'===e.nodeName||'LineStringSegment'===e.nodeName){const r=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(r),this.writeCoordinates_(r,t,o)}else if('Curve'===e.nodeName){const r=Un(e.namespaceURI,'segments');e.appendChild(r),this.writeCurveSegments_(r,t,o)}},of.prototype.writeLineStringOrCurveMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeCurveOrLineString_(r,t,o))},of.prototype.writeMultiCurveOrLineString_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.curve;n&&e.setAttribute('srsName',n);const s=t.getLineStrings();na({node:e,hasZ:i,srsName:n,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},of.prototype.writeGeometryElement=function(e,t,o){const r=o[o.length-1],i=Ad({},r);i.node=e;let n;n=Array.isArray(t)?r.dataProjection?et(t,r.featureProjection,r.dataProjection):t:Nn(t,!0,r),na(i,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[n],o,void 0,this)},of.prototype.createCoordinatesNode_=function(e){const t=Un(e,'coordinates');return t.setAttribute('decimal','.'),t.setAttribute('cs',','),t.setAttribute('ts',' '),t},of.prototype.writeCoordinates_=function(e,t,o){const r=o[o.length-1],n=r.hasZ,a=r.srsName,s=t.getCoordinates(),l=s.length,d=Array(l);for(let r=0;r<l;++r){const e=s[r];d[r]=this.getCoords_(e,a,n)}fa(e,d.join(' '))},of.prototype.writeCurveSegments_=function(e,t,o){const r=Un(e.namespaceURI,'LineStringSegment');e.appendChild(r),this.writeCurveOrLineString_(r,t,o)},of.prototype.writeSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;if('PolygonPatch'!==e.nodeName&&n&&e.setAttribute('srsName',n),'Polygon'===e.nodeName||'PolygonPatch'===e.nodeName){const r=t.getLinearRings();na({node:e,hasZ:i,srsName:n},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,r,o,void 0,this)}else if('Surface'===e.nodeName){const r=Un(e.namespaceURI,'patches');e.appendChild(r),this.writeSurfacePatches_(r,t,o)}},of.prototype.RING_NODE_FACTORY_=function(e,t){const o=t[t.length-1],r=o.node,i=o.exteriorWritten;return void 0===i&&(o.exteriorWritten=!0),Un(r.namespaceURI,void 0===i?'outerBoundaryIs':'innerBoundaryIs')},of.prototype.writeSurfacePatches_=function(e,t,o){const r=Un(e.namespaceURI,'PolygonPatch');e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o)},of.prototype.writeRing_=function(e,t,o){const r=Un(e.namespaceURI,'LinearRing');e.appendChild(r),this.writeLinearRing_(r,t,o)},of.prototype.getCoords_=function(e,t,o){let r='enu';t&&(r=Ve(t).getAxisOrientation());let i='en'===r.substr(0,2)?e[0]+','+e[1]:e[1]+','+e[0];if(o){const t=e[2]||0;i+=','+t}return i},of.prototype.writePoint_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;n&&e.setAttribute('srsName',n);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const s=t.getCoordinates(),l=this.getCoords_(s,n,i);fa(a,l)},of.prototype.writeMultiPoint_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName;n&&e.setAttribute('srsName',n);const a=t.getPoints();na({node:e,hasZ:i,srsName:n},this.POINTMEMBER_SERIALIZERS_,$n('pointMember'),a,o,void 0,this)},of.prototype.writePointMember_=function(e,t,o){const r=Un(e.namespaceURI,'Point');e.appendChild(r),this.writePoint_(r,t,o)},of.prototype.writeLinearRing_=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(n),this.writeCoordinates_(n,t,o)},of.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){const r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.surface;n&&e.setAttribute('srsName',n);const s=t.getPolygons();na({node:e,hasZ:i,srsName:n,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,o,void 0,this)},of.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){const r=this.GEOMETRY_NODE_FACTORY_(t,o);r&&(e.appendChild(r),this.writeSurfaceOrPolygon_(r,t,o))},of.prototype.writeEnvelope=function(e,t,o){const r=o[o.length-1],i=r.srsName;i&&e.setAttribute('srsName',i);const n=[t[0]+' '+t[1],t[2]+' '+t[3]];na({node:e},this.ENVELOPE_SERIALIZERS_,Xh,n,o,['lowerCorner','upperCorner'],this)};const rf={MultiLineString:'lineStringMember',MultiCurve:'curveMember',MultiPolygon:'polygonMember',MultiSurface:'surfaceMember'};of.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t){const o=t[t.length-1].node;return Un('http://www.opengis.net/gml',rf[o.nodeName])},of.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{coordinates:Hn(of.prototype.readFlatCoordinates_)}},of.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{innerBoundaryIs:of.prototype.innerBoundaryIsParser_,outerBoundaryIs:of.prototype.outerBoundaryIsParser_}},of.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Kn(of.prototype.readFlatCoordinates_)}},of.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:Hn(Jh.prototype.readPoint),MultiPoint:Hn(Jh.prototype.readMultiPoint),LineString:Hn(Jh.prototype.readLineString),MultiLineString:Hn(Jh.prototype.readMultiLineString),LinearRing:Hn(Jh.prototype.readLinearRing),Polygon:Hn(Jh.prototype.readPolygon),MultiPolygon:Hn(Jh.prototype.readMultiPolygon),Box:Hn(of.prototype.readBox_)}},of.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Jn(of.prototype.writeCurveOrLineString_),MultiCurve:Jn(of.prototype.writeMultiCurveOrLineString_),Point:Jn(of.prototype.writePoint_),MultiPoint:Jn(of.prototype.writeMultiPoint_),LineString:Jn(of.prototype.writeCurveOrLineString_),MultiLineString:Jn(of.prototype.writeMultiCurveOrLineString_),LinearRing:Jn(of.prototype.writeLinearRing_),Polygon:Jn(of.prototype.writeSurfaceOrPolygon_),MultiPolygon:Jn(of.prototype.writeMultiSurfaceOrPolygon_),Surface:Jn(of.prototype.writeSurfaceOrPolygon_),MultiSurface:Jn(of.prototype.writeMultiSurfaceOrPolygon_),Envelope:Jn(of.prototype.writeEnvelope)}},of.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Jn(of.prototype.writeLineStringOrCurveMember_),curveMember:Jn(of.prototype.writeLineStringOrCurveMember_)}},of.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:Jn(of.prototype.writeRing_),innerBoundaryIs:Jn(of.prototype.writeRing_)}},of.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Jn(of.prototype.writePointMember_)}},of.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Jn(of.prototype.writeSurfaceOrPolygonMember_),polygonMember:Jn(of.prototype.writeSurfaceOrPolygonMember_)}},of.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Jn(fa),upperCorner:Jn(fa)}};var nf=of;const af=function(e){const t=e?e:{};Kh.call(this),this.defaultDataProjection=Ve('EPSG:4326'),this.readExtensions_=t.readExtensions};i(af,Kh);const sf=[null,'http://www.topografix.com/GPX/1/0','http://www.topografix.com/GPX/1/1'],lf={rte:Ra,trk:Ia,wpt:La},df=ta(sf,{rte:Kn(Ra),trk:Kn(Ia),wpt:Kn(La)}),pf=ta(sf,{text:qn(ua,'linkText'),type:qn(ua,'linkType')}),gf=ta(sf,{name:qn(ua),cmt:qn(ua),desc:qn(ua),src:qn(ua),link:Sa,number:qn(ga),extensions:Ca,type:qn(ua),rtept:function(e,t){const o=ra({},_f,e,t);if(o){const r=t[t.length-1],i=r.flatCoordinates,n=r.layoutOptions;Ea(i,n,e,o)}}}),_f=ta(sf,{ele:qn(da),time:qn(la)}),uf=ta(sf,{name:qn(ua),cmt:qn(ua),desc:qn(ua),src:qn(ua),link:Sa,number:qn(ga),type:qn(ua),extensions:Ca,trkseg:function(e,t){const o=t[t.length-1];oa(cf,e,t);const r=o.flatCoordinates,i=o.ends;i.push(r.length)}}),cf=ta(sf,{trkpt:function(e,t){const o=ra({},yf,e,t);if(o){const r=t[t.length-1],i=r.flatCoordinates,n=r.layoutOptions;Ea(i,n,e,o)}}}),yf=ta(sf,{ele:qn(da),time:qn(la)}),mf=ta(sf,{ele:qn(da),time:qn(la),magvar:qn(da),geoidheight:qn(da),name:qn(ua),cmt:qn(ua),desc:qn(ua),src:qn(ua),link:Sa,sym:qn(ua),type:qn(ua),fix:qn(ua),sat:qn(ga),hdop:qn(da),vdop:qn(da),pdop:qn(da),ageofdgpsdata:qn(da),dgpsid:qn(ga),extensions:Ca}),hf=['text','type'],ff=ta(sf,{text:Jn(fa),type:Jn(fa)}),xf=ta(sf,['name','cmt','desc','src','link','number','type','rtept']),Ef=ta(sf,{name:Jn(fa),cmt:Jn(fa),desc:Jn(fa),src:Jn(fa),link:Jn(Pa),number:Jn(ha),type:Jn(fa),rtept:Qn(Jn(va))}),Tf=ta(sf,['ele','time']),Sf=ta(sf,['name','cmt','desc','src','link','number','type','trkseg']),Cf=ta(sf,{name:Jn(fa),cmt:Jn(fa),desc:Jn(fa),src:Jn(fa),link:Jn(Pa),number:Jn(ha),type:Jn(fa),trkseg:Qn(Jn(function(e,t,o){const r={node:e,geometryLayout:t.getLayout(),properties:{}};na(r,If,Rf,t.getCoordinates(),o)}))}),Rf=$n('trkpt'),If=ta(sf,{trkpt:Jn(va)}),Lf=ta(sf,['ele','time','magvar','geoidheight','name','cmt','desc','src','link','sym','type','fix','sat','hdop','vdop','pdop','ageofdgpsdata','dgpsid']),Pf=ta(sf,{ele:Jn(ma),time:Jn(function(e,t){const o=new Date(1e3*t),r=o.getUTCFullYear()+'-'+Vo(o.getUTCMonth()+1,2)+'-'+Vo(o.getUTCDate(),2)+'T'+Vo(o.getUTCHours(),2)+':'+Vo(o.getUTCMinutes(),2)+':'+Vo(o.getUTCSeconds(),2)+'Z';e.appendChild(Vh.createTextNode(r))}),magvar:Jn(ma),geoidheight:Jn(ma),name:Jn(fa),cmt:Jn(fa),desc:Jn(fa),src:Jn(fa),link:Jn(Pa),sym:Jn(fa),type:Jn(fa),fix:Jn(fa),sat:Jn(ha),hdop:Jn(ma),vdop:Jn(ma),pdop:Jn(ma),ageofdgpsdata:Jn(ma),dgpsid:Jn(ha)}),vf={Point:'wpt',LineString:'rte',MultiLineString:'trk'},Ff=ta(sf,{rte:Jn(function(e,t,o){const r=o[0],i=t.getProperties(),n={node:e,properties:i};let a=t.getGeometry();a&&(a=Nn(a,!0,r),n.geometryLayout=a.getLayout(),i.rtept=a.getCoordinates());const s=o[o.length-1].node,l=xf[s.namespaceURI],d=ea(i,l);na(n,Ef,Xh,d,o,l)}),trk:Jn(function(e,t,o){const r=o[0],i=t.getProperties();let n=t.getGeometry();n&&(n=Nn(n,!0,r),i.trkseg=n.getLineStrings());const a=o[o.length-1].node,s=Sf[a.namespaceURI],l=ea(i,s);na({node:e,properties:i},Cf,Xh,l,o,s)}),wpt:Jn(function(e,t,o){const r=o[0],i=o[o.length-1];i.properties=t.getProperties();let n=t.getGeometry();n&&(n=Nn(n,!0,r),i.geometryLayout=n.getLayout(),va(e,n.getCoordinates(),o))})});af.prototype.handleReadExtensions_=function(e){e||(e=[]);for(let t=0,o=e.length;t<o;++t){const o=e[t];if(this.readExtensions_){const e=o.get('extensionsNode_')||null;this.readExtensions_(o,e)}o.set('extensionsNode_',void 0)}},af.prototype.readFeature,af.prototype.readFeatureFromNode=function(e,t){if(!kt(sf,e.namespaceURI))return null;const o=lf[e.localName];if(!o)return null;const r=o(e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_([r]),r):null},af.prototype.readFeatures,af.prototype.readFeaturesFromNode=function(e,t){if(!kt(sf,e.namespaceURI))return[];if('gpx'==e.localName){const o=ra([],df,e,[this.getReadOptions(e,t)]);return o?(this.handleReadExtensions_(o),o):[]}return[]},af.prototype.readProjection,af.prototype.writeFeatures,af.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);const o=Un('http://www.topografix.com/GPX/1/1','gpx');return o.setAttributeNS('http://www.w3.org/2000/xmlns/','xmlns:xsi',zh),o.setAttributeNS(zh,'xsi:schemaLocation','http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd'),o.setAttribute('version','1.1'),o.setAttribute('creator','OpenLayers'),na({node:o},Ff,xa,e,[t]),o};const Of=function(e){Ep.call(this),this.geometries_=e?e:null,this.listenGeometriesChange_()};i(Of,Ep),Of.prototype.unlistenGeometriesChange_=function(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)m(this.geometries_[e],Yd.CHANGE,this.changed,this)},Of.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)c(this.geometries_[e],Yd.CHANGE,this.changed,this)},Of.prototype.clone=function(){const e=new Of(null);return e.setGeometries(this.geometries_),e},Of.prototype.closestPointXY=function(e,t,o,r){if(r<F(this.getExtent(),e,t))return r;const n=this.geometries_;for(let a=0,i=n.length;a<i;++a)r=n[a].closestPointXY(e,t,o,r);return r},Of.prototype.containsXY=function(e,t){const o=this.geometries_;for(let r=0,i=o.length;r<i;++r)if(o[r].containsXY(e,t))return!0;return!1},Of.prototype.computeExtent=function(e){D(e);const t=this.geometries_;for(let o=0,r=t.length;o<r;++o)B(e,t[o].getExtent());return e},Of.prototype.getGeometries=function(){return Fa(this.geometries_)},Of.prototype.getGeometriesArray=function(){return this.geometries_},Of.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!=this.getRevision()&&(a(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),0>e||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];else{const o=[],r=this.geometries_;let n=!1;for(let t=0,i=r.length;t<i;++t){const i=r[t],a=i.getSimplifiedGeometry(e);o.push(a),a!==i&&(n=!0)}if(n){const e=new Of(null);return e.setGeometriesArray(o),this.simplifiedGeometryCache[t]=e,e}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}},Of.prototype.getType=function(){return ep.GEOMETRY_COLLECTION},Of.prototype.intersectsExtent=function(e){const t=this.geometries_;for(let o=0,r=t.length;o<r;++o)if(t[o].intersectsExtent(e))return!0;return!1},Of.prototype.isEmpty=function(){return 0===this.geometries_.length},Of.prototype.rotate=function(e,t){const o=this.geometries_;for(let r=0,i=o.length;r<i;++r)o[r].rotate(e,t);this.changed()},Of.prototype.scale=function(e,t,o){let r=o;r||(r=Q(this.getExtent()));const n=this.geometries_;for(let a=0,i=n.length;a<i;++a)n[a].scale(e,t,r);this.changed()},Of.prototype.setGeometries=function(e){this.setGeometriesArray(Fa(e))},Of.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()},Of.prototype.applyTransform=function(e){const t=this.geometries_;for(let o=0,r=t.length;o<r;++o)t[o].applyTransform(e);this.changed()},Of.prototype.translate=function(e,t){const o=this.geometries_;for(let r=0,i=o.length;r<i;++r)o[r].translate(e,t);this.changed()},Of.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),Ep.prototype.disposeInternal.call(this)};var wf=Of;const Nf=function(e){const t=e?e:{};Uh.call(this),this.defaultDataProjection=Ve(t.defaultDataProjection?t.defaultDataProjection:'EPSG:4326'),t.featureProjection&&(this.defaultFeatureProjection=Ve(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName};i(Nf,Uh);const Af={Point:function(e){return new wg(e.coordinates)},LineString:function(e){return new Gg(e.coordinates)},Polygon:function(e){return new Ag(e.coordinates)},MultiPoint:function(e){return new oc(e.coordinates)},MultiLineString:function(e){return new ec(e.coordinates)},MultiPolygon:function(e){return new ic(e.coordinates)},GeometryCollection:function(e,t){const o=e.geometries.map(function(e){return Oa(e,t)});return new wf(o)}},bf={Point:function(e){return{type:'Point',coordinates:e.getCoordinates()}},LineString:function(e){return{type:'LineString',coordinates:e.getCoordinates()}},Polygon:function(e,t){let o;return t&&(o=t.rightHanded),{type:'Polygon',coordinates:e.getCoordinates(o)}},MultiPoint:function(e){return{type:'MultiPoint',coordinates:e.getCoordinates()}},MultiLineString:function(e){return{type:'MultiLineString',coordinates:e.getCoordinates()}},MultiPolygon:function(e,t){let o;return t&&(o=t.rightHanded),{type:'MultiPolygon',coordinates:e.getCoordinates(o)}},GeometryCollection:function(e,t){const o=e.getGeometriesArray().map(function(e){const o=Ad({},t);return delete o.featureProjection,wa(e,o)});return{type:'GeometryCollection',geometries:o}},Circle:function(){return{type:'GeometryCollection',geometries:[]}}};Nf.prototype.readFeature,Nf.prototype.readFeatures,Nf.prototype.readFeatureFromObject=function(e,t){let o=null;o='Feature'===e.type?e:{type:'Feature',geometry:e};const r=Oa(o.geometry,t),i=new Cg;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&void 0!==o.geometry_name&&i.setGeometryName(o.geometry_name),i.setGeometry(r),void 0!==o.id&&i.setId(o.id),o.properties&&i.setProperties(o.properties),i},Nf.prototype.readFeaturesFromObject=function(e,t){let o=null;if('FeatureCollection'===e.type){o=[];const r=e.features;for(let e=0,i=r.length;e<i;++e)o.push(this.readFeatureFromObject(r[e],t))}else o=[this.readFeatureFromObject(e,t)];return o},Nf.prototype.readGeometry,Nf.prototype.readGeometryFromObject=function(e,t){return Oa(e,t)},Nf.prototype.readProjection,Nf.prototype.readProjectionFromObject=function(e){const t=e.crs;let o;return t?'name'==t.type?o=Ve(t.properties.name):R(!1,36):o=this.defaultDataProjection,o},Nf.prototype.writeFeature,Nf.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);const o={type:'Feature'},r=e.getId();void 0!==r&&(o.id=r);const i=e.getGeometry();o.geometry=i?wa(i,t):null;const n=e.getProperties();return delete n[e.getGeometryName()],o.properties=l(n)?null:n,o},Nf.prototype.writeFeatures,Nf.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);const o=[];for(let r=0,i=e.length;r<i;++r)o.push(this.writeFeatureObject(e[r],t));return{type:'FeatureCollection',features:o}},Nf.prototype.writeGeometry,Nf.prototype.writeGeometryObject=function(e,t){return wa(e,this.adaptOptions(t))};const Mf=function(){Dh.call(this)};i(Mf,Dh),Mf.prototype.getType=function(){return pc.TEXT},Mf.prototype.readFeature=function(e,t){return this.readFeatureFromText(Na(e),this.adaptOptions(t))},Mf.prototype.readFeatureFromText=function(){},Mf.prototype.readFeatures=function(e,t){return this.readFeaturesFromText(Na(e),this.adaptOptions(t))},Mf.prototype.readFeaturesFromText=function(){},Mf.prototype.readGeometry=function(e,t){return this.readGeometryFromText(Na(e),this.adaptOptions(t))},Mf.prototype.readGeometryFromText=function(){},Mf.prototype.readProjection=function(e){return this.readProjectionFromText(Na(e))},Mf.prototype.readProjectionFromText=function(){return this.defaultDataProjection},Mf.prototype.writeFeature=function(e,t){return this.writeFeatureText(e,this.adaptOptions(t))},Mf.prototype.writeFeatureText=function(){},Mf.prototype.writeFeatures=function(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))},Mf.prototype.writeFeaturesText=function(){},Mf.prototype.writeGeometry=function(e,t){return this.writeGeometryText(e,this.adaptOptions(t))},Mf.prototype.writeGeometryText=function(){};var Gf=Mf;const Df={BAROMETRIC:'barometric',GPS:'gps',NONE:'none'},kf=function(e){const t=e?e:{};Gf.call(this),this.defaultDataProjection=Ve('EPSG:4326'),this.altitudeMode_=t.altitudeMode?t.altitudeMode:Df.NONE};i(kf,Gf);const Uf=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Yf=/^H.([A-Z]{3}).*?:(.*)/,jf=/^HFDTE(\d{2})(\d{2})(\d{2})/,Bf=/\r\n|\r|\n/;kf.prototype.readFeature,kf.prototype.readFeatureFromText=function(e,t){const o=this.altitudeMode_,r=e.split(Bf),n={},a=[];let s=2e3,l=0,d=1,p=-1,g,i;for(g=0,i=r.length;g<i;++g){const e=r[g];let t;if('B'!=e.charAt(0))'H'==e.charAt(0)&&(t=jf.exec(e),t?(d=parseInt(t[1],10),l=parseInt(t[2],10)-1,s=2e3+parseInt(t[3],10)):(t=Yf.exec(e),t&&(n[t[1]]=t[2].trim())));else if(t=Uf.exec(e),t){const e=parseInt(t[1],10),r=parseInt(t[2],10),i=parseInt(t[3],10);let n=parseInt(t[4],10)+parseInt(t[5],10)/6e4;'S'==t[6]&&(n=-n);let g=parseInt(t[7],10)+parseInt(t[8],10)/6e4;if('W'==t[9]&&(g=-g),a.push(g,n),o!=Df.NONE){let e;e=o==Df.GPS?parseInt(t[11],10):o==Df.BAROMETRIC?parseInt(t[12],10):0,a.push(e)}let _=Date.UTC(s,l,d,e,r,i);_<p&&(_=Date.UTC(s,l,d+1,e,r,i)),a.push(_/1e3),p=_}}if(0===a.length)return null;const _=new Gg(null),u=o==Df.NONE?Ig.XYM:Ig.XYZM;_.setFlatCoordinates(u,a);const c=new Cg(Nn(_,!1,t));return c.setProperties(n),c},kf.prototype.readFeatures,kf.prototype.readFeaturesFromText=function(e,t){const o=this.readFeatureFromText(e,t);return o?[o]:[]},kf.prototype.readProjection,kf.prototype.writeFeatureText=function(){},kf.prototype.writeFeaturesText=function(){},kf.prototype.writeGeometryText=function(){},kf.prototype.readGeometryFromText=function(){};var Vf={FRACTION:'fraction',PIXELS:'pixels'};const zf=function(e,t,o,r,i,n){Ud.call(this),this.hitDetectionImage_=null,this.image_=e?e:new Image,null!==r&&(this.image_.crossOrigin=r),this.canvas_=n?document.createElement('CANVAS'):null,this.color_=n,this.imageListenerKeys_=null,this.imageState_=i,this.size_=o,this.src_=t,this.tainting_=!1,this.imageState_==Gp.LOADED&&this.determineTainting_()};i(zf,Ud),zf.prototype.determineTainting_=function(){const e=Tt(1,1);try{e.drawImage(this.image_,0,0),e.getImageData(0,0,1,1)}catch(t){this.tainting_=!0}},zf.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(Yd.CHANGE)},zf.prototype.handleImageError_=function(){this.imageState_=Gp.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},zf.prototype.handleImageLoad_=function(){this.imageState_=Gp.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.determineTainting_(),this.replaceColor_(),this.dispatchChangeEvent_()},zf.prototype.getImage=function(){return this.canvas_?this.canvas_:this.image_},zf.prototype.getImageState=function(){return this.imageState_},zf.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.tainting_){const e=this.size_[0],t=this.size_[1],o=Tt(e,t);o.fillRect(0,0,e,t),this.hitDetectionImage_=o.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},zf.prototype.getSize=function(){return this.size_},zf.prototype.getSrc=function(){return this.src_},zf.prototype.load=function(){if(this.imageState_==Gp.IDLE){this.imageState_=Gp.LOADING,this.imageListenerKeys_=[y(this.image_,Yd.ERROR,this.handleImageError_,this),y(this.image_,Yd.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(t){this.handleImageError_()}}},zf.prototype.replaceColor_=function(){if(!(this.tainting_||null===this.color_)){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;const e=this.canvas_.getContext('2d');e.drawImage(this.image_,0,0);const t=e.getImageData(0,0,this.image_.width,this.image_.height),o=t.data,n=this.color_[0]/255,r=this.color_[1]/255,a=this.color_[2]/255;for(let e=0,t=o.length;e<t;e+=4)o[e]*=n,o[e+1]*=r,o[e+2]*=a;e.putImageData(t,0,0)}},zf.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(h),this.imageListenerKeys_=null};var Xf={BOTTOM_LEFT:'bottom-left',BOTTOM_RIGHT:'bottom-right',TOP_LEFT:'top-left',TOP_RIGHT:'top-right'};const Wf=function(e){const t=e||{};this.anchor_=t.anchor===void 0?[.5,.5]:t.anchor,this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin===void 0?Xf.TOP_LEFT:t.anchorOrigin,this.anchorXUnits_=t.anchorXUnits===void 0?Vf.FRACTION:t.anchorXUnits,this.anchorYUnits_=t.anchorYUnits===void 0?Vf.FRACTION:t.anchorYUnits,this.crossOrigin_=t.crossOrigin===void 0?null:t.crossOrigin;const o=t.img===void 0?null:t.img,r=t.imgSize===void 0?null:t.imgSize;let i=t.src;R(!(i!==void 0&&o),4),R(!o||o&&r,5),(i===void 0||0===i.length)&&o&&(i=o.src||n(o).toString()),R(i!==void 0&&0<i.length,6);const a=t.src===void 0?Gp.LOADED:Gp.IDLE;this.color_=t.color===void 0?null:yt(t.color),this.iconImage_=Aa(o,i,r,this.crossOrigin_,a,this.color_),this.offset_=t.offset===void 0?[0,0]:t.offset,this.offsetOrigin_=t.offsetOrigin===void 0?Xf.TOP_LEFT:t.offsetOrigin,this.origin_=null,this.size_=t.size===void 0?null:t.size;const s=t.opacity===void 0?1:t.opacity,l=t.rotateWithView!==void 0&&t.rotateWithView,d=t.rotation===void 0?0:t.rotation,p=t.scale===void 0?1:t.scale,g=!(t.snapToPixel!==void 0)||t.snapToPixel;pg.call(this,{opacity:s,rotation:d,scale:p,snapToPixel:g,rotateWithView:l})};i(Wf,pg),Wf.prototype.clone=function(){return new Wf({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null===this.size_?void 0:this.size_.slice(),opacity:this.getOpacity(),scale:this.getScale(),snapToPixel:this.getSnapToPixel(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},Wf.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;let e=this.anchor_;const t=this.getSize();if(this.anchorXUnits_==Vf.FRACTION||this.anchorYUnits_==Vf.FRACTION){if(!t)return null;e=this.anchor_.slice(),this.anchorXUnits_==Vf.FRACTION&&(e[0]*=t[0]),this.anchorYUnits_==Vf.FRACTION&&(e[1]*=t[1])}if(this.anchorOrigin_!=Xf.TOP_LEFT){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_==Xf.TOP_RIGHT||this.anchorOrigin_==Xf.BOTTOM_RIGHT)&&(e[0]=-e[0]+t[0]),(this.anchorOrigin_==Xf.BOTTOM_LEFT||this.anchorOrigin_==Xf.BOTTOM_RIGHT)&&(e[1]=-e[1]+t[1])}return this.normalizedAnchor_=e,this.normalizedAnchor_},Wf.prototype.getColor=function(){return this.color_},Wf.prototype.getImage=function(e){return this.iconImage_.getImage(e)},Wf.prototype.getImageSize=function(){return this.iconImage_.getSize()},Wf.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},Wf.prototype.getImageState=function(){return this.iconImage_.getImageState()},Wf.prototype.getHitDetectionImage=function(e){return this.iconImage_.getHitDetectionImage(e)},Wf.prototype.getOrigin=function(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!=Xf.TOP_LEFT){const t=this.getSize(),o=this.iconImage_.getSize();if(!t||!o)return null;e=e.slice(),(this.offsetOrigin_==Xf.TOP_RIGHT||this.offsetOrigin_==Xf.BOTTOM_RIGHT)&&(e[0]=o[0]-t[0]-e[0]),(this.offsetOrigin_==Xf.BOTTOM_LEFT||this.offsetOrigin_==Xf.BOTTOM_RIGHT)&&(e[1]=o[1]-t[1]-e[1])}return this.origin_=e,this.origin_},Wf.prototype.getSrc=function(){return this.iconImage_.getSrc()},Wf.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},Wf.prototype.listenImageChange=function(e,t){return c(this.iconImage_,Yd.CHANGE,e,t)},Wf.prototype.load=function(){this.iconImage_.load()},Wf.prototype.unlistenImageChange=function(e,t){m(this.iconImage_,Yd.CHANGE,e,t)};var Kf=Wf;let Hf=null,Zf=null,qf=null,Jf=null,Qf=null,$f=null,ex,tx,ox,rx,ix,nx,ax,sx,lx;const dx=function(e){const t=e?e:{};Kh.call(this),$f||ba(),this.defaultDataProjection=Ve('EPSG:4326'),this.defaultStyle_=t.defaultStyle?t.defaultStyle:$f,this.extractStyles_=!(t.extractStyles!==void 0)||t.extractStyles,this.writeStyles_=!(t.writeStyles!==void 0)||t.writeStyles,this.sharedStyles_={},this.showPointNames_=!(t.showPointNames!==void 0)||t.showPointNames};i(dx,Kh);const px=['http://www.google.com/kml/ext/2.2'],gx=[null,'http://earth.google.com/kml/2.0','http://earth.google.com/kml/2.1','http://earth.google.com/kml/2.2','http://www.opengis.net/kml/2.2'],_x={fraction:Vf.FRACTION,pixels:Vf.PIXELS,insetPixels:Vf.PIXELS},ux=ta(gx,{Pair:function(e,t){const o=ra({},Ox,e,t);if(o){const e=o.key;if(e&&'normal'==e){const e=o.styleUrl;e&&(t[t.length-1]=e);const r=o.Style;r&&(t[t.length-1]=r)}}}}),cx=ta(gx,{Icon:qn(function(e,t){const o=ra({},Tx,e,t);return o?o:null}),heading:qn(da),hotSpot:qn(function(e){const t=e.getAttribute('xunits'),o=e.getAttribute('yunits');let r;return r='insetPixels'===t?'insetPixels'===o?Xf.TOP_RIGHT:Xf.BOTTOM_RIGHT:'insetPixels'===o?Xf.TOP_LEFT:Xf.BOTTOM_LEFT,{x:parseFloat(e.getAttribute('x')),xunits:_x[t],y:parseFloat(e.getAttribute('y')),yunits:_x[o],origin:r}}),scale:qn(ja)}),yx=ta(gx,{color:qn(ka),scale:qn(ja)}),mx=ta(gx,{color:qn(ka),width:qn(da)}),hx=ta(gx,{color:qn(ka),fill:qn(aa),outline:qn(aa)}),fx=ta(gx,{coordinates:Hn(Ua)}),xx=ta(px,{Track:Kn(Ha)}),Ex=ta(gx,{when:function(e,t){const o=t[t.length-1],r=o.whens,i=Yn(e,!1),n=Date.parse(i);r.push(isNaN(n)?0:n)}},ta(px,{coord:function(e,t){const o=t[t.length-1],r=o.flatCoordinates,i=Yn(e,!1),n=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i,a=n.exec(i);if(a){const e=parseFloat(a[1]),t=parseFloat(a[2]),o=parseFloat(a[3]);r.push(e,t,o,0)}else r.push(0,0,0,0)}})),Tx=ta(gx,{href:qn(Ya)},ta(px,{x:qn(da),y:qn(da),w:qn(da),h:qn(da)})),Sx=ta(gx,{coordinates:Hn(Ua)}),Cx=ta(gx,{extrude:qn(aa),tessellate:qn(aa),altitudeMode:qn(ua)}),Rx=ta(gx,{LineString:Kn(qa),LinearRing:Kn(Ja),MultiGeometry:Kn(Qa),Point:Kn($a),Polygon:Kn(es)}),Ix=ta(gx,{innerBoundaryIs:function(e,t){const o=ra(void 0,bx,e,t);if(o){const e=t[t.length-1];e.push(o)}},outerBoundaryIs:function(e,t){const o=ra(void 0,Mx,e,t);if(o){const e=t[t.length-1];e[0]=o}}}),Lx=ta(gx,{IconStyle:Va,LabelStyle:za,LineStyle:Xa,PolyStyle:Wa}),Px=ta(gx,{displayName:qn(ua),value:qn(ua)}),vx=ta(gx,{Data:function(e,t){const o=e.getAttribute('name');oa(Px,e,t);const r=t[t.length-1];null===o?null!==r.displayName&&(r[r.displayName]=r.value):r[o]=r.value,delete r.value},SchemaData:function(e,t){oa(wx,e,t)}}),Fx=ta(gx,{LatLonAltBox:function(e,t){const o=ra({},Nx,e,t);if(o){const e=t[t.length-1],r=[parseFloat(o.west),parseFloat(o.south),parseFloat(o.east),parseFloat(o.north)];e.extent=r,e.altitudeMode=o.altitudeMode,e.minAltitude=parseFloat(o.minAltitude),e.maxAltitude=parseFloat(o.maxAltitude)}},Lod:function(e,t){const o=ra({},Ax,e,t);if(o){const e=t[t.length-1];e.minLodPixels=parseFloat(o.minLodPixels),e.maxLodPixels=parseFloat(o.maxLodPixels),e.minFadeExtent=parseFloat(o.minFadeExtent),e.maxFadeExtent=parseFloat(o.maxFadeExtent)}}}),Ox=ta(gx,{Style:qn(ts),key:qn(ua),styleUrl:qn(Ya)}),wx=ta(gx,{SimpleData:function(e,t){const o=e.getAttribute('name');if(null!==o){const r=ua(e),i=t[t.length-1];i[o]=r}}}),Nx=ta(gx,{altitudeMode:qn(ua),minAltitude:qn(da),maxAltitude:qn(da),north:qn(da),south:qn(da),east:qn(da),west:qn(da)}),Ax=ta(gx,{minLodPixels:qn(da),maxLodPixels:qn(da),minFadeExtent:qn(da),maxFadeExtent:qn(da)}),bx=ta(gx,{LinearRing:Hn(Ka)}),Mx=ta(gx,{LinearRing:Hn(Ka)}),Gx=ta(gx,{ExtendedData:rs,Region:is,Link:function(e,t){oa(Dx,e,t)},address:qn(ua),description:qn(ua),name:qn(ua),open:qn(aa),phoneNumber:qn(ua),visibility:qn(aa)}),Dx=ta(gx,{href:qn(Ya)}),kx=ta(gx,{ExtendedData:rs,Region:is,MultiGeometry:qn(Qa,'geometry'),LineString:qn(qa,'geometry'),LinearRing:qn(Ja,'geometry'),Point:qn($a,'geometry'),Polygon:qn(es,'geometry'),Style:qn(ts),StyleMap:function(e,t){const o=Ba(e,t);if(o){const e=t[t.length-1];Array.isArray(o)?e.Style=o:'string'==typeof o?e.styleUrl=o:R(!1,38)}},address:qn(ua),description:qn(ua),name:qn(ua),open:qn(aa),phoneNumber:qn(ua),styleUrl:qn(Ya),visibility:qn(aa)},ta(px,{MultiTrack:qn(function(e,t){const o=ra([],xx,e,t);if(o){const e=new ec(null);return e.setLineStrings(o),e}},'geometry'),Track:qn(Ha,'geometry')}));dx.prototype.readDocumentOrFolder_=function(e,t){const o=ta(gx,{Document:Wn(this.readDocumentOrFolder_,this),Folder:Wn(this.readDocumentOrFolder_,this),Placemark:Kn(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=ra([],o,e,t,this);return r?r:void 0},dx.prototype.readPlacemark_=function(e,t){const o=ra({geometry:null},kx,e,t);if(o){const r=new Cg,i=e.getAttribute('id');null!==i&&r.setId(i);const n=t[0],a=o.geometry;if(a&&Nn(a,!1,n),r.setGeometry(a),delete o.geometry,this.extractStyles_){const e=o.Style,t=o.styleUrl,i=Ga(e,t,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(i)}return delete o.Style,r.setProperties(o),r}},dx.prototype.readSharedStyle_=function(e,t){const o=e.getAttribute('id');if(null!==o){const r=ts(e,t);if(r){let t=e.baseURI,i;if(t&&'about:blank'!=t||(t=window.location.href),t){const e=new URL('#'+o,t);i=e.href}else i='#'+o;this.sharedStyles_[i]=r}}},dx.prototype.readSharedStyleMap_=function(e,t){const o=e.getAttribute('id');if(null===o)return;const r=Ba(e,t);if(!r)return;let i=e.baseURI,n;if(i&&'about:blank'!=i||(i=window.location.href),i){const e=new URL('#'+o,i);n=e.href}else n='#'+o;this.sharedStyles_[n]=r},dx.prototype.readFeature,dx.prototype.readFeatureFromNode=function(e,t){if(!kt(gx,e.namespaceURI))return null;const o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o?o:null},dx.prototype.readFeatures,dx.prototype.readFeaturesFromNode=function(e,t){if(!kt(gx,e.namespaceURI))return[];let o;const r=e.localName;if('Document'==r||'Folder'==r)return o=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),o?o:[];if('Placemark'==r){const o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o?[o]:[]}if('kml'==r){o=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=this.readFeaturesFromNode(r,t);e&&jt(o,e)}return o}return[]},dx.prototype.readName=function(e){if(Bn(e))return this.readNameFromDocument(e);if(Vn(e))return this.readNameFromNode(e);if('string'==typeof e){const t=Xn(e);return this.readNameFromDocument(t)}},dx.prototype.readNameFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const e=this.readNameFromNode(t);if(e)return e}},dx.prototype.readNameFromNode=function(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(kt(gx,t.namespaceURI)&&'name'==t.localName)return ua(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const e=t.localName;if(kt(gx,t.namespaceURI)&&('Document'==e||'Folder'==e||'Placemark'==e||'kml'==e)){const e=this.readNameFromNode(t);if(e)return e}}},dx.prototype.readNetworkLinks=function(e){const t=[];if(Bn(e))jt(t,this.readNetworkLinksFromDocument(e));else if(Vn(e))jt(t,this.readNetworkLinksFromNode(e));else if('string'==typeof e){const o=Xn(e);jt(t,this.readNetworkLinksFromDocument(o))}return t},dx.prototype.readNetworkLinksFromDocument=function(e){const t=[];for(let o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&jt(t,this.readNetworkLinksFromNode(o));return t},dx.prototype.readNetworkLinksFromNode=function(e){const t=[];for(let o=e.firstElementChild;o;o=o.nextElementSibling)if(kt(gx,o.namespaceURI)&&'NetworkLink'==o.localName){const e=ra({},Gx,o,[]);t.push(e)}for(let o=e.firstElementChild;o;o=o.nextElementSibling){const e=o.localName;kt(gx,o.namespaceURI)&&('Document'==e||'Folder'==e||'kml'==e)&&jt(t,this.readNetworkLinksFromNode(o))}return t},dx.prototype.readRegion=function(e){const t=[];if(Bn(e))jt(t,this.readRegionFromDocument(e));else if(Vn(e))jt(t,this.readRegionFromNode(e));else if('string'==typeof e){const o=Xn(e);jt(t,this.readRegionFromDocument(o))}return t},dx.prototype.readRegionFromDocument=function(e){const t=[];for(let o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&jt(t,this.readRegionFromNode(o));return t},dx.prototype.readRegionFromNode=function(e){const t=[];for(let o=e.firstElementChild;o;o=o.nextElementSibling)if(kt(gx,o.namespaceURI)&&'Region'==o.localName){const e=ra({},Fx,o,[]);t.push(e)}for(let o=e.firstElementChild;o;o=o.nextElementSibling){const e=o.localName;kt(gx,o.namespaceURI)&&('Document'==e||'Folder'==e||'kml'==e)&&jt(t,this.readRegionFromNode(o))}return t},dx.prototype.readProjection;const Ux=ta(gx,{Data:Jn(function(e,t,o){e.setAttribute('name',t.name);const r={node:e},i=t.value;'object'==typeof i?(null!==i&&i.displayName&&na(r,Ux,Xh,[i.displayName],o,['displayName']),null!==i&&i.value&&na(r,Ux,Xh,[i.value],o,['value'])):na(r,Ux,Xh,[i],o,['value'])}),value:Jn(function(e,t){fa(e,t)}),displayName:Jn(function(e,t){ya(e,t)})}),Yx=ta(gx,{Placemark:Jn(ls)}),jx=function(e,t){const o=t[t.length-1].node;return Un(o.namespaceURI,'Placemark')},Bx=$n('Data'),Vx=ta(gx,['href'],ta(px,['x','y','w','h'])),zx=ta(gx,{href:Jn(fa)},ta(px,{x:Jn(ma),y:Jn(ma),w:Jn(ma),h:Jn(ma)})),Xx=function(e,t,o){return Un(px[0],'gx:'+o)},Wx=ta(gx,['scale','heading','Icon','hotSpot']),Kx=ta(gx,{Icon:Jn(function(e,t,o){const r={node:e},i=o[o.length-1].node;let n=Vx[i.namespaceURI],a=ea(t,n);na(r,zx,Xh,a,o,n),n=Vx[px[0]],a=ea(t,n),na(r,zx,Xx,a,o,n)}),heading:Jn(ma),hotSpot:Jn(function(e,t){e.setAttribute('x',t.x),e.setAttribute('y',t.y),e.setAttribute('xunits',t.xunits),e.setAttribute('yunits',t.yunits)}),scale:Jn(gs)}),Hx=ta(gx,['color','scale']),Zx=ta(gx,{color:Jn(ns),scale:Jn(gs)}),qx=ta(gx,['color','width']),Jx=ta(gx,{color:Jn(ns),width:Jn(ma)}),Qx={Point:'Point',LineString:'LineString',LinearRing:'LinearRing',Polygon:'Polygon',MultiPoint:'MultiGeometry',MultiLineString:'MultiGeometry',MultiPolygon:'MultiGeometry',GeometryCollection:'MultiGeometry'},$x=function(e,t){if(e){const o=t[t.length-1].node;return Un(o.namespaceURI,Qx[e.getType()])}},eE=$n('Point'),tE=$n('LineString'),oE=$n('LinearRing'),rE=$n('Polygon'),iE=ta(gx,{LineString:Jn(ds),Point:Jn(ds),Polygon:Jn(ps),GeometryCollection:Jn(as)}),nE=ta(gx,{LinearRing:Jn(ds)}),aE=ta(gx,{ExtendedData:Jn(function(e,t,o){const r={node:e},n=t.names,a=t.values,s=n.length;for(let l=0;l<s;l++)na(r,Ux,Bx,[{name:n[l],value:a[l]}],o)}),MultiGeometry:Jn(as),LineString:Jn(ds),LinearRing:Jn(ds),Point:Jn(ds),Polygon:Jn(ps),Style:Jn(function(e,t,o){const r={},i=t.getFill(),n=t.getStroke(),a=t.getImage(),s=t.getText();a instanceof Kf&&(r.IconStyle=a),s&&(r.LabelStyle=s),n&&(r.LineStyle=n),i&&(r.PolyStyle=i);const l=o[o.length-1].node,d=mE[l.namespaceURI],p=ea(r,d);na({node:e},hE,Xh,p,o,d)}),address:Jn(fa),description:Jn(fa),name:Jn(fa),open:Jn(ca),phoneNumber:Jn(fa),styleUrl:Jn(fa),visibility:Jn(ca)}),sE=ta(gx,['name','open','visibility','address','phoneNumber','description','styleUrl','Style']),lE=$n('ExtendedData'),dE=ta(gx,['extrude','tessellate','altitudeMode','coordinates']),pE=ta(gx,{extrude:Jn(ca),tessellate:Jn(ca),altitudeMode:Jn(fa),coordinates:Jn(function(e,t,o){const r=o[o.length-1],i=r.layout,n=r.stride;let a;i==Ig.XY||i==Ig.XYM?a=2:i==Ig.XYZ||i==Ig.XYZM?a=3:R(!1,34);const s=t.length;let l='';if(0<s){l+=t[0];for(let e=1;e<a;++e)l+=','+t[e];for(let e=n;e<s;e+=n){l+=' '+t[e];for(let o=1;o<a;++o)l+=','+t[e+o]}}fa(e,l)})}),gE=ta(gx,{outerBoundaryIs:Jn(ss),innerBoundaryIs:Jn(ss)}),_E=$n('innerBoundaryIs'),uE=$n('outerBoundaryIs'),cE=ta(gx,{color:Jn(ns)}),yE=$n('color'),mE=ta(gx,['IconStyle','LabelStyle','LineStyle','PolyStyle']),hE=ta(gx,{IconStyle:Jn(function(e,t,o){const r={},i=t.getSrc(),n=t.getSize(),a=t.getImageSize(),s={href:i};if(n){s.w=n[0],s.h=n[1];const e=t.getAnchor(),o=t.getOrigin();if(o&&a&&0!==o[0]&&o[1]!==n[1]&&(s.x=o[0],s.y=a[1]-(o[1]+n[1])),e&&(e[0]!==n[0]/2||e[1]!==n[1]/2)){const t={x:e[0],xunits:Vf.PIXELS,y:n[1]-e[1],yunits:Vf.PIXELS};r.hotSpot=t}}r.Icon=s;const l=t.getScale();1!==l&&(r.scale=l);const d=t.getRotation();0!==d&&(r.heading=d);const p=o[o.length-1].node,g=Wx[p.namespaceURI],_=ea(r,g);na({node:e},Kx,Xh,_,o,g)}),LabelStyle:Jn(function(e,t,o){const r={},i=t.getFill();i&&(r.color=i.getColor());const n=t.getScale();n&&1!==n&&(r.scale=n);const a=o[o.length-1].node,s=Hx[a.namespaceURI],l=ea(r,s);na({node:e},Zx,Xh,l,o,s)}),LineStyle:Jn(function(e,t,o){const r={color:t.getColor(),width:t.getWidth()},i=o[o.length-1].node,n=qx[i.namespaceURI],a=ea(r,n);na({node:e},Jx,Xh,a,o,n)}),PolyStyle:Jn(function(e,t,o){na({node:e},cE,yE,[t.getColor()],o)})}),fE=ta(gx,['Document','Placemark']),xE=ta(gx,{Document:Jn(function(e,t,o){na({node:e},Yx,jx,t,o,void 0,this)}),Placemark:Jn(ls)});dx.prototype.writeFeatures,dx.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);const o=Un(gx[4],'kml'),r='http://www.w3.org/2000/xmlns/';o.setAttributeNS(r,'xmlns:gx',px[0]),o.setAttributeNS(r,'xmlns:xsi',zh),o.setAttributeNS(zh,'xsi:schemaLocation','http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd');const i={};1<e.length?i.Document=e:1==e.length&&(i.Placemark=e[0]);const n=fE[o.namespaceURI],a=ea(i,n);return na({node:o},xE,Xh,a,[t],n,this),o};var EE=o(3),TE=o.n(EE);const SE=function(e,t,o,r,i){this.extent_,this.id_=i,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=o,this.properties_=r},CE=tt();SE.prototype.get=function(e){return this.properties_[e]},SE.prototype.getEnds=SE.prototype.getEndss=function(){return this.ends_},SE.prototype.getExtent=function(){return this.extent_||(this.extent_=this.type_===ep.POINT?k(this.flatCoordinates_):Y(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_},SE.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){const e=Q(this.getExtent());this.flatInteriorPoints_=Io(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_},SE.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){const e=fi(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=Lo(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_},SE.prototype.getFlatMidpoint=function(){return this.flatMidpoints_||(this.flatMidpoints_=rr(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_},SE.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const o=this.ends_;for(let r=0,i=o.length;r<i;++r){const i=o[r],n=rr(e,t,i,2,.5);jt(this.flatMidpoints_,n),t=i}}return this.flatMidpoints_},SE.prototype.getId=function(){return this.id_},SE.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},SE.prototype.getFlatCoordinates=SE.prototype.getOrientedFlatCoordinates,SE.prototype.getGeometry=function(){return this},SE.prototype.getProperties=function(){return this.properties_},SE.prototype.getSimplifiedGeometry=SE.prototype.getGeometry,SE.prototype.getStride=function(){return 2},SE.prototype.getStyleFunction=T,SE.prototype.getType=function(){return this.type_},SE.prototype.transform=function(e){const t=e.getExtent(),o=e.getWorldExtent(),r=te(o)/te(t);pt(CE,o[0],o[3],r,-r,0,0,0),_e(this.flatCoordinates_,0,this.flatCoordinates_.length,2,CE,this.flatCoordinates_)};var RE=SE;const IE=function(e){Dh.call(this);const t=e?e:{};this.defaultDataProjection=new ap({code:'',units:ip.TILE_PIXELS}),this.featureClass_=t.featureClass?t.featureClass:RE,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:'layer',this.layers_=t.layers?t.layers:null,this.extent_=null};i(IE,Dh),IE.prototype.readRawGeometry_=function(e,t,o,r){e.pos=t.geometry;const i=e.readVarint()+e.pos;let n=1,a=0,s=0,l=0,d=0,p=0;for(;e.pos<i;){if(!a){const t=e.readVarint();n=7&t,a=t>>3}a--,1==n||2==n?(s+=e.readSVarint(),l+=e.readSVarint(),1==n&&d>p&&(r.push(d),p=d),o.push(s,l),d+=2):7==n?d>p&&(o.push(o[p],o[p+1]),d+=2):R(!1,59)}d>p&&(r.push(d),p=d)},IE.prototype.createFeature_=function(e,t,o){const r=t.type;if(0===r)return null;let i;const n=t.id,a=t.properties;a[this.layerName_]=t.layer.name;const s=[];let l=[];this.readRawGeometry_(e,t,s,l);const d=ms(r,l.length);if(this.featureClass_===RE)i=new this.featureClass_(d,s,l,a,n);else{let e;if(d==ep.POLYGON){const t=[];let o=0,r=0;for(let e=0,i=l.length;e<i;++e){const i=l[e];bo(s,o,i,2)||(t.push(l.slice(r,e)),r=e),o=i}1<t.length?(l=t,e=new ic(null)):e=new Ag(null)}else e=d===ep.POINT?new wg(null):d===ep.LINE_STRING?new Gg(null):d===ep.POLYGON?new Ag(null):d===ep.MULTI_POINT?new oc(null):d===ep.MULTI_LINE_STRING?new ec(null):null;e.setFlatCoordinates(Ig.XY,s,l),i=new this.featureClass_,this.geometryName_&&i.setGeometryName(this.geometryName_);const t=Nn(e,!1,this.adaptOptions(o));i.setGeometry(t),i.setId(n),i.setProperties(a)}return i},IE.prototype.getLastExtent=function(){return this.extent_},IE.prototype.getType=function(){return pc.ARRAY_BUFFER},IE.prototype.readFeatures=function(e){const t=this.layers_,o=new TE.a(e),r=o.readFields(_s,{}),n=[];for(const i in r){if(t&&-1==t.indexOf(i))continue;const e=r[i];for(let t=0,r=e.length;t<r;++t){const r=ys(o,e,t);n.push(this.createFeature_(o,r))}this.extent_=e?[0,0,e.extent,e.extent]:null}return n},IE.prototype.readProjection=function(){return this.defaultDataProjection},IE.prototype.setLayers=function(e){this.layers_=e},IE.prototype.readFeature=function(){},IE.prototype.readGeometry=function(){},IE.prototype.writeFeature=function(){},IE.prototype.writeGeometry=function(){},IE.prototype.writeFeatures=function(){};const LE=function(){Kh.call(this),this.defaultDataProjection=Ve('EPSG:4326')};i(LE,Kh);const PE=[null],vE=ta(PE,{nd:function(e,t){const o=t[t.length-1];o.ndrefs.push(e.getAttribute('ref'))},tag:hs}),FE=ta(PE,{node:function(e,t){const o=t[0],r=t[t.length-1],i=e.getAttribute('id'),n=[parseFloat(e.getAttribute('lon')),parseFloat(e.getAttribute('lat'))];r.nodes[i]=n;const a=ra({tags:{}},OE,e,t);if(!l(a.tags)){const e=new wg(n);Nn(e,!1,o);const t=new Cg(e);t.setId(i),t.setProperties(a.tags),r.features.push(t)}},way:function(e,t){const o=e.getAttribute('id'),r=ra({id:o,ndrefs:[],tags:{}},vE,e,t),i=t[t.length-1];i.ways.push(r)}}),OE=ta(PE,{tag:hs});LE.prototype.readFeatures,LE.prototype.readFeaturesFromNode=function(e,t){const o=this.getReadOptions(e,t);if('osm'==e.localName){const t=ra({nodes:{},ways:[],features:[]},FE,e,[o]);for(let e=0;e<t.ways.length;e++){const r=t.ways[e],n=[];for(let e=0,o=r.ndrefs.length;e<o;e++){const o=t.nodes[r.ndrefs[e]];jt(n,o)}let i;r.ndrefs[0]==r.ndrefs[r.ndrefs.length-1]?(i=new Ag(null),i.setFlatCoordinates(Ig.XY,n,[n.length])):(i=new Gg(null),i.setFlatCoordinates(Ig.XY,n)),Nn(i,!1,o);const a=new Cg(i);a.setId(r.id),a.setProperties(r.tags),t.features.push(a)}if(t.features)return t.features}return[]},LE.prototype.readProjection,LE.prototype.writeFeatureNode=function(){},LE.prototype.writeFeaturesNode=function(){},LE.prototype.writeGeometryNode=function(){};const wE=function(e){const t=e?e:{};Gf.call(this),this.defaultDataProjection=Ve('EPSG:4326'),this.factor_=t.factor?t.factor:1e5,this.geometryLayout_=t.geometryLayout?t.geometryLayout:Ig.XY};i(wE,Gf),wE.prototype.readFeature,wE.prototype.readFeatureFromText=function(e,t){const o=this.readGeometryFromText(e,t);return new Cg(o)},wE.prototype.readFeatures,wE.prototype.readFeaturesFromText=function(e,t){const o=this.readFeatureFromText(e,t);return[o]},wE.prototype.readGeometry,wE.prototype.readGeometryFromText=function(e,t){const o=Zt(this.geometryLayout_),r=Es(e,o,this.factor_);fs(r,0,r.length,o,r);const i=_o(r,0,r.length,o);return Nn(new Gg(i,this.geometryLayout_),!1,this.adaptOptions(t))},wE.prototype.readProjection,wE.prototype.writeFeatureText=function(e,t){const o=e.getGeometry();return o?this.writeGeometryText(o,t):(R(!1,40),'')},wE.prototype.writeFeaturesText=function(e,t){return this.writeFeatureText(e[0],t)},wE.prototype.writeGeometry,wE.prototype.writeGeometryText=function(e,t){e=Nn(e,!0,this.adaptOptions(t));const o=e.getFlatCoordinates(),r=e.getStride();return fs(o,0,o.length,r,o),xs(o,r,this.factor_)};const NE=function(e){const t=e?e:{};Uh.call(this),this.layerName_=t.layerName,this.layers_=t.layers?t.layers:null,this.defaultDataProjection=Ve(t.defaultDataProjection?t.defaultDataProjection:'EPSG:4326')};i(NE,Uh);const AE={Point:function(e,t,o){const r=e.coordinates;return t&&o&&As(r,t,o),new wg(r)},LineString:function(e,t){const o=vs(e.arcs,t);return new Gg(o)},Polygon:function(e,t){const o=[];for(let r=0,i=e.arcs.length;r<i;++r)o[r]=vs(e.arcs[r],t);return new Ag(o)},MultiPoint:function(e,t,o){const r=e.coordinates;if(t&&o)for(let e=0,i=r.length;e<i;++e)As(r[e],t,o);return new oc(r)},MultiLineString:function(e,t){const o=[];for(let r=0,i=e.arcs.length;r<i;++r)o[r]=vs(e.arcs[r],t);return new ec(o)},MultiPolygon:function(e,t){const o=[];for(let r=0,i=e.arcs.length;r<i;++r){const i=e.arcs[r],n=[];for(let e=0,o=i.length;e<o;++e)n[e]=vs(i[e],t);o[r]=n}return new ic(o)}};NE.prototype.readFeatures,NE.prototype.readFeaturesFromObject=function(e,t){if('Topology'==e.type){const o=e;let r=null,i=null,n;o.transform&&(n=o.transform,r=n.scale,i=n.translate);const a=o.arcs;n&&ws(a,r,i);const s=[],l=o.objects,d=this.layerName_;let p;for(const e in l)this.layers_&&-1==this.layers_.indexOf(e)||('GeometryCollection'===l[e].type?(p=l[e],s.push.apply(s,Fs(p,a,r,i,d,e,t))):(p=l[e],s.push(Os(p,a,r,i,d,e,t))));return s}return[]},NE.prototype.readProjection,NE.prototype.readProjectionFromObject=function(){return this.defaultDataProjection},NE.prototype.writeFeatureObject=function(){},NE.prototype.writeFeaturesObject=function(){},NE.prototype.writeGeometryObject=function(){},NE.prototype.readGeometryFromObject=function(){},NE.prototype.readFeatureFromObject=function(){};const bE=function(e){this.tagName_=e};bE.prototype.getTagName=function(){return this.tagName_};var ME=bE;const GE=function(e){ME.call(this,e),this.conditions=Array.prototype.slice.call(arguments,1),R(2<=this.conditions.length,57)};i(GE,ME);var DE=GE;const kE=function(){const e=['And'].concat(Array.prototype.slice.call(arguments));DE.apply(this,e)};i(kE,DE);var UE=kE;const YE=function(e,t,o){ME.call(this,'BBOX'),this.geometryName=e,this.extent=t,this.srsName=o};i(YE,ME);var jE=YE;const BE=function(e,t,o,r){ME.call(this,e),this.geometryName=t||'the_geom',this.geometry=o,this.srsName=r};i(BE,ME);var VE=BE;const zE=function(e,t,o){VE.call(this,'Contains',e,t,o)};i(zE,VE);var XE=zE;const WE=function(e,t){ME.call(this,e),this.propertyName=t};i(WE,ME);var KE=WE;const HE=function(e,t,o){KE.call(this,'During',e),this.begin=t,this.end=o};i(HE,KE);var ZE=HE;const qE=function(e,t,o,r){KE.call(this,e,t),this.expression=o,this.matchCase=r};i(qE,KE);var JE=qE;const QE=function(e,t,o){JE.call(this,'PropertyIsEqualTo',e,t,o)};i(QE,JE);var $E=QE;const eT=function(e,t){JE.call(this,'PropertyIsGreaterThan',e,t)};i(eT,JE);var tT=eT;const oT=function(e,t){JE.call(this,'PropertyIsGreaterThanOrEqualTo',e,t)};i(oT,JE);var rT=oT;const iT=function(e,t,o){VE.call(this,'Intersects',e,t,o)};i(iT,VE);var nT=iT;const aT=function(e,t,o){KE.call(this,'PropertyIsBetween',e),this.lowerBoundary=t,this.upperBoundary=o};i(aT,KE);var sT=aT;const lT=function(e,t,o,r,i,n){KE.call(this,'PropertyIsLike',e),this.pattern=t,this.wildCard=o===void 0?'*':o,this.singleChar=r===void 0?'.':r,this.escapeChar=i===void 0?'!':i,this.matchCase=n};i(lT,KE);var dT=lT;const pT=function(e){KE.call(this,'PropertyIsNull',e)};i(pT,KE);var gT=pT;const _T=function(e,t){JE.call(this,'PropertyIsLessThan',e,t)};i(_T,JE);var uT=_T;const cT=function(e,t){JE.call(this,'PropertyIsLessThanOrEqualTo',e,t)};i(cT,JE);var yT=cT;const mT=function(e){ME.call(this,'Not'),this.condition=e};i(mT,ME);var hT=mT;const fT=function(e,t,o){JE.call(this,'PropertyIsNotEqualTo',e,t,o)};i(fT,JE);var xT=fT;const ET=function(){const e=['Or'].concat(Array.prototype.slice.call(arguments));DE.apply(this,e)};i(ET,DE);var Or=ET;const TT=function(e,t,o){VE.call(this,'Within',e,t,o)};i(TT,VE);var ST=TT;const CT='feature',RT='http://www.w3.org/2000/xmlns/',IT='http://www.opengis.net/ogc',LT='http://www.opengis.net/wfs',PT={"1.1.0":'http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd',"1.0.0":'http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd'},vT='1.1.0',FT=function(e){const t=e?e:{};this.featureType_=t.featureType,this.featureNS_=t.featureNS,this.gmlFormat_=t.gmlFormat?t.gmlFormat:new ef,this.schemaLocation_=t.schemaLocation?t.schemaLocation:PT[vT],Kh.call(this)};i(FT,Kh),FT.prototype.getFeatureType=function(){return this.featureType_},FT.prototype.setFeatureType=function(e){this.featureType_=e},FT.prototype.readFeatures,FT.prototype.readFeaturesFromNode=function(e,t){const o={featureType:this.featureType_,featureNS:this.featureNS_};Ad(o,this.getReadOptions(e,t?t:{}));this.gmlFormat_.FEATURE_COLLECTION_PARSERS[Hh].featureMember=Kn(Jh.prototype.readFeaturesInternal);let r=ra([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[o],this.gmlFormat_);return r||(r=[]),r},FT.prototype.readTransactionResponse=function(e){if(Bn(e))return this.readTransactionResponseFromDocument(e);if(Vn(e))return this.readTransactionResponseFromNode(e);if('string'==typeof e){const t=Xn(e);return this.readTransactionResponseFromDocument(t)}},FT.prototype.readFeatureCollectionMetadata=function(e){if(Bn(e))return this.readFeatureCollectionMetadataFromDocument(e);if(Vn(e))return this.readFeatureCollectionMetadataFromNode(e);if('string'==typeof e){const t=Xn(e);return this.readFeatureCollectionMetadataFromDocument(t)}},FT.prototype.readFeatureCollectionMetadataFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)};const OT={"http://www.opengis.net/gml":{boundedBy:qn(Jh.prototype.readGeometryElement,'bounds')}};FT.prototype.readFeatureCollectionMetadataFromNode=function(e){const t={},o=_a(e.getAttribute('numberOfFeatures'));return t.numberOfFeatures=o,ra(t,OT,e,[],this.gmlFormat_)};const wT={"http://www.opengis.net/wfs":{totalInserted:qn(ga),totalUpdated:qn(ga),totalDeleted:qn(ga)}},NT={"http://www.opengis.net/ogc":{FeatureId:Kn(function(e){return e.getAttribute('fid')})}},AT={"http://www.opengis.net/wfs":{Feature:function(e,t){oa(NT,e,t)}}},bT={"http://www.opengis.net/wfs":{TransactionSummary:qn(function(e,t){return ra({},wT,e,t)},'transactionSummary'),InsertResults:qn(function(e,t){return ra([],AT,e,t)},'insertIds')}};FT.prototype.readTransactionResponseFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)},FT.prototype.readTransactionResponseFromNode=function(e){return ra({},bT,e,[])};const MT={"http://www.opengis.net/wfs":{PropertyName:Jn(fa)}},GT={"http://www.opengis.net/wfs":{Insert:Jn(function(e,t,o){const r=o[o.length-1],i=r.featureType,n=r.featureNS,a=r.gmlVersion,s=Un(n,i);e.appendChild(s),2===a?nf.prototype.writeFeatureElement(s,t,o):ef.prototype.writeFeatureElement(s,t,o)}),Update:Jn(function(e,t,o){const r=o[o.length-1];R(t.getId()!==void 0,27);const i=r.featureType,n=r.featurePrefix,a=r.featureNS,s=Ds(n,i),l=t.getGeometryName();e.setAttribute('typeName',s),e.setAttributeNS(RT,'xmlns:'+n,a);const d=t.getId();if(d!==void 0){const n=t.getKeys(),a=[];for(let e=0,o=n.length;e<o;e++){const o=t.get(n[e]);if(o!==void 0){let t=n[e];o instanceof Ep&&(t=l),a.push({name:t,value:o})}}na({gmlVersion:r.gmlVersion,node:e,hasZ:r.hasZ,srsName:r.srsName},GT,$n('Property'),a,o),Gs(e,d,o)}}),Delete:Jn(function(e,t,o){const r=o[o.length-1];R(t.getId()!==void 0,26);const i=r.featureType,n=r.featurePrefix,a=r.featureNS,s=Ds(n,i);e.setAttribute('typeName',s),e.setAttributeNS(RT,'xmlns:'+n,a);const l=t.getId();l!==void 0&&Gs(e,l,o)}),Property:Jn(function(e,t,o){const r=Un(LT,'Name'),i=o[o.length-1],n=i.gmlVersion;if(e.appendChild(r),fa(r,t.name),void 0!==t.value&&null!==t.value){const r=Un(LT,'Value');e.appendChild(r),t.value instanceof Ep?2===n?nf.prototype.writeGeometryElement(r,t.value,o):ef.prototype.writeGeometryElement(r,t.value,o):fa(r,t.value)}}),Native:Jn(function(e,t){t.vendorId&&e.setAttribute('vendorId',t.vendorId),t.safeToIgnore!==void 0&&e.setAttribute('safeToIgnore',t.safeToIgnore),t.value!==void 0&&fa(e,t.value)})}},DT={"http://www.opengis.net/wfs":{Query:Jn(function(e,t,o){const r=o[o.length-1],i=r.featurePrefix,n=r.featureNS,a=r.propertyNames,s=r.srsName;let l;l=i?Ds(i,t):t,e.setAttribute('typeName',l),s&&e.setAttribute('srsName',s),n&&e.setAttributeNS(RT,'xmlns:'+i,n);const d=Ad({},r);d.node=e,na(d,MT,$n('PropertyName'),a,o);const p=r.filter;if(p){const t=Un(IT,'Filter');e.appendChild(t),ks(t,p,o)}})},"http://www.opengis.net/ogc":{During:Jn(function(e,t){const o=Un('http://www.opengis.net/fes','ValueReference');fa(o,t.propertyName),e.appendChild(o);const r=Un(Hh,'TimePeriod');e.appendChild(r);const i=Un(Hh,'begin');r.appendChild(i),zs(i,t.begin);const n=Un(Hh,'end');r.appendChild(n),zs(n,t.end)}),And:Jn(Us),Or:Jn(Us),Not:Jn(function(e,t,o){const r=t.condition;na({node:e},DT,$n(r.getTagName()),[r],o)}),BBOX:Jn(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,Bs(e,t.geometryName),ef.prototype.writeGeometryElement(e,t.extent,o)}),Contains:Jn(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,Bs(e,t.geometryName),ef.prototype.writeGeometryElement(e,t.geometry,o)}),Intersects:Jn(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,Bs(e,t.geometryName),ef.prototype.writeGeometryElement(e,t.geometry,o)}),Within:Jn(function(e,t,o){const r=o[o.length-1];r.srsName=t.srsName,Bs(e,t.geometryName),ef.prototype.writeGeometryElement(e,t.geometry,o)}),PropertyIsEqualTo:Jn(Ys),PropertyIsNotEqualTo:Jn(Ys),PropertyIsLessThan:Jn(Ys),PropertyIsLessThanOrEqualTo:Jn(Ys),PropertyIsGreaterThan:Jn(Ys),PropertyIsGreaterThanOrEqualTo:Jn(Ys),PropertyIsNull:Jn(function(e,t){Bs(e,t.propertyName)}),PropertyIsBetween:Jn(function(e,t){Bs(e,t.propertyName);const o=Un(IT,'LowerBoundary');e.appendChild(o),Vs(o,''+t.lowerBoundary);const r=Un(IT,'UpperBoundary');e.appendChild(r),Vs(r,''+t.upperBoundary)}),PropertyIsLike:Jn(function(e,t){e.setAttribute('wildCard',t.wildCard),e.setAttribute('singleChar',t.singleChar),e.setAttribute('escapeChar',t.escapeChar),t.matchCase!==void 0&&e.setAttribute('matchCase',t.matchCase.toString()),Bs(e,t.propertyName),Vs(e,''+t.pattern)})}};FT.prototype.writeGetFeature=function(e){const t=Un(LT,'GetFeature');t.setAttribute('service','WFS'),t.setAttribute('version','1.1.0');let o;if(e&&(e.handle&&t.setAttribute('handle',e.handle),e.outputFormat&&t.setAttribute('outputFormat',e.outputFormat),void 0!==e.maxFeatures&&t.setAttribute('maxFeatures',e.maxFeatures),e.resultType&&t.setAttribute('resultType',e.resultType),void 0!==e.startIndex&&t.setAttribute('startIndex',e.startIndex),void 0!==e.count&&t.setAttribute('count',e.count),o=e.filter,e.bbox)){R(e.geometryName,12);const t=Ms(e.geometryName,e.bbox,e.srsName);o=o?bs(o,t):t}t.setAttributeNS(zh,'xsi:schemaLocation',this.schemaLocation_);const r={node:t,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,geometryName:e.geometryName,filter:o,propertyNames:e.propertyNames?e.propertyNames:[]};return R(Array.isArray(e.featureTypes),11),Xs(t,e.featureTypes,[r]),t},FT.prototype.writeTransaction=function(e,t,o,r){const i=[],n=Un(LT,'Transaction'),a=r.version?r.version:vT,s='1.0.0'===a?2:3;n.setAttribute('service','WFS'),n.setAttribute('version',a);let l,d;r&&(l=r.gmlOptions?r.gmlOptions:{},r.handle&&n.setAttribute('handle',r.handle));const p=PT[a];n.setAttributeNS(zh,'xsi:schemaLocation',p);const g=r.featurePrefix?r.featurePrefix:CT;return e&&(d={node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},Ad(d,l),na(d,GT,$n('Insert'),e,i)),t&&(d={node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},Ad(d,l),na(d,GT,$n('Update'),t,i)),o&&na({node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,srsName:r.srsName},GT,$n('Delete'),o,i),r.nativeElements&&na({node:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:g,gmlVersion:s,srsName:r.srsName},GT,$n('Native'),r.nativeElements,i),n},FT.prototype.readProjection,FT.prototype.readProjectionFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null},FT.prototype.readProjectionFromNode=function(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){const e=[{}];return this.gmlFormat_.readGeometryElement(t,e),Ve(e.pop().srsName)}}return null};const kT='EMPTY',UT='Z',Z='M',M={TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},YT=function(e){this.wkt=e,this.index_=-1};YT.prototype.isAlpha_=function(e){return'a'<=e&&'z'>=e||'A'<=e&&'Z'>=e},YT.prototype.isNumeric_=function(e,t){return'0'<=e&&'9'>=e||'.'==e&&!(t!==void 0&&t)},YT.prototype.isWhiteSpace_=function(e){return' '==e||'\t'==e||'\r'==e||'\n'==e},YT.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},YT.prototype.nextToken=function(){const e=this.nextChar_(),t={position:this.index_,value:e};if('('==e)t.type=M.LEFT_PAREN;else if(','==e)t.type=M.COMMA;else if(')'==e)t.type=M.RIGHT_PAREN;else if(this.isNumeric_(e)||'-'==e)t.type=M.NUMBER,t.value=this.readNumber_();else if(this.isAlpha_(e))t.type=M.TEXT,t.value=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(''===e)t.type=M.EOF;else throw new Error('Unexpected character: '+e)}return t},YT.prototype.readNumber_=function(){let e;const t=this.index_;let o=!1,r=!1;do'.'==e?o=!0:('e'==e||'E'==e)&&(r=!0),e=this.nextChar_();while(this.isNumeric_(e,o)||!r&&('e'==e||'E'==e)||r&&('-'==e||'+'==e));return parseFloat(this.wkt.substring(t,this.index_--))},YT.prototype.readText_=function(){let e;const t=this.index_;do e=this.nextChar_();while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()};const jT=function(e){this.lexer_=e,this.token_,this.layout_=Ig.XY};jT.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},jT.prototype.isTokenType=function(e){const t=this.token_.type==e;return t},jT.prototype.match=function(e){const t=this.isTokenType(e);return t&&this.consume_(),t},jT.prototype.parse=function(){this.consume_();const e=this.parseGeometry_();return e},jT.prototype.parseGeometryLayout_=function(){let e=Ig.XY;const t=this.token_;if(this.isTokenType(M.TEXT)){const o=t.value;o===UT?e=Ig.XYZ:o===Z?e=Ig.XYM:o==='ZM'&&(e=Ig.XYZM),e!==Ig.XY&&this.consume_()}return e},jT.prototype.parseGeometryCollectionText_=function(){if(this.match(M.LEFT_PAREN)){const e=[];do e.push(this.parseGeometry_());while(this.match(M.COMMA));if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},jT.prototype.parsePointText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parsePoint_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())},jT.prototype.parseLineStringText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parsePointList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},jT.prototype.parsePolygonText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},jT.prototype.parseMultiPointText_=function(){if(this.match(M.LEFT_PAREN)){let e;if(e=this.token_.type==M.LEFT_PAREN?this.parsePointTextList_():this.parsePointList_(),this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},jT.prototype.parseMultiLineStringText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parseLineStringTextList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},jT.prototype.parseMultiPolygonText_=function(){if(this.match(M.LEFT_PAREN)){const e=this.parsePolygonTextList_();if(this.match(M.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},jT.prototype.parsePoint_=function(){const e=[],t=this.layout_.length;for(let o=0;o<t;++o){const t=this.token_;if(this.match(M.NUMBER))e.push(t.value);else break}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())},jT.prototype.parsePointList_=function(){const e=[this.parsePoint_()];for(;this.match(M.COMMA);)e.push(this.parsePoint_());return e},jT.prototype.parsePointTextList_=function(){const e=[this.parsePointText_()];for(;this.match(M.COMMA);)e.push(this.parsePointText_());return e},jT.prototype.parseLineStringTextList_=function(){const e=[this.parseLineStringText_()];for(;this.match(M.COMMA);)e.push(this.parseLineStringText_());return e},jT.prototype.parsePolygonTextList_=function(){const e=[this.parsePolygonText_()];for(;this.match(M.COMMA);)e.push(this.parsePolygonText_());return e},jT.prototype.isEmptyGeometry_=function(){const e=this.isTokenType(M.TEXT)&&this.token_.value==kT;return e&&this.consume_(),e},jT.prototype.formatErrorMessage_=function(){return'Unexpected `'+this.token_.value+'` at position '+this.token_.position+' in `'+this.lexer_.wkt+'`'};const BT=function(e){const t=e?e:{};Gf.call(this),this.splitCollection_=t.splitCollection!==void 0&&t.splitCollection};i(BT,Gf);const VT={Point:Ws,LineString:Ks,Polygon:Hs,MultiPoint:function(e){const t=[],o=e.getPoints();for(let r=0,i=o.length;r<i;++r)t.push('('+Ws(o[r])+')');return t.join(',')},MultiLineString:function(e){const t=[],o=e.getLineStrings();for(let r=0,i=o.length;r<i;++r)t.push('('+Ks(o[r])+')');return t.join(',')},MultiPolygon:function(e){const t=[],o=e.getPolygons();for(let r=0,i=o.length;r<i;++r)t.push('('+Hs(o[r])+')');return t.join(',')},GeometryCollection:function(e){const t=[],o=e.getGeometries();for(let r=0,i=o.length;r<i;++r)t.push(qs(o[r]));return t.join(',')}};BT.prototype.parse_=function(e){const t=new YT(e),o=new jT(t);return o.parse()},BT.prototype.readFeature,BT.prototype.readFeatureFromText=function(e,t){const o=this.readGeometryFromText(e,t);if(o){const e=new Cg;return e.setGeometry(o),e}return null},BT.prototype.readFeatures,BT.prototype.readFeaturesFromText=function(e,t){let o=[];const r=this.readGeometryFromText(e,t);o=this.splitCollection_&&r.getType()==ep.GEOMETRY_COLLECTION?r.getGeometriesArray():[r];const n=[];for(let r=0,i=o.length;r<i;++r){const e=new Cg;e.setGeometry(o[r]),n.push(e)}return n},BT.prototype.readGeometry,BT.prototype.readGeometryFromText=function(e,t){const o=this.parse_(e);return o?Nn(o,!1,t):null};const zT={POINT:wg,LINESTRING:Gg,POLYGON:Ag,MULTIPOINT:oc,MULTILINESTRING:ec,MULTIPOLYGON:ic},XT={POINT:jT.prototype.parsePointText_,LINESTRING:jT.prototype.parseLineStringText_,POLYGON:jT.prototype.parsePolygonText_,MULTIPOINT:jT.prototype.parseMultiPointText_,MULTILINESTRING:jT.prototype.parseMultiLineStringText_,MULTIPOLYGON:jT.prototype.parseMultiPolygonText_};jT.prototype.parseGeometry_=function(){const e=this.token_;if(this.match(M.TEXT)){const t=e.value;if(this.layout_=this.parseGeometryLayout_(),t==ep.GEOMETRY_COLLECTION.toUpperCase()){const e=this.parseGeometryCollectionText_();return new wf(e)}else{const e=XT[t],o=zT[t];if(!e||!o)throw new Error('Invalid geometry type: '+t);const r=e.call(this);return new o(r,this.layout_)}}throw new Error(this.formatErrorMessage_())},BT.prototype.writeFeature,BT.prototype.writeFeatureText=function(e,t){const o=e.getGeometry();return o?this.writeGeometryText(o,t):''},BT.prototype.writeFeatures,BT.prototype.writeFeaturesText=function(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);const o=[];for(let r=0,i=e.length;r<i;++r)o.push(e[r].getGeometry());const r=new wf(o);return this.writeGeometryText(r,t)},BT.prototype.writeGeometry,BT.prototype.writeGeometryText=function(e,t){return qs(Nn(e,!0,t))};const WT='http://www.w3.org/1999/xlink',KT=function(){};KT.prototype.read=function(e){if(Bn(e))return this.readFromDocument(e);if(Vn(e))return this.readFromNode(e);if('string'==typeof e){const t=Xn(e);return this.readFromDocument(t)}return null},KT.prototype.readFromDocument=function(){},KT.prototype.readFromNode=function(){};var HT=KT;const ZT=function(){HT.call(this),this.version=void 0};i(ZT,HT);const qT=[null,'http://www.opengis.net/wms'],JT=ta(qT,{Service:qn(function(e,t){return ra({},$T,e,t)}),Capability:qn(function(e,t){return ra({},QT,e,t)})}),QT=ta(qT,{Request:qn(function(e,t){return ra({},sS,e,t)}),Exception:qn(function(e,t){return ra([],rS,e,t)}),Layer:qn(function(e,t){return ra({},iS,e,t)})}),$T=ta(qT,{Name:qn(ua),Title:qn(ua),Abstract:qn(ua),KeywordList:qn(tl),OnlineResource:qn(Js),ContactInformation:qn(function(e,t){return ra({},eS,e,t)}),Fees:qn(ua),AccessConstraints:qn(ua),LayerLimit:qn(ga),MaxWidth:qn(ga),MaxHeight:qn(ga)}),eS=ta(qT,{ContactPersonPrimary:qn(function(e,t){return ra({},tS,e,t)}),ContactPosition:qn(ua),ContactAddress:qn(function(e,t){return ra({},oS,e,t)}),ContactVoiceTelephone:qn(ua),ContactFacsimileTelephone:qn(ua),ContactElectronicMailAddress:qn(ua)}),tS=ta(qT,{ContactPerson:qn(ua),ContactOrganization:qn(ua)}),oS=ta(qT,{AddressType:qn(ua),Address:qn(ua),City:qn(ua),StateOrProvince:qn(ua),PostCode:qn(ua),Country:qn(ua)}),rS=ta(qT,{Format:Kn(ua)}),iS=ta(qT,{Name:qn(ua),Title:qn(ua),Abstract:qn(ua),KeywordList:qn(tl),CRS:Zn(ua),EX_GeographicBoundingBox:qn(function(e,t){const o=ra({},aS,e,t);if(o){const e=o.westBoundLongitude,t=o.southBoundLatitude,r=o.eastBoundLongitude,i=o.northBoundLatitude;return void 0===e||void 0===t||void 0===r||void 0===i?void 0:[e,t,r,i]}}),BoundingBox:Zn(function(e){const t=[pa(e.getAttribute('minx')),pa(e.getAttribute('miny')),pa(e.getAttribute('maxx')),pa(e.getAttribute('maxy'))],o=[pa(e.getAttribute('resx')),pa(e.getAttribute('resy'))];return{crs:e.getAttribute('CRS'),extent:t,res:o}}),Dimension:Zn(function(e){const t={name:e.getAttribute('name'),units:e.getAttribute('units'),unitSymbol:e.getAttribute('unitSymbol'),default:e.getAttribute('default'),multipleValues:sa(e.getAttribute('multipleValues')),nearestValue:sa(e.getAttribute('nearestValue')),current:sa(e.getAttribute('current')),values:ua(e)};return t}),Attribution:qn(function(e,t){return ra({},nS,e,t)}),AuthorityURL:Zn(function(e,t){const o=Qs(e,t);return o?(o.name=e.getAttribute('name'),o):void 0}),Identifier:Zn(ua),MetadataURL:Zn(function(e,t){const o=Qs(e,t);return o?(o.type=e.getAttribute('type'),o):void 0}),DataURL:Zn(Qs),FeatureListURL:Zn(Qs),Style:Zn(function(e,t){return ra({},gS,e,t)}),MinScaleDenominator:qn(da),MaxScaleDenominator:qn(da),Layer:Zn(function(e,t){const o=t[t.length-1],r=ra({},iS,e,t);if(!r)return;let i=sa(e.getAttribute('queryable'));void 0===i&&(i=o.queryable),r.queryable=void 0!==i&&i;let n=_a(e.getAttribute('cascaded'));void 0===n&&(n=o.cascaded),r.cascaded=n;let a=sa(e.getAttribute('opaque'));void 0===a&&(a=o.opaque),r.opaque=void 0!==a&&a;let s=sa(e.getAttribute('noSubsets'));void 0===s&&(s=o.noSubsets),r.noSubsets=void 0!==s&&s;let l=pa(e.getAttribute('fixedWidth'));l||(l=o.fixedWidth),r.fixedWidth=l;let d=pa(e.getAttribute('fixedHeight'));d||(d=o.fixedHeight),r.fixedHeight=d;['Style','CRS','AuthorityURL'].forEach(function(e){if(e in o){const t=r[e]||[];r[e]=t.concat(o[e])}});return['EX_GeographicBoundingBox','BoundingBox','Dimension','Attribution','MinScaleDenominator','MaxScaleDenominator'].forEach(function(e){if(!(e in r)){const t=o[e];r[e]=t}}),r})}),nS=ta(qT,{Title:qn(ua),OnlineResource:qn(Js),LogoURL:qn(el)}),aS=ta(qT,{westBoundLongitude:qn(da),eastBoundLongitude:qn(da),southBoundLatitude:qn(da),northBoundLatitude:qn(da)}),sS=ta(qT,{GetCapabilities:qn($s),GetMap:qn($s),GetFeatureInfo:qn($s)}),lS=ta(qT,{Format:Zn(ua),DCPType:Zn(function(e,t){return ra({},dS,e,t)})}),dS=ta(qT,{HTTP:qn(function(e,t){return ra({},pS,e,t)})}),pS=ta(qT,{Get:qn(Qs),Post:qn(Qs)}),gS=ta(qT,{Name:qn(ua),Title:qn(ua),Abstract:qn(ua),LegendURL:Zn(el),StyleSheetURL:qn(Qs),StyleURL:qn(Qs)}),_S=ta(qT,{Format:qn(ua),OnlineResource:qn(Js)}),uS=ta(qT,{Keyword:Kn(ua)});ZT.prototype.read,ZT.prototype.readFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},ZT.prototype.readFromNode=function(e){this.version=e.getAttribute('version').trim();const t=ra({version:this.version},JT,e,[]);return t?t:null};const cS=function(e){const t=e?e:{};this.featureNS_='http://mapserver.gis.umn.edu/mapserver',this.gmlFormat_=new nf,this.layers_=t.layers?t.layers:null,Kh.call(this)};i(cS,Kh);cS.prototype.getLayers=function(){return this.layers_},cS.prototype.setLayers=function(e){this.layers_=e},cS.prototype.readFeatures_=function(e,t){e.setAttribute('namespaceURI',this.featureNS_);const o=e.localName;let r=[];if(0===e.childNodes.length)return r;if('msGMLOutput'==o)for(let o=0,i=e.childNodes.length;o<i;o++){const i=e.childNodes[o];if(i.nodeType!==Node.ELEMENT_NODE)continue;const n=t[0],a=i.localName.replace('_layer','');if(this.layers_&&!kt(this.layers_,a))continue;const s=a+'_feature';n.featureType=s,n.featureNS=this.featureNS_;const l={};l[s]=Kn(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const d=ta([n.featureNS,null],l);i.setAttribute('namespaceURI',this.featureNS_);const p=ra([],d,i,t,this.gmlFormat_);p&&jt(r,p)}if('FeatureCollection'==o){const t=ra([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);t&&(r=t)}return r},cS.prototype.readFeatures,cS.prototype.readFeaturesFromNode=function(e,t){const o={};return t&&Ad(o,this.getReadOptions(e,t)),this.readFeatures_(e,[o])},cS.prototype.writeFeatureNode=function(){},cS.prototype.writeFeaturesNode=function(){},cS.prototype.writeGeometryNode=function(){};const yS=function(){HT.call(this)};i(yS,HT);const mS=[null,'http://www.opengis.net/ows/1.1'],hS=ta(mS,{ServiceIdentification:qn(function(e,t){return ra({},FS,e,t)}),ServiceProvider:qn(function(e,t){return ra({},OS,e,t)}),OperationsMetadata:qn(function(e,t){return ra({},IS,e,t)})}),fS=ta(mS,{DeliveryPoint:qn(ua),City:qn(ua),AdministrativeArea:qn(ua),PostalCode:qn(ua),Country:qn(ua),ElectronicMailAddress:qn(ua)}),xS=ta(mS,{Value:Zn(function(e){return ua(e)})}),ES=ta(mS,{AllowedValues:qn(function(e,t){return ra({},xS,e,t)})}),TS=ta(mS,{Phone:qn(function(e,t){return ra({},LS,e,t)}),Address:qn(function(e,t){return ra({},fS,e,t)})}),SS=ta(mS,{HTTP:qn(function(e,t){return ra({},CS,e,t)})}),CS=ta(mS,{Get:Zn(function(e,t){const o=Js(e);return o?ra({href:o},PS,e,t):void 0}),Post:void 0}),RS=ta(mS,{DCP:qn(function(e,t){return ra({},SS,e,t)})}),IS=ta(mS,{Operation:function(e,t){const o=e.getAttribute('name'),r=ra({},RS,e,t);if(r){const e=t[t.length-1];e[o]=r}}}),LS=ta(mS,{Voice:qn(ua),Facsimile:qn(ua)}),PS=ta(mS,{Constraint:Zn(function(e,t){const o=e.getAttribute('name');return o?ra({name:o},ES,e,t):void 0})}),vS=ta(mS,{IndividualName:qn(ua),PositionName:qn(ua),ContactInfo:qn(function(e,t){return ra({},TS,e,t)})}),FS=ta(mS,{Abstract:qn(ua),AccessConstraints:qn(ua),Fees:qn(ua),Title:qn(ua),ServiceTypeVersion:qn(ua),ServiceType:qn(ua)}),OS=ta(mS,{ProviderName:qn(ua),ProviderSite:qn(Js),ServiceContact:qn(function(e,t){return ra({},vS,e,t)})});yS.prototype.readFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},yS.prototype.readFromNode=function(e){const t=ra({},hS,e,[]);return t?t:null};const wS=function(){HT.call(this),this.owsParser_=new yS};i(wS,HT);const NS=[null,'http://www.opengis.net/wmts/1.0'],AS=[null,'http://www.opengis.net/ows/1.1'],bS=ta(NS,{Contents:qn(function(e,t){return ra({},MS,e,t)})}),MS=ta(NS,{Layer:Zn(function(e,t){return ra({},GS,e,t)}),TileMatrixSet:Zn(function(e,t){return ra({},VS,e,t)})}),GS=ta(NS,{Style:Zn(function(e,t){const o=ra({},DS,e,t);if(o){const t='true'===e.getAttribute('isDefault');return o.isDefault=t,o}}),Format:Zn(ua),TileMatrixSetLink:Zn(function(e,t){return ra({},kS,e,t)}),Dimension:Zn(function(e,t){return ra({},jS,e,t)}),ResourceURL:Zn(function(e){const t=e.getAttribute('format'),o=e.getAttribute('template'),r=e.getAttribute('resourceType'),i={};return t&&(i.format=t),o&&(i.template=o),r&&(i.resourceType=r),i})},ta(AS,{Title:qn(ua),Abstract:qn(ua),WGS84BoundingBox:qn(function(e,t){const o=ra([],BS,e,t);return 2==o.length?I(o):void 0}),Identifier:qn(ua)})),DS=ta(NS,{LegendURL:Zn(function(e){const t={format:e.getAttribute('format'),href:Js(e)};return t})},ta(AS,{Title:qn(ua),Identifier:qn(ua)})),kS=ta(NS,{TileMatrixSet:qn(ua),TileMatrixSetLimits:qn(function(e,t){return ra([],US,e,t)})}),US=ta(NS,{TileMatrixLimits:Kn(function(e,t){return ra({},YS,e,t)})}),YS=ta(NS,{TileMatrix:qn(ua),MinTileRow:qn(ga),MaxTileRow:qn(ga),MinTileCol:qn(ga),MaxTileCol:qn(ga)}),jS=ta(NS,{Default:qn(ua),Value:Zn(ua)},ta(AS,{Identifier:qn(ua)})),BS=ta(AS,{LowerCorner:Kn(rl),UpperCorner:Kn(rl)}),VS=ta(NS,{WellKnownScaleSet:qn(ua),TileMatrix:Zn(function(e,t){return ra({},zS,e,t)})},ta(AS,{SupportedCRS:qn(ua),Identifier:qn(ua)})),zS=ta(NS,{TopLeftCorner:qn(rl),ScaleDenominator:qn(da),TileWidth:qn(ga),TileHeight:qn(ga),MatrixWidth:qn(ga),MatrixHeight:qn(ga)},ta(AS,{Identifier:qn(ua)}));wS.prototype.read,wS.prototype.readFromDocument=function(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},wS.prototype.readFromNode=function(e){const t=e.getAttribute('version').trim();let o=this.owsParser_.readFromNode(e);return o?(o.version=t,o=ra(o,bS,e,[]),o?o:null):null};const XS={BLUR:'blur',GRADIENT:'gradient',RADIUS:'radius'},WS=['#00f','#0ff','#0f0','#ff0','#f00'],KS=function(e){const t=e?e:{},o=Ad({},t);delete o.gradient,delete o.radius,delete o.blur,delete o.shadow,delete o.weight,dc.call(this,o),this.gradient_=null,this.shadow_=t.shadow===void 0?250:t.shadow,this.circleImage_=void 0,this.styleCache_=null,c(this,C(XS.GRADIENT),this.handleGradientChanged_,this),this.setGradient(t.gradient?t.gradient:WS),this.setBlur(t.blur===void 0?15:t.blur),this.setRadius(t.radius===void 0?8:t.radius),c(this,C(XS.BLUR),this.handleStyleChanged_,this),c(this,C(XS.RADIUS),this.handleStyleChanged_,this),this.handleStyleChanged_();const r=t.weight?t.weight:'weight';let i;i='string'==typeof r?function(e){return e.get(r)}:r,this.setStyle(function(e){const t=i(e),o=void 0===t?1:me(t,0,1),r=0|255*o;let n=this.styleCache_[r];return n||(n=[new Tg({image:new Kf({opacity:o,src:this.circleImage_})})],this.styleCache_[r]=n),n}.bind(this)),this.setRenderOrder(null),c(this,Dg.RENDER,this.handleRender_,this)};i(KS,dc);const HS=function(e){const t=1,o=256,r=Tt(t,o),n=r.createLinearGradient(0,0,t,o),a=1/(e.length-1);for(let t=0,o=e.length;t<o;++t)n.addColorStop(t*a,e[t]);return r.fillStyle=n,r.fillRect(0,0,t,o),r.getImageData(0,0,t,o).data};KS.prototype.createCircle_=function(){const e=this.getRadius(),t=this.getBlur(),o=e+t+1,r=2*o,i=Tt(r,r);i.shadowOffsetX=i.shadowOffsetY=this.shadow_,i.shadowBlur=t,i.shadowColor='#000',i.beginPath();const n=o-this.shadow_;return i.arc(n,n,e,0,2*Kl,!0),i.fill(),i.canvas.toDataURL()},KS.prototype.getBlur=function(){return this.get(XS.BLUR)},KS.prototype.getGradient=function(){return this.get(XS.GRADIENT)},KS.prototype.getRadius=function(){return this.get(XS.RADIUS)},KS.prototype.handleGradientChanged_=function(){this.gradient_=HS(this.getGradient())},KS.prototype.handleStyleChanged_=function(){this.circleImage_=this.createCircle_(),this.styleCache_=Array(256),this.changed()},KS.prototype.handleRender_=function(e){const t=e.context,o=t.canvas,r=t.getImageData(0,0,o.width,o.height),n=r.data;for(let t=0,o=n.length;t<o;t+=4){const e=4*n[t+3];e&&(n[t]=this.gradient_[e],n[t+1]=this.gradient_[e+1],n[t+2]=this.gradient_[e+2])}t.putImageData(r,0,0)},KS.prototype.setBlur=function(e){this.set(XS.BLUR,e)},KS.prototype.setGradient=function(e){this.set(XS.GRADIENT,e)},KS.prototype.setRadius=function(e){this.set(XS.RADIUS,e)};const ZS=function(e){const t=e?e:{};Q_.call(this,t),this.type=nc.IMAGE};i(ZS,Q_),ZS.prototype.getSource;var qS=ZS,JS={PRELOAD:'preload',USE_INTERIM_TILES_ON_ERROR:'useInterimTilesOnError'};const QS=function(e){const t=e?e:{},o=Ad({},t);delete o.preload,delete o.useInterimTilesOnError,Q_.call(this,o),this.setPreload(t.preload===void 0?0:t.preload),this.setUseInterimTilesOnError(!(t.useInterimTilesOnError!==void 0)||t.useInterimTilesOnError),this.type=nc.TILE};i(QS,Q_),QS.prototype.getPreload=function(){return this.get(JS.PRELOAD)},QS.prototype.getSource,QS.prototype.setPreload=function(e){this.set(JS.PRELOAD,e)},QS.prototype.getUseInterimTilesOnError=function(){return this.get(JS.USE_INTERIM_TILES_ON_ERROR)},QS.prototype.setUseInterimTilesOnError=function(e){this.set(JS.USE_INTERIM_TILES_ON_ERROR,e)};var $S=QS;const eC=function(e){const t=e?e:{};let o=t.renderMode||jy.HYBRID;R(o==void 0||o==jy.IMAGE||o==jy.HYBRID||o==jy.VECTOR,28),t.declutter&&o==jy.IMAGE&&(o=jy.HYBRID),t.renderMode=o;const r=Ad({},t);delete r.preload,delete r.useInterimTilesOnError,dc.call(this,r),this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(!(t.useInterimTilesOnError!==void 0)||t.useInterimTilesOnError),this.type=nc.VECTOR_TILE};i(eC,dc),eC.prototype.getPreload=function(){return this.get(JS.PRELOAD)},eC.prototype.getUseInterimTilesOnError=function(){return this.get(JS.USE_INTERIM_TILES_ON_ERROR)},eC.prototype.setPreload=function(e){this.set(JS.PRELOAD,e)},eC.prototype.setUseInterimTilesOnError=function(e){this.set(JS.USE_INTERIM_TILES_ON_ERROR,e)},eC.prototype.getSource;const tC=function(e){Vp.call(this,e)};i(tC,Vp),tC.prototype.expireCache=function(e){for(;this.canExpireCache();){const t=this.peekLast(),o=t.tileCoord[0].toString();if(o in e&&e[o].contains(t.tileCoord))break;else this.pop().dispose()}},tC.prototype.pruneExceptNewestZ=function(){if(0===this.getCount())return;const e=this.peekFirstKey(),t=sl(e),o=t[0];this.forEach(function(e){e.tileCoord[0]!==o&&(this.remove(al(e.tileCoord)),e.dispose())},this)};var oC=tC;const rC=.25,iC=function(e,t,o,r,i){this.sourceProj_=e,this.targetProj_=t;let n={};const a=Qe(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){const t=e[0]+'/'+e[1];return n[t]||(n[t]=a(e)),n[t]},this.maxSourceExtent_=r,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&ne(r)==ne(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ne(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ne(this.targetProj_.getExtent()):null;const s=re(o),l=ie(o),d=J(o),p=q(o),g=this.transformInv_(s),_=this.transformInv_(l),u=this.transformInv_(d),c=this.transformInv_(p);if(this.addQuad_(s,l,d,p,g,_,u,c,10),this.wrapsXInSource_){let e=Infinity;this.triangles_.forEach(function(t){e=$l(e,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){if(id(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){const o=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];o[0][0]-e>this.sourceWorldWidth_/2&&(o[0][0]-=this.sourceWorldWidth_),o[1][0]-e>this.sourceWorldWidth_/2&&(o[1][0]-=this.sourceWorldWidth_),o[2][0]-e>this.sourceWorldWidth_/2&&(o[2][0]-=this.sourceWorldWidth_);const r=$l(o[0][0],o[1][0],o[2][0]),i=id(o[0][0],o[1][0],o[2][0]);i-r<this.sourceWorldWidth_/2&&(t.source=o)}}.bind(this))}n={}};iC.prototype.addTriangle_=function(e,t,o,r,i,n){this.triangles_.push({source:[r,i,n],target:[e,t,o]})},iC.prototype.addQuad_=function(e,t,o,r,i,n,a,s,l){const d=I([i,n,a,s]),p=this.sourceWorldWidth_?ne(d)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&.5<p&&1>p;let u=!1;if(0<l){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const i=I([e,t,o,r]),n=ne(i)/this.targetWorldWidth_;u|=n>rC}!_&&this.sourceProj_.isGlobal()&&p&&(u|=p>rC)}if(u||!this.maxSourceExtent_||ae(d,this.maxSourceExtent_)){if(!u&&(!isFinite(i[0])||!isFinite(i[1])||!isFinite(n[0])||!isFinite(n[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(s[0])||!isFinite(s[1])))if(0<l)u=!0;else return;if(0<l){if(!u){const t=[(e[0]+o[0])/2,(e[1]+o[1])/2],r=this.transformInv_(t);let n;if(_){const e=(Ce(i[0],g)+Ce(a[0],g))/2;n=e-Ce(r[0],g)}else n=(i[0]+a[0])/2-r[0];const s=(i[1]+a[1])/2-r[1],l=n*n+s*s;u=l>this.errorThresholdSquared_}if(u){if(Hl(e[0]-o[0])<=Hl(e[1]-o[1])){const d=[(t[0]+o[0])/2,(t[1]+o[1])/2],p=this.transformInv_(d),g=[(r[0]+e[0])/2,(r[1]+e[1])/2],_=this.transformInv_(g);this.addQuad_(e,t,d,g,i,n,p,_,l-1),this.addQuad_(g,d,o,r,_,p,a,s,l-1)}else{const d=[(e[0]+t[0])/2,(e[1]+t[1])/2],p=this.transformInv_(d),g=[(o[0]+r[0])/2,(o[1]+r[1])/2],_=this.transformInv_(g);this.addQuad_(e,d,g,r,i,p,_,s,l-1),this.addQuad_(d,t,o,g,p,n,a,_,l-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(e,o,r,i,a,s),this.addTriangle_(e,t,o,i,n,a)}},iC.prototype.calculateSourceExtent=function(){const e=b();return this.triangles_.forEach(function(t){const o=t.source;V(e,o[0]),V(e,o[1]),V(e,o[2])}),e},iC.prototype.getTriangles=function(){return this.triangles_};var nC=iC;const aC=function(e,t,o,r,i,n,a,s,l,d,p){qg.call(this,i,Hg.IDLE),this.renderEdges_=void 0!==p&&p,this.pixelRatio_=a,this.gutter_=s,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=n?n:i,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),_=this.targetTileGrid_.getExtent();let u=this.sourceTileGrid_.getExtent();const c=_?oe(g,_):g;if(0===H(c))return void(this.state=Hg.EMPTY);const y=e.getExtent();y&&(u?u=oe(u,y):u=y);const m=r.getResolution(this.wrappedTileCoord_[0]),h=Q(c),f=hl(e,o,h,m);if(!isFinite(f)||0>=f)return void(this.state=Hg.EMPTY);const x=void 0===d?Yc:d;if(this.triangulation_=new nC(e,o,c,u,f*x),0===this.triangulation_.getTriangles().length)return void(this.state=Hg.EMPTY);this.sourceZ_=t.getZForResolution(f);let E=this.triangulation_.calculateSourceExtent();if(u&&(e.canWrapX()?(E[1]=me(E[1],u[1],u[3]),E[3]=me(E[3],u[1],u[3])):E=oe(E,u)),!H(E))this.state=Hg.EMPTY;else{const e=t.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let t=e.minX;t<=e.maxX;t++)for(let o=e.minY;o<=e.maxY;o++){const e=l(this.sourceZ_,t,o,a);e&&this.sourceTiles_.push(e)}0===this.sourceTiles_.length&&(this.state=Hg.EMPTY)}};i(aC,qg),aC.prototype.disposeInternal=function(){this.state==Hg.LOADING&&this.unlistenSources_(),qg.prototype.disposeInternal.call(this)},aC.prototype.getImage=function(){return this.canvas_},aC.prototype.reproject_=function(){const e=[];if(this.sourceTiles_.forEach(function(t){t&&t.getState()==Hg.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===e.length)this.state=Hg.ERROR;else{const t=this.wrappedTileCoord_[0],o=this.targetTileGrid_.getTileSize(t),r='number'==typeof o?o:o[0],i='number'==typeof o?o:o[1],n=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=xl(r,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),n,s,this.triangulation_,e,this.gutter_,this.renderEdges_),this.state=Hg.LOADED}this.changed()},aC.prototype.load=function(){if(this.state==Hg.IDLE){this.state=Hg.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(t){const o=t.getState();if(o==Hg.IDLE||o==Hg.LOADING){e++;const o=c(t,Yd.CHANGE,function(){const r=t.getState();(r==Hg.LOADED||r==Hg.ERROR||r==Hg.EMPTY)&&(h(o),e--,0==e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),this.sourceTiles_.forEach(function(e){const t=e.getState();t==Hg.IDLE&&e.load()}),0==e&&setTimeout(this.reproject_.bind(this),0)}},aC.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(h),this.sourcesListenerKeys_=null};const sC=function(e){this.minZoom=e.minZoom===void 0?0:e.minZoom,this.resolutions_=e.resolutions,R(Kt(this.resolutions_,function(e,t){return t-e},!0),17);let t;if(!e.origins)for(let e=0,o=this.resolutions_.length-1;e<o;++e)if(!t)t=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==t){t=void 0;break}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin===void 0?null:e.origin,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,R(this.origins_.length==this.resolutions_.length,20));const o=e.extent;o===void 0||this.origin_||this.origins_||(this.origin_=re(o)),R(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,R(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize===void 0?this.tileSizes_?null:b_:e.tileSize,R(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=o===void 0?null:o,this.fullTileRanges_=null,this.tmpSize_=[0,0],e.sizes===void 0?o&&this.calculateTileRanges_(o):this.fullTileRanges_=e.sizes.map(function(e){const t=new py($l(0,e[0]),id(e[0]-1,-1),$l(0,e[1]),id(e[1]-1,-1));return t},this)},lC=[0,0,0];sC.prototype.forEachTileCoord=function(e,t,o){const r=this.getTileRangeForExtentAndZ(e,t);for(let n=r.minX,i=r.maxX;n<=i;++n)for(let e=r.minY,i=r.maxY;e<=i;++e)o([t,n,e])},sC.prototype.forEachTileCoordParentTileRange=function(e,t,o,r,i){let n=null,a=e[0]-1,s,l,d;for(2===this.zoomFactor_?(l=e[1],d=e[2]):n=this.getTileCoordExtent(e,i);a>=this.minZoom;){if(2===this.zoomFactor_?(l=Bl(l/2),d=Bl(d/2),s=rn(l,l,d,d,r)):s=this.getTileRangeForExtentAndZ(n,a,r),t.call(o,a,s))return!0;--a}return!1},sC.prototype.getExtent=function(){return this.extent_},sC.prototype.getMaxZoom=function(){return this.maxZoom},sC.prototype.getMinZoom=function(){return this.minZoom},sC.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]},sC.prototype.getResolution=function(e){return this.resolutions_[e]},sC.prototype.getResolutions=function(){return this.resolutions_},sC.prototype.getTileCoordChildTileRange=function(e,t,o){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){const o=2*e[1],r=2*e[2];return rn(o,o+1,r,r+1,t)}const r=this.getTileCoordExtent(e,o);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null},sC.prototype.getTileRangeExtent=function(e,t,o){const r=this.getOrigin(e),i=this.getResolution(e),n=Nr(this.getTileSize(e),this.tmpSize_),a=r[0]+t.minX*n[0]*i,s=r[0]+(t.maxX+1)*n[0]*i,l=r[1]+t.minY*n[1]*i,d=r[1]+(t.maxY+1)*n[1]*i;return G(a,l,s,d,o)},sC.prototype.getTileRangeForExtentAndZ=function(e,t,o){const r=lC;this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,r);const i=r[1],n=r[2];return this.getTileCoordForXYAndZ_(e[2],e[3],t,!0,r),rn(i,r[1],n,r[2],o)},sC.prototype.getTileCoordCenter=function(e){const t=this.getOrigin(e[0]),o=this.getResolution(e[0]),r=Nr(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*o,t[1]+(e[2]+.5)*r[1]*o]},sC.prototype.getTileCoordExtent=function(e,t){const o=this.getOrigin(e[0]),r=this.getResolution(e[0]),i=Nr(this.getTileSize(e[0]),this.tmpSize_),n=o[0]+e[1]*i[0]*r,a=o[1]+e[2]*i[1]*r,s=n+i[0]*r,l=a+i[1]*r;return G(n,a,s,l,t)},sC.prototype.getTileCoordForCoordAndResolution=function(e,t,o){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,o)},sC.prototype.getTileCoordForXYAndResolution_=function(e,t,o,r,i){const n=this.getZForResolution(o),a=o/this.getResolution(n),s=this.getOrigin(n),l=Nr(this.getTileSize(n),this.tmpSize_),d=r?.5:0,p=r?0:.5,g=Bl((e-s[0])/o+d),_=Bl((t-s[1])/o+p);let u=a*g/l[0],c=a*_/l[1];return r?(u=rd(u)-1,c=rd(c)-1):(u=Bl(u),c=Bl(c)),il(n,u,c,i)},sC.prototype.getTileCoordForXYAndZ_=function(e,t,o,r,i){const n=this.getOrigin(o),a=this.getResolution(o),s=Nr(this.getTileSize(o),this.tmpSize_),l=r?.5:0,d=r?0:.5,p=Bl((e-n[0])/a+l),g=Bl((t-n[1])/a+d);let _=p/s[0],u=g/s[1];return r?(_=rd(_)-1,u=rd(u)-1):(_=Bl(_),u=Bl(u)),il(o,_,u,i)},sC.prototype.getTileCoordForCoordAndZ=function(e,t,o){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,o)},sC.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]},sC.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]},sC.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:null},sC.prototype.getZForResolution=function(e,t){const o=Ut(this.resolutions_,e,t||0);return me(o,this.minZoom,this.maxZoom)},sC.prototype.calculateTileRanges_=function(e){const t=this.resolutions_.length,o=Array(t);for(let r=this.minZoom;r<t;++r)o[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=o};var dC=sC;const pC=function(e){_c.call(this,{attributions:e.attributions,extent:e.extent,projection:e.projection,state:e.state,wrapX:e.wrapX}),this.opaque_=e.opaque!==void 0&&e.opaque,this.tilePixelRatio_=e.tilePixelRatio===void 0?1:e.tilePixelRatio,this.tileGrid=e.tileGrid===void 0?null:e.tileGrid,this.tileCache=new oC(e.cacheSize),this.tmpSize=[0,0],this.key_='',this.tileOptions={transition:e.transition}};i(pC,_c),pC.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},pC.prototype.expireCache=function(e,t){const o=this.getTileCacheForProjection(e);o&&o.expireCache(t)},pC.prototype.forEachLoadedTile=function(e,t,o,r){const i=this.getTileCacheForProjection(e);if(!i)return!1;let n=!0,a,s,l;for(let d=o.minX;d<=o.maxX;++d)for(let e=o.minY;e<=o.maxY;++e)s=nl(t,d,e),l=!1,i.containsKey(s)&&(a=i.get(s),l=a.getState()===Hg.LOADED,l&&(l=!1!==r(a))),l||(n=!1);return n},pC.prototype.getGutter=function(){return 0},pC.prototype.getKey=function(){return this.key_},pC.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},pC.prototype.getOpaque=function(){return this.opaque_},pC.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},pC.prototype.getTile=function(){},pC.prototype.getTileGrid=function(){return this.tileGrid},pC.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:El(e)},pC.prototype.getTileCacheForProjection=function(e){const t=this.getProjection();return t&&!qe(t,e)?null:this.tileCache},pC.prototype.getTilePixelRatio=function(){return this.tilePixelRatio_},pC.prototype.getTilePixelSize=function(e,t,o){const r=this.getTileGridForProjection(o),i=this.getTilePixelRatio(t),n=Nr(r.getTileSize(e),this.tmpSize);return 1==i?n:wr(n,i,this.tmpSize)},pC.prototype.getTileCoordForTileUrlFunction=function(e,t){const o=void 0===t?this.getProjection():t,r=this.getTileGridForProjection(o);return this.getWrapX()&&o.isGlobal()&&(e=Tl(r,e,o)),pl(e,r)?e:null},pC.prototype.refresh=function(){this.tileCache.clear(),this.changed()},pC.prototype.useTile=T;const gC=function(e,t){Dd.call(this,e),this.tile=t};i(gC,Dd);var _C=pC,uC={TILELOADSTART:'tileloadstart',TILELOADEND:'tileloadend',TILELOADERROR:'tileloaderror'};const cC=function(e){_C.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition}),this.tileLoadFunction=e.tileLoadFunction,this.tileUrlFunction=this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):cl,this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),e.tileUrlFunction&&this.setTileUrlFunction(e.tileUrlFunction),this.tileLoadingKeys_={}};i(cC,_C),cC.prototype.fixedTileUrlFunction,cC.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},cC.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},cC.prototype.getUrls=function(){return this.urls},cC.prototype.handleTileChange=function(e){const t=e.target,o=n(t),r=t.getState();let i;r==Hg.LOADING?(this.tileLoadingKeys_[o]=!0,i=uC.TILELOADSTART):o in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[o],i=r==Hg.ERROR?uC.TILELOADERROR:r==Hg.LOADED||r==Hg.ABORT?uC.TILELOADEND:void 0),i!=void 0&&this.dispatchEvent(new gC(i,t))},cC.prototype.setTileLoadFunction=function(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()},cC.prototype.setTileUrlFunction=function(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),'undefined'==typeof t?this.changed():this.setKey(t)},cC.prototype.setUrl=function(e){const t=this.urls=yl(e);this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):_l(t,this.tileGrid),e)},cC.prototype.setUrls=function(e){this.urls=e;const t=e.join('\n');this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):_l(e,this.tileGrid),t)},cC.prototype.useTile=function(e,t,o){const r=nl(e,t,o);this.tileCache.containsKey(r)&&this.tileCache.get(r)};var yC=cC;const mC=function(e){yC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Pl,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition}),this.crossOrigin=e.crossOrigin===void 0?null:e.crossOrigin,this.tileClass=e.tileClass===void 0?Qg:e.tileClass,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1};i(mC,yC),mC.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1},mC.prototype.expireCache=function(e,t){const o=this.getTileCacheForProjection(e);for(const r in this.tileCache.expireCache(this.tileCache==o?t:{}),this.tileCacheForProjection){const e=this.tileCacheForProjection[r];e.expireCache(e==o?t:{})}},mC.prototype.getGutter=function(e){return this.getProjection()&&e&&!qe(this.getProjection(),e)?0:this.getGutterInternal()},mC.prototype.getGutterInternal=function(){return 0},mC.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!qe(this.getProjection(),e))&&yC.prototype.getOpaque.call(this,e)},mC.prototype.getTileGridForProjection=function(e){const t=this.getProjection();if(this.tileGrid&&(!t||qe(t,e)))return this.tileGrid;else{const t=n(e).toString();return t in this.tileGridForProjection||(this.tileGridForProjection[t]=El(e)),this.tileGridForProjection[t]}},mC.prototype.getTileCacheForProjection=function(e){const t=this.getProjection();if(!t||qe(t,e))return this.tileCache;else{const t=n(e).toString();return t in this.tileCacheForProjection||(this.tileCacheForProjection[t]=new oC(this.tileCache.highWaterMark)),this.tileCacheForProjection[t]}},mC.prototype.createTile_=function(e,t,o,r,i,n){const a=[e,t,o],s=this.getTileCoordForTileUrlFunction(a,i),l=s?this.tileUrlFunction(s,r,i):void 0,d=new this.tileClass(a,void 0===l?Hg.EMPTY:Hg.IDLE,void 0===l?'':l,this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=n,c(d,Yd.CHANGE,this.handleTileChange,this),d},mC.prototype.getTile=function(e,t,o,r,i){const n=this.getProjection();if(!n||!i||qe(n,i))return this.getTileInternal(e,t,o,r,n||i);else{const a=this.getTileCacheForProjection(i),s=[e,t,o];let l;const d=al(s);a.containsKey(d)&&(l=a.get(d));const p=this.getKey();if(l&&l.key==p)return l;else{const e=this.getTileGridForProjection(n),t=this.getTileGridForProjection(i),o=this.getTileCoordForTileUrlFunction(s,i),g=new aC(n,e,i,t,s,o,this.getTilePixelRatio(r),this.getGutterInternal(),function(e,t,o,r){return this.getTileInternal(e,t,o,r,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return g.key=p,l?(g.interimTile=l,g.refreshInterimChain(),a.replace(d,g)):a.set(d,g),g}}},mC.prototype.getTileInternal=function(e,t,o,r,i){let n=null;const a=nl(e,t,o),s=this.getKey();if(!this.tileCache.containsKey(a))n=this.createTile_(e,t,o,r,i,s),this.tileCache.set(a,n);else if(n=this.tileCache.get(a),n.key!=s){const l=n;n=this.createTile_(e,t,o,r,i,s),n.interimTile=l.getState()==Hg.IDLE?l.interimTile:l,n.refreshInterimChain(),this.tileCache.replace(a,n)}return n},mC.prototype.setRenderReprojectionEdges=function(e){if(this.renderReprojectionEdges_!=e){for(const t in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}},mC.prototype.setTileGridForProjection=function(e,t){{const o=Ve(e);if(o){const e=n(o).toString();e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}};var hC=mC;const fC=function(e){this.hidpi_=e.hidpi!==void 0&&e.hidpi,hC.call(this,{cacheSize:e.cacheSize,crossOrigin:'anonymous',opaque:!0,projection:Ve('EPSG:3857'),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:V_.LOADING,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:this.hidpi_?2:1,wrapX:!(e.wrapX!==void 0)||e.wrapX,transition:e.transition}),this.culture_=e.culture===void 0?'en-us':e.culture,this.maxZoom_=e.maxZoom===void 0?-1:e.maxZoom,this.apiKey_=e.key,this.imagerySet_=e.imagerySet;const t='https://dev.virtualearth.net/REST/v1/Imagery/Metadata/'+this.imagerySet_+'?uriScheme=https&include=ImageryProviders&key='+this.apiKey_+'&c='+this.culture_;ml(t,this.handleImageryMetadataResponse.bind(this),void 0,'jsonp')};i(fC,hC);fC.prototype.getApiKey=function(){return this.apiKey_},fC.prototype.getImagerySet=function(){return this.imagerySet_},fC.prototype.handleImageryMetadataResponse=function(e){if(200!=e.statusCode||'OK'!=e.statusDescription||'ValidCredentials'!=e.authenticationResultCode||1!=e.resourceSets.length||1!=e.resourceSets[0].resources.length)return void this.setState(V_.ERROR);const t=e.resourceSets[0].resources[0],o=-1==this.maxZoom_?t.zoomMax:this.maxZoom_,r=this.getProjection(),i=Ll(r),n=t.imageWidth==t.imageHeight?t.imageWidth:[t.imageWidth,t.imageHeight],a=Cl({extent:i,minZoom:t.zoomMin,maxZoom:o,tileSize:n/(this.hidpi_?2:1)});this.tileGrid=a;const s=this.culture_,l=this.hidpi_;if(this.tileUrlFunction=ul(t.imageUrlSubdomains.map(function(e){const o=[0,0,0],r=t.imageUrl.replace('{subdomain}',e).replace('{culture}',s);return function(e){if(!e)return;else{il(e[0],e[1],-e[2]-1,o);let t=r;return l&&(t+='&dpi=d1&device=mobile'),t.replace('{quadkey}',dl(o))}}})),t.imageryProviders){const e=Je(Ve('EPSG:4326'),this.getProjection());this.setAttributions(function(o){const r=[],n=o.viewState.zoom;return t.imageryProviders.map(function(t){let i=!1;const a=t.coverageAreas;for(let r=0,s=a.length;r<s;++r){const t=a[r];if(n>=t.zoomMin&&n<=t.zoomMax){const r=t.bbox,n=[r[1],r[0],r[3],r[2]],a=ge(n,e);if(ae(a,o.extent)){i=!0;break}}}i&&r.push(t.attribution)}),r.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html">Terms of Use</a>'),r})}this.setState(V_.READY)};const xC=function(e){const t=e||{},o=t.projection===void 0?'EPSG:3857':t.projection,r=t.tileGrid===void 0?Cl({extent:Ll(o),maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize}):t.tileGrid;hC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:t.opaque,projection:o,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:!(t.wrapX!==void 0)||t.wrapX,transition:t.transition})};i(xC,hC);var EC=xC;const TC=function(e){this.account_=e.account,this.mapId_=e.map||'',this.config_=e.config||{},this.templateCache_={},EC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom===void 0?18:e.maxZoom,minZoom:e.minZoom,projection:e.projection,state:V_.LOADING,wrapX:e.wrapX}),this.initializeMap_()};i(TC,EC),TC.prototype.getConfig=function(){return this.config_},TC.prototype.updateConfig=function(e){Ad(this.config_,e),this.initializeMap_()},TC.prototype.setConfig=function(e){this.config_=e||{},this.initializeMap_()},TC.prototype.initializeMap_=function(){const e=JSON.stringify(this.config_);if(this.templateCache_[e])return void this.applyTemplate_(this.templateCache_[e]);let t='https://'+this.account_+'.carto.com/api/v1/map';this.mapId_&&(t+='/named/'+this.mapId_);const o=new XMLHttpRequest;o.addEventListener('load',this.handleInitResponse_.bind(this,e)),o.addEventListener('error',this.handleInitError_.bind(this)),o.open('POST',t),o.setRequestHeader('Content-type','application/json'),o.send(JSON.stringify(this.config_))},TC.prototype.handleInitResponse_=function(e,t){const o=t.target;if(!o.status||200<=o.status&&300>o.status){let t;try{t=JSON.parse(o.responseText)}catch(e){return void this.setState(V_.ERROR)}this.applyTemplate_(t),this.templateCache_[e]=t,this.setState(V_.READY)}else this.setState(V_.ERROR)},TC.prototype.handleInitError_=function(){this.setState(V_.ERROR)},TC.prototype.applyTemplate_=function(e){const t='https://'+e.cdn_url.https+'/'+this.account_+'/api/v1/map/'+e.layergroupid+'/{z}/{x}/{y}.png';this.setUrl(t)};const SC=function(e){Ec.call(this,{attributions:e.attributions,extent:e.extent,projection:e.projection,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance===void 0?20:e.distance,this.features=[],this.geometryFunction=e.geometryFunction||function(e){const t=e.getGeometry();return R(t instanceof wg,10),t},this.source=e.source,c(this.source,Yd.CHANGE,this.refresh,this)};i(SC,Ec),SC.prototype.getDistance=function(){return this.distance},SC.prototype.getSource=function(){return this.source},SC.prototype.loadFeatures=function(e,t,o){this.source.loadFeatures(e,t,o),t!==this.resolution&&(this.clear(),this.resolution=t,this.cluster(),this.addFeatures(this.features))},SC.prototype.setDistance=function(e){this.distance=e,this.refresh()},SC.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features),Ec.prototype.refresh.call(this)},SC.prototype.cluster=function(){if(void 0===this.resolution)return;this.features.length=0;const e=b(),t=this.distance*this.resolution,o=this.source.getFeatures(),r={};for(let a=0,i=o.length;a<i;a++){const i=o[a];if(!(n(i).toString()in r)){const o=this.geometryFunction(i);if(o){const i=o.getCoordinates();k(i,e),P(e,t,e);let a=this.source.getFeaturesInExtent(e);a=a.filter(function(e){const t=n(e).toString();return!(t in r)&&(r[t]=!0,!0)}),this.features.push(this.createCluster(a))}}}},SC.prototype.createCluster=function(e){const t=[0,0];for(let o=e.length-1;0<=o;--o){const r=this.geometryFunction(e[o]);r?Xo(t,r.getCoordinates()):e.splice(o,1)}Qo(t,1/e.length);const o=new Cg(new wg(t));return o.set('features',e),o};const CC=function(e,t,o,r,i,n){this.targetProj_=t,this.maxSourceExtent_=e.getExtent();const a=t.getExtent(),s=a?oe(o,a):o,l=Q(s),d=hl(e,t,l,r);this.triangulation_=new nC(e,t,s,this.maxSourceExtent_,d*Yc),this.targetResolution_=r,this.targetExtent_=o;const p=this.triangulation_.calculateSourceExtent();this.sourceImage_=n(p,d,i),this.sourcePixelRatio_=this.sourceImage_?this.sourceImage_.getPixelRatio():1,this.canvas_=null,this.sourceListenerKey_=null;let g=Gp.LOADED;this.sourceImage_&&(g=Gp.IDLE),Xg.call(this,o,r,this.sourcePixelRatio_,g)};i(CC,Xg),CC.prototype.disposeInternal=function(){this.state==Gp.LOADING&&this.unlistenSource_(),Xg.prototype.disposeInternal.call(this)},CC.prototype.getImage=function(){return this.canvas_},CC.prototype.getProjection=function(){return this.targetProj_},CC.prototype.reproject_=function(){const e=this.sourceImage_.getState();if(e==Gp.LOADED){const e=ne(this.targetExtent_)/this.targetResolution_,t=te(this.targetExtent_)/this.targetResolution_;this.canvas_=xl(e,t,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=e,this.changed()},CC.prototype.load=function(){if(this.state==Gp.IDLE){this.state=Gp.LOADING,this.changed();const e=this.sourceImage_.getState();e==Gp.LOADED||e==Gp.ERROR?this.reproject_():(this.sourceListenerKey_=c(this.sourceImage_,Yd.CHANGE,function(){const e=this.sourceImage_.getState();(e==Gp.LOADED||e==Gp.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},CC.prototype.unlistenSource_=function(){h(this.sourceListenerKey_),this.sourceListenerKey_=null};const RC={IMAGELOADSTART:'imageloadstart',IMAGELOADEND:'imageloadend',IMAGELOADERROR:'imageloaderror'},IC=function(e,t){Dd.call(this,e),this.image=t};i(IC,Dd);const LC=function(e){_c.call(this,{attributions:e.attributions,extent:e.extent,projection:e.projection,state:e.state}),this.resolutions_=e.resolutions===void 0?null:e.resolutions,this.reprojectedImage_=null,this.reprojectedRevision_=0};i(LC,_c),LC.prototype.getResolutions=function(){return this.resolutions_},LC.prototype.findNearestResolution=function(e){if(this.resolutions_){const t=Ut(this.resolutions_,e,0);e=this.resolutions_[t]}return e},LC.prototype.getImage=function(e,t,o,r){const i=this.getProjection();if(!i||!r||qe(i,r))return i&&(r=i),this.getImageInternal(e,t,o,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&qe(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&j(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new CC(i,r,e,t,o,function(e,t,o){return this.getImageInternal(e,t,o,i)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_},LC.prototype.getImageInternal=function(){},LC.prototype.handleImageChange=function(e){const t=e.target;switch(t.getState()){case Gp.LOADING:this.dispatchEvent(new IC(RC.IMAGELOADSTART,t));break;case Gp.LOADED:this.dispatchEvent(new IC(RC.IMAGELOADEND,t));break;case Gp.ERROR:this.dispatchEvent(new IC(RC.IMAGELOADERROR,t));break;default:}};var PC=LC;const vC=function(e){const t=e||{};PC.call(this,{attributions:t.attributions,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin===void 0?null:t.crossOrigin,this.hidpi_=!(t.hidpi!==void 0)||t.hidpi,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction===void 0?vl:t.imageLoadFunction,this.params_=t.params||{},this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio===void 0?1.5:t.ratio};i(vC,PC),vC.prototype.getParams=function(){return this.params_},vC.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t),o=this.hidpi_?o:1;const i=this.image_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&w(i.getExtent(),e))return i;const n={F:'image',FORMAT:'PNG32',TRANSPARENT:!0};Ad(n,this.params_),e=e.slice();const a=(e[0]+e[2])/2,s=(e[1]+e[3])/2;if(1!=this.ratio_){const t=this.ratio_*ne(e)/2,o=this.ratio_*te(e)/2;e[0]=a-t,e[1]=s-o,e[2]=a+t,e[3]=s+o}const l=t/o,d=rd(ne(e)/l),p=rd(te(e)/l);e[0]=a-l*d/2,e[2]=a+l*d/2,e[1]=s-l*p/2,e[3]=s+l*p/2,this.imageSize_[0]=d,this.imageSize_[1]=p;const g=this.getRequestUrl_(e,this.imageSize_,o,r,n);return this.image_=new Kg(e,t,o,g,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),c(this.image_,Yd.CHANGE,this.handleImageChange,this),this.image_},vC.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},vC.prototype.getRequestUrl_=function(e,t,o,r,i){const n=r.getCode().split(':').pop();i.SIZE=t[0]+','+t[1],i.BBOX=e.join(','),i.BBOXSR=n,i.IMAGESR=n,i.DPI=Vl(90*o);const a=this.url_,s=a.replace(/MapServer\/?$/,'MapServer/export').replace(/ImageServer\/?$/,'ImageServer/exportImage');return s==a&&R(!1,50),Fl(s,i)},vC.prototype.getUrl=function(){return this.url_},vC.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},vC.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},vC.prototype.updateParams=function(e){Ad(this.params_,e),this.image_=null,this.changed()};const FC=function(e){PC.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio===void 0?1.5:e.ratio};i(FC,PC),FC.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t);let i=this.canvas_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&w(i.getExtent(),e))return i;e=e.slice(),de(e,this.ratio_);const n=ne(e)/t,a=te(e)/t,s=this.canvasFunction_(e,t,o,[n*o,a*o],r);return s&&(i=new Bc(e,t,o,s)),this.canvas_=i,this.renderedRevision_=this.getRevision(),i};const OC=function(e){PC.call(this,{projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin===void 0?null:e.crossOrigin,this.displayDpi_=e.displayDpi===void 0?96:e.displayDpi,this.params_=e.params||{},this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction===void 0?vl:e.imageLoadFunction,this.hidpi_=!(e.hidpi!==void 0)||e.hidpi,this.metersPerUnit_=e.metersPerUnit===void 0?1:e.metersPerUnit,this.ratio_=e.ratio===void 0?1:e.ratio,this.useOverlay_=e.useOverlay!==void 0&&e.useOverlay,this.image_=null,this.renderedRevision_=0};i(OC,PC),OC.prototype.getParams=function(){return this.params_},OC.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t),o=this.hidpi_?o:1;let i=this.image_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&w(i.getExtent(),e))return i;1!=this.ratio_&&(e=e.slice(),de(e,this.ratio_));const n=ne(e)/t,a=te(e)/t,s=[n*o,a*o];if(void 0!==this.url_){const n=this.getUrl(this.url_,this.params_,e,s,r);i=new Kg(e,t,o,n,this.crossOrigin_,this.imageLoadFunction_),c(i,Yd.CHANGE,this.handleImageChange,this)}else i=null;return this.image_=i,this.renderedRevision_=this.getRevision(),i},OC.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},OC.prototype.updateParams=function(e){Ad(this.params_,e),this.changed()},OC.prototype.getUrl=function(e,t,o,r){const i=Ol(o,r,this.metersPerUnit_,this.displayDpi_),n=Q(o),a={OPERATION:this.useOverlay_?'GETDYNAMICMAPOVERLAYIMAGE':'GETMAPIMAGE',VERSION:'2.0.0',LOCALE:'en',CLIENTAGENT:'ol/source/ImageMapGuide source',CLIP:'1',SETDISPLAYDPI:this.displayDpi_,SETDISPLAYWIDTH:Vl(r[0]),SETDISPLAYHEIGHT:Vl(r[1]),SETVIEWSCALE:i,SETVIEWCENTERX:n[0],SETVIEWCENTERY:n[1]};return Ad(a,t),Fl(e,a)},OC.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()};const wC=function(e){const t=e.imageExtent,o=e.crossOrigin===void 0?null:e.crossOrigin,r=e.imageLoadFunction===void 0?vl:e.imageLoadFunction;PC.call(this,{attributions:e.attributions,projection:Ve(e.projection)}),this.image_=new Kg(t,void 0,1,e.url,o,r),this.imageSize_=e.imageSize?e.imageSize:null,c(this.image_,Yd.CHANGE,this.handleImageChange,this)};i(wC,PC),wC.prototype.getImageInternal=function(e){return ae(e,this.image_.getExtent())?this.image_:null},wC.prototype.handleImageChange=function(e){if(this.image_.getState()==Gp.LOADED){const e=this.image_.getExtent(),t=this.image_.getImage();let o,r;this.imageSize_?(o=this.imageSize_[0],r=this.imageSize_[1]):(o=t.width,r=t.height);const i=te(e)/r,n=rd(ne(e)/i);if(n!=o){const e=Tt(n,r),i=e.canvas;e.drawImage(t,0,0,o,r,0,0,i.width,i.height),this.image_.setImage(i)}}PC.prototype.handleImageChange.call(this,e)};const NC='1.3.0';var AC={CARMENTA_SERVER:'carmentaserver',GEOSERVER:'geoserver',MAPSERVER:'mapserver',QGIS:'qgis'};const bC=function(e){const t=e||{};PC.call(this,{attributions:t.attributions,projection:t.projection,resolutions:t.resolutions}),this.crossOrigin_=t.crossOrigin===void 0?null:t.crossOrigin,this.url_=t.url,this.imageLoadFunction_=t.imageLoadFunction===void 0?vl:t.imageLoadFunction,this.params_=t.params||{},this.v13_=!0,this.updateV13_(),this.serverType_=t.serverType,this.hidpi_=!(t.hidpi!==void 0)||t.hidpi,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=t.ratio===void 0?1.5:t.ratio};i(bC,PC);const MC=[101,101];bC.prototype.getGetFeatureInfoUrl=function(e,t,o,r){if(void 0!==this.url_){const i=Ve(o),n=this.getProjection();n&&n!==i&&(t=hl(n,i,e,t),e=$e(e,i,n));const a=ee(e,t,0,MC),s={SERVICE:'WMS',VERSION:NC,REQUEST:'GetFeatureInfo',FORMAT:'image/png',TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Ad(s,this.params_,r);const l=Bl((e[0]-a[0])/t),d=Bl((a[3]-e[1])/t);return s[this.v13_?'I':'X']=l,s[this.v13_?'J':'Y']=d,this.getRequestUrl_(a,MC,1,n||i,s)}},bC.prototype.getParams=function(){return this.params_},bC.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t),1==o||this.hidpi_&&void 0!==this.serverType_||(o=1);const i=t/o,n=Q(e),a=rd(ne(e)/i),s=rd(te(e)/i),l=ee(n,i,0,[a,s]),d=rd(this.ratio_*ne(e)/i),p=rd(this.ratio_*te(e)/i),g=ee(n,i,0,[d,p]),_=this.image_;if(_&&this.renderedRevision_==this.getRevision()&&_.getResolution()==t&&_.getPixelRatio()==o&&w(_.getExtent(),l))return _;const u={SERVICE:'WMS',VERSION:NC,REQUEST:'GetMap',FORMAT:'image/png',TRANSPARENT:!0};Ad(u,this.params_),this.imageSize_[0]=Vl(ne(g)/i),this.imageSize_[1]=Vl(te(g)/i);const y=this.getRequestUrl_(g,this.imageSize_,o,r,u);return this.image_=new Kg(g,t,o,y,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),c(this.image_,Yd.CHANGE,this.handleImageChange,this),this.image_},bC.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},bC.prototype.getRequestUrl_=function(e,t,o,r,i){if(R(void 0!==this.url_,9),i[this.v13_?'CRS':'SRS']=r.getCode(),'STYLES'in this.params_||(i.STYLES=''),1!=o)switch(this.serverType_){case AC.GEOSERVER:const e=0|90*o+.5;'FORMAT_OPTIONS'in i?i.FORMAT_OPTIONS+=';dpi:'+e:i.FORMAT_OPTIONS='dpi:'+e;break;case AC.MAPSERVER:i.MAP_RESOLUTION=90*o;break;case AC.CARMENTA_SERVER:case AC.QGIS:i.DPI=90*o;break;default:R(!1,8);}i.WIDTH=t[0],i.HEIGHT=t[1];const n=r.getAxisOrientation();let a;return a=this.v13_&&'ne'==n.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,i.BBOX=a.join(','),Fl(this.url_,i)},bC.prototype.getUrl=function(){return this.url_},bC.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},bC.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},bC.prototype.updateParams=function(e){Ad(this.params_,e),this.updateV13_(),this.image_=null,this.changed()},bC.prototype.updateV13_=function(){const e=this.params_.VERSION||NC;this.v13_=0<=zo(e,'1.3')};const GC='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',DC=function(e){const t=e||{};let o=void 0===t.attributions?[GC]:t.attributions;const r=t.crossOrigin===void 0?'anonymous':t.crossOrigin,i=t.url===void 0?'https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png':t.url;EC.call(this,{attributions:o,cacheSize:t.cacheSize,crossOrigin:r,opaque:!(t.opaque!==void 0)||t.opaque,maxZoom:t.maxZoom===void 0?19:t.maxZoom,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:i,wrapX:t.wrapX})};i(DC,EC);var kC=o(5),UC=o.n(kC);const YC={BEFOREOPERATIONS:'beforeoperations',AFTEROPERATIONS:'afteroperations'},jC={PIXEL:'pixel',IMAGE:'image'},BC=function(e,t,o){Dd.call(this,e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=o};i(BC,Dd);const VC=function(e){this.worker_=null,this.operationType_=e.operationType===void 0?jC.PIXEL:e.operationType,this.threads_=e.threads===void 0?1:e.threads,this.renderers_=Al(e.sources);for(let t=0,o=this.renderers_.length;t<o;++t)c(this.renderers_[t],Yd.CHANGE,this.changed,this);this.tileQueue_=new N_(function(){return 1},this.changed.bind(this));const t=Nl(this.renderers_),o={};for(let r=0,i=t.length;r<i;++r)o[n(t[r].layer)]=t[r];this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:tt(),extent:null,focus:null,index:0,layerStates:o,layerStatesArray:t,pixelRatio:1,pixelToCoordinateTransform:tt(),postRenderFunctions:[],size:[0,0],skippedFeatureUids:{},tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{}},PC.call(this,{}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)};i(VC,PC),VC.prototype.setOperation=function(e,t){this.worker_=new kC.Processor({operation:e,imageOps:this.operationType_===jC.IMAGE,queue:1,lib:t,threads:this.threads_}),this.changed()},VC.prototype.updateFrameState_=function(e,t,o){const r=Ad({},this.frameState_);r.viewState=Ad({},r.viewState);const i=Q(e);r.extent=e.slice(),r.focus=i,r.size[0]=Vl(ne(e)/t),r.size[1]=Vl(te(e)/t),r.time=Date.now(),r.animate=!1;const n=r.viewState;return n.center=i,n.projection=o,n.resolution=t,r},VC.prototype.allSourcesReady_=function(){let e=!0,t;for(let o=0,r=this.renderers_.length;o<r;++o)if(t=this.renderers_[o].getLayer().getSource(),t.getState()!==V_.READY){e=!1;break}return e},VC.prototype.getImage=function(e,t,o,r){if(!this.allSourcesReady_())return null;const i=this.updateFrameState_(e,t,r);if(this.requestedFrameState_=i,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),r=this.renderedImageCanvas_.getExtent();t===o&&j(e,r)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),i.tileQueue.loadMoreTiles(16,16),i.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_},VC.prototype.processSources_=function(){const e=this.requestedFrameState_,t=this.renderers_.length,o=Array(t);for(let r=0;r<t;++r){const t=wl(this.renderers_[r],e,e.layerStatesArray[r]);if(t)o[r]=t;else return}const r={};this.dispatchEvent(new BC(YC.BEFOREOPERATIONS,e,r)),this.worker_.process(o,r,this.onWorkerComplete_.bind(this,e))},VC.prototype.onWorkerComplete_=function(e,t,o,r){if(t||!o)return;const i=e.extent,n=e.viewState.resolution;if(n!==this.requestedFrameState_.viewState.resolution||!j(i,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext('2d');else{const e=Vl(ne(i)/n),t=Vl(te(i)/n);a=Tt(e,t),this.renderedImageCanvas_=new Bc(i,n,1,a.canvas)}a.putImageData(o,0,0),this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new BC(YC.AFTEROPERATIONS,e,r))};let zC=null;VC.prototype.getImageInternal=function(){return null};const XC=['Map tiles by <a href="https://stamen.com/">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.',GC],WC={terrain:{extension:'jpg',opaque:!0},"terrain-background":{extension:'jpg',opaque:!0},"terrain-labels":{extension:'png',opaque:!1},"terrain-lines":{extension:'png',opaque:!1},"toner-background":{extension:'png',opaque:!0},toner:{extension:'png',opaque:!0},"toner-hybrid":{extension:'png',opaque:!1},"toner-labels":{extension:'png',opaque:!1},"toner-lines":{extension:'png',opaque:!1},"toner-lite":{extension:'png',opaque:!0},watercolor:{extension:'jpg',opaque:!0}},KC={terrain:{minZoom:4,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:1,maxZoom:16}},HC=function(e){const t=e.layer.indexOf('-'),o=-1==t?e.layer:e.layer.slice(0,t),r=KC[o],i=WC[e.layer],n=e.url===void 0?'https://stamen-tiles-{a-d}.a.ssl.fastly.net/'+e.layer+'/{z}/{x}/{y}.'+i.extension:e.url;EC.call(this,{attributions:XC,cacheSize:e.cacheSize,crossOrigin:'anonymous',maxZoom:e.maxZoom==void 0?r.maxZoom:e.maxZoom,minZoom:e.minZoom==void 0?r.minZoom:e.minZoom,opaque:i.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:n,wrapX:e.wrapX})};i(HC,EC);const ZC=function(e){const t=e||{};hC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:!(t.wrapX!==void 0)||t.wrapX,transition:t.transition}),this.params_=t.params||{},this.tmpExtent_=b(),this.setKey(this.getKeyForParams_())};i(ZC,hC),ZC.prototype.getKeyForParams_=function(){let e=0;const t=[];for(const o in this.params_)t[e++]=o+'-'+this.params_[o];return t.join('/')},ZC.prototype.getParams=function(){return this.params_},ZC.prototype.getRequestUrl_=function(e,t,o,r,i,n){const a=this.urls;if(!a)return;const s=i.getCode().split(':').pop();n.SIZE=t[0]+','+t[1],n.BBOX=o.join(','),n.BBOXSR=s,n.IMAGESR=s,n.DPI=Vl(n.DPI?n.DPI*r:90*r);let l;if(1==a.length)l=a[0];else{const t=Ce(ll(e),a.length);l=a[t]}const d=l.replace(/MapServer\/?$/,'MapServer/export').replace(/ImageServer\/?$/,'ImageServer/exportImage');return Fl(d,n)},ZC.prototype.getTilePixelRatio=function(e){return e},ZC.prototype.fixedTileUrlFunction=function(e,t,o){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(o)),r.getResolutions().length<=e[0])return;const i=r.getTileCoordExtent(e,this.tmpExtent_);let n=Nr(r.getTileSize(e[0]),this.tmpSize);1!=t&&(n=wr(n,t,this.tmpSize));const a={F:'image',FORMAT:'PNG32',TRANSPARENT:!0};return Ad(a,this.params_),this.getRequestUrl_(e,n,i,t,o,a)},ZC.prototype.updateParams=function(e){Ad(this.params_,e),this.setKey(this.getKeyForParams_())};const qC=function(e,t,o){qg.call(this,e,Hg.LOADED),this.tileSize_=t,this.text_=o,this.canvas_=null};i(qC,qg),qC.prototype.getImage=function(){if(this.canvas_)return this.canvas_;else{const e=this.tileSize_,t=Tt(e[0],e[1]);return t.strokeStyle='black',t.strokeRect(.5,.5,e[0]+.5,e[1]+.5),t.fillStyle='black',t.textAlign='center',t.textBaseline='middle',t.font='24px sans-serif',t.fillText(this.text_,e[0]/2,e[1]/2),this.canvas_=t.canvas,t.canvas}},qC.prototype.load=function(){};const JC=function(e){_C.call(this,{opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:!(e.wrapX!==void 0)||e.wrapX})};i(JC,_C),JC.prototype.getTile=function(e,t,o){const r=nl(e,t,o);if(this.tileCache.containsKey(r))return this.tileCache.get(r);else{const i=Nr(this.tileGrid.getTileSize(e)),n=[e,t,o],a=this.getTileCoordForTileUrlFunction(n),s=a?this.getTileCoordForTileUrlFunction(a).toString():'',l=new qC(n,i,s);return this.tileCache.set(r,l),l}};const QC=function(e){if(this.tileJSON_=null,hC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:Ve('EPSG:3857'),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:V_.LOADING,tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition}),!e.url)e.tileJSON?this.handleTileJSONResponse(e.tileJSON):R(!1,51);else if(e.jsonp)ml(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener('load',this.onXHRLoad_.bind(this)),t.addEventListener('error',this.onXHRError_.bind(this)),t.open('GET',e.url),t.send()}};i(QC,hC),QC.prototype.onXHRLoad_=function(e){const t=e.target;if(!t.status||200<=t.status&&300>t.status){let e;try{e=JSON.parse(t.responseText)}catch(e){return void this.handleTileJSONError()}this.handleTileJSONResponse(e)}else this.handleTileJSONError()},QC.prototype.onXHRError_=function(){this.handleTileJSONError()},QC.prototype.getTileJSON=function(){return this.tileJSON_},QC.prototype.handleTileJSONResponse=function(e){const t=Ve('EPSG:4326'),o=this.getProjection();let r;if(void 0!==e.bounds){const i=Je(t,o);r=ge(e.bounds,i)}const i=e.minzoom||0,n=e.maxzoom||22,a=Cl({extent:Ll(o),maxZoom:n,minZoom:i});if(this.tileGrid=a,this.tileUrlFunction=_l(e.tiles,a),void 0!==e.attribution&&!this.getAttributions()){const o=void 0===r?t.getExtent():r;this.setAttributions(function(t){return ae(o,t.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState(V_.READY)},QC.prototype.handleTileJSONError=function(){this.setState(V_.ERROR)};const $C=function(e,t,o,r,i,n){qg.call(this,e,t),this.src_=o,this.extent_=r,this.preemptive_=i,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=n};i($C,qg),$C.prototype.getImage=function(){return null},$C.prototype.getData=function(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),o=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Bl((1-o)*this.grid_.length)];if('string'!=typeof r)return null;let i=r.charCodeAt(Bl(t*r.length));93<=i&&i--,35<=i&&i--,i-=32;let n=null;if(i in this.keys_){const e=this.keys_[i];n=this.data_&&e in this.data_?this.data_[e]:e}return n},$C.prototype.forDataAtCoordinate=function(e,t,o,r){this.state==Hg.IDLE&&!0===r?(y(this,Yd.CHANGE,function(){t.call(o,this.getData(e))},this),this.loadInternal_()):!0===r?setTimeout(function(){t.call(o,this.getData(e))}.bind(this),0):t.call(o,this.getData(e))},$C.prototype.getKey=function(){return this.src_},$C.prototype.handleError_=function(){this.state=Hg.ERROR,this.changed()},$C.prototype.handleLoad_=function(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=Hg.EMPTY,this.changed()},$C.prototype.loadInternal_=function(){if(this.state==Hg.IDLE)if(this.state=Hg.LOADING,this.jsonp_)ml(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener('load',this.onXHRLoad_.bind(this)),e.addEventListener('error',this.onXHRError_.bind(this)),e.open('GET',this.src_),e.send()}},$C.prototype.onXHRLoad_=function(e){const t=e.target;if(!t.status||200<=t.status&&300>t.status){let e;try{e=JSON.parse(t.responseText)}catch(e){return void this.handleError_()}this.handleLoad_(e)}else this.handleError_()},$C.prototype.onXHRError_=function(){this.handleError_()},$C.prototype.load=function(){this.preemptive_&&this.loadInternal_()};const eR=function(e){if(_C.call(this,{projection:Ve('EPSG:3857'),state:V_.LOADING}),this.preemptive_=void 0===e.preemptive||e.preemptive,this.tileUrlFunction_=cl,this.template_=void 0,this.jsonp_=e.jsonp||!1,!e.url)e.tileJSON?this.handleTileJSONResponse(e.tileJSON):R(!1,51);else if(this.jsonp_)ml(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener('load',this.onXHRLoad_.bind(this)),t.addEventListener('error',this.onXHRError_.bind(this)),t.open('GET',e.url),t.send()}};i(eR,_C),eR.prototype.onXHRLoad_=function(e){const t=e.target;if(!t.status||200<=t.status&&300>t.status){let e;try{e=JSON.parse(t.responseText)}catch(e){return void this.handleTileJSONError()}this.handleTileJSONResponse(e)}else this.handleTileJSONError()},eR.prototype.onXHRError_=function(){this.handleTileJSONError()},eR.prototype.getTemplate=function(){return this.template_},eR.prototype.forDataAtCoordinateAndResolution=function(e,t,o,r){if(this.tileGrid){const i=this.tileGrid.getTileCoordForCoordAndResolution(e,t),n=this.getTile(i[0],i[1],i[2],1,this.getProjection());n.forDataAtCoordinate(e,o,null,r)}else!0===r?setTimeout(function(){o(null)},0):o(null)},eR.prototype.handleTileJSONError=function(){this.setState(V_.ERROR)},eR.prototype.handleTileJSONResponse=function(e){const t=Ve('EPSG:4326'),o=this.getProjection();let r;if(void 0!==e.bounds){const i=Je(t,o);r=ge(e.bounds,i)}const i=e.minzoom||0,n=e.maxzoom||22,a=Cl({extent:Ll(o),maxZoom:n,minZoom:i});this.tileGrid=a,this.template_=e.template;const s=e.grids;if(!s)return void this.setState(V_.ERROR);if(this.tileUrlFunction_=_l(s,a),void 0!==e.attribution){const o=void 0===r?t.getExtent():r;this.setAttributions(function(t){return ae(o,t.extent)?[e.attribution]:null})}this.setState(V_.READY)},eR.prototype.getTile=function(e,t,o,r,i){const n=nl(e,t,o);if(this.tileCache.containsKey(n))return this.tileCache.get(n);else{const a=[e,t,o],s=this.getTileCoordForTileUrlFunction(a,i),l=this.tileUrlFunction_(s,r,i),d=new $C(a,void 0===l?Hg.EMPTY:Hg.IDLE,void 0===l?'':l,this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);return this.tileCache.set(n,d),d}},eR.prototype.useTile=function(e,t,o){const r=nl(e,t,o);this.tileCache.containsKey(r)&&this.tileCache.get(r)};const tR=function(e){const t=e||{},o=t.params||{},r=!('TRANSPARENT'in o)||o.TRANSPARENT;hC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:!r,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:!(t.wrapX!==void 0)||t.wrapX,transition:t.transition}),this.gutter_=t.gutter===void 0?0:t.gutter,this.params_=o,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=!(t.hidpi!==void 0)||t.hidpi,this.tmpExtent_=b(),this.updateV13_(),this.setKey(this.getKeyForParams_())};i(tR,hC),tR.prototype.getGetFeatureInfoUrl=function(e,t,o,r){const i=Ve(o),n=this.getProjection();let a=this.getTileGrid();a||(a=this.getTileGridForProjection(i));const s=a.getTileCoordForCoordAndResolution(e,t);if(a.getResolutions().length<=s[0])return;let l=a.getResolution(s[0]),d=a.getTileCoordExtent(s,this.tmpExtent_),p=Nr(a.getTileSize(s[0]),this.tmpSize);const g=this.gutter_;0!==g&&(p=vr(p,g,this.tmpSize),d=P(d,l*g,d)),n&&n!==i&&(l=hl(n,i,e,l),d=et(d,i,n),e=$e(e,i,n));const _={SERVICE:'WMS',VERSION:NC,REQUEST:'GetFeatureInfo',FORMAT:'image/png',TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Ad(_,this.params_,r);const u=Bl((e[0]-d[0])/l),c=Bl((d[3]-e[1])/l);return _[this.v13_?'I':'X']=u,_[this.v13_?'J':'Y']=c,this.getRequestUrl_(s,p,d,1,n||i,_)},tR.prototype.getGutterInternal=function(){return this.gutter_},tR.prototype.getParams=function(){return this.params_},tR.prototype.getRequestUrl_=function(e,t,o,r,i,n){const a=this.urls;if(!a)return;if(n.WIDTH=t[0],n.HEIGHT=t[1],n[this.v13_?'CRS':'SRS']=i.getCode(),'STYLES'in this.params_||(n.STYLES=''),1!=r)switch(this.serverType_){case AC.GEOSERVER:const e=0|90*r+.5;'FORMAT_OPTIONS'in n?n.FORMAT_OPTIONS+=';dpi:'+e:n.FORMAT_OPTIONS='dpi:'+e;break;case AC.MAPSERVER:n.MAP_RESOLUTION=90*r;break;case AC.CARMENTA_SERVER:case AC.QGIS:n.DPI=90*r;break;default:R(!1,52);}const s=i.getAxisOrientation(),l=o;if(this.v13_&&'ne'==s.substr(0,2)){let e;e=o[0],l[0]=o[1],l[1]=e,e=o[2],l[2]=o[3],l[3]=e}n.BBOX=l.join(',');let d;if(1==a.length)d=a[0];else{const t=Ce(ll(e),a.length);d=a[t]}return Fl(d,n)},tR.prototype.getTilePixelRatio=function(e){return this.hidpi_&&this.serverType_!==void 0?e:1},tR.prototype.getKeyForParams_=function(){let e=0;const t=[];for(const o in this.params_)t[e++]=o+'-'+this.params_[o];return t.join('/')},tR.prototype.fixedTileUrlFunction=function(e,t,o){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(o)),r.getResolutions().length<=e[0])return;1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);const i=r.getResolution(e[0]);let n=r.getTileCoordExtent(e,this.tmpExtent_),a=Nr(r.getTileSize(e[0]),this.tmpSize);const s=this.gutter_;0!==s&&(a=vr(a,s,this.tmpSize),n=P(n,i*s,n)),1!=t&&(a=wr(a,t,this.tmpSize));const l={SERVICE:'WMS',VERSION:NC,REQUEST:'GetMap',FORMAT:'image/png',TRANSPARENT:!0};return Ad(l,this.params_),this.getRequestUrl_(e,a,n,t,o,l)},tR.prototype.updateParams=function(e){Ad(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())},tR.prototype.updateV13_=function(){const e=this.params_.VERSION||NC;this.v13_=0<=zo(e,'1.3')};const oR=function(e,t,o,r,i,n,a,s,l,d,p,g,_,u,y){if(qg.call(this,e,t,y),this.context_={},this.loader_,this.replayState_={},this.sourceTiles_=d,this.tileKeys=[],this.sourceRevision_=o,this.wrappedTileCoord=n,this.loadListenerKeys_=[],this.sourceTileListenerKeys_=[],n){const t=l.getTileCoordExtent(n),o=l.getResolution(e[0]),y=s.getZForResolution(o);s.forEachTileCoord(t,y,function(e){let n=oe(t,s.getTileCoordExtent(e));const l=s.getExtent();if(l&&(n=oe(n,l,n)),.5<=ne(n)/o&&.5<=te(n)/o){const t=e.toString();let o=d[t];if(!o){const n=a(e,p,g);o=d[t]=new _(e,void 0==n?Hg.EMPTY:Hg.IDLE,void 0==n?'':n,r,i),this.sourceTileListenerKeys_.push(c(o,Yd.CHANGE,u))}o.consumers++,this.tileKeys.push(t)}}.bind(this))}};i(oR,qg),oR.prototype.disposeInternal=function(){this.state=Hg.ABORT,this.changed(),this.interimTile&&this.interimTile.dispose();for(let e=0,t=this.tileKeys.length;e<t;++e){const t=this.tileKeys[e],o=this.getTile(t);o.consumers--,0==o.consumers&&(delete this.sourceTiles_[t],o.dispose())}this.tileKeys.length=0,this.sourceTiles_=null,this.loadListenerKeys_.forEach(h),this.loadListenerKeys_.length=0,this.sourceTileListenerKeys_.forEach(h),this.sourceTileListenerKeys_.length=0,qg.prototype.disposeInternal.call(this)},oR.prototype.getContext=function(e){const t=n(e).toString();return t in this.context_||(this.context_[t]=Tt()),this.context_[t]},oR.prototype.getImage=function(e){return-1==this.getReplayState(e).renderedTileRevision?null:this.getContext(e).canvas},oR.prototype.getReplayState=function(e){const t=n(e).toString();return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedRevision:-1,renderedTileRevision:-1}),this.replayState_[t]},oR.prototype.getKey=function(){return this.tileKeys.join('/')+'-'+this.sourceRevision_},oR.prototype.getTile=function(e){return this.sourceTiles_[e]},oR.prototype.load=function(){let e=0;const t={};this.state==Hg.IDLE&&this.setState(Hg.LOADING),this.state==Hg.LOADING&&this.tileKeys.forEach(function(o){const r=this.getTile(o);if(r.state==Hg.IDLE&&(r.setLoader(this.loader_),r.load()),r.state==Hg.LOADING){const o=c(r,Yd.CHANGE,function(){const o=r.getState();if(o==Hg.LOADED||o==Hg.ERROR){const i=n(r);o==Hg.ERROR?t[i]=!0:(--e,delete t[i]),0==e-Object.keys(t).length&&this.finishLoading_()}}.bind(this));this.loadListenerKeys_.push(o),++e}}.bind(this)),0==e-Object.keys(t).length&&setTimeout(this.finishLoading_.bind(this),0)},oR.prototype.finishLoading_=function(){let e=this.tileKeys.length,t=0;for(let o=e-1;0<=o;--o){const r=this.getTile(this.tileKeys[o]).getState();r!=Hg.LOADED&&--e,r==Hg.EMPTY&&++t}e==this.tileKeys.length?(this.loadListenerKeys_.forEach(h),this.loadListenerKeys_.length=0,this.setState(Hg.LOADED)):this.setState(t==this.tileKeys.length?Hg.EMPTY:Hg.ERROR)};const rR=function(e){const t=e.projection||'EPSG:3857',o=e.extent||Ll(t),r=e.tileGrid||Cl({extent:o,maxZoom:e.maxZoom||22,minZoom:e.minZoom,tileSize:e.tileSize||512});yC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize===void 0?128:e.cacheSize,extent:o,opaque:!1,projection:t,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Dl,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:!(e.wrapX!==void 0)||e.wrapX,transition:e.transition}),this.format_=e.format?e.format:null,this.sourceTiles_={},this.overlaps_=!(e.overlaps!=void 0)||e.overlaps,this.tileClass=e.tileClass?e.tileClass:Qy,this.tileGrids_={}};i(rR,yC),rR.prototype.getOverlaps=function(){return this.overlaps_},rR.prototype.clear=function(){this.tileCache.clear(),this.sourceTiles_={}},rR.prototype.getTile=function(e,t,o,r,i){const n=nl(e,t,o);if(this.tileCache.containsKey(n))return this.tileCache.get(n);else{const a=[e,t,o],s=this.getTileCoordForTileUrlFunction(a,i),l=new oR(a,null===s?Hg.EMPTY:Hg.IDLE,this.getRevision(),this.format_,this.tileLoadFunction,s,this.tileUrlFunction,this.tileGrid,this.getTileGridForProjection(i),this.sourceTiles_,r,i,this.tileClass,this.handleTileChange.bind(this),this.tileOptions);return this.tileCache.set(n,l),l}},rR.prototype.getTileGridForProjection=function(e){const t=e.getCode();let o=this.tileGrids_[t];if(!o){const r=this.tileGrid;o=this.tileGrids_[t]=Il(e,void 0,r?r.getTileSize(r.getMinZoom()):void 0)}return o},rR.prototype.getTilePixelRatio=function(e){return e},rR.prototype.getTilePixelSize=function(e,t,o){const r=this.getTileGridForProjection(o),i=Nr(r.getTileSize(e),this.tmpSize);return[Vl(i[0]*t),Vl(i[1]*t)]};var iR={KVP:'KVP',REST:'REST'};const nR=function(e){this.matrixIds_=e.matrixIds,dC.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})};i(nR,dC),nR.prototype.getMatrixId=function(e){return this.matrixIds_[e]},nR.prototype.getMatrixIds=function(){return this.matrixIds_};const aR=function(e){this.version_=e.version===void 0?'1.0.0':e.version,this.format_=e.format===void 0?'image/jpeg':e.format,this.dimensions_=e.dimensions===void 0?{}:e.dimensions,this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style;let t=e.urls;t===void 0&&e.url!==void 0&&(t=yl(e.url)),this.requestEncoding_=e.requestEncoding===void 0?iR.KVP:e.requestEncoding;const o=this.requestEncoding_,r=e.tileGrid,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};o==iR.KVP&&Ad(i,{Service:'WMTS',Request:'GetTile',Version:this.version_,Format:this.format_});const n=this.dimensions_;this.createFromWMTSTemplate_=function(e){return e=o==iR.KVP?Fl(e,i):e.replace(/\{(\w+?)\}/g,function(e,t){return t.toLowerCase()in i?i[t.toLowerCase()]:e}),function(t){if(!t)return;else{const i={TileMatrix:r.getMatrixId(t[0]),TileCol:t[1],TileRow:-t[2]-1};Ad(i,n);let a=e;return a=o==iR.KVP?Fl(a,i):a.replace(/\{(\w+?)\}/g,function(e,t){return i[t]}),a}}};const a=t&&0<t.length?ul(t.map(this.createFromWMTSTemplate_)):cl;hC.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:a,urls:t,wrapX:e.wrapX!==void 0&&e.wrapX,transition:e.transition}),this.setKey(this.getKeyForDimensions_())};i(aR,hC),aR.prototype.setUrls=function(e){this.urls=e;const t=e.join('\n');this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ul(e.map(this.createFromWMTSTemplate_.bind(this))),t)},aR.prototype.getDimensions=function(){return this.dimensions_},aR.prototype.getFormat=function(){return this.format_},aR.prototype.getLayer=function(){return this.layer_},aR.prototype.getMatrixSet=function(){return this.matrixSet_},aR.prototype.getRequestEncoding=function(){return this.requestEncoding_},aR.prototype.getStyle=function(){return this.style_},aR.prototype.getVersion=function(){return this.version_},aR.prototype.getKeyForDimensions_=function(){let e=0;const t=[];for(const o in this.dimensions_)t[e++]=o+'-'+this.dimensions_[o];return t.join('/')},aR.prototype.updateDimensions=function(e){Ad(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())};const sR={DEFAULT:'default',TRUNCATED:'truncated'},lR=function(e,t,o,r,i,n,a){Qg.call(this,t,o,r,i,n,a),this.zoomifyImage_=null,this.tileSize_=Nr(e.getTileSize(t[0]))};i(lR,Qg),lR.prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=Qg.prototype.getImage.call(this);if(this.state==Hg.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;else{const o=Tt(t[0],t[1]);return o.drawImage(e,0,0),this.zoomifyImage_=o.canvas,o.canvas}}else return e};const dR=function(e){const t=e||{},o=t.size,r=t.tierSizeCalculation===void 0?sR.DEFAULT:t.tierSizeCalculation,i=o[0],n=o[1],a=t.extent||[0,-o[1],o[0],0],s=[],l=t.tileSize||b_;let d=l;switch(r){case sR.DEFAULT:for(;i>d||n>d;)s.push([rd(i/d),rd(n/d)]),d+=d;break;case sR.TRUNCATED:for(let e=i,t=n;e>d||t>d;)s.push([rd(e/d),rd(t/d)]),e>>=1,t>>=1;break;default:R(!1,53);}s.push([1,1]),s.reverse();const p=[1],g=[0];for(let t=1,o=s.length;t<o;t++)p.push(1<<t),g.push(s[t-1][0]*s[t-1][1]+g[t-1]);p.reverse();const _=new dC({tileSize:l,extent:a,origin:re(a),resolutions:p});let u=t.url;u&&-1==u.indexOf('{TileGroup}')&&-1==u.indexOf('{tileIndex}')&&(u+='{TileGroup}/{z}-{x}-{y}.jpg');const c=yl(u),y=ul(c.map(function(e){return function(t){if(!t)return;else{const o=t[0],r=t[1],i=-t[2]-1,n=r+i*s[o][0],a=_.getTileSize(o),l=0|(n+g[o])/a,d={z:o,x:r,y:i,tileIndex:n,TileGroup:'TileGroup'+l};return e.replace(/\{(\w+?)\}/g,function(e,t){return d[t]})}}})),m=lR.bind(null,_);hC.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:m,tileGrid:_,tileUrlFunction:y,transition:t.transition})};i(dR,hC);const pR=window.ol={};pR.color={},pR.colorlike={},pR.control={},pR.coordinate={},pR.easing={},pR.events={},pR.events.condition={},pR.extent={},pR.featureloader={},pR.format={},pR.format.filter={},pR.geom={},pR.has={},pR.interaction={},pR.layer={},pR.loadingstrategy={},pR.proj={},pR.proj.Units={},pR.proj.proj4={},pR.render={},pR.render.canvas={},pR.renderer={},pR.renderer.canvas={},pR.renderer.webgl={},pR.size={},pR.source={},pR.sphere={},pR.style={},pR.style.IconImageCache={},pR.tilegrid={},pR.xml={},pR.Collection=qd,pR.Feature=Cg,pR.Geolocation=bg,pR.Graticule=Vg,pR.Kinetic=e_,pR.Map=Ky,pR.Object=Wd,pR.Observable=Bd,pR.Observable.unByKey=function(e){if(Array.isArray(e))for(let t=0,o=e.length;t<o;++t)h(e[t]);else h(e)},pR.Overlay=Jy,pR.PluggableMap=H_,pR.View=U_,pR.WebGLMap=Nh,pR.color.asArray=yt,pR.color.asString=ut,pR.colorlike.asColorLike=xt,pR.control.Attribution=eu,pR.control.Attribution.render=Mr,pR.control.Control=q_,pR.control.FullScreen=tm,pR.control.MousePosition=Mh,pR.control.MousePosition.render=wn,pR.control.OverviewMap=im,pR.control.OverviewMap.render=Sn,pR.control.Rotate=ou,pR.control.Rotate.render=Gr,pR.control.ScaleLine=lm,pR.control.ScaleLine.render=Cn,pR.control.Zoom=iu,pR.control.ZoomSlider=pm,pR.control.ZoomSlider.render=Rn,pR.control.ZoomToExtent=gm,pR.control.defaults=Dr,pR.coordinate.add=Xo,pR.coordinate.createStringXY=function(e){return function(t){return or(t,e)}},pR.coordinate.format=Zo,pR.coordinate.rotate=Jo,pR.coordinate.toStringHDMS=function(e,t){return e?Ho('NS',e[1],t)+' '+Ho('EW',e[0],t):''},pR.coordinate.toStringXY=or,pR.easing.easeIn=pr,pR.easing.easeOut=gr,pR.easing.inAndOut=_r,pR.easing.linear=ur,pR.easing.upAndDown=function(e){return .5>e?_r(2*e):1-_r(2*(e-.5))},pR.events.condition.altKeyOnly=pu,pR.events.condition.altShiftKeysOnly=gu,pR.events.condition.always=_u,pR.events.condition.click=function(e){return e.type==n_.CLICK},pR.events.condition.doubleClick=function(e){return e.type==n_.DBLCLICK},pR.events.condition.focus=function(e){return e.target.getTargetElement()===document.activeElement},pR.events.condition.mouseOnly=Eu,pR.events.condition.never=cu,pR.events.condition.noModifierKeys=hu,pR.events.condition.platformModifierKeyOnly=function(e){const t=e.originalEvent;return!t.altKey&&(vp?t.metaKey:t.ctrlKey)&&!t.shiftKey},pR.events.condition.pointerMove=yu,pR.events.condition.primaryAction=Tu,pR.events.condition.shiftKeyOnly=fu,pR.events.condition.singleClick=mu,pR.events.condition.targetNotEditable=xu,pR.extent.applyTransform=ge,pR.extent.boundingExtent=I,pR.extent.buffer=P,pR.extent.containsCoordinate=O,pR.extent.containsExtent=w,pR.extent.containsXY=N,pR.extent.createEmpty=b,pR.extent.equals=j,pR.extent.extend=B,pR.extent.getArea=H,pR.extent.getBottomLeft=q,pR.extent.getBottomRight=J,pR.extent.getCenter=Q,pR.extent.getHeight=te,pR.extent.getIntersection=oe,pR.extent.getSize=function(e){return[e[2]-e[0],e[3]-e[1]]},pR.extent.getTopLeft=re,pR.extent.getTopRight=ie,pR.extent.getWidth=ne,pR.extent.intersects=ae,pR.extent.isEmpty=se,pR.featureloader.xhr=Ei,pR.format.EsriJSON=Bh,pR.format.Feature=Dh,pR.format.GML=tf,pR.format.GML2=nf,pR.format.GML3=ef,pR.format.GPX=af,pR.format.GeoJSON=Nf,pR.format.IGC=kf,pR.format.KML=dx,pR.format.MVT=IE,pR.format.OSMXML=LE,pR.format.Polyline=wE,pR.format.Polyline.decodeDeltas=Es,pR.format.Polyline.decodeFloats=Ss,pR.format.Polyline.encodeDeltas=xs,pR.format.Polyline.encodeFloats=Ts,pR.format.TopoJSON=NE,pR.format.WFS=FT,pR.format.WFS.writeFilter=function(e){const t=Un(IT,'Filter');return ks(t,e,[]),t},pR.format.WKT=BT,pR.format.WMSCapabilities=ZT,pR.format.WMSGetFeatureInfo=cS,pR.format.WMTSCapabilities=wS,pR.format.filter.Bbox=jE,pR.format.filter.Contains=XE,pR.format.filter.During=ZE,pR.format.filter.EqualTo=$E,pR.format.filter.GreaterThan=tT,pR.format.filter.GreaterThanOrEqualTo=rT,pR.format.filter.Intersects=nT,pR.format.filter.IsBetween=sT,pR.format.filter.IsLike=dT,pR.format.filter.IsNull=gT,pR.format.filter.LessThan=uT,pR.format.filter.LessThanOrEqualTo=yT,pR.format.filter.Not=hT,pR.format.filter.NotEqualTo=xT,pR.format.filter.Or=Or,pR.format.filter.Within=ST,pR.format.filter.and=bs,pR.format.filter.bbox=Ms,pR.format.filter.between=function(e,t,o){return new sT(e,t,o)},pR.format.filter.contains=function(e,t,o){return new XE(e,t,o)},pR.format.filter.during=function(e,t,o){return new ZE(e,t,o)},pR.format.filter.equalTo=function(e,t,o){return new $E(e,t,o)},pR.format.filter.greaterThan=function(e,t){return new tT(e,t)},pR.format.filter.greaterThanOrEqualTo=function(e,t){return new rT(e,t)},pR.format.filter.intersects=function(e,t,o){return new nT(e,t,o)},pR.format.filter.isNull=function(e){return new gT(e)},pR.format.filter.lessThan=function(e,t){return new uT(e,t)},pR.format.filter.lessThanOrEqualTo=function(e,t){return new yT(e,t)},pR.format.filter.like=function(e,t,o,r,i,n){return new dT(e,t,o,r,i,n)},pR.format.filter.not=function(e){return new hT(e)},pR.format.filter.notEqualTo=function(e,t,o){return new xT(e,t,o)},pR.format.filter.or=function(){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Or,e))},pR.format.filter.within=function(e,t,o){return new ST(e,t,o)},pR.geom.Circle=Qu,pR.geom.Geometry=Ep,pR.geom.GeometryCollection=wf,pR.geom.LineString=Gg,pR.geom.LinearRing=Fg,pR.geom.MultiLineString=ec,pR.geom.MultiPoint=oc,pR.geom.MultiPolygon=ic,pR.geom.Point=wg,pR.geom.Polygon=Ag,pR.geom.Polygon.circular=Uo,pR.geom.Polygon.fromCircle=jo,pR.geom.Polygon.fromExtent=Yo,pR.geom.SimpleGeometry=Pg,pR.has.DEVICE_PIXEL_RATIO=Fp,pR.has.GEOLOCATION=wp,pR.has.TOUCH=Np,pR.has.WEBGL=Mp,pR.inherits=i,pR.interaction.DoubleClickZoom=du,pR.interaction.DragAndDrop=Zu,pR.interaction.DragBox=Nu,pR.interaction.DragPan=Iu,pR.interaction.DragRotate=Pu,pR.interaction.DragRotateAndZoom=qu,pR.interaction.DragZoom=bu,pR.interaction.Draw=Rc,pR.interaction.Draw.createBox=function(){return function(e,t){const o=I(e),r=t||new Ag(null);return r.setCoordinates([[q(o),J(o),ie(o),re(o),q(o)]]),r}},pR.interaction.Draw.createRegularPolygon=function(e,t){return function(o,r){const i=o[0],n=o[1],a=ed($o(i,n)),s=r?r:jo(new Qu(i),e),l=t?t:zl((n[1]-i[1])/(n[0]-i[0]));return Bo(s,i,a,l),s}},pR.interaction.Draw.handleEvent=Ci,pR.interaction.Extent=Pc,pR.interaction.Interaction=su,pR.interaction.KeyboardPan=Du,pR.interaction.KeyboardZoom=Uu,pR.interaction.Modify=Oc,pR.interaction.MouseWheelZoom=Bu,pR.interaction.PinchRotate=zu,pR.interaction.PinchZoom=Wu,pR.interaction.Pointer=Cu,pR.interaction.Pointer.handleEvent=Kr,pR.interaction.Select=Mc,pR.interaction.Snap=Gc,pR.interaction.Translate=Uc,pR.interaction.defaults=$i,pR.layer.Base=B_,pR.layer.Group=W_,pR.layer.Heatmap=KS,pR.layer.Image=qS,pR.layer.Layer=Q_,pR.layer.Tile=$S,pR.layer.Vector=dc,pR.layer.VectorTile=eC,pR.loadingstrategy.all=Ti,pR.loadingstrategy.bbox=function(e){return[e]},pR.loadingstrategy.tile=function(e){return function(t,o){const r=e.getZForResolution(o),i=e.getTileRangeForExtentAndZ(t,r),n=[],a=[r,0,0];for(a[1]=i.minX;a[1]<=i.maxX;++a[1])for(a[2]=i.minY;a[2]<=i.maxY;++a[2])n.push(e.getTileCoordExtent(a));return n}},pR.proj.Projection=ap,pR.proj.Units.METERS_PER_UNIT=rp,pR.proj.addCoordinateTransforms=Ze,pR.proj.addEquivalentProjections=Xe,pR.proj.addProjection=je,pR.proj.equivalent=qe,pR.proj.fromLonLat=function(e,t){return $e(e,'EPSG:4326',t===void 0?'EPSG:3857':t)},pR.proj.get=Ve,pR.proj.getPointResolution=ze,pR.proj.getTransform=Qe,pR.proj.proj4.register=function(e){const t=Object.keys(e.defs),o=t.length;let r,i;for(r=0;r<o;++r){const o=t[r];if(!Ve(o)){const t=e.defs(o);je(new ap({code:o,axisOrientation:t.axis,metersPerUnit:t.to_meter,units:t.units}))}}for(r=0;r<o;++r){const n=t[r],a=Ve(n);for(i=0;i<o;++i){const o=t[i],r=Ve(o);if(!ke(n,o))if(e.defs[n]===e.defs[o])Xe([a,r]);else{const t=e(n,o);Ze(a,r,t.forward,t.inverse)}}}},pR.proj.toLonLat=function(e,t){const o=$e(e,void 0===t?'EPSG:3857':t,'EPSG:4326'),r=o[0];return(-180>r||180<r)&&(o[0]=Ce(r+180,360)-180),o},pR.proj.transform=$e,pR.proj.transformExtent=et,pR.render.VectorContext=Wc,pR.render.canvas.labelCache=og,pR.render.toContext=function(e,t){const o=e.canvas,r=t?t:{},i=r.pixelRatio||Fp,n=r.size;n&&(o.width=n[0]*i,o.height=n[1]*i,o.style.width=n[0]+'px',o.style.height=n[1]+'px');const a=[0,0,o.width,o.height],s=lt(tt(),i,i);return new Hc(e,i,a,s,0)},pR.renderer.canvas.ImageLayer=oy,pR.renderer.canvas.Map=ly,pR.renderer.canvas.TileLayer=_y,pR.renderer.canvas.VectorLayer=Yy,pR.renderer.canvas.VectorTileLayer=Xy,pR.renderer.webgl.ImageLayer=Th,pR.renderer.webgl.Map=Rh,pR.renderer.webgl.TileLayer=Fh,pR.renderer.webgl.VectorLayer=wh,pR.size.toSize=Nr,pR.source.BingMaps=fC,pR.source.CartoDB=TC,pR.source.Cluster=SC,pR.source.Image=PC,pR.source.ImageArcGISRest=vC,pR.source.ImageCanvas=FC,pR.source.ImageMapGuide=OC,pR.source.ImageStatic=wC,pR.source.ImageWMS=bC,pR.source.OSM=DC,pR.source.OSM.ATTRIBUTION=GC,pR.source.Raster=VC,pR.source.Source=_c,pR.source.Stamen=HC,pR.source.Tile=_C,pR.source.TileArcGISRest=ZC,pR.source.TileDebug=JC,pR.source.TileImage=hC,pR.source.TileJSON=QC,pR.source.TileUTFGrid=eR,pR.source.TileWMS=tR,pR.source.Vector=Ec,pR.source.VectorTile=rR,pR.source.WMTS=aR,pR.source.WMTS.optionsFromCapabilities=Ul,pR.source.XYZ=EC,pR.source.Zoomify=dR,pR.sphere.getArea=Fe,pR.sphere.getDistance=Ie,pR.sphere.getLength=Pe,pR.style.AtlasManager=sh,pR.style.Circle=cg,pR.style.Fill=mg,pR.style.Icon=Kf,pR.style.IconImageCache.shared=iy,pR.style.Image=pg,pR.style.RegularShape=_g,pR.style.Stroke=fg,pR.style.Style=Tg,pR.style.Text=Yg,pR.tilegrid.TileGrid=dC,pR.tilegrid.WMTS=nR,pR.tilegrid.WMTS.createFromCapabilitiesMatrixSet=kl,pR.tilegrid.createXYZ=Cl,pR.xml.getAllTextContent=Yn,pR.xml.parse=Xn},function(e){var t=Math.floor;(function(t,o){e.exports=o()})(this,function(){'use strict';function e(r,a,l,d,p){for(;d>l;){if(600<d-l){var g=d-l+1,n=a-l+1,_=Math.log(g),u=.5*Math.exp(2*_/3),s=.5*Math.sqrt(_*u*(g-u)/g)*(0>n-g/2?-1:1),c=Math.max(l,t(a-n*u/g+s)),y=Math.min(d,t(a+(g-n)*u/g+s));e(r,a,c,y,p)}var m=r[a],h=l,i=d;for(o(r,l,a),0<p(r[d],m)&&o(r,l,d);h<i;){for(o(r,h,i),h++,i--;0>p(r[h],m);)h++;for(;0<p(r[i],m);)i--}0===p(r[l],m)?o(r,l,i):(i++,o(r,i,d)),i<=a&&(l=i+1),a<=i&&(d=i-1)}}function o(e,t,o){var r=e[t];e[t]=e[o],e[o]=r}function r(e,t){return e<t?-1:e>t?1:0}return function(t,o,i,n,a){e(t,o,i||0,n||t.length-1,a||r)}})},function(e,t,o){'use strict';function r(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}function i(e,t,o){var r=o.buf,i,n;if(n=r[o.pos++],i=(112&n)>>4,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<3,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<10,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<17,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(127&n)<<24,128>n)return a(e,i,t);if(n=r[o.pos++],i|=(1&n)<<31,128>n)return a(e,i,t);throw new Error('Expected varint not more than 10 bytes')}function n(e){return e.type===r.Bytes?e.readVarint()+e.pos:e.pos+1}function a(e,t,o){return o?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function s(e,t){var o,r;if(0<=e?(o=0|e%4294967296,r=0|e/4294967296):(o=~(-e%4294967296),r=~(-e/4294967296),4294967295^o?o=0|o+1:(o=0,r=0|r+1)),0x10000000000000000<=e||-0x10000000000000000>e)throw new Error('Given varint doesn\'t fit into 10 bytes');t.realloc(10),l(o,r,t),d(r,t)}function l(e,t,o){o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos++]=128|127&e,e>>>=7,o.buf[o.pos]=127&e}function d(e,t){var o=(7&e)<<4;(t.buf[t.pos++]|=o|((e>>>=3)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!!e)&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e))}function p(e,t,o){var r=16383>=t?1:2097151>=t?2:268435455>=t?3:Math.ceil(Math.log(t)/(7*Math.LN2));o.realloc(r);for(var n=o.pos-1;n>=e;n--)o.buf[n+r]=o.buf[n]}function g(e,t){for(var o=0;o<e.length;o++)t.writeVarint(e[o])}function _(e,t){for(var o=0;o<e.length;o++)t.writeSVarint(e[o])}function u(e,t){for(var o=0;o<e.length;o++)t.writeFloat(e[o])}function c(e,t){for(var o=0;o<e.length;o++)t.writeDouble(e[o])}function y(e,t){for(var o=0;o<e.length;o++)t.writeBoolean(e[o])}function m(e,t){for(var o=0;o<e.length;o++)t.writeFixed32(e[o])}function h(e,t){for(var o=0;o<e.length;o++)t.writeSFixed32(e[o])}function f(e,t){for(var o=0;o<e.length;o++)t.writeFixed64(e[o])}function x(e,t){for(var o=0;o<e.length;o++)t.writeSFixed64(e[o])}function E(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function T(e,t,o){e[o]=t,e[o+1]=t>>>8,e[o+2]=t>>>16,e[o+3]=t>>>24}function S(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function C(e,t,o){for(var r='',n=t;n<o;){var i=e[n],a=null,s=239<i?4:223<i?3:191<i?2:1;if(n+s>o)break;var l,d,p;1==s?128>i&&(a=i):2==s?(l=e[n+1],128==(192&l)&&(a=(31&i)<<6|63&l,127>=a&&(a=null))):3==s?(l=e[n+1],d=e[n+2],128==(192&l)&&128==(192&d)&&(a=(15&i)<<12|(63&l)<<6|63&d,(2047>=a||55296<=a&&57343>=a)&&(a=null))):4==s&&(l=e[n+1],d=e[n+2],p=e[n+3],128==(192&l)&&128==(192&d)&&128==(192&p)&&(a=(15&i)<<18|(63&l)<<12|(63&d)<<6|63&p,(65535>=a||1114112<=a)&&(a=null))),null===a?(a=65533,s=1):65535<a&&(a-=65536,r+=I(55296|1023&a>>>10),a=56320|1023&a),r+=I(a),n+=s}return r}function R(e,t,o){for(var r=0,i,n;r<t.length;r++){if(i=t.charCodeAt(r),!(55295<i&&57344>i))n&&(e[o++]=239,e[o++]=191,e[o++]=189,n=null);else if(!n){56319<i||r+1===t.length?(e[o++]=239,e[o++]=191,e[o++]=189):n=i;continue}else if(56320>i){e[o++]=239,e[o++]=191,e[o++]=189,n=i;continue}else i=65536|(n-55296<<10|i-56320),n=null;128>i?e[o++]=i:(2048>i?e[o++]=192|i>>6:(65536>i?e[o++]=224|i>>12:(e[o++]=240|i>>18,e[o++]=128|63&i>>12),e[o++]=128|63&i>>6),e[o++]=128|63&i)}return o}var I=String.fromCharCode,L=Math.floor;e.exports=r;var P=o(4);r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var v=4294967296,F=1/v;r.prototype={destroy:function(){this.buf=null},readFields:function(e,t,o){for(o=o||this.length;this.pos<o;){var r=this.readVarint(),i=this.pos;this.type=7&r,e(r>>3,t,this),this.pos===i&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=E(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=S(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=E(this.buf,this.pos)+E(this.buf,this.pos+4)*v;return this.pos+=8,e},readSFixed64:function(){var e=E(this.buf,this.pos)+S(this.buf,this.pos+4)*v;return this.pos+=8,e},readFloat:function(){var e=P.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=P.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,o,r;return(r=t[this.pos++],o=127&r,128>r)?o:(r=t[this.pos++],o|=(127&r)<<7,128>r)?o:(r=t[this.pos++],o|=(127&r)<<14,128>r)?o:(r=t[this.pos++],o|=(127&r)<<21,128>r)?o:(r=t[this.pos],o|=(15&r)<<28,i(o,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return 1==e%2?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=C(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var o=n(this);for(e=e||[];this.pos<o;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=n(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===r.Varint)for(;127<this.buf[this.pos++];);else if(t===r.Bytes)this.pos=this.readVarint()+this.pos;else if(t===r.Fixed32)this.pos+=4;else if(t===r.Fixed64)this.pos+=8;else throw new Error('Unimplemented type: '+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),T(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),T(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),T(this.buf,-1&e,this.pos),T(this.buf,L(e*F),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),T(this.buf,-1&e,this.pos),T(this.buf,L(e*F),this.pos+4),this.pos+=8},writeVarint:function(e){return(e=+e||0,268435455<e||0>e)?void s(e,this):void((this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),!(127>=e))&&(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),!(127>=e))&&(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),127>=e||(this.buf[this.pos++]=127&e>>>7)))},writeSVarint:function(e){this.writeVarint(0>e?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=e+'',this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=R(this.buf,e,this.pos);var o=this.pos-t;128<=o&&p(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(e){this.realloc(4),P.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),P.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=e[o]},writeRawMessage:function(e,t){this.pos++;var o=this.pos;e(t,this);var r=this.pos-o;128<=r&&p(o,r,this),this.pos=o-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,o){this.writeTag(e,r.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(e,t){this.writeMessage(e,g,t)},writePackedSVarint:function(e,t){this.writeMessage(e,_,t)},writePackedBoolean:function(e,t){this.writeMessage(e,y,t)},writePackedFloat:function(e,t){this.writeMessage(e,u,t)},writePackedDouble:function(e,t){this.writeMessage(e,c,t)},writePackedFixed32:function(e,t){this.writeMessage(e,m,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,h,t)},writePackedFixed64:function(e,t){this.writeMessage(e,f,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,x,t)},writeBytesField:function(e,t){this.writeTag(e,r.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,r.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,r.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,r.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,r.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,r.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,r.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}}},function(e,t){var o=Math.pow;t.read=function(t,r,n,a,l){var p=8*l-a-1,g=(1<<p)-1,_=g>>1,u=-7,c=n?l-1:0,i=n?-1:1,d=t[r+c],s,e;for(c+=i,s=d&(1<<-u)-1,d>>=-u,u+=p;0<u;s=256*s+t[r+c],c+=i,u-=8);for(e=s&(1<<-u)-1,s>>=-u,u+=a;0<u;e=256*e+t[r+c],c+=i,u-=8);if(0===s)s=1-_;else{if(s===g)return e?NaN:(d?-1:1)*Infinity;e+=o(2,a),s-=_}return(d?-1:1)*e*o(2,s-a)},t.write=function(t,r,n,a,l,p){var g=8*p-l-1,_=(1<<g)-1,u=_>>1,y=23===l?5.960464477539063e-8-6.617444900424222e-24:0,h=a?0:p-1,i=a?1:-1,d=0>r||0===r&&0>1/r?1:0,s,f,m;for(r=Math.abs(r),isNaN(r)||r===Infinity?(f=isNaN(r)?1:0,s=_):(s=Math.floor(Math.log(r)/Math.LN2),1>r*(m=o(2,-s))&&(s--,m*=2),r+=1<=s+u?y/m:y*o(2,1-u),2<=r*m&&(s++,m/=2),s+u>=_?(f=0,s=_):1<=s+u?(f=(r*m-1)*o(2,l),s+=u):(f=r*o(2,u-1)*o(2,l),s=0));8<=l;t[n+h]=255&f,h+=i,f/=256,l-=8);for(s=s<<l|f,g+=l;0<g;t[n+h]=255&s,h+=i,s/=256,g-=8);t[n+h-i]|=128*d}},function(e,t,o){var r=o(6);t.Processor=r},function(e,t,o){function r(e){function t(e,t,r){return o?new ImageData(e,t,r):{data:e,width:t,height:r}}var o=!0;try{new ImageData(10,10)}catch(e){o=!1}return function(o){var r=o.buffers,n=o.meta,a=o.imageOps,s=o.width,l=o.height,d=r.length,p=r[0].byteLength,g,_;if(a){var u=Array(d);for(_=0;_<d;++_)u[_]=t(new Uint8ClampedArray(r[_]),s,l);g=e(u,n).data}else{g=new Uint8ClampedArray(p);var c=Array(d),y=Array(d);for(_=0;_<d;++_)c[_]=new Uint8ClampedArray(r[_]),y[_]=[0,0,0,0];for(var m=0;m<p;m+=4){for(var i=0,h;i<d;++i)h=c[i],y[i][0]=h[m],y[i][1]=h[m+1],y[i][2]=h[m+2],y[i][3]=h[m+3];var f=e(y,n);g[m]=f[0],g[m+1]=f[1],g[m+2]=f[2],g[m+3]=f[3]}}return g.buffer}}function n(e,t){var o=Object.keys(e.lib||{}).map(function(t){return'var '+t+' = '+e.lib[t].toString()+';'}),i=o.concat(['var __minion__ = ('+r.toString()+')(',e.operation.toString(),');','self.addEventListener("message", function(event) {','  var buffer = __minion__(event.data);','  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);','});']),n=new Blob(i,{type:'text/javascript'}),a=URL.createObjectURL(n),s=new Worker(a);return s.addEventListener('message',t),s}function a(e,t){var o=r(e.operation);return{postMessage:function(e){setTimeout(function(){t({data:{buffer:o(e),meta:e.meta}})},0)}}}function i(e){this._imageOps=!!e.imageOps;var t=0===e.threads?0:this._imageOps?1:e.threads||1;var o=[];if(t)for(var r=0;r<t;++r)o[r]=n(e,this._onWorkerMessage.bind(this,r));else o[0]=a(e,this._onWorkerMessage.bind(this,0));this._workers=o,this._queue=[],this._maxQueueLength=e.queue||Infinity,this._running=0,this._dataLookup={},this._job=null}var s=Math.ceil,l=o(7).newImageData;i.prototype.process=function(e,t,o){this._enqueue({inputs:e,meta:t,callback:o}),this._dispatch()},i.prototype.destroy=function(){for(var e in this)this[e]=null;this._destroyed=!0},i.prototype._enqueue=function(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)},i.prototype._dispatch=function(){if(0===this._running&&0<this._queue.length){var e=this._job=this._queue.shift(),t=e.inputs[0].width,o=e.inputs[0].height,r=e.inputs.map(function(e){return e.data.buffer}),n=this._workers.length;if(this._running=n,1===n)this._workers[0].postMessage({buffers:r,meta:e.meta,imageOps:this._imageOps,width:t,height:o},r);else for(var a=e.inputs[0].data.length,l=4*s(a/4/n),d=0;d<n;++d){for(var i=d*l,p=[],g=0,_=r.length;g<_;++g)p.push(r[d].slice(i,i+l));this._workers[d].postMessage({buffers:p,meta:e.meta,imageOps:this._imageOps,width:t,height:o},p)}}},i.prototype._onWorkerMessage=function(e,t){this._destroyed||(this._dataLookup[e]=t.data,--this._running,0===this._running&&this._resolveJob())},i.prototype._resolveJob=function(){var e=this._job,t=this._workers.length,o,r;if(1===t)o=new Uint8ClampedArray(this._dataLookup[0].buffer),r=this._dataLookup[0].meta;else{var n=e.inputs[0].data.length;o=new Uint8ClampedArray(n),r=Array(n);for(var a=4*s(n/4/t),d=0;d<t;++d){var i=this._dataLookup[d].buffer,p=d*a;o.set(new Uint8ClampedArray(i),p),r[d]=this._dataLookup[d].meta}}this._job=null,this._dataLookup={},e.callback(null,l(o,e.inputs[0].width,e.inputs[0].height),r),this._dispatch()},e.exports=i},function(e,t){function o(e,t,o){if(r)return new ImageData(e,t,o);var n=i.createImageData(t,o);return n.data.set(e),n}var r=!0;try{new ImageData(10,10)}catch(e){r=!1}var i=document.createElement('canvas').getContext('2d');t.newImageData=o}]);